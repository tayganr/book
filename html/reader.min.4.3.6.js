/*!
 * HTML reader 4.3.6
 */

/*
 RequireJS 2.1.9 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

/*! jQuery v3.4.1 | (c) JS Foundation and other contributors | jquery.org/license */

/*!
 * @license EaselJS
 * Visit http://createjs.com/ for documentation, updates and examples.
 *
 * Copyright (c) 2011-2013 gskinner.com, inc.
 *
 * Distributed under the terms of the MIT license.
 * http://www.opensource.org/licenses/mit-license.html
 *
 * This notice shall be included in all copies or substantial portions of the Software.
 */

/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/

/*!
 * Bowser - a browser detector
 * https://github.com/ded/bowser
 * MIT License | (c) Dustin Diaz 2015
 */

/*!
 * @license TweenJS
 * Visit http://createjs.com/ for documentation, updates and examples.
 *
 * Copyright (c) 2011-2013 gskinner.com, inc.
 *
 * Distributed under the terms of the MIT license.
 * http://www.opensource.org/licenses/mit-license.html
 *
 * This notice shall be included in all copies or substantial portions of the Software.
 */

/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Modifications Copyright (c) 2017 YUDU Ltd.
 * Licensed under the MIT license */

/*! Copyright (c) 2013 Brandon Aaron (http://brandon.aaron.sh)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Version: 3.1.4
 *
 * Requires: 1.2.2+
 */

/*! Hammer.JS - v1.0.5 - 2013-04-07
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2013 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */

/*!
* @license SoundJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011-2015 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/

var requirejs,require,define;!function(Z){function H(t){return"[object Function]"===L.call(t)}function I(t){return"[object Array]"===L.call(t)}function y(t,e){if(t){var i;for(i=0;i<t.length&&(!t[i]||!e(t[i],i,t));i+=1);}}function M(t,e){if(t){var i;for(i=t.length-1;-1<i&&(!t[i]||!e(t[i],i,t));i-=1);}}function t(t,e){return ga.call(t,e)}function l(e,i){return t(e,i)&&e[i]}function F(e,i){for(var n in e)if(t(e,n)&&i(e[n],n))break}function Q(e,i,n,r){return i&&F(i,function(i,s){!n&&t(e,s)||(r&&"string"!=typeof i?(e[s]||(e[s]={}),Q(e[s],i,n,r)):e[s]=i)}),e}function u(t,e){return function(){return e.apply(t,arguments)}}function aa(t){throw t}function ba(t){if(!t)return t;var e=Z;return y(t.split("."),function(t){e=e[t]}),e}function A(t,e,i,n){return e=Error(e+"\nhttp://requirejs.org/docs/errors.html#"+t),e.requireType=t,e.requireModules=n,i&&(e.originalError=i),e}function ha(e){function i(t,e,i){var n,r,s,o,a,h,c,u=e&&e.split("/");n=u;var d=C.map,f=d&&d["*"];if(t&&"."===t.charAt(0))if(e){for(n=l(C.pkgs,e)?u=[e]:u.slice(0,u.length-1),e=t=n.concat(t.split("/")),n=0;e[n];n+=1)if("."===(r=e[n]))e.splice(n,1),n-=1;else if(".."===r){if(1===n&&(".."===e[2]||".."===e[0]))break;0<n&&(e.splice(n-1,2),n-=2)}n=l(C.pkgs,e=t[0]),t=t.join("/"),n&&t===e+"/"+n.main&&(t=e)}else 0===t.indexOf("./")&&(t=t.substring(2));if(i&&d&&(u||f)){for(e=t.split("/"),n=e.length;0<n;n-=1){if(s=e.slice(0,n).join("/"),u)for(r=u.length;0<r;r-=1)if((i=l(d,u.slice(0,r).join("/")))&&(i=l(i,s))){o=i,a=n;break}if(o)break;!h&&f&&l(f,s)&&(h=l(f,s),c=n)}!o&&h&&(o=h,a=c),o&&(e.splice(0,a,o),t=e.join("/"))}return t}function n(t){z&&y(document.getElementsByTagName("script"),function(e){if(e.getAttribute("data-requiremodule")===t&&e.getAttribute("data-requirecontext")===T.contextName)return e.parentNode.removeChild(e),!0})}function r(t){var e=l(C.paths,t);if(e&&I(e)&&1<e.length)return e.shift(),T.require.undef(t),T.require([t]),!0}function s(t){var e,i=t?t.indexOf("!"):-1;return-1<i&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function o(t,e,n,r){var o,a,h=null,c=e?e.name:null,u=t,d=!0,f="";return t||(d=!1,t="_@r"+(B+=1)),t=s(t),h=t[0],t=t[1],h&&(h=i(h,c,r),a=l(M,h)),t&&(h?f=a&&a.normalize?a.normalize(t,function(t){return i(t,c,r)}):i(t,c,r):(f=i(t,c,r),t=s(f),h=t[0],f=t[1],n=!0,o=T.nameToUrl(f))),n=!h||a||n?"":"_unnormalized"+(U+=1),{prefix:h,name:f,parentMap:e,unnormalized:!!n,url:o,originalName:u,isDefine:d,id:(h?h+"!"+f:f)+n}}function a(t){var e=t.id,i=l(E,e);return i||(i=E[e]=new T.Module(t)),i}function h(e,i,n){var r=e.id,s=l(E,r);!t(M,r)||s&&!s.defineEmitComplete?(s=a(e),s.error&&"error"===i?n(s.error):s.on(i,n)):"defined"===i&&n(M[r])}function c(t,e){var i=t.requireModules,n=!1;e?e(t):(y(i,function(e){(e=l(E,e))&&(e.error=t,e.events.error&&(n=!0,e.emit("error",t)))}),n||j.onError(t))}function d(){R.length&&(ia.apply(D,[D.length-1,0].concat(R)),R=[])}function f(t){delete E[t],delete k[t]}function g(t,e,i){var n=t.map.id;t.error?t.emit("error",t.error):(e[n]=!0,y(t.depMaps,function(n,r){var s=n.id,o=l(E,s);o&&!t.depMatched[r]&&!i[s]&&(l(e,s)?(t.defineDep(r,M[s]),t.check()):g(o,e,i))}),i[n]=!0)}function p(){var t,e,i,s,o=(i=1e3*C.waitSeconds)&&T.startTime+i<(new Date).getTime(),a=[],h=[],l=!1,u=!0;if(!_){if(_=!0,F(k,function(i){if(t=i.map,e=t.id,i.enabled&&(t.isDefine||h.push(i),!i.error))if(!i.inited&&o)r(e)?l=s=!0:(a.push(e),n(e));else if(!i.inited&&i.fetched&&t.isDefine&&(l=!0,!t.prefix))return u=!1}),o&&a.length)return i=A("timeout","Load timeout for modules: "+a,null,a),i.contextName=T.contextName,c(i);u&&y(h,function(t){g(t,{},{})}),o&&!s||!l||!z&&!da||S||(S=setTimeout(function(){S=0,p()},50)),_=!1}}function m(e){t(M,e[0])||a(o(e[0],null,!0)).init(e[1],e[2])}function v(t){var t=t.currentTarget||t.srcElement,e=T.onScriptLoad;return t.detachEvent&&!W?t.detachEvent("onreadystatechange",e):t.removeEventListener("load",e,!1),e=T.onScriptError,(!t.detachEvent||W)&&t.removeEventListener("error",e,!1),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function b(){var t;for(d();D.length;){if(t=D.shift(),null===t[0])return c(A("mismatch","Mismatched anonymous define() module: "+t[t.length-1]));m(t)}}var _,w,T,x,S,C={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},E={},k={},L={},D=[],M={},N={},B=1,U=1;return x={require:function(t){return t.require?t.require:t.require=T.makeRequire(t.map)},exports:function(t){if(t.usingExports=!0,t.map.isDefine)return t.exports?t.exports:t.exports=M[t.map.id]={}},module:function(t){return t.module?t.module:t.module={id:t.map.id,uri:t.map.url,config:function(){var e=l(C.pkgs,t.map.id);return(e?l(C.config,t.map.id+"/"+e.main):l(C.config,t.map.id))||{}},exports:M[t.map.id]}}},w=function(t){this.events=l(L,t.id)||{},this.map=t,this.shim=l(C.shim,t.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},w.prototype={init:function(t,e,i,n){n=n||{},this.inited||(this.factory=e,i?this.on("error",i):this.events.error&&(i=u(this,function(t){this.emit("error",t)})),this.depMaps=t&&t.slice(0),this.errback=i,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDep:function(t,e){this.depMatched[t]||(this.depMatched[t]=!0,this.depCount-=1,this.depExports[t]=e)},fetch:function(){if(!this.fetched){this.fetched=!0,T.startTime=(new Date).getTime();var t=this.map;if(!this.shim)return t.prefix?this.callPlugin():this.load();T.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],u(this,function(){return t.prefix?this.callPlugin():this.load()}))}},load:function(){var t=this.map.url;N[t]||(N[t]=!0,T.load(this.map.id,t))},check:function(){if(this.enabled&&!this.enabling){var t,e,i=this.map.id;e=this.depExports;var n=this.exports,r=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,1>this.depCount&&!this.defined){if(H(r)){if(this.events.error&&this.map.isDefine||j.onError!==aa)try{n=T.execCb(i,r,e,n)}catch(e){t=e}else n=T.execCb(i,r,e,n);if(this.map.isDefine&&((e=this.module)&&void 0!==e.exports&&e.exports!==this.exports?n=e.exports:void 0===n&&this.usingExports&&(n=this.exports)),t)return t.requireMap=this.map,t.requireModules=this.map.isDefine?[this.map.id]:null,t.requireType=this.map.isDefine?"define":"require",c(this.error=t)}else n=r;this.exports=n,this.map.isDefine&&!this.ignore&&(M[i]=n,j.onResourceLoad)&&j.onResourceLoad(T,this.map,this.depMaps),f(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var e=this.map,n=e.id,r=o(e.prefix);this.depMaps.push(r),h(r,"defined",u(this,function(r){var s,d;d=this.map.name;var g=this.map.parentMap?this.map.parentMap.name:null,p=T.makeRequire(e.parentMap,{enableBuildCallback:!0});this.map.unnormalized?(r.normalize&&(d=r.normalize(d,function(t){return i(t,g,!0)})||""),r=o(e.prefix+"!"+d,this.map.parentMap),h(r,"defined",u(this,function(t){this.init([],function(){return t},null,{enabled:!0,ignore:!0})})),(d=l(E,r.id))&&(this.depMaps.push(r),this.events.error&&d.on("error",u(this,function(t){this.emit("error",t)})),d.enable())):(s=u(this,function(t){this.init([],function(){return t},null,{enabled:!0})}),s.error=u(this,function(t){this.inited=!0,this.error=t,t.requireModules=[n],F(E,function(t){0===t.map.id.indexOf(n+"_unnormalized")&&f(t.map.id)}),c(t)}),s.fromText=u(this,function(i,r){var h=e.name,l=o(h),u=O;r&&(i=r),u&&(O=!1),a(l),t(C.config,n)&&(C.config[h]=C.config[n]);try{j.exec(i)}catch(t){return c(A("fromtexteval","fromText eval for "+n+" failed: "+t,t,[n]))}u&&(O=!0),this.depMaps.push(l),T.completeLoad(h),p([h],s)}),r.load(e.name,p,s,C))})),T.enable(r,this),this.pluginMaps[r.id]=r},enable:function(){k[this.map.id]=this,this.enabling=this.enabled=!0,y(this.depMaps,u(this,function(e,i){var n,r;if("string"==typeof e){if(e=o(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[i]=e,n=l(x,e.id))return void(this.depExports[i]=n(this));this.depCount+=1,h(e,"defined",u(this,function(t){this.defineDep(i,t),this.check()})),this.errback&&h(e,"error",u(this,this.errback))}n=e.id,r=E[n],!t(x,n)&&r&&!r.enabled&&T.enable(e,this)})),F(this.pluginMaps,u(this,function(t){var e=l(E,t.id);e&&!e.enabled&&T.enable(t,this)})),this.enabling=!1,this.check()},on:function(t,e){var i=this.events[t];i||(i=this.events[t]=[]),i.push(e)},emit:function(t,e){y(this.events[t],function(t){t(e)}),"error"===t&&delete this.events[t]}},T={config:C,contextName:e,registry:E,defined:M,urlFetched:N,defQueue:D,Module:w,makeModuleMap:o,nextTick:j.nextTick,onError:c,configure:function(t){t.baseUrl&&"/"!==t.baseUrl.charAt(t.baseUrl.length-1)&&(t.baseUrl+="/");var e=C.pkgs,i=C.shim,n={paths:!0,config:!0,map:!0};F(t,function(t,e){n[e]?"map"===e?(C.map||(C.map={}),Q(C[e],t,!0,!0)):Q(C[e],t,!0):C[e]=t}),t.shim&&(F(t.shim,function(t,e){I(t)&&(t={deps:t}),!t.exports&&!t.init||t.exportsFn||(t.exportsFn=T.makeShimExports(t)),i[e]=t}),C.shim=i),t.packages&&(y(t.packages,function(t){t="string"==typeof t?{name:t}:t,e[t.name]={name:t.name,location:t.location||t.name,main:(t.main||"main").replace(ja,"").replace(ea,"")}}),C.pkgs=e),F(E,function(t,e){!t.inited&&!t.map.unnormalized&&(t.map=o(e))}),(t.deps||t.callback)&&T.require(t.deps||[],t.callback)},makeShimExports:function(t){return function(){var e;return t.init&&(e=t.init.apply(Z,arguments)),e||t.exports&&ba(t.exports)}},makeRequire:function(r,s){function h(i,n,l){var u,d;return s.enableBuildCallback&&n&&H(n)&&(n.__requireJsBuild=!0),"string"==typeof i?H(n)?c(A("requireargs","Invalid require call"),l):r&&t(x,i)?x[i](E[r.id]):j.get?j.get(T,i,r,h):(u=o(i,r,!1,!0),u=u.id,t(M,u)?M[u]:c(A("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e+(r?"":". Use require([])")))):(b(),T.nextTick(function(){b(),d=a(o(null,r)),d.skipMap=s.skipMap,d.init(i,n,l,{enabled:!0}),p()}),h)}return s=s||{},Q(h,{isBrowser:z,toUrl:function(t){var e,n=t.lastIndexOf("."),s=t.split("/")[0];return-1!==n&&("."!==s&&".."!==s||1<n)&&(e=t.substring(n,t.length),t=t.substring(0,n)),T.nameToUrl(i(t,r&&r.id,!0),e,!0)},defined:function(e){return t(M,o(e,r,!1,!0).id)},specified:function(e){return e=o(e,r,!1,!0).id,t(M,e)||t(E,e)}}),r||(h.undef=function(t){d();var e=o(t,r,!0),i=l(E,t);n(t),delete M[t],delete N[e.url],delete L[t],i&&(i.events.defined&&(L[t]=i.events),f(t))}),h},enable:function(t){l(E,t.id)&&a(t).enable()},completeLoad:function(e){var i,n,s=l(C.shim,e)||{},o=s.exports;for(d();D.length;){if(n=D.shift(),null===n[0]){if(n[0]=e,i)break;i=!0}else n[0]===e&&(i=!0);m(n)}if(n=l(E,e),!i&&!t(M,e)&&n&&!n.inited){if(C.enforceDefine&&(!o||!ba(o)))return r(e)?void 0:c(A("nodefine","No define call for "+e,null,[e]));m([e,s.deps||[],s.exportsFn])}p()},nameToUrl:function(t,e,i){var n,r,s,o,a,h;if(j.jsExtRegExp.test(t))o=t+(e||"");else{for(n=C.paths,r=C.pkgs,o=t.split("/"),a=o.length;0<a;a-=1){if(h=o.slice(0,a).join("/"),s=l(r,h),h=l(n,h)){I(h)&&(h=h[0]),o.splice(0,a,h);break}if(s){t=t===s.name?s.location+"/"+s.main:s.location,o.splice(0,a,t);break}}o=o.join("/"),o+=e||(/^data\:|\?/.test(o)||i?"":".js"),o=("/"===o.charAt(0)||o.match(/^[\w\+\.\-]+:/)?"":C.baseUrl)+o}return C.urlArgs?o+(-1===o.indexOf("?")?"?":"&")+C.urlArgs:o},load:function(t,e){j.load(T,t,e)},execCb:function(t,e,i,n){return e.apply(n,i)},onScriptLoad:function(t){("load"===t.type||ka.test((t.currentTarget||t.srcElement).readyState))&&(P=null,t=v(t),T.completeLoad(t.id))},onScriptError:function(t){var e=v(t);if(!r(e.id))return c(A("scripterror","Script error for: "+e.id,t,[e.id]))}},T.require=T.makeRequire(),T}var j,w,x,C,J,D,P,K,q,fa,la=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,ma=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,ea=/\.js$/,ja=/^\.\//;w=Object.prototype;var L=w.toString,ga=w.hasOwnProperty,ia=Array.prototype.splice,z=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),da=!z&&"undefined"!=typeof importScripts,ka=z&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,W="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),E={},s={},R=[],O=!1;if(void 0===define){if(void 0!==requirejs){if(H(requirejs))return;s=requirejs,requirejs=void 0}void 0!==require&&!H(require)&&(s=require,require=void 0),j=requirejs=function(t,e,i,n){var r,s="_";return!I(t)&&"string"!=typeof t&&(r=t,I(e)?(t=e,e=i,i=n):t=[]),r&&r.context&&(s=r.context),(n=l(E,s))||(n=E[s]=j.s.newContext(s)),r&&n.configure(r),n.require(t,e,i)},j.config=function(t){return j(t)},j.nextTick="undefined"!=typeof setTimeout?function(t){setTimeout(t,4)}:function(t){t()},require||(require=j),j.version="2.1.9",j.jsExtRegExp=/^\/|:|\?|\.js$/,j.isBrowser=z,w=j.s={contexts:E,newContext:ha},j({}),y(["toUrl","undef","defined","specified"],function(t){j[t]=function(){var e=E._;return e.require[t].apply(e,arguments)}}),z&&(x=w.head=document.getElementsByTagName("head")[0],C=document.getElementsByTagName("base")[0])&&(x=w.head=C.parentNode),j.onError=aa,j.createNode=function(t){var e=t.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return e.type=t.scriptType||"text/javascript",e.charset="utf-8",e.async=!0,e},j.load=function(t,e,i){var n=t&&t.config||{};if(z)return n=j.createNode(n,e,i),n.setAttribute("data-requirecontext",t.contextName),n.setAttribute("data-requiremodule",e),!n.attachEvent||n.attachEvent.toString&&0>n.attachEvent.toString().indexOf("[native code")||W?(n.addEventListener("load",t.onScriptLoad,!1),n.addEventListener("error",t.onScriptError,!1)):(O=!0,n.attachEvent("onreadystatechange",t.onScriptLoad)),n.src=i,K=n,C?x.insertBefore(n,C):x.appendChild(n),K=null,n;if(da)try{importScripts(i),t.completeLoad(e)}catch(n){t.onError(A("importscripts","importScripts failed for "+e+" at "+i,n,[e]))}},z&&!s.skipDataMain&&M(document.getElementsByTagName("script"),function(t){if(x||(x=t.parentNode),J=t.getAttribute("data-main"))return q=J,s.baseUrl||(D=q.split("/"),q=D.pop(),fa=D.length?D.join("/")+"/":"./",s.baseUrl=fa),q=q.replace(ea,""),j.jsExtRegExp.test(q)&&(q=J),s.deps=s.deps?s.deps.concat(q):[q],!0}),define=function(t,e,i){var n,r;"string"!=typeof t&&(i=e,e=t,t=null),I(e)||(i=e,e=null),!e&&H(i)&&(e=[],i.length&&(i.toString().replace(la,"").replace(ma,function(t,i){e.push(i)}),e=(1===i.length?["require"]:["require","exports","module"]).concat(e))),O&&((n=K)||(P&&"interactive"===P.readyState||M(document.getElementsByTagName("script"),function(t){if("interactive"===t.readyState)return P=t}),n=P),n&&(t||(t=n.getAttribute("data-requiremodule")),r=E[n.getAttribute("data-requirecontext")])),(r?r.defQueue:R).push([t,e,i])},define.amd={jQuery:!0},j.exec=function(b){return eval(b)},j(s)}}(this),define("../lib/require.js",function(){}),function(t,e){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){"use strict";function i(t,e,i){var n,r,s=(i=i||J).createElement("script");if(s.text=t,e)for(n in dt)(r=e[n]||e.getAttribute&&e.getAttribute(n))&&s.setAttribute(n,r);i.head.appendChild(s).parentNode.removeChild(s)}function n(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?rt[st.call(t)]||"object":typeof t}function r(t){var e=!!t&&"length"in t&&t.length,i=n(t);return!lt(t)&&!ut(t)&&("array"===i||0===e||"number"==typeof e&&0<e&&e-1 in t)}function s(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()}function o(t,e,i){return lt(e)?gt.grep(t,function(t,n){return!!e.call(t,n,t)!==i}):e.nodeType?gt.grep(t,function(t){return t===e!==i}):"string"!=typeof e?gt.grep(t,function(t){return-1<nt.call(e,t)!==i}):gt.filter(e,t,i)}function a(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function h(t){return t}function c(t){throw t}function l(t,e,i,n){var r;try{t&&lt(r=t.promise)?r.call(t).done(e).fail(i):t&&lt(r=t.then)?r.call(t,e,i):e.apply(void 0,[t].slice(n))}catch(t){i.apply(void 0,[t])}}function u(){J.removeEventListener("DOMContentLoaded",u),t.removeEventListener("load",u),gt.ready()}function d(t,e){return e.toUpperCase()}function f(t){return t.replace(Pt,"ms-").replace(kt,d)}function g(){this.expando=gt.expando+g.uid++}function p(t,e,i){var n,r;if(void 0===i&&1===t.nodeType)if(n="data-"+e.replace(jt,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(n))){try{i="true"===(r=i)||"false"!==r&&("null"===r?null:r===+r+""?+r:Mt.test(r)?JSON.parse(r):r)}catch(t){}Dt.set(t,e,i)}else i=void 0;return i}function m(t,e,i,n){var r,s,o=20,a=n?function(){return n.cur()}:function(){return gt.css(t,e,"")},h=a(),c=i&&i[3]||(gt.cssNumber[e]?"":"px"),l=t.nodeType&&(gt.cssNumber[e]||"px"!==c&&+h)&&Nt.exec(gt.css(t,e));if(l&&l[3]!==c){for(h/=2,c=c||l[3],l=+h||1;o--;)gt.style(t,e,l+c),(1-s)*(1-(s=a()/h||.5))<=0&&(o=0),l/=s;l*=2,gt.style(t,e,l+c),i=i||[]}return i&&(l=+l||+h||0,r=i[1]?l+(i[1]+1)*i[2]:+i[2],n&&(n.unit=c,n.start=l,n.end=r)),r}function v(t,e){for(var i,n,r,s,o,a,h,c=[],l=0,u=t.length;l<u;l++)(n=t[l]).style&&(i=n.style.display,e?("none"===i&&(c[l]=It.get(n,"display")||null,c[l]||(n.style.display="")),""===n.style.display&&zt(n)&&(c[l]=(h=o=s=void 0,o=(r=n).ownerDocument,a=r.nodeName,(h=Wt[a])||(s=o.body.appendChild(o.createElement(a)),h=gt.css(s,"display"),s.parentNode.removeChild(s),"none"===h&&(h="block"),Wt[a]=h)))):"none"!==i&&(c[l]="none",It.set(n,"display",i)));for(l=0;l<u;l++)null!=c[l]&&(t[l].style.display=c[l]);return t}function y(t,e){var i;return i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[],void 0===e||e&&s(t,e)?gt.merge([t],i):i}function b(t,e){for(var i=0,n=t.length;i<n;i++)It.set(t[i],"globalEval",!e||It.get(e[i],"globalEval"))}function _(t,e,i,r,s){for(var o,a,h,c,l,u,d=e.createDocumentFragment(),f=[],g=0,p=t.length;g<p;g++)if((o=t[g])||0===o)if("object"===n(o))gt.merge(f,o.nodeType?[o]:o);else if(Kt.test(o)){for(a=a||d.appendChild(e.createElement("div")),h=(Vt.exec(o)||["",""])[1].toLowerCase(),c=Yt[h]||Yt._default,a.innerHTML=c[1]+gt.htmlPrefilter(o)+c[2],u=c[0];u--;)a=a.lastChild;gt.merge(f,a.childNodes),(a=d.firstChild).textContent=""}else f.push(e.createTextNode(o));for(d.textContent="",g=0;o=f[g++];)if(r&&-1<gt.inArray(o,r))s&&s.push(o);else if(l=Ht(o),a=y(d.appendChild(o),"script"),l&&b(a),i)for(u=0;o=a[u++];)Xt.test(o.type||"")&&i.push(o);return d}function w(){return!0}function T(){return!1}function x(t,e){return t===function(){try{return J.activeElement}catch(t){}}()==("focus"===e)}function S(t,e,i,n,r,s){var o,a;if("object"==typeof e){for(a in"string"!=typeof i&&(n=n||i,i=void 0),e)S(t,a,i,n,e[a],s);return t}if(null==n&&null==r?(r=i,n=i=void 0):null==r&&("string"==typeof i?(r=n,n=void 0):(r=n,n=i,i=void 0)),!1===r)r=T;else if(!r)return t;return 1===s&&(o=r,(r=function(t){return gt().off(t),o.apply(this,arguments)}).guid=o.guid||(o.guid=gt.guid++)),t.each(function(){gt.event.add(this,e,r,n,i)})}function C(t,e,i){i?(It.set(t,e,!1),gt.event.add(t,e,{namespace:!1,handler:function(t){var n,r,s=It.get(this,e);if(1&t.isTrigger&&this[e]){if(s.length)(gt.event.special[e]||{}).delegateType&&t.stopPropagation();else if(s=tt.call(arguments),It.set(this,e,s),n=i(this,e),this[e](),s!==(r=It.get(this,e))||n?It.set(this,e,!1):r={},s!==r)return t.stopImmediatePropagation(),t.preventDefault(),r.value}else s.length&&(It.set(this,e,{value:gt.event.trigger(gt.extend(s[0],gt.Event.prototype),s.slice(1),this)}),t.stopImmediatePropagation())}})):void 0===It.get(t,e)&&gt.event.add(t,e,w)}function E(t,e){return s(t,"table")&&s(11!==e.nodeType?e:e.firstChild,"tr")&&gt(t).children("tbody")[0]||t}function O(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function A(t){return"true/"===(t.type||"").slice(0,5)?t.type=t.type.slice(5):t.removeAttribute("type"),t}function P(t,e){var i,n,r,s,o,a,h,c;if(1===e.nodeType){if(It.hasData(t)&&(s=It.access(t),o=It.set(e,s),c=s.events))for(r in delete o.handle,o.events={},c)for(i=0,n=c[r].length;i<n;i++)gt.event.add(e,r,c[r][i]);Dt.hasData(t)&&(a=Dt.access(t),h=gt.extend({},a),Dt.set(e,h))}}function k(t,e,n,r){e=et.apply([],e);var s,o,a,h,c,l,u=0,d=t.length,f=d-1,g=e[0],p=lt(g);if(p||1<d&&"string"==typeof g&&!ct.checkClone&&ne.test(g))return t.each(function(i){var s=t.eq(i);p&&(e[0]=g.call(this,i,s.html())),k(s,e,n,r)});if(d&&(o=(s=_(e,t[0].ownerDocument,!1,t,r)).firstChild,1===s.childNodes.length&&(s=o),o||r)){for(h=(a=gt.map(y(s,"script"),O)).length;u<d;u++)c=s,u!==f&&(c=gt.clone(c,!0,!0),h&&gt.merge(a,y(c,"script"))),n.call(t[u],c,u);if(h)for(l=a[a.length-1].ownerDocument,gt.map(a,A),u=0;u<h;u++)c=a[u],Xt.test(c.type||"")&&!It.access(c,"globalEval")&&gt.contains(l,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?gt._evalUrl&&!c.noModule&&gt._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")}):i(c.textContent.replace(re,""),c,l))}return t}function L(t,e,i){for(var n,r=e?gt.filter(e,t):t,s=0;null!=(n=r[s]);s++)i||1!==n.nodeType||gt.cleanData(y(n)),n.parentNode&&(i&&Ht(n)&&b(y(n,"script")),n.parentNode.removeChild(n));return t}function I(t,e,i){var n,r,s,o,a=t.style;return(i=i||oe(t))&&(""!==(o=i.getPropertyValue(e)||i[e])||Ht(t)||(o=gt.style(t,e)),!ct.pixelBoxStyles()&&se.test(o)&&ae.test(e)&&(n=a.width,r=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=i.width,a.width=n,a.minWidth=r,a.maxWidth=s)),void 0!==o?o+"":o}function D(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}function M(t){return gt.cssProps[t]||le[t]||(t in ce?t:le[t]=function(t){for(var e=t[0].toUpperCase()+t.slice(1),i=he.length;i--;)if((t=he[i]+e)in ce)return t}(t)||t)}function j(t,e,i){var n=Nt.exec(e);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):e}function R(t,e,i,n,r,s){var o="width"===e?1:0,a=0,h=0;if(i===(n?"border":"content"))return 0;for(;o<4;o+=2)"margin"===i&&(h+=gt.css(t,i+Ft[o],!0,r)),n?("content"===i&&(h-=gt.css(t,"padding"+Ft[o],!0,r)),"margin"!==i&&(h-=gt.css(t,"border"+Ft[o]+"Width",!0,r))):(h+=gt.css(t,"padding"+Ft[o],!0,r),"padding"!==i?h+=gt.css(t,"border"+Ft[o]+"Width",!0,r):a+=gt.css(t,"border"+Ft[o]+"Width",!0,r));return!n&&0<=s&&(h+=Math.max(0,Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-s-h-a-.5))||0),h}function N(t,e,i){var n=oe(t),r=(!ct.boxSizingReliable()||i)&&"border-box"===gt.css(t,"boxSizing",!1,n),s=r,o=I(t,e,n),a="offset"+e[0].toUpperCase()+e.slice(1);if(se.test(o)){if(!i)return o;o="auto"}return(!ct.boxSizingReliable()&&r||"auto"===o||!parseFloat(o)&&"inline"===gt.css(t,"display",!1,n))&&t.getClientRects().length&&(r="border-box"===gt.css(t,"boxSizing",!1,n),(s=a in t)&&(o=t[a])),(o=parseFloat(o)||0)+R(t,e,i||(r?"border":"content"),s,n,o)+"px"}function F(t,e,i,n,r){return new F.prototype.init(t,e,i,n,r)}function B(){me&&(!1===J.hidden&&t.requestAnimationFrame?t.requestAnimationFrame(B):t.setTimeout(B,gt.fx.interval),gt.fx.tick())}function H(){return t.setTimeout(function(){pe=void 0}),pe=Date.now()}function U(t,e){var i,n=0,r={height:t};for(e=e?1:0;n<4;n+=2-e)r["margin"+(i=Ft[n])]=r["padding"+i]=t;return e&&(r.opacity=r.width=t),r}function z(t,e,i){for(var n,r=(G.tweeners[e]||[]).concat(G.tweeners["*"]),s=0,o=r.length;s<o;s++)if(n=r[s].call(i,e,t))return n}function G(t,e,i){var n,r,s=0,o=G.prefilters.length,a=gt.Deferred().always(function(){delete h.elem}),h=function(){if(r)return!1;for(var e=pe||H(),i=Math.max(0,c.startTime+c.duration-e),n=1-(i/c.duration||0),s=0,o=c.tweens.length;s<o;s++)c.tweens[s].run(n);return a.notifyWith(t,[c,n,i]),n<1&&o?i:(o||a.notifyWith(t,[c,1,0]),a.resolveWith(t,[c]),!1)},c=a.promise({elem:t,props:gt.extend({},e),opts:gt.extend(!0,{specialEasing:{},easing:gt.easing._default},i),originalProperties:e,originalOptions:i,startTime:pe||H(),duration:i.duration,tweens:[],createTween:function(e,i){var n=gt.Tween(t,c.opts,e,i,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(n),n},stop:function(e){var i=0,n=e?c.tweens.length:0;if(r)return this;for(r=!0;i<n;i++)c.tweens[i].run(1);return e?(a.notifyWith(t,[c,1,0]),a.resolveWith(t,[c,e])):a.rejectWith(t,[c,e]),this}}),l=c.props;for((!function(t,e){var i,n,r,s,o;for(i in t)if(r=e[n=f(i)],s=t[i],Array.isArray(s)&&(r=s[1],s=t[i]=s[0]),i!==n&&(t[n]=s,delete t[i]),(o=gt.cssHooks[n])&&"expand"in o)for(i in s=o.expand(s),delete t[n],s)i in t||(t[i]=s[i],e[i]=r);else e[n]=r}(l,c.opts.specialEasing));s<o;s++)if(n=G.prefilters[s].call(c,t,l,c.opts))return lt(n.stop)&&(gt._queueHooks(c.elem,c.opts.queue).stop=n.stop.bind(n)),n;return gt.map(l,z,c),lt(c.opts.start)&&c.opts.start.call(t,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),gt.fx.timer(gt.extend(h,{elem:t,anim:c,queue:c.opts.queue})),c}function W(t){return(t.match(Ct)||[]).join(" ")}function q(t){return t.getAttribute&&t.getAttribute("class")||""}function V(t){return Array.isArray(t)?t:"string"==typeof t&&t.match(Ct)||[]}function X(t,e,i,r){var s;if(Array.isArray(e))gt.each(e,function(e,n){i||Le.test(t)?r(t,n):X(t+"["+("object"==typeof n&&null!=n?e:"")+"]",n,i,r)});else if(i||"object"!==n(e))r(t,e);else for(s in e)X(t+"["+s+"]",e[s],i,r)}function Y(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,r=0,s=e.toLowerCase().match(Ct)||[];if(lt(i))for(;n=s[r++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function Z(t,e,i,n){function r(a){var h;return s[a]=!0,gt.each(t[a]||[],function(t,a){var c=a(e,i,n);return"string"!=typeof c||o||s[c]?o?!(h=c):void 0:(e.dataTypes.unshift(c),r(c),!1)}),h}var s={},o=t===ze;return r(e.dataTypes[0])||!s["*"]&&r("*")}function Q(t,e){var i,n,r=gt.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((r[i]?t:n||(n={}))[i]=e[i]);return n&&gt.extend(!0,t,n),t}var K=[],J=t.document,$=Object.getPrototypeOf,tt=K.slice,et=K.concat,it=K.push,nt=K.indexOf,rt={},st=rt.toString,ot=rt.hasOwnProperty,at=ot.toString,ht=at.call(Object),ct={},lt=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType},ut=function(t){return null!=t&&t===t.window},dt={type:!0,src:!0,nonce:!0,noModule:!0},ft="3.4.1",gt=function(t,e){return new gt.fn.init(t,e)},pt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;gt.fn=gt.prototype={jquery:ft,constructor:gt,length:0,toArray:function(){return tt.call(this)},get:function(t){return null==t?tt.call(this):t<0?this[t+this.length]:this[t]},pushStack:function(t){var e=gt.merge(this.constructor(),t);return e.prevObject=this,e},each:function(t){return gt.each(this,t)},map:function(t){return this.pushStack(gt.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack(tt.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(0<=i&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:it,sort:K.sort,splice:K.splice},gt.extend=gt.fn.extend=function(){var t,e,i,n,r,s,o=arguments[0]||{},a=1,h=arguments.length,c=!1;for("boolean"==typeof o&&(c=o,o=arguments[a]||{},a++),"object"==typeof o||lt(o)||(o={}),a===h&&(o=this,a--);a<h;a++)if(null!=(t=arguments[a]))for(e in t)n=t[e],"__proto__"!==e&&o!==n&&(c&&n&&(gt.isPlainObject(n)||(r=Array.isArray(n)))?(i=o[e],s=r&&!Array.isArray(i)?[]:r||gt.isPlainObject(i)?i:{},r=!1,o[e]=gt.extend(c,s,n)):void 0!==n&&(o[e]=n));return o},gt.extend({expando:"jQuery"+(ft+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isPlainObject:function(t){var e,i;return!(!t||"[object Object]"!==st.call(t)||(e=$(t))&&("function"!=typeof(i=ot.call(e,"constructor")&&e.constructor)||at.call(i)!==ht))},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},globalEval:function(t,e){i(t,{nonce:e&&e.nonce})},each:function(t,e){var i,n=0;if(r(t))for(i=t.length;n<i&&!1!==e.call(t[n],n,t[n]);n++);else for(n in t)if(!1===e.call(t[n],n,t[n]))break;return t},trim:function(t){return null==t?"":(t+"").replace(pt,"")},makeArray:function(t,e){var i=e||[];return null!=t&&(r(Object(t))?gt.merge(i,"string"==typeof t?[t]:t):it.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:nt.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,r=t.length;n<i;n++)t[r++]=e[n];return t.length=r,t},grep:function(t,e,i){for(var n=[],r=0,s=t.length,o=!i;r<s;r++)!e(t[r],r)!==o&&n.push(t[r]);return n},map:function(t,e,i){var n,s,o=0,a=[];if(r(t))for(n=t.length;o<n;o++)null!=(s=e(t[o],o,i))&&a.push(s);else for(o in t)null!=(s=e(t[o],o,i))&&a.push(s);return et.apply([],a)},guid:1,support:ct}),"function"==typeof Symbol&&(gt.fn[Symbol.iterator]=K[Symbol.iterator]),gt.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){rt["[object "+e+"]"]=e.toLowerCase()});var mt=function(t){function e(t,e,i,n){var r,s,o,a,h,l,d,f=e&&e.ownerDocument,g=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==g&&9!==g&&11!==g)return i;if(!n&&((e?e.ownerDocument||e:N)!==P&&A(e),e=e||P,L)){if(11!==g&&(h=pt.exec(t)))if(r=h[1]){if(9===g){if(!(o=e.getElementById(r)))return i;if(o.id===r)return i.push(o),i}else if(f&&(o=f.getElementById(r))&&j(e,o)&&o.id===r)return i.push(o),i}else{if(h[2])return Z.apply(i,e.getElementsByTagName(t)),i;if((r=h[3])&&y.getElementsByClassName&&e.getElementsByClassName)return Z.apply(i,e.getElementsByClassName(r)),i}if(y.qsa&&!G[t+" "]&&(!I||!I.test(t))&&(1!==g||"object"!==e.nodeName.toLowerCase())){if(d=t,f=e,1===g&&at.test(t)){for((a=e.getAttribute("id"))?a=a.replace(bt,_t):e.setAttribute("id",a=R),s=(l=T(t)).length;s--;)l[s]="#"+a+" "+u(l[s]);d=l.join(","),f=mt.test(t)&&c(e.parentNode)||e}try{return Z.apply(i,f.querySelectorAll(d)),i}catch(e){G(t,!0)}finally{a===R&&e.removeAttribute("id")}}}return S(t.replace(rt,"$1"),e,i,n)}function i(){var t=[];return function e(i,n){return t.push(i+" ")>b.cacheLength&&delete e[t.shift()],e[i+" "]=n}}function n(t){return t[R]=!0,t}function r(t){var e=P.createElement("fieldset");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function s(t,e){for(var i=t.split("|"),n=i.length;n--;)b.attrHandle[i[n]]=e}function o(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&t.sourceIndex-e.sourceIndex;if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function a(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&Tt(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function h(t){return n(function(e){return e=+e,n(function(i,n){for(var r,s=t([],i.length,e),o=s.length;o--;)i[r=s[o]]&&(i[r]=!(n[r]=i[r]))})})}function c(t){return t&&void 0!==t.getElementsByTagName&&t}function l(){}function u(t){for(var e=0,i=t.length,n="";e<i;e++)n+=t[e].value;return n}function d(t,e,i){var n=e.dir,r=e.next,s=r||n,o=i&&"parentNode"===s,a=B++;return e.first?function(e,i,r){for(;e=e[n];)if(1===e.nodeType||o)return t(e,i,r);return!1}:function(e,i,h){var c,l,u,d=[F,a];if(h){for(;e=e[n];)if((1===e.nodeType||o)&&t(e,i,h))return!0}else for(;e=e[n];)if(1===e.nodeType||o)if(l=(u=e[R]||(e[R]={}))[e.uniqueID]||(u[e.uniqueID]={}),r&&r===e.nodeName.toLowerCase())e=e[n]||e;else{if((c=l[s])&&c[0]===F&&c[1]===a)return d[2]=c[2];if((l[s]=d)[2]=t(e,i,h))return!0}return!1}}function f(t){return 1<t.length?function(e,i,n){for(var r=t.length;r--;)if(!t[r](e,i,n))return!1;return!0}:t[0]}function g(t,e,i,n,r){for(var s,o=[],a=0,h=t.length,c=null!=e;a<h;a++)(s=t[a])&&(i&&!i(s,n,r)||(o.push(s),c&&e.push(a)));return o}function p(t,i,r,s,o,a){return s&&!s[R]&&(s=p(s)),o&&!o[R]&&(o=p(o,a)),n(function(n,a,h,c){var l,u,d,f=[],p=[],m=a.length,v=n||function(t,i,n){for(var r=0,s=i.length;r<s;r++)e(t,i[r],n);return n}(i||"*",h.nodeType?[h]:h,[]),y=!t||!n&&i?v:g(v,f,t,h,c),b=r?o||(n?t:m||s)?[]:a:y;if(r&&r(y,b,h,c),s)for(l=g(b,p),s(l,[],h,c),u=l.length;u--;)(d=l[u])&&(b[p[u]]=!(y[p[u]]=d));if(n){if(o||t){if(o){for(l=[],u=b.length;u--;)(d=b[u])&&l.push(y[u]=d)
;o(null,b=[],l,c)}for(u=b.length;u--;)(d=b[u])&&-1<(l=o?K(n,d):f[u])&&(n[l]=!(a[l]=d))}}else b=g(b===a?b.splice(m,b.length):b),o?o(null,a,b,c):Z.apply(a,b)})}function m(t){for(var e,i,n,r=t.length,s=b.relative[t[0].type],o=s||b.relative[" "],a=s?1:0,h=d(function(t){return t===e},o,!0),c=d(function(t){return-1<K(e,t)},o,!0),l=[function(t,i,n){var r=!s&&(n||i!==C)||((e=i).nodeType?h(t,i,n):c(t,i,n));return e=null,r}];a<r;a++)if(i=b.relative[t[a].type])l=[d(f(l),i)];else{if((i=b.filter[t[a].type].apply(null,t[a].matches))[R]){for(n=++a;n<r&&!b.relative[t[n].type];n++);return p(1<a&&f(l),1<a&&u(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(rt,"$1"),i,a<n&&m(t.slice(a,n)),n<r&&m(t=t.slice(n)),n<r&&u(t))}l.push(i)}return f(l)}var v,y,b,_,w,T,x,S,C,E,O,A,P,k,L,I,D,M,j,R="sizzle"+1*new Date,N=t.document,F=0,B=0,H=i(),U=i(),z=i(),G=i(),W=function(t,e){return t===e&&(O=!0),0},q={}.hasOwnProperty,V=[],X=V.pop,Y=V.push,Z=V.push,Q=V.slice,K=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",$="[\\x20\\t\\r\\n\\f]",tt="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",et="\\["+$+"*("+tt+")(?:"+$+"*([*^$|!~]?=)"+$+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+tt+"))|)"+$+"*\\]",it=":("+tt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+et+")*)|.*)\\)|)",nt=new RegExp($+"+","g"),rt=new RegExp("^"+$+"+|((?:^|[^\\\\])(?:\\\\.)*)"+$+"+$","g"),st=new RegExp("^"+$+"*,"+$+"*"),ot=new RegExp("^"+$+"*([>+~]|"+$+")"+$+"*"),at=new RegExp($+"|>"),ht=new RegExp(it),ct=new RegExp("^"+tt+"$"),lt={ID:new RegExp("^#("+tt+")"),CLASS:new RegExp("^\\.("+tt+")"),TAG:new RegExp("^("+tt+"|[*])"),ATTR:new RegExp("^"+et),PSEUDO:new RegExp("^"+it),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+$+"*(even|odd|(([+-]|)(\\d*)n|)"+$+"*(?:([+-]|)"+$+"*(\\d+)|))"+$+"*\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+$+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+$+"*((?:-\\d)?\\d*)"+$+"*\\)|)(?=[^-]|$)","i")},ut=/HTML$/i,dt=/^(?:input|select|textarea|button)$/i,ft=/^h\d$/i,gt=/^[^{]+\{\s*\[native \w/,pt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,mt=/[+~]/,vt=new RegExp("\\\\([\\da-f]{1,6}"+$+"?|("+$+")|.)","ig"),yt=function(t,e,i){var n="0x"+e-65536;return n!=n||i?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},bt=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,_t=function(t,e){return e?"\0"===t?"�":t.slice(0,-1)+"\\"+t.charCodeAt(t.length-1).toString(16)+" ":"\\"+t},wt=function(){A()},Tt=d(function(t){return!0===t.disabled&&"fieldset"===t.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{Z.apply(V=Q.call(N.childNodes),N.childNodes),V[N.childNodes.length].nodeType}catch(v){Z={apply:V.length?function(t,e){Y.apply(t,Q.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}for(v in y=e.support={},w=e.isXML=function(t){var e=t.namespaceURI,i=(t.ownerDocument||t).documentElement;return!ut.test(e||i&&i.nodeName||"HTML")},A=e.setDocument=function(t){var e,i,n=t?t.ownerDocument||t:N;return n!==P&&9===n.nodeType&&n.documentElement&&(k=(P=n).documentElement,L=!w(P),N!==P&&(i=P.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",wt,!1):i.attachEvent&&i.attachEvent("onunload",wt)),y.attributes=r(function(t){return t.className="i",!t.getAttribute("className")}),y.getElementsByTagName=r(function(t){return t.appendChild(P.createComment("")),!t.getElementsByTagName("*").length}),y.getElementsByClassName=gt.test(P.getElementsByClassName),y.getById=r(function(t){return k.appendChild(t).id=R,!P.getElementsByName||!P.getElementsByName(R).length}),y.getById?(b.filter.ID=function(t){var e=t.replace(vt,yt);return function(t){return t.getAttribute("id")===e}},b.find.ID=function(t,e){if(void 0!==e.getElementById&&L){var i=e.getElementById(t);return i?[i]:[]}}):(b.filter.ID=function(t){var e=t.replace(vt,yt);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}},b.find.ID=function(t,e){if(void 0!==e.getElementById&&L){var i,n,r,s=e.getElementById(t);if(s){if((i=s.getAttributeNode("id"))&&i.value===t)return[s];for(r=e.getElementsByName(t),n=0;s=r[n++];)if((i=s.getAttributeNode("id"))&&i.value===t)return[s]}return[]}}),b.find.TAG=y.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):y.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],r=0,s=e.getElementsByTagName(t);if("*"===t){for(;i=s[r++];)1===i.nodeType&&n.push(i);return n}return s},b.find.CLASS=y.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&L)return e.getElementsByClassName(t)},D=[],I=[],(y.qsa=gt.test(P.querySelectorAll))&&(r(function(t){k.appendChild(t).innerHTML="<a id='"+R+"'></a><select id='"+R+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&I.push("[*^$]="+$+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||I.push("\\["+$+"*(?:value|"+J+")"),t.querySelectorAll("[id~="+R+"-]").length||I.push("~="),t.querySelectorAll(":checked").length||I.push(":checked"),t.querySelectorAll("a#"+R+"+*").length||I.push(".#.+[+~]")}),r(function(t){t.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=P.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&I.push("name"+$+"*[*^$|!~]?="),2!==t.querySelectorAll(":enabled").length&&I.push(":enabled",":disabled"),k.appendChild(t).disabled=!0,2!==t.querySelectorAll(":disabled").length&&I.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),I.push(",.*:")})),(y.matchesSelector=gt.test(M=k.matches||k.webkitMatchesSelector||k.mozMatchesSelector||k.oMatchesSelector||k.msMatchesSelector))&&r(function(t){y.disconnectedMatch=M.call(t,"*"),M.call(t,"[s!='']:x"),D.push("!=",it)}),I=I.length&&new RegExp(I.join("|")),D=D.length&&new RegExp(D.join("|")),e=gt.test(k.compareDocumentPosition),j=e||gt.test(k.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},W=e?function(t,e){if(t===e)return O=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i||(1&(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!y.sortDetached&&e.compareDocumentPosition(t)===i?t===P||t.ownerDocument===N&&j(N,t)?-1:e===P||e.ownerDocument===N&&j(N,e)?1:E?K(E,t)-K(E,e):0:4&i?-1:1)}:function(t,e){if(t===e)return O=!0,0;var i,n=0,r=t.parentNode,s=e.parentNode,a=[t],h=[e];if(!r||!s)return t===P?-1:e===P?1:r?-1:s?1:E?K(E,t)-K(E,e):0;if(r===s)return o(t,e);for(i=t;i=i.parentNode;)a.unshift(i);for(i=e;i=i.parentNode;)h.unshift(i);for(;a[n]===h[n];)n++;return n?o(a[n],h[n]):a[n]===N?-1:h[n]===N?1:0}),P},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if((t.ownerDocument||t)!==P&&A(t),y.matchesSelector&&L&&!G[i+" "]&&(!D||!D.test(i))&&(!I||!I.test(i)))try{var n=M.call(t,i);if(n||y.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){G(i,!0)}return 0<e(i,P,null,[t]).length},e.contains=function(t,e){return(t.ownerDocument||t)!==P&&A(t),j(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==P&&A(t);var i=b.attrHandle[e.toLowerCase()],n=i&&q.call(b.attrHandle,e.toLowerCase())?i(t,e,!L):void 0;return void 0!==n?n:y.attributes||!L?t.getAttribute(e):(n=t.getAttributeNode(e))&&n.specified?n.value:null},e.escape=function(t){return(t+"").replace(bt,_t)},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],n=0,r=0;if(O=!y.detectDuplicates,E=!y.sortStable&&t.slice(0),t.sort(W),O){for(;e=t[r++];)e===t[r]&&(n=i.push(r));for(;n--;)t.splice(i[n],1)}return E=null,t},_=e.getText=function(t){var e,i="",n=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=_(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[n++];)i+=_(e);return i},(b=e.selectors={cacheLength:50,createPseudo:n,match:lt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(vt,yt),t[3]=(t[3]||t[4]||t[5]||"").replace(vt,yt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return lt.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&ht.test(i)&&(e=T(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(vt,yt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=H[t+" "];return e||(e=new RegExp("(^|"+$+")"+t+"("+$+"|$)"))&&H(t,function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,i,n){return function(r){var s=e.attr(r,t);return null==s?"!="===i:!i||(s+="","="===i?s===n:"!="===i?s!==n:"^="===i?n&&0===s.indexOf(n):"*="===i?n&&-1<s.indexOf(n):"$="===i?n&&s.slice(-n.length)===n:"~="===i?-1<(" "+s.replace(nt," ")+" ").indexOf(n):"|="===i&&(s===n||s.slice(0,n.length+1)===n+"-"))}},CHILD:function(t,e,i,n,r){var s="nth"!==t.slice(0,3),o="last"!==t.slice(-4),a="of-type"===e;return 1===n&&0===r?function(t){return!!t.parentNode}:function(e,i,h){var c,l,u,d,f,g,p=s!==o?"nextSibling":"previousSibling",m=e.parentNode,v=a&&e.nodeName.toLowerCase(),y=!h&&!a,b=!1;if(m){if(s){for(;p;){for(d=e;d=d[p];)if(a?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;g=p="only"===t&&!g&&"nextSibling"}return!0}if(g=[o?m.firstChild:m.lastChild],o&&y){for(b=(f=(c=(l=(u=(d=m)[R]||(d[R]={}))[d.uniqueID]||(u[d.uniqueID]={}))[t]||[])[0]===F&&c[1])&&c[2],d=f&&m.childNodes[f];d=++f&&d&&d[p]||(b=f=0)||g.pop();)if(1===d.nodeType&&++b&&d===e){l[t]=[F,f,b];break}}else if(y&&(b=f=(c=(l=(u=(d=e)[R]||(d[R]={}))[d.uniqueID]||(u[d.uniqueID]={}))[t]||[])[0]===F&&c[1]),!1===b)for(;(d=++f&&d&&d[p]||(b=f=0)||g.pop())&&((a?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++b||(y&&((l=(u=d[R]||(d[R]={}))[d.uniqueID]||(u[d.uniqueID]={}))[t]=[F,b]),d!==e)););return(b-=r)===n||b%n==0&&0<=b/n}}},PSEUDO:function(t,i){var r,s=b.pseudos[t]||b.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return s[R]?s(i):1<s.length?(r=[t,t,"",i],b.setFilters.hasOwnProperty(t.toLowerCase())?n(function(t,e){for(var n,r=s(t,i),o=r.length;o--;)t[n=K(t,r[o])]=!(e[n]=r[o])}):function(t){return s(t,0,r)}):s}},pseudos:{not:n(function(t){var e=[],i=[],r=x(t.replace(rt,"$1"));return r[R]?n(function(t,e,i,n){for(var s,o=r(t,null,n,[]),a=t.length;a--;)(s=o[a])&&(t[a]=!(e[a]=s))}):function(t,n,s){return e[0]=t,r(e,null,s,i),e[0]=null,!i.pop()}}),has:n(function(t){return function(i){return 0<e(t,i).length}}),contains:n(function(t){return t=t.replace(vt,yt),function(e){return-1<(e.textContent||_(e)).indexOf(t)}}),lang:n(function(t){return ct.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(vt,yt).toLowerCase(),function(e){var i;do{if(i=L?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===k},focus:function(t){return t===P.activeElement&&(!P.hasFocus||P.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:a(!1),disabled:a(!0),checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!b.pseudos.empty(t)},header:function(t){return ft.test(t.nodeName)},input:function(t){return dt.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:h(function(){return[0]}),last:h(function(t,e){return[e-1]}),eq:h(function(t,e,i){return[i<0?i+e:i]}),even:h(function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t}),odd:h(function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t}),lt:h(function(t,e,i){for(var n=i<0?i+e:e<i?e:i;0<=--n;)t.push(n);return t}),gt:h(function(t,e,i){for(var n=i<0?i+e:i;++n<e;)t.push(n);return t})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[v]=function(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}(v);for(v in{submit:!0,reset:!0})b.pseudos[v]=function(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}(v);return l.prototype=b.filters=b.pseudos,b.setFilters=new l,T=e.tokenize=function(t,i){var n,r,s,o,a,h,c,l=U[t+" "];if(l)return i?0:l.slice(0);for(a=t,h=[],c=b.preFilter;a;){for(o in n&&!(r=st.exec(a))||(r&&(a=a.slice(r[0].length)||a),h.push(s=[])),n=!1,(r=ot.exec(a))&&(n=r.shift(),s.push({value:n,type:r[0].replace(rt," ")}),a=a.slice(n.length)),b.filter)!(r=lt[o].exec(a))||c[o]&&!(r=c[o](r))||(n=r.shift(),s.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return i?a.length:a?e.error(t):U(t,h).slice(0)},x=e.compile=function(t,i){var r,s,o,a,h,c,l=[],u=[],d=z[t+" "];if(!d){for(i||(i=T(t)),r=i.length;r--;)(d=m(i[r]))[R]?l.push(d):u.push(d);(d=z(t,(s=u,a=0<(o=l).length,h=0<s.length,c=function(t,i,n,r,c){var l,u,d,f=0,p="0",m=t&&[],v=[],y=C,_=t||h&&b.find.TAG("*",c),w=F+=null==y?1:Math.random()||.1,T=_.length;for(c&&(C=i===P||i||c);p!==T&&null!=(l=_[p]);p++){if(h&&l){for(u=0,i||l.ownerDocument===P||(A(l),n=!L);d=s[u++];)if(d(l,i||P,n)){r.push(l);break}c&&(F=w)}a&&((l=!d&&l)&&f--,t&&m.push(l))}if(f+=p,a&&p!==f){for(u=0;d=o[u++];)d(m,v,i,n);if(t){if(0<f)for(;p--;)m[p]||v[p]||(v[p]=X.call(r));v=g(v)}Z.apply(r,v),c&&!t&&0<v.length&&1<f+o.length&&e.uniqueSort(r)}return c&&(F=w,C=y),m},a?n(c):c))).selector=t}return d},S=e.select=function(t,e,i,n){var r,s,o,a,h,l="function"==typeof t&&t,d=!n&&T(t=l.selector||t);if(i=i||[],1===d.length){if(2<(s=d[0]=d[0].slice(0)).length&&"ID"===(o=s[0]).type&&9===e.nodeType&&L&&b.relative[s[1].type]){if(!(e=(b.find.ID(o.matches[0].replace(vt,yt),e)||[])[0]))return i;l&&(e=e.parentNode),t=t.slice(s.shift().value.length)}for(r=lt.needsContext.test(t)?0:s.length;r--&&(o=s[r],!b.relative[a=o.type]);)if((h=b.find[a])&&(n=h(o.matches[0].replace(vt,yt),mt.test(s[0].type)&&c(e.parentNode)||e))){if(s.splice(r,1),!(t=n.length&&u(s)))return Z.apply(i,n),i;break}}return(l||x(t,d))(n,e,!L,i,!e||mt.test(t)&&c(e.parentNode)||e),i},y.sortStable=R.split("").sort(W).join("")===R,y.detectDuplicates=!!O,A(),y.sortDetached=r(function(t){return 1&t.compareDocumentPosition(P.createElement("fieldset"))}),r(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||s("type|href|height|width",function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),y.attributes&&r(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||s("value",function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),r(function(t){return null==t.getAttribute("disabled")})||s(J,function(t,e,i){var n;if(!i)return!0===t[e]?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),e}(t);gt.find=mt,gt.expr=mt.selectors,gt.expr[":"]=gt.expr.pseudos,gt.uniqueSort=gt.unique=mt.uniqueSort,gt.text=mt.getText,gt.isXMLDoc=mt.isXML,gt.contains=mt.contains,gt.escapeSelector=mt.escape;var vt=function(t,e,i){for(var n=[],r=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(r&&gt(t).is(i))break;n.push(t)}return n},yt=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},bt=gt.expr.match.needsContext,_t=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;gt.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?gt.find.matchesSelector(n,t)?[n]:[]:gt.find.matches(t,gt.grep(e,function(t){return 1===t.nodeType}))},gt.fn.extend({find:function(t){var e,i,n=this.length,r=this;if("string"!=typeof t)return this.pushStack(gt(t).filter(function(){for(e=0;e<n;e++)if(gt.contains(r[e],this))return!0}));for(i=this.pushStack([]),e=0;e<n;e++)gt.find(t,r[e],i);return 1<n?gt.uniqueSort(i):i},filter:function(t){return this.pushStack(o(this,t||[],!1))},not:function(t){return this.pushStack(o(this,t||[],!0))},is:function(t){return!!o(this,"string"==typeof t&&bt.test(t)?gt(t):t||[],!1).length}});var wt,Tt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(gt.fn.init=function(t,e,i){var n,r;if(!t)return this;if(i=i||wt,"string"==typeof t){if(!(n="<"===t[0]&&">"===t[t.length-1]&&3<=t.length?[null,t,null]:Tt.exec(t))||!n[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof gt?e[0]:e,gt.merge(this,gt.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:J,!0)),_t.test(n[1])&&gt.isPlainObject(e))for(n in e)lt(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return(r=J.getElementById(n[2]))&&(this[0]=r,this.length=1),this}return t.nodeType?(this[0]=t,this.length=1,this):lt(t)?void 0!==i.ready?i.ready(t):t(gt):gt.makeArray(t,this)}).prototype=gt.fn,wt=gt(J);var xt=/^(?:parents|prev(?:Until|All))/,St={children:!0,contents:!0,next:!0,prev:!0};gt.fn.extend({has:function(t){var e=gt(t,this),i=e.length;return this.filter(function(){for(var t=0;t<i;t++)if(gt.contains(this,e[t]))return!0})},closest:function(t,e){var i,n=0,r=this.length,s=[],o="string"!=typeof t&&gt(t);if(!bt.test(t))for(;n<r;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?-1<o.index(i):1===i.nodeType&&gt.find.matchesSelector(i,t))){s.push(i);break}return this.pushStack(1<s.length?gt.uniqueSort(s):s)},index:function(t){return t?"string"==typeof t?nt.call(gt(t),this[0]):nt.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(gt.uniqueSort(gt.merge(this.get(),gt(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),gt.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return vt(t,"parentNode")},parentsUntil:function(t,e,i){return vt(t,"parentNode",i)},next:function(t){return a(t,"nextSibling")},prev:function(t){return a(t,"previousSibling")},nextAll:function(t){return vt(t,"nextSibling")},prevAll:function(t){return vt(t,"previousSibling")},nextUntil:function(t,e,i){return vt(t,"nextSibling",i)},prevUntil:function(t,e,i){return vt(t,"previousSibling",i)},siblings:function(t){return yt((t.parentNode||{}).firstChild,t)},children:function(t){return yt(t.firstChild)},contents:function(t){return void 0!==t.contentDocument?t.contentDocument:(s(t,"template")&&(t=t.content||t),gt.merge([],t.childNodes))}},function(t,e){gt.fn[t]=function(i,n){var r=gt.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=gt.filter(n,r)),1<this.length&&(St[t]||gt.uniqueSort(r),xt.test(t)&&r.reverse()),this.pushStack(r)}});var Ct=/[^\x20\t\r\n\f]+/g;gt.Callbacks=function(t){var e,i;t="string"==typeof t?(e=t,i={},gt.each(e.match(Ct)||[],function(t,e){i[e]=!0}),i):gt.extend({},t);var r,s,o,a,h=[],c=[],l=-1,u=function(){for(a=a||t.once,o=r=!0;c.length;l=-1)for(s=c.shift();++l<h.length;)!1===h[l].apply(s[0],s[1])&&t.stopOnFalse&&(l=h.length,s=!1);t.memory||(s=!1),r=!1,a&&(h=s?[]:"")},d={add:function(){return h&&(s&&!r&&(l=h.length-1,c.push(s)),function e(i){gt.each(i,function(i,r){lt(r)?t.unique&&d.has(r)||h.push(r):r&&r.length&&"string"!==n(r)&&e(r)})}(arguments),s&&!r&&u()),this},remove:function(){return gt.each(arguments,function(t,e){for(var i;-1<(i=gt.inArray(e,h,i));)h.splice(i,1),i<=l&&l--}),this},has:function(t){return t?-1<gt.inArray(t,h):0<h.length},empty:function(){return h&&(h=[]),this},disable:function(){return a=c=[],h=s="",this},disabled:function(){return!h},lock:function(){return a=c=[],s||r||(h=s=""),this},locked:function(){return!!a},fireWith:function(t,e){return a||(e=[t,(e=e||[]).slice?e.slice():e],c.push(e),r||u()),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!o}};return d},gt.extend({Deferred:function(e){var i=[["notify","progress",gt.Callbacks("memory"),gt.Callbacks("memory"),2],["resolve","done",gt.Callbacks("once memory"),gt.Callbacks("once memory"),0,"resolved"],["reject","fail",gt.Callbacks("once memory"),gt.Callbacks("once memory"),1,"rejected"]],n="pending",r={state:function(){return n},always:function(){return s.done(arguments).fail(arguments),this},catch:function(t){return r.then(null,t)},pipe:function(){var t=arguments;return gt.Deferred(function(e){gt.each(i,function(i,n){var r=lt(t[n[4]])&&t[n[4]];s[n[1]](function(){var t=r&&r.apply(this,arguments);t&&lt(t.promise)?t.promise().progress(e.notify).done(e.resolve).fail(e.reject):e[n[0]+"With"](this,r?[t]:arguments)})}),t=null}).promise()},then:function(e,n,r){function s(e,i,n,r){return function(){var a=this,l=arguments,u=function(){var t,u;if(!(e<o)){if((t=n.apply(a,l))===i.promise())throw new TypeError("Thenable self-resolution");u=t&&("object"==typeof t||"function"==typeof t)&&t.then,lt(u)?r?u.call(t,s(o,i,h,r),s(o,i,c,r)):(o++,u.call(t,s(o,i,h,r),s(o,i,c,r),s(o,i,h,i.notifyWith))):(n!==h&&(a=void 0,l=[t]),(r||i.resolveWith)(a,l))}},d=r?u:function(){try{u()}catch(t){gt.Deferred.exceptionHook&&gt.Deferred.exceptionHook(t,d.stackTrace),o<=e+1&&(n!==c&&(a=void 0,l=[t]),i.rejectWith(a,l))}};e?d():(gt.Deferred.getStackHook&&(d.stackTrace=gt.Deferred.getStackHook()),t.setTimeout(d))}}var o=0;return gt.Deferred(function(t){i[0][3].add(s(0,t,lt(r)?r:h,t.notifyWith)),i[1][3].add(s(0,t,lt(e)?e:h)),i[2][3].add(s(0,t,lt(n)?n:c))}).promise()},promise:function(t){return null!=t?gt.extend(t,r):r}},s={};return gt.each(i,function(t,e){var o=e[2],a=e[5];r[e[1]]=o.add,a&&o.add(function(){n=a},i[3-t][2].disable,i[3-t][3].disable,i[0][2].lock,i[0][3].lock),o.add(e[3].fire),s[e[0]]=function(){return s[e[0]+"With"](this===s?void 0:this,arguments),this},s[e[0]+"With"]=o.fireWith}),r.promise(s),e&&e.call(s,s),s},when:function(t){var e=arguments.length,i=e,n=Array(i),r=tt.call(arguments),s=gt.Deferred(),o=function(t){return function(i){n[t]=this,r[t]=1<arguments.length?tt.call(arguments):i,--e||s.resolveWith(n,r)}};if(e<=1&&(l(t,s.done(o(i)).resolve,s.reject,!e),"pending"===s.state()||lt(r[i]&&r[i].then)))return s.then();for(;i--;)l(r[i],o(i),s.reject);return s.promise()}});var Et=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;gt.Deferred.exceptionHook=function(e,i){t.console&&t.console.warn&&e&&Et.test(e.name)&&t.console.warn("jQuery.Deferred exception: "+e.message,e.stack,i)},gt.readyException=function(e){t.setTimeout(function(){throw e})};var Ot=gt.Deferred();gt.fn.ready=function(t){return Ot.then(t).catch(function(t){gt.readyException(t)}),this},gt.extend({isReady:!1,readyWait:1,ready:function(t){(!0===t?--gt.readyWait:gt.isReady)||(gt.isReady=!0)!==t&&0<--gt.readyWait||Ot.resolveWith(J,[gt])}}),gt.ready.then=Ot.then,"complete"===J.readyState||"loading"!==J.readyState&&!J.documentElement.doScroll?t.setTimeout(gt.ready):(J.addEventListener("DOMContentLoaded",u),t.addEventListener("load",u));var At=function(t,e,i,r,s,o,a){var h=0,c=t.length,l=null==i;if("object"===n(i))for(h in s=!0,i)At(t,e,h,i[h],!0,o,a);else if(void 0!==r&&(s=!0,lt(r)||(a=!0),l&&(a?(e.call(t,r),e=null):(l=e,e=function(t,e,i){return l.call(gt(t),i)})),e))for(;h<c;h++)e(t[h],i,a?r:r.call(t[h],h,e(t[h],i)));return s?t:l?e.call(t):c?e(t[0],i):o},Pt=/^-ms-/,kt=/-([a-z])/g,Lt=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};g.uid=1,g.prototype={cache:function(t){var e=t[this.expando];return e||(e={},Lt(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var n,r=this.cache(t);if("string"==typeof e)r[f(e)]=i;else for(n in e)r[f(n)]=e[n];return r},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][f(e)]},access:function(t,e,i){return void 0===e||e&&"string"==typeof e&&void 0===i?this.get(t,e):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,n=t[this.expando];if(void 0!==n){if(void 0!==e){i=(e=Array.isArray(e)?e.map(f):(e=f(e))in n?[e]:e.match(Ct)||[]).length;for(;i--;)delete n[e[i]]}(void 0===e||gt.isEmptyObject(n))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!gt.isEmptyObject(e)}};var It=new g,Dt=new g,Mt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,jt=/[A-Z]/g;gt.extend({hasData:function(t){return Dt.hasData(t)||It.hasData(t)},data:function(t,e,i){return Dt.access(t,e,i)},removeData:function(t,e){Dt.remove(t,e)},_data:function(t,e,i){return It.access(t,e,i)},_removeData:function(t,e){It.remove(t,e)}}),gt.fn.extend({data:function(t,e){var i,n,r,s=this[0],o=s&&s.attributes;if(void 0===t){if(this.length&&(r=Dt.get(s),1===s.nodeType&&!It.get(s,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&0===(n=o[i].name).indexOf("data-")&&(n=f(n.slice(5)),p(s,n,r[n]));It.set(s,"hasDataAttrs",!0)}return r}return"object"==typeof t?this.each(function(){Dt.set(this,t)}):At(this,function(e){var i;if(s&&void 0===e)return void 0!==(i=Dt.get(s,t))?i:void 0!==(i=p(s,t))?i:void 0;this.each(function(){Dt.set(this,t,e)})},null,e,1<arguments.length,null,!0)},removeData:function(t){return this.each(function(){Dt.remove(this,t)})}}),gt.extend({queue:function(t,e,i){var n;if(t)return e=(e||"fx")+"queue",n=It.get(t,e),i&&(!n||Array.isArray(i)?n=It.access(t,e,gt.makeArray(i)):n.push(i)),n||[]},dequeue:function(t,e){e=e||"fx";var i=gt.queue(t,e),n=i.length,r=i.shift(),s=gt._queueHooks(t,e);"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===e&&i.unshift("inprogress"),delete s.stop,r.call(t,function(){gt.dequeue(t,e)},s)),!n&&s&&s.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return It.get(t,i)||It.access(t,i,{empty:gt.Callbacks("once memory").add(function(){It.remove(t,[e+"queue",i])})})}}),gt.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?gt.queue(this[0],t):void 0===e?this:this.each(function(){var i=gt.queue(this,t,e);gt._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&gt.dequeue(this,t)})},dequeue:function(t){return this.each(function(){gt.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,r=gt.Deferred(),s=this,o=this.length,a=function(){--n||r.resolveWith(s,[s])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)(i=It.get(s[o],t+"queueHooks"))&&i.empty&&(n++,i.empty.add(a));return a(),r.promise(e)}});var Rt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Nt=new RegExp("^(?:([+-])=|)("+Rt+")([a-z%]*)$","i"),Ft=["Top","Right","Bottom","Left"],Bt=J.documentElement,Ht=function(t){return gt.contains(t.ownerDocument,t)},Ut={composed:!0};Bt.getRootNode&&(Ht=function(t){return gt.contains(t.ownerDocument,t)||t.getRootNode(Ut)===t.ownerDocument});var zt=function(t,e){return"none"===(t=e||t).style.display||""===t.style.display&&Ht(t)&&"none"===gt.css(t,"display")},Gt=function(t,e,i,n){var r,s,o={};for(s in e)o[s]=t.style[s],t.style[s]=e[s];for(s in r=i.apply(t,n||[]),e)t.style[s]=o[s];return r},Wt={};gt.fn.extend({show:function(){return v(this,!0)},hide:function(){return v(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){zt(this)?gt(this).show():gt(this).hide()})}});var qt=/^(?:checkbox|radio)$/i,Vt=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Xt=/^$|^module$|\/(?:java|ecma)script/i,Yt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Yt.optgroup=Yt.option,Yt.tbody=Yt.tfoot=Yt.colgroup=Yt.caption=Yt.thead,Yt.th=Yt.td;var Zt,Qt,Kt=/<|&#?\w+;/;Zt=J.createDocumentFragment().appendChild(J.createElement("div")),(Qt=J.createElement("input")).setAttribute("type","radio"),Qt.setAttribute("checked","checked"),Qt.setAttribute("name","t"),Zt.appendChild(Qt),ct.checkClone=Zt.cloneNode(!0).cloneNode(!0).lastChild.checked,Zt.innerHTML="<textarea>x</textarea>",ct.noCloneChecked=!!Zt.cloneNode(!0).lastChild.defaultValue;var Jt=/^key/,$t=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,te=/^([^.]*)(?:\.(.+)|)/;gt.event={global:{},add:function(t,e,i,n,r){var s,o,a,h,c,l,u,d,f,g,p,m=It.get(t);if(m)for(i.handler&&(i=(s=i).handler,r=s.selector),r&&gt.find.matchesSelector(Bt,r),i.guid||(i.guid=gt.guid++),(h=m.events)||(h=m.events={}),(o=m.handle)||(o=m.handle=function(e){return void 0!==gt&&gt.event.triggered!==e.type?gt.event.dispatch.apply(t,arguments):void 0}),c=(e=(e||"").match(Ct)||[""]).length;c--;)f=p=(a=te.exec(e[c])||[])[1],g=(a[2]||"").split(".").sort(),f&&(u=gt.event.special[f]||{},f=(r?u.delegateType:u.bindType)||f,u=gt.event.special[f]||{},l=gt.extend({type:f,origType:p,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&gt.expr.match.needsContext.test(r),namespace:g.join(".")},s),(d=h[f])||((d=h[f]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(t,n,g,o)||t.addEventListener&&t.addEventListener(f,o)),u.add&&(u.add.call(t,l),l.handler.guid||(l.handler.guid=i.guid)),r?d.splice(d.delegateCount++,0,l):d.push(l),gt.event.global[f]=!0)},remove:function(t,e,i,n,r){var s,o,a,h,c,l,u,d,f,g,p,m=It.hasData(t)&&It.get(t);if(m&&(h=m.events)){for(c=(e=(e||"").match(Ct)||[""]).length;c--;)if(f=p=(a=te.exec(e[c])||[])[1],g=(a[2]||"").split(".").sort(),f){for(u=gt.event.special[f]||{},d=h[f=(n?u.delegateType:u.bindType)||f]||[],a=a[2]&&new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=d.length;s--;)l=d[s],!r&&p!==l.origType||i&&i.guid!==l.guid||a&&!a.test(l.namespace)||n&&n!==l.selector&&("**"!==n||!l.selector)||(d.splice(s,1),l.selector&&d.delegateCount--,u.remove&&u.remove.call(t,l));o&&!d.length&&(u.teardown&&!1!==u.teardown.call(t,g,m.handle)||gt.removeEvent(t,f,m.handle),delete h[f])}else for(f in h)gt.event.remove(t,f+e[c],i,n,!0);gt.isEmptyObject(h)&&It.remove(t,"handle events")}},dispatch:function(t){var e,i,n,r,s,o,a=gt.event.fix(t),h=new Array(arguments.length),c=(It.get(this,"events")||{})[a.type]||[],l=gt.event.special[a.type]||{};for(h[0]=a,e=1;e<arguments.length;e++)h[e]=arguments[e];if(a.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,a)){for(o=gt.event.handlers.call(this,a,c),e=0;(r=o[e++])&&!a.isPropagationStopped();)for(a.currentTarget=r.elem,i=0;(s=r.handlers[i++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!1!==s.namespace&&!a.rnamespace.test(s.namespace)||(a.handleObj=s,a.data=s.data,void 0!==(n=((gt.event.special[s.origType]||{}).handle||s.handler).apply(r.elem,h))&&!1===(a.result=n)&&(a.preventDefault(),a.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,a),a.result}},handlers:function(t,e){var i,n,r,s,o,a=[],h=e.delegateCount,c=t.target;if(h&&c.nodeType&&!("click"===t.type&&1<=t.button))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==t.type||!0!==c.disabled)){for(s=[],o={},
i=0;i<h;i++)void 0===o[r=(n=e[i]).selector+" "]&&(o[r]=n.needsContext?-1<gt(r,this).index(c):gt.find(r,this,null,[c]).length),o[r]&&s.push(n);s.length&&a.push({elem:c,handlers:s})}return c=this,h<e.length&&a.push({elem:c,handlers:e.slice(h)}),a},addProp:function(t,e){Object.defineProperty(gt.Event.prototype,t,{enumerable:!0,configurable:!0,get:lt(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(t){return t[gt.expando]?t:new gt.Event(t)},special:{load:{noBubble:!0},click:{setup:function(t){var e=this||t;return qt.test(e.type)&&e.click&&s(e,"input")&&C(e,"click",w),!1},trigger:function(t){var e=this||t;return qt.test(e.type)&&e.click&&s(e,"input")&&C(e,"click"),!0},_default:function(t){var e=t.target;return qt.test(e.type)&&e.click&&s(e,"input")&&It.get(e,"click")||s(e,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},gt.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},gt.Event=function(t,e){if(!(this instanceof gt.Event))return new gt.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&!1===t.returnValue?w:T,this.target=t.target&&3===t.target.nodeType?t.target.parentNode:t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&gt.extend(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this[gt.expando]=!0},gt.Event.prototype={constructor:gt.Event,isDefaultPrevented:T,isPropagationStopped:T,isImmediatePropagationStopped:T,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=w,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=w,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=w,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},gt.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(t){var e=t.button;return null==t.which&&Jt.test(t.type)?null!=t.charCode?t.charCode:t.keyCode:!t.which&&void 0!==e&&$t.test(t.type)?1&e?1:2&e?3:4&e?2:0:t.which}},gt.event.addProp),gt.each({focus:"focusin",blur:"focusout"},function(t,e){gt.event.special[t]={setup:function(){return C(this,t,x),!1},trigger:function(){return C(this,t),!0},delegateType:e}}),gt.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){gt.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=t.relatedTarget,r=t.handleObj;return n&&(n===this||gt.contains(this,n))||(t.type=r.origType,i=r.handler.apply(this,arguments),t.type=e),i}}}),gt.fn.extend({on:function(t,e,i,n){return S(this,t,e,i,n)},one:function(t,e,i,n){return S(this,t,e,i,n,1)},off:function(t,e,i){var n,r;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,gt(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(r in t)this.off(r,e,t[r]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=void 0),!1===i&&(i=T),this.each(function(){gt.event.remove(this,t,i,e)})}});var ee=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,ie=/<script|<style|<link/i,ne=/checked\s*(?:[^=]|=\s*.checked.)/i,re=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;gt.extend({htmlPrefilter:function(t){return t.replace(ee,"<$1></$2>")},clone:function(t,e,i){var n,r,s,o,a,h,c,l=t.cloneNode(!0),u=Ht(t);if(!(ct.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||gt.isXMLDoc(t)))for(o=y(l),n=0,r=(s=y(t)).length;n<r;n++)a=s[n],h=o[n],"input"===(c=h.nodeName.toLowerCase())&&qt.test(a.type)?h.checked=a.checked:"input"!==c&&"textarea"!==c||(h.defaultValue=a.defaultValue);if(e)if(i)for(s=s||y(t),o=o||y(l),n=0,r=s.length;n<r;n++)P(s[n],o[n]);else P(t,l);return 0<(o=y(l,"script")).length&&b(o,!u&&y(t,"script")),l},cleanData:function(t){for(var e,i,n,r=gt.event.special,s=0;void 0!==(i=t[s]);s++)if(Lt(i)){if(e=i[It.expando]){if(e.events)for(n in e.events)r[n]?gt.event.remove(i,n):gt.removeEvent(i,n,e.handle);i[It.expando]=void 0}i[Dt.expando]&&(i[Dt.expando]=void 0)}}}),gt.fn.extend({detach:function(t){return L(this,t,!0)},remove:function(t){return L(this,t)},text:function(t){return At(this,function(t){return void 0===t?gt.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return k(this,arguments,function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||E(this,t).appendChild(t)})},prepend:function(){return k(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=E(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return k(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return k(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(gt.cleanData(y(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return gt.clone(this,t,e)})},html:function(t){return At(this,function(t){var e=this[0]||{},i=0,n=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!ie.test(t)&&!Yt[(Vt.exec(t)||["",""])[1].toLowerCase()]){t=gt.htmlPrefilter(t);try{for(;i<n;i++)1===(e=this[i]||{}).nodeType&&(gt.cleanData(y(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=[];return k(this,arguments,function(e){var i=this.parentNode;gt.inArray(this,t)<0&&(gt.cleanData(y(this)),i&&i.replaceChild(e,this))},t)}}),gt.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){gt.fn[t]=function(t){for(var i,n=[],r=gt(t),s=r.length-1,o=0;o<=s;o++)i=o===s?this:this.clone(!0),gt(r[o])[e](i),it.apply(n,i.get());return this.pushStack(n)}});var se=new RegExp("^("+Rt+")(?!px)[a-z%]+$","i"),oe=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)},ae=new RegExp(Ft.join("|"),"i");!function(){function e(){if(c){h.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Bt.appendChild(h).appendChild(c);var e=t.getComputedStyle(c);n="1%"!==e.top,a=12===i(e.marginLeft),c.style.right="60%",o=36===i(e.right),r=36===i(e.width),c.style.position="absolute",s=12===i(c.offsetWidth/3),Bt.removeChild(h),c=null}}function i(t){return Math.round(parseFloat(t))}var n,r,s,o,a,h=J.createElement("div"),c=J.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",ct.clearCloneStyle="content-box"===c.style.backgroundClip,gt.extend(ct,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),a},scrollboxSize:function(){return e(),s}}))}();var he=["Webkit","Moz","ms"],ce=J.createElement("div").style,le={},ue=/^(none|table(?!-c[ea]).+)/,de=/^--/,fe={position:"absolute",visibility:"hidden",display:"block"},ge={letterSpacing:"0",fontWeight:"400"};gt.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=I(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,s,o,a=f(e),h=de.test(e),c=t.style;if(h||(e=M(a)),o=gt.cssHooks[e]||gt.cssHooks[a],void 0===i)return o&&"get"in o&&void 0!==(r=o.get(t,!1,n))?r:c[e];"string"==(s=typeof i)&&(r=Nt.exec(i))&&r[1]&&(i=m(t,e,r),s="number"),null!=i&&i==i&&("number"!==s||h||(i+=r&&r[3]||(gt.cssNumber[a]?"":"px")),ct.clearCloneStyle||""!==i||0!==e.indexOf("background")||(c[e]="inherit"),o&&"set"in o&&void 0===(i=o.set(t,i,n))||(h?c.setProperty(e,i):c[e]=i))}},css:function(t,e,i,n){var r,s,o,a=f(e);return de.test(e)||(e=M(a)),(o=gt.cssHooks[e]||gt.cssHooks[a])&&"get"in o&&(r=o.get(t,!0,i)),void 0===r&&(r=I(t,e,n)),"normal"===r&&e in ge&&(r=ge[e]),""===i||i?(s=parseFloat(r),!0===i||isFinite(s)?s||0:r):r}}),gt.each(["height","width"],function(t,e){gt.cssHooks[e]={get:function(t,i,n){if(i)return!ue.test(gt.css(t,"display"))||t.getClientRects().length&&t.getBoundingClientRect().width?N(t,e,n):Gt(t,fe,function(){return N(t,e,n)})},set:function(t,i,n){var r,s=oe(t),o=!ct.scrollboxSize()&&"absolute"===s.position,a=(o||n)&&"border-box"===gt.css(t,"boxSizing",!1,s),h=n?R(t,e,n,a,s):0;return a&&o&&(h-=Math.ceil(t["offset"+e[0].toUpperCase()+e.slice(1)]-parseFloat(s[e])-R(t,e,"border",!1,s)-.5)),h&&(r=Nt.exec(i))&&"px"!==(r[3]||"px")&&(t.style[e]=i,i=gt.css(t,e)),j(0,i,h)}}}),gt.cssHooks.marginLeft=D(ct.reliableMarginLeft,function(t,e){if(e)return(parseFloat(I(t,"marginLeft"))||t.getBoundingClientRect().left-Gt(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),gt.each({margin:"",padding:"",border:"Width"},function(t,e){gt.cssHooks[t+e]={expand:function(i){for(var n=0,r={},s="string"==typeof i?i.split(" "):[i];n<4;n++)r[t+Ft[n]+e]=s[n]||s[n-2]||s[0];return r}},"margin"!==t&&(gt.cssHooks[t+e].set=j)}),gt.fn.extend({css:function(t,e){return At(this,function(t,e,i){var n,r,s={},o=0;if(Array.isArray(e)){for(n=oe(t),r=e.length;o<r;o++)s[e[o]]=gt.css(t,e[o],!1,n);return s}return void 0!==i?gt.style(t,e,i):gt.css(t,e)},t,e,1<arguments.length)}}),((gt.Tween=F).prototype={constructor:F,init:function(t,e,i,n,r,s){this.elem=t,this.prop=i,this.easing=r||gt.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=s||(gt.cssNumber[i]?"":"px")},cur:function(){var t=F.propHooks[this.prop];return t&&t.get?t.get(this):F.propHooks._default.get(this)},run:function(t){var e,i=F.propHooks[this.prop];return this.options.duration?this.pos=e=gt.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):F.propHooks._default.set(this),this}}).init.prototype=F.prototype,(F.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=gt.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){gt.fx.step[t.prop]?gt.fx.step[t.prop](t):1!==t.elem.nodeType||!gt.cssHooks[t.prop]&&null==t.elem.style[M(t.prop)]?t.elem[t.prop]=t.now:gt.style(t.elem,t.prop,t.now+t.unit)}}}).scrollTop=F.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},gt.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},gt.fx=F.prototype.init,gt.fx.step={};var pe,me,ve,ye,be=/^(?:toggle|show|hide)$/,_e=/queueHooks$/;gt.Animation=gt.extend(G,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return m(i.elem,t,Nt.exec(e),i),i}]},tweener:function(t,e){lt(t)?(e=t,t=["*"]):t=t.match(Ct);for(var i,n=0,r=t.length;n<r;n++)i=t[n],G.tweeners[i]=G.tweeners[i]||[],G.tweeners[i].unshift(e)},prefilters:[function(t,e,i){var n,r,s,o,a,h,c,l,u="width"in e||"height"in e,d=this,f={},g=t.style,p=t.nodeType&&zt(t),m=It.get(t,"fxshow");for(n in i.queue||(null==(o=gt._queueHooks(t,"fx")).unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,d.always(function(){d.always(function(){o.unqueued--,gt.queue(t,"fx").length||o.empty.fire()})})),e)if(r=e[n],be.test(r)){if(delete e[n],s=s||"toggle"===r,r===(p?"hide":"show")){if("show"!==r||!m||void 0===m[n])continue;p=!0}f[n]=m&&m[n]||gt.style(t,n)}if((h=!gt.isEmptyObject(e))||!gt.isEmptyObject(f))for(n in u&&1===t.nodeType&&(i.overflow=[g.overflow,g.overflowX,g.overflowY],null==(c=m&&m.display)&&(c=It.get(t,"display")),"none"===(l=gt.css(t,"display"))&&(c?l=c:(v([t],!0),c=t.style.display||c,l=gt.css(t,"display"),v([t]))),("inline"===l||"inline-block"===l&&null!=c)&&"none"===gt.css(t,"float")&&(h||(d.done(function(){g.display=c}),null==c&&(l=g.display,c="none"===l?"":l)),g.display="inline-block")),i.overflow&&(g.overflow="hidden",d.always(function(){g.overflow=i.overflow[0],g.overflowX=i.overflow[1],g.overflowY=i.overflow[2]})),h=!1,f)h||(m?"hidden"in m&&(p=m.hidden):m=It.access(t,"fxshow",{display:c}),s&&(m.hidden=!p),p&&v([t],!0),d.done(function(){for(n in p||v([t]),It.remove(t,"fxshow"),f)gt.style(t,n,f[n])})),h=z(p?m[n]:0,n,d),n in m||(m[n]=h.start,p&&(h.end=h.start,h.start=0))}],prefilter:function(t,e){e?G.prefilters.unshift(t):G.prefilters.push(t)}}),gt.speed=function(t,e,i){var n=t&&"object"==typeof t?gt.extend({},t):{complete:i||!i&&e||lt(t)&&t,duration:t,easing:i&&e||e&&!lt(e)&&e};return gt.fx.off?n.duration=0:"number"!=typeof n.duration&&(n.duration in gt.fx.speeds?n.duration=gt.fx.speeds[n.duration]:n.duration=gt.fx.speeds._default),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){lt(n.old)&&n.old.call(this),n.queue&&gt.dequeue(this,n.queue)},n},gt.fn.extend({fadeTo:function(t,e,i,n){return this.filter(zt).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var r=gt.isEmptyObject(t),s=gt.speed(e,i,n),o=function(){var e=G(this,gt.extend({},t),s);(r||It.get(this,"finish"))&&e.stop(!0)};return o.finish=o,r||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(t,e,i){var n=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&!1!==t&&this.queue(t||"fx",[]),this.each(function(){var e=!0,r=null!=t&&t+"queueHooks",s=gt.timers,o=It.get(this);if(r)o[r]&&o[r].stop&&n(o[r]);else for(r in o)o[r]&&o[r].stop&&_e.test(r)&&n(o[r]);for(r=s.length;r--;)s[r].elem!==this||null!=t&&s[r].queue!==t||(s[r].anim.stop(i),e=!1,s.splice(r,1));!e&&i||gt.dequeue(this,t)})},finish:function(t){return!1!==t&&(t=t||"fx"),this.each(function(){var e,i=It.get(this),n=i[t+"queue"],r=i[t+"queueHooks"],s=gt.timers,o=n?n.length:0;for(i.finish=!0,gt.queue(this,t,[]),r&&r.stop&&r.stop.call(this,!0),e=s.length;e--;)s[e].elem===this&&s[e].queue===t&&(s[e].anim.stop(!0),s.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish})}}),gt.each(["toggle","show","hide"],function(t,e){var i=gt.fn[e];gt.fn[e]=function(t,n,r){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(U(e,!0),t,n,r)}}),gt.each({slideDown:U("show"),slideUp:U("hide"),slideToggle:U("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){gt.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),gt.timers=[],gt.fx.tick=function(){var t,e=0,i=gt.timers;for(pe=Date.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||gt.fx.stop(),pe=void 0},gt.fx.timer=function(t){gt.timers.push(t),gt.fx.start()},gt.fx.interval=13,gt.fx.start=function(){me||(me=!0,B())},gt.fx.stop=function(){me=null},gt.fx.speeds={slow:600,fast:200,_default:400},gt.fn.delay=function(e,i){return e=gt.fx&&gt.fx.speeds[e]||e,i=i||"fx",this.queue(i,function(i,n){var r=t.setTimeout(i,e);n.stop=function(){t.clearTimeout(r)}})},ve=J.createElement("input"),ye=J.createElement("select").appendChild(J.createElement("option")),ve.type="checkbox",ct.checkOn=""!==ve.value,ct.optSelected=ye.selected,(ve=J.createElement("input")).value="t",ve.type="radio",ct.radioValue="t"===ve.value;var we,Te=gt.expr.attrHandle;gt.fn.extend({attr:function(t,e){return At(this,gt.attr,t,e,1<arguments.length)},removeAttr:function(t){return this.each(function(){gt.removeAttr(this,t)})}}),gt.extend({attr:function(t,e,i){var n,r,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===t.getAttribute?gt.prop(t,e,i):(1===s&&gt.isXMLDoc(t)||(r=gt.attrHooks[e.toLowerCase()]||(gt.expr.match.bool.test(e)?we:void 0)),void 0!==i?null===i?void gt.removeAttr(t,e):r&&"set"in r&&void 0!==(n=r.set(t,i,e))?n:(t.setAttribute(e,i+""),i):r&&"get"in r&&null!==(n=r.get(t,e))?n:null==(n=gt.find.attr(t,e))?void 0:n)},attrHooks:{type:{set:function(t,e){if(!ct.radioValue&&"radio"===e&&s(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n=0,r=e&&e.match(Ct);if(r&&1===t.nodeType)for(;i=r[n++];)t.removeAttribute(i)}}),we={set:function(t,e,i){return!1===e?gt.removeAttr(t,i):t.setAttribute(i,i),i}},gt.each(gt.expr.match.bool.source.match(/\w+/g),function(t,e){var i=Te[e]||gt.find.attr;Te[e]=function(t,e,n){var r,s,o=e.toLowerCase();return n||(s=Te[o],Te[o]=r,r=null!=i(t,e,n)?o:null,Te[o]=s),r}});var xe=/^(?:input|select|textarea|button)$/i,Se=/^(?:a|area)$/i;gt.fn.extend({prop:function(t,e){return At(this,gt.prop,t,e,1<arguments.length)},removeProp:function(t){return this.each(function(){delete this[gt.propFix[t]||t]})}}),gt.extend({prop:function(t,e,i){var n,r,s=t.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&gt.isXMLDoc(t)||(e=gt.propFix[e]||e,r=gt.propHooks[e]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(t,i,e))?n:t[e]=i:r&&"get"in r&&null!==(n=r.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=gt.find.attr(t,"tabindex");return e?parseInt(e,10):xe.test(t.nodeName)||Se.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),ct.optSelected||(gt.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),gt.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){gt.propFix[this.toLowerCase()]=this}),gt.fn.extend({addClass:function(t){var e,i,n,r,s,o,a,h=0;if(lt(t))return this.each(function(e){gt(this).addClass(t.call(this,e,q(this)))});if((e=V(t)).length)for(;i=this[h++];)if(r=q(i),n=1===i.nodeType&&" "+W(r)+" "){for(o=0;s=e[o++];)n.indexOf(" "+s+" ")<0&&(n+=s+" ");r!==(a=W(n))&&i.setAttribute("class",a)}return this},removeClass:function(t){var e,i,n,r,s,o,a,h=0;if(lt(t))return this.each(function(e){gt(this).removeClass(t.call(this,e,q(this)))});if(!arguments.length)return this.attr("class","");if((e=V(t)).length)for(;i=this[h++];)if(r=q(i),n=1===i.nodeType&&" "+W(r)+" "){for(o=0;s=e[o++];)for(;-1<n.indexOf(" "+s+" ");)n=n.replace(" "+s+" "," ");r!==(a=W(n))&&i.setAttribute("class",a)}return this},toggleClass:function(t,e){var i=typeof t,n="string"===i||Array.isArray(t);return"boolean"==typeof e&&n?e?this.addClass(t):this.removeClass(t):lt(t)?this.each(function(i){gt(this).toggleClass(t.call(this,i,q(this),e),e)}):this.each(function(){var e,r,s,o;if(n)for(r=0,s=gt(this),o=V(t);e=o[r++];)s.hasClass(e)?s.removeClass(e):s.addClass(e);else void 0!==t&&"boolean"!==i||((e=q(this))&&It.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===t?"":It.get(this,"__className__")||""))})},hasClass:function(t){var e,i,n=0;for(e=" "+t+" ";i=this[n++];)if(1===i.nodeType&&-1<(" "+W(q(i))+" ").indexOf(e))return!0;return!1}});var Ce=/\r/g;gt.fn.extend({val:function(t){var e,i,n,r=this[0];return arguments.length?(n=lt(t),this.each(function(i){var r;1===this.nodeType&&(null==(r=n?t.call(this,i,gt(this).val()):t)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=gt.map(r,function(t){return null==t?"":t+""})),(e=gt.valHooks[this.type]||gt.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&void 0!==e.set(this,r,"value")||(this.value=r))})):r?(e=gt.valHooks[r.type]||gt.valHooks[r.nodeName.toLowerCase()])&&"get"in e&&void 0!==(i=e.get(r,"value"))?i:"string"==typeof(i=r.value)?i.replace(Ce,""):null==i?"":i:void 0}}),gt.extend({valHooks:{option:{get:function(t){var e=gt.find.attr(t,"value");return null!=e?e:W(gt.text(t))}},select:{get:function(t){var e,i,n,r=t.options,o=t.selectedIndex,a="select-one"===t.type,h=a?null:[],c=a?o+1:r.length;for(n=o<0?c:a?o:0;n<c;n++)if(((i=r[n]).selected||n===o)&&!i.disabled&&(!i.parentNode.disabled||!s(i.parentNode,"optgroup"))){if(e=gt(i).val(),a)return e;h.push(e)}return h},set:function(t,e){for(var i,n,r=t.options,s=gt.makeArray(e),o=r.length;o--;)((n=r[o]).selected=-1<gt.inArray(gt.valHooks.option.get(n),s))&&(i=!0);return i||(t.selectedIndex=-1),s}}}}),gt.each(["radio","checkbox"],function(){gt.valHooks[this]={set:function(t,e){if(Array.isArray(e))return t.checked=-1<gt.inArray(gt(t).val(),e)}},ct.checkOn||(gt.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}),ct.focusin="onfocusin"in t;var Ee=/^(?:focusinfocus|focusoutblur)$/,Oe=function(t){t.stopPropagation()};gt.extend(gt.event,{trigger:function(e,i,n,r){var s,o,a,h,c,l,u,d,f=[n||J],g=ot.call(e,"type")?e.type:e,p=ot.call(e,"namespace")?e.namespace.split("."):[];if(o=d=a=n=n||J,3!==n.nodeType&&8!==n.nodeType&&!Ee.test(g+gt.event.triggered)&&(-1<g.indexOf(".")&&(g=(p=g.split(".")).shift(),p.sort()),c=g.indexOf(":")<0&&"on"+g,(e=e[gt.expando]?e:new gt.Event(g,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=p.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),i=null==i?[e]:gt.makeArray(i,[e]),u=gt.event.special[g]||{},r||!u.trigger||!1!==u.trigger.apply(n,i))){if(!r&&!u.noBubble&&!ut(n)){for(h=u.delegateType||g,Ee.test(h+g)||(o=o.parentNode);o;o=o.parentNode)f.push(o),a=o;a===(n.ownerDocument||J)&&f.push(a.defaultView||a.parentWindow||t)}for(s=0;(o=f[s++])&&!e.isPropagationStopped();)d=o,e.type=1<s?h:u.bindType||g,(l=(It.get(o,"events")||{})[e.type]&&It.get(o,"handle"))&&l.apply(o,i),(l=c&&o[c])&&l.apply&&Lt(o)&&(e.result=l.apply(o,i),!1===e.result&&e.preventDefault());return e.type=g,r||e.isDefaultPrevented()||u._default&&!1!==u._default.apply(f.pop(),i)||!Lt(n)||c&&lt(n[g])&&!ut(n)&&((a=n[c])&&(n[c]=null),gt.event.triggered=g,e.isPropagationStopped()&&d.addEventListener(g,Oe),n[g](),e.isPropagationStopped()&&d.removeEventListener(g,Oe),gt.event.triggered=void 0,a&&(n[c]=a)),e.result}},simulate:function(t,e,i){var n=gt.extend(new gt.Event,i,{type:t,isSimulated:!0});gt.event.trigger(n,null,e)}}),gt.fn.extend({trigger:function(t,e){return this.each(function(){gt.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];if(i)return gt.event.trigger(t,e,i,!0)}}),ct.focusin||gt.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){gt.event.simulate(e,t.target,gt.event.fix(t))};gt.event.special[e]={setup:function(){var n=this.ownerDocument||this,r=It.access(n,e);r||n.addEventListener(t,i,!0),It.access(n,e,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this,r=It.access(n,e)-1;r?It.access(n,e,r):(n.removeEventListener(t,i,!0),It.remove(n,e))}}});var Ae=t.location,Pe=Date.now(),ke=/\?/;gt.parseXML=function(e){var i;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(e){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||gt.error("Invalid XML: "+e),i};var Le=/\[\]$/,Ie=/\r?\n/g,De=/^(?:submit|button|image|reset|file)$/i,Me=/^(?:input|select|textarea|keygen)/i;gt.param=function(t,e){var i,n=[],r=function(t,e){var i=lt(e)?e():e;n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(null==i?"":i)};if(null==t)return"";if(Array.isArray(t)||t.jquery&&!gt.isPlainObject(t))gt.each(t,function(){r(this.name,this.value)});else for(i in t)X(i,t[i],e,r);return n.join("&")},gt.fn.extend({serialize:function(){return gt.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=gt.prop(this,"elements");return t?gt.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!gt(this).is(":disabled")&&Me.test(this.nodeName)&&!De.test(t)&&(this.checked||!qt.test(t))}).map(function(t,e){var i=gt(this).val();return null==i?null:Array.isArray(i)?gt.map(i,function(t){return{name:e.name,value:t.replace(Ie,"\r\n")}}):{name:e.name,value:i.replace(Ie,"\r\n")}}).get()}});var je=/%20/g,Re=/#.*$/,Ne=/([?&])_=[^&]*/,Fe=/^(.*?):[ \t]*([^\r\n]*)$/gm,Be=/^(?:GET|HEAD)$/,He=/^\/\//,Ue={},ze={},Ge="*/".concat("*"),We=J.createElement("a");We.href=Ae.href,gt.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ae.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ae.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ge,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":gt.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?Q(Q(t,gt.ajaxSettings),e):Q(gt.ajaxSettings,t)},ajaxPrefilter:Y(Ue),ajaxTransport:Y(ze),ajax:function(e,i){function n(e,i,n,a){var c,d,f,_,w,T=i;l||(l=!0,h&&t.clearTimeout(h),r=void 0,o=a||"",x.readyState=0<e?4:0,c=200<=e&&e<300||304===e,n&&(_=function(t,e,i){for(var n,r,s,o,a=t.contents,h=t.dataTypes;"*"===h[0];)h.shift(),void 0===n&&(n=t.mimeType||e.getResponseHeader("Content-Type"));if(n)for(r in a)if(a[r]&&a[r].test(n)){h.unshift(r);break}if(h[0]in i)s=h[0];else{for(r in i){if(!h[0]||t.converters[r+" "+h[0]]){s=r;break}o||(o=r)}s=s||o}if(s)return s!==h[0]&&h.unshift(s),i[s]}(g,x,n)),_=function(t,e,i,n){var r,s,o,a,h,c={},l=t.dataTypes.slice();if(l[1])for(o in t.converters)c[o.toLowerCase()]=t.converters[o];for(s=l.shift();s;)if(t.responseFields[s]&&(i[t.responseFields[s]]=e),!h&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),h=s,s=l.shift())if("*"===s)s=h;else if("*"!==h&&h!==s){if(!(o=c[h+" "+s]||c["* "+s]))for(r in c)if((a=r.split(" "))[1]===s&&(o=c[h+" "+a[0]]||c["* "+a[0]])){!0===o?o=c[r]:!0!==c[r]&&(s=a[0],l.unshift(a[1]));break}if(!0!==o)if(o&&t.throws)e=o(e);else try{e=o(e)}catch(t){return{state:"parsererror",error:o?t:"No conversion from "+h+" to "+s}}}return{state:"success",data:e}}(g,_,x,c),c?(g.ifModified&&((w=x.getResponseHeader("Last-Modified"))&&(gt.lastModified[s]=w),(w=x.getResponseHeader("etag"))&&(gt.etag[s]=w)),204===e||"HEAD"===g.type?T="nocontent":304===e?T="notmodified":(T=_.state,d=_.data,c=!(f=_.error))):(f=T,!e&&T||(T="error",e<0&&(e=0))),x.status=e,x.statusText=(i||T)+"",c?v.resolveWith(p,[d,T,x]):v.rejectWith(p,[x,T,f]),x.statusCode(b),b=void 0,u&&m.trigger(c?"ajaxSuccess":"ajaxError",[x,g,c?d:f]),y.fireWith(p,[x,T]),u&&(m.trigger("ajaxComplete",[x,g]),--gt.active||gt.event.trigger("ajaxStop")))}"object"==typeof e&&(i=e,e=void 0),i=i||{};var r,s,o,a,h,c,l,u,d,f,g=gt.ajaxSetup({},i),p=g.context||g,m=g.context&&(p.nodeType||p.jquery)?gt(p):gt.event,v=gt.Deferred(),y=gt.Callbacks("once memory"),b=g.statusCode||{},_={},w={},T="canceled",x={readyState:0,getResponseHeader:function(t){var e;if(l){if(!a)for(a={};e=Fe.exec(o);)a[e[1].toLowerCase()+" "]=(a[e[1].toLowerCase()+" "]||[]).concat(e[2]);e=a[t.toLowerCase()+" "]}return null==e?null:e.join(", ")},getAllResponseHeaders:function(){return l?o:null},setRequestHeader:function(t,e){return null==l&&(t=w[t.toLowerCase()]=w[t.toLowerCase()]||t,_[t]=e),this},overrideMimeType:function(t){return null==l&&(g.mimeType=t),this},statusCode:function(t){var e;if(t)if(l)x.always(t[x.status]);else for(e in t)b[e]=[b[e],t[e]];return this},abort:function(t){var e=t||T;return r&&r.abort(e),n(0,e),this}};if(v.promise(x),g.url=((e||g.url||Ae.href)+"").replace(He,Ae.protocol+"//"),g.type=i.method||i.type||g.method||g.type,g.dataTypes=(g.dataType||"*").toLowerCase().match(Ct)||[""],null==g.crossDomain){c=J.createElement("a");try{c.href=g.url,c.href=c.href,g.crossDomain=We.protocol+"//"+We.host!=c.protocol+"//"+c.host}catch(e){g.crossDomain=!0}}if(g.data&&g.processData&&"string"!=typeof g.data&&(g.data=gt.param(g.data,g.traditional)),Z(Ue,g,i,x),l)return x;for(d in(u=gt.event&&g.global)&&0==gt.active++&&gt.event.trigger("ajaxStart"),g.type=g.type.toUpperCase(),g.hasContent=!Be.test(g.type),s=g.url.replace(Re,""),g.hasContent?g.data&&g.processData&&0===(g.contentType||"").indexOf("application/x-www-form-urlencoded")&&(g.data=g.data.replace(je,"+")):(f=g.url.slice(s.length),g.data&&(g.processData||"string"==typeof g.data)&&(s+=(ke.test(s)?"&":"?")+g.data,delete g.data),!1===g.cache&&(s=s.replace(Ne,"$1"),f=(ke.test(s)?"&":"?")+"_="+Pe+++f),g.url=s+f),g.ifModified&&(gt.lastModified[s]&&x.setRequestHeader("If-Modified-Since",gt.lastModified[s]),gt.etag[s]&&x.setRequestHeader("If-None-Match",gt.etag[s])),(g.data&&g.hasContent&&!1!==g.contentType||i.contentType)&&x.setRequestHeader("Content-Type",g.contentType),x.setRequestHeader("Accept",g.dataTypes[0]&&g.accepts[g.dataTypes[0]]?g.accepts[g.dataTypes[0]]+("*"!==g.dataTypes[0]?", "+Ge+"; q=0.01":""):g.accepts["*"]),g.headers)x.setRequestHeader(d,g.headers[d]);if(g.beforeSend&&(!1===g.beforeSend.call(p,x,g)||l))return x.abort();if(T="abort",y.add(g.complete),x.done(g.success),x.fail(g.error),r=Z(ze,g,i,x)){if(x.readyState=1,u&&m.trigger("ajaxSend",[x,g]),l)return x;g.async&&0<g.timeout&&(h=t.setTimeout(function(){x.abort("timeout")},g.timeout));try{l=!1,r.send(_,n)}catch(e){if(l)throw e;n(-1,e)}}else n(-1,"No Transport");return x},getJSON:function(t,e,i){return gt.get(t,e,i,"json")},getScript:function(t,e){return gt.get(t,void 0,e,"script")}}),gt.each(["get","post"],function(t,e){gt[e]=function(t,i,n,r){return lt(i)&&(r=r||n,n=i,i=void 0),gt.ajax(gt.extend({url:t,type:e,dataType:r,data:i,success:n},gt.isPlainObject(t)&&t))}}),gt._evalUrl=function(t,e){return gt.ajax({url:t,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(t){gt.globalEval(t,e)}})},gt.fn.extend({wrapAll:function(t){var e;return this[0]&&(lt(t)&&(t=t.call(this[0])),e=gt(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this},wrapInner:function(t){return lt(t)?this.each(function(e){gt(this).wrapInner(t.call(this,e))}):this.each(function(){var e=gt(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=lt(t);return this.each(function(i){gt(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(t){return this.parent(t).not("body").each(function(){gt(this).replaceWith(this.childNodes)}),this}}),gt.expr.pseudos.hidden=function(t){return!gt.expr.pseudos.visible(t)},gt.expr.pseudos.visible=function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},gt.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(t){}};var qe={0:200,1223:204},Ve=gt.ajaxSettings.xhr();ct.cors=!!Ve&&"withCredentials"in Ve,ct.ajax=Ve=!!Ve,gt.ajaxTransport(function(e){var i,n;if(ct.cors||Ve&&!e.crossDomain)return{send:function(r,s){var o,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)a[o]=e.xhrFields[o];for(o in e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)a.setRequestHeader(o,r[o]);i=function(t){
return function(){i&&(i=n=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?s(0,"error"):s(a.status,a.statusText):s(qe[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=i(),n=a.onerror=a.ontimeout=i("error"),void 0!==a.onabort?a.onabort=n:a.onreadystatechange=function(){4===a.readyState&&t.setTimeout(function(){i&&n()})},i=i("abort");try{a.send(e.hasContent&&e.data||null)}catch(r){if(i)throw r}},abort:function(){i&&i()}}}),gt.ajaxPrefilter(function(t){t.crossDomain&&(t.contents.script=!1)}),gt.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return gt.globalEval(t),t}}}),gt.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),gt.ajaxTransport("script",function(t){var e,i;if(t.crossDomain||t.scriptAttrs)return{send:function(n,r){e=gt("<script>").attr(t.scriptAttrs||{}).prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&r("error"===t.type?404:200,t.type)}),J.head.appendChild(e[0])},abort:function(){i&&i()}}});var Xe,Ye=[],Ze=/(=)\?(?=&|$)|\?\?/;gt.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Ye.pop()||gt.expando+"_"+Pe++;return this[t]=!0,t}}),gt.ajaxPrefilter("json jsonp",function(e,i,n){var r,s,o,a=!1!==e.jsonp&&(Ze.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ze.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=lt(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Ze,"$1"+r):!1!==e.jsonp&&(e.url+=(ke.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||gt.error(r+" was not called"),o[0]},e.dataTypes[0]="json",s=t[r],t[r]=function(){o=arguments},n.always(function(){void 0===s?gt(t).removeProp(r):t[r]=s,e[r]&&(e.jsonpCallback=i.jsonpCallback,Ye.push(r)),o&&lt(s)&&s(o[0]),o=s=void 0}),"script"}),ct.createHTMLDocument=((Xe=J.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Xe.childNodes.length),gt.parseHTML=function(t,e,i){return"string"!=typeof t?[]:("boolean"==typeof e&&(i=e,e=!1),e||(ct.createHTMLDocument?((n=(e=J.implementation.createHTMLDocument("")).createElement("base")).href=J.location.href,e.head.appendChild(n)):e=J),s=!i&&[],(r=_t.exec(t))?[e.createElement(r[1])]:(r=_([t],e,s),s&&s.length&&gt(s).remove(),gt.merge([],r.childNodes)));var n,r,s},gt.fn.load=function(t,e,i){var n,r,s,o=this,a=t.indexOf(" ");return-1<a&&(n=W(t.slice(a)),t=t.slice(0,a)),lt(e)?(i=e,e=void 0):e&&"object"==typeof e&&(r="POST"),0<o.length&&gt.ajax({url:t,type:r||"GET",dataType:"html",data:e}).done(function(t){s=arguments,o.html(n?gt("<div>").append(gt.parseHTML(t)).find(n):t)}).always(i&&function(t,e){o.each(function(){i.apply(this,s||[t.responseText,e,t])})}),this},gt.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){gt.fn[e]=function(t){return this.on(e,t)}}),gt.expr.pseudos.animated=function(t){return gt.grep(gt.timers,function(e){return t===e.elem}).length},gt.offset={setOffset:function(t,e,i){var n,r,s,o,a,h,c=gt.css(t,"position"),l=gt(t),u={};"static"===c&&(t.style.position="relative"),a=l.offset(),s=gt.css(t,"top"),h=gt.css(t,"left"),("absolute"===c||"fixed"===c)&&-1<(s+h).indexOf("auto")?(o=(n=l.position()).top,r=n.left):(o=parseFloat(s)||0,r=parseFloat(h)||0),lt(e)&&(e=e.call(t,i,gt.extend({},a))),null!=e.top&&(u.top=e.top-a.top+o),null!=e.left&&(u.left=e.left-a.left+r),"using"in e?e.using.call(t,u):l.css(u)}},gt.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){gt.offset.setOffset(this,t,e)});var e,i,n=this[0];return n?n.getClientRects().length?(e=n.getBoundingClientRect(),i=n.ownerDocument.defaultView,{top:e.top+i.pageYOffset,left:e.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var t,e,i,n=this[0],r={top:0,left:0};if("fixed"===gt.css(n,"position"))e=n.getBoundingClientRect();else{for(e=this.offset(),i=n.ownerDocument,t=n.offsetParent||i.documentElement;t&&(t===i.body||t===i.documentElement)&&"static"===gt.css(t,"position");)t=t.parentNode;t&&t!==n&&1===t.nodeType&&((r=gt(t).offset()).top+=gt.css(t,"borderTopWidth",!0),r.left+=gt.css(t,"borderLeftWidth",!0))}return{top:e.top-r.top-gt.css(n,"marginTop",!0),left:e.left-r.left-gt.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===gt.css(t,"position");)t=t.offsetParent;return t||Bt})}}),gt.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var i="pageYOffset"===e;gt.fn[t]=function(n){return At(this,function(t,n,r){var s;if(ut(t)?s=t:9===t.nodeType&&(s=t.defaultView),void 0===r)return s?s[e]:t[n];s?s.scrollTo(i?s.pageXOffset:r,i?r:s.pageYOffset):t[n]=r},t,n,arguments.length)}}),gt.each(["top","left"],function(t,e){gt.cssHooks[e]=D(ct.pixelPosition,function(t,i){if(i)return i=I(t,e),se.test(i)?gt(t).position()[e]+"px":i})}),gt.each({Height:"height",Width:"width"},function(t,e){gt.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,n){gt.fn[n]=function(r,s){var o=arguments.length&&(i||"boolean"!=typeof r),a=i||(!0===r||!0===s?"margin":"border");return At(this,function(e,i,r){var s;return ut(e)?0===n.indexOf("outer")?e["inner"+t]:e.document.documentElement["client"+t]:9===e.nodeType?(s=e.documentElement,Math.max(e.body["scroll"+t],s["scroll"+t],e.body["offset"+t],s["offset"+t],s["client"+t])):void 0===r?gt.css(e,i,a):gt.style(e,i,r,a)},e,o?r:void 0,o)}})}),gt.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(t,e){gt.fn[e]=function(t,i){return 0<arguments.length?this.on(e,null,t,i):this.trigger(e)}}),gt.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),gt.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}}),gt.proxy=function(t,e){var i,n,r;if("string"==typeof e&&(i=t[e],e=t,t=i),lt(t))return n=tt.call(arguments,2),(r=function(){return t.apply(e||this,n.concat(tt.call(arguments)))}).guid=t.guid=t.guid||gt.guid++,r},gt.holdReady=function(t){t?gt.readyWait++:gt.ready(!0)},gt.isArray=Array.isArray,gt.parseJSON=JSON.parse,gt.nodeName=s,gt.isFunction=lt,gt.isWindow=ut,gt.camelCase=f,gt.type=n,gt.now=Date.now,gt.isNumeric=function(t){var e=gt.type(t);return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))},"function"==typeof define&&define.amd&&define("jquery",[],function(){return gt});var Qe=t.jQuery,Ke=t.$;return gt.noConflict=function(e){return t.$===gt&&(t.$=Ke),e&&t.jQuery===gt&&(t.jQuery=Qe),gt},e||(t.jQuery=t.$=gt),gt}),define("jquery-private",["jquery"],function(t){return t.noConflict()}),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i){this.initialize(t,e,i)},e=t.prototype;e.type=null,e.target=null,e.currentTarget=null,e.eventPhase=0,e.bubbles=!1,e.cancelable=!1,e.timeStamp=0,e.defaultPrevented=!1,e.propagationStopped=!1,e.immediatePropagationStopped=!1,e.removed=!1,e.initialize=function(t,e,i){this.type=t,this.bubbles=e,this.cancelable=i,this.timeStamp=(new Date).getTime()},e.preventDefault=function(){this.defaultPrevented=!0},e.stopPropagation=function(){this.propagationStopped=!0},e.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},e.remove=function(){this.removed=!0},e.clone=function(){return new t(this.type,this.bubbles,this.cancelable)},e.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(){},e=t.prototype;t.initialize=function(t){t.addEventListener=e.addEventListener,t.on=e.on,t.removeEventListener=t.off=e.removeEventListener,t.removeAllEventListeners=e.removeAllEventListeners,t.hasEventListener=e.hasEventListener,t.dispatchEvent=e.dispatchEvent,t._dispatchEvent=e._dispatchEvent,t.willTrigger=e.willTrigger},e._listeners=null,e._captureListeners=null,e.initialize=function(){},e.addEventListener=function(t,e,i){var n;n=i?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var r=n[t];return r&&this.removeEventListener(t,e,i),r=n[t],r?r.push(e):n[t]=[e],e},e.on=function(t,e,i,n,r,s){return e.handleEvent&&(i=i||e,e=e.handleEvent),i=i||this,this.addEventListener(t,function(t){e.call(i,t,r),n&&t.remove()},s)},e.removeEventListener=function(t,e,i){var n=i?this._captureListeners:this._listeners;if(n){var r=n[t];if(r)for(var s=0,o=r.length;o>s;s++)if(r[s]==e){1==o?delete n[t]:r.splice(s,1);break}}},e.off=e.removeEventListener,e.removeAllEventListeners=function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null},e.dispatchEvent=function(t,e){if("string"==typeof t){var i=this._listeners;if(!i||!i[t])return!1;t=new createjs.Event(t)}if(t.target=e||this,t.bubbles&&this.parent){for(var n=this,r=[n];n.parent;)r.push(n=n.parent);var s,o=r.length;for(s=o-1;s>=0&&!t.propagationStopped;s--)r[s]._dispatchEvent(t,1+(0==s));for(s=1;o>s&&!t.propagationStopped;s++)r[s]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return t.defaultPrevented},e.hasEventListener=function(t){var e=this._listeners,i=this._captureListeners;return!!(e&&e[t]||i&&i[t])},e.willTrigger=function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.parent}return!1},e.toString=function(){return"[EventDispatcher]"},e._dispatchEvent=function(t,e){var i,n=1==e?this._captureListeners:this._listeners;if(t&&n){var r=n[t.type];if(!r||!(i=r.length))return;t.currentTarget=this,t.eventPhase=e,t.removed=!1,r=r.slice();for(var s=0;i>s&&!t.immediatePropagationStopped;s++){var o=r[s];o.handleEvent?o.handleEvent(t):o(t),t.removed&&(this.off(t.type,o,1==e),t.removed=!1)}}},createjs.EventDispatcher=t}(),this.createjs=this.createjs||{},function(){"use strict";createjs.indexOf=function(t,e){for(var i=0,n=t.length;n>i;i++)if(e===t[i])return i;return-1}}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(){throw"UID cannot be instantiated"};t._nextID=0,t.get=function(){return t._nextID++},createjs.UID=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(){throw"Ticker cannot be instantiated."};t.RAF_SYNCHED="synched",t.RAF="raf",t.TIMEOUT="timeout",t.useRAF=!1,t.timingMode=null,t.maxDelta=0,t.removeEventListener=null,t.removeAllEventListeners=null,t.dispatchEvent=null,t.hasEventListener=null,t._listeners=null,createjs.EventDispatcher.initialize(t),t._addEventListener=t.addEventListener,t.addEventListener=function(){return!t._inited&&t.init(),t._addEventListener.apply(t,arguments)},t._paused=!1,t._inited=!1,t._startTime=0,t._pausedTime=0,t._ticks=0,t._pausedTicks=0,t._interval=50,t._lastTime=0,t._times=null,t._tickTimes=null,t._timerId=null,t._raf=!0,t.init=function(){t._inited||(t._inited=!0,t._times=[],t._tickTimes=[],t._startTime=t._getTime(),t._times.push(t._lastTime=0),t.setInterval(t._interval))},t.reset=function(){if(t._raf){var e=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;e&&e(t._timerId)}else clearTimeout(t._timerId);t.removeAllEventListeners("tick")},t.setInterval=function(e){t._interval=e,t._inited&&t._setupTick()},t.getInterval=function(){return t._interval},t.setFPS=function(e){t.setInterval(1e3/e)},t.getFPS=function(){return 1e3/t._interval},t.getMeasuredTickTime=function(e){var i=0,n=t._tickTimes;if(n.length<1)return-1;e=Math.min(n.length,e||0|t.getFPS());for(var r=0;e>r;r++)i+=n[r];return i/e},t.getMeasuredFPS=function(e){var i=t._times;return i.length<2?-1:(e=Math.min(i.length-1,e||0|t.getFPS()),1e3/((i[0]-i[e])/e))},t.setPaused=function(e){t._paused=e},t.getPaused=function(){return t._paused},t.getTime=function(e){return t._getTime()-t._startTime-(e?t._pausedTime:0)},t.getEventTime=function(e){return(t._lastTime||t._startTime)-(e?t._pausedTime:0)},t.getTicks=function(e){return t._ticks-(e?t._pausedTicks:0)},t._handleSynch=function(){var e=t._getTime()-t._startTime;t._timerId=null,t._setupTick(),e-t._lastTime>=.97*(t._interval-1)&&t._tick()},t._handleRAF=function(){t._timerId=null,t._setupTick(),t._tick()},t._handleTimeout=function(){t._timerId=null,t._setupTick(),t._tick()},t._setupTick=function(){if(null==t._timerId){var e=t.timingMode||t.useRAF&&t.RAF_SYNCHED;if(e==t.RAF_SYNCHED||e==t.RAF){var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(i)return t._timerId=i(e==t.RAF?t._handleRAF:t._handleSynch),void(t._raf=!0)}t._raf=!1,t._timerId=setTimeout(t._handleTimeout,t._interval)}},t._tick=function(){var e=t._getTime()-t._startTime,i=e-t._lastTime,n=t._paused;if(t._ticks++,n&&(t._pausedTicks++,t._pausedTime+=i),t._lastTime=e,t.hasEventListener("tick")){var r=new createjs.Event("tick"),s=t.maxDelta;r.delta=s&&i>s?s:i,r.paused=n,r.time=e,r.runTime=e-t._pausedTime,t.dispatchEvent(r)}for(t._tickTimes.unshift(t._getTime()-e);t._tickTimes.length>100;)t._tickTimes.pop();for(t._times.unshift(e);t._times.length>100;)t._times.pop()};var e=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);t._getTime=function(){return e&&e.call(performance)||(new Date).getTime()},createjs.Ticker=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i,n,r,s,o,a,h,c){this.initialize(t,e,i,n,r,s,o,a,h,c)},e=t.prototype=new createjs.Event;e.stageX=0,e.stageY=0,e.rawX=0,e.rawY=0,e.nativeEvent=null,e.pointerID=0,e.primary=!1,e.addEventListener=null,e.removeEventListener=null,e.removeAllEventListeners=null,e.dispatchEvent=null,e.hasEventListener=null,e._listeners=null,createjs.EventDispatcher.initialize(e),e._get_localX=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).x},e._get_localY=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).y};try{Object.defineProperties(e,{localX:{get:e._get_localX},localY:{get:e._get_localY}})}catch(t){}e.Event_initialize=e.initialize,e.initialize=function(t,e,i,n,r,s,o,a,h,c){this.Event_initialize(t,e,i),this.stageX=n,this.stageY=r,this.nativeEvent=s,this.pointerID=o,this.primary=a,this.rawX=null==h?n:h,this.rawY=null==c?r:c},e.clone=function(){return new t(this.type,this.bubbles,this.cancelable,this.stageX,this.stageY,this.target,this.nativeEvent,this.pointerID,this.primary,this.rawX,this.rawY)},e.toString=function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"},createjs.MouseEvent=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i,n,r,s){this.initialize(t,e,i,n,r,s)},e=t.prototype;t.identity=null,t.DEG_TO_RAD=Math.PI/180,e.a=1,e.b=0,e.c=0,e.d=1,e.tx=0,e.ty=0,e.alpha=1,e.shadow=null,e.compositeOperation=null,e.initialize=function(t,e,i,n,r,s){return this.a=null==t?1:t,this.b=e||0,this.c=i||0,this.d=null==n?1:n,this.tx=r||0,this.ty=s||0,this},e.prepend=function(t,e,i,n,r,s){var o=this.tx;if(1!=t||0!=e||0!=i||1!=n){var a=this.a,h=this.c;this.a=a*t+this.b*i,this.b=a*e+this.b*n,this.c=h*t+this.d*i,this.d=h*e+this.d*n}return this.tx=o*t+this.ty*i+r,this.ty=o*e+this.ty*n+s,this},e.append=function(t,e,i,n,r,s){var o=this.a,a=this.b,h=this.c,c=this.d;return this.a=t*o+e*h,this.b=t*a+e*c,this.c=i*o+n*h,this.d=i*a+n*c,this.tx=r*o+s*h+this.tx,this.ty=r*a+s*c+this.ty,this},e.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty),this.prependProperties(t.alpha,t.shadow,t.compositeOperation),this},e.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty),this.appendProperties(t.alpha,t.shadow,t.compositeOperation),this},e.prependTransform=function(e,i,n,r,s,o,a,h,c){if(s%360)var l=s*t.DEG_TO_RAD,u=Math.cos(l),d=Math.sin(l);else u=1,d=0;return(h||c)&&(this.tx-=h,this.ty-=c),o||a?(o*=t.DEG_TO_RAD,a*=t.DEG_TO_RAD,this.prepend(u*n,d*n,-d*r,u*r,0,0),this.prepend(Math.cos(a),Math.sin(a),-Math.sin(o),Math.cos(o),e,i)):this.prepend(u*n,d*n,-d*r,u*r,e,i),this},e.appendTransform=function(e,i,n,r,s,o,a,h,c){if(s%360)var l=s*t.DEG_TO_RAD,u=Math.cos(l),d=Math.sin(l);else u=1,d=0;return o||a?(o*=t.DEG_TO_RAD,a*=t.DEG_TO_RAD,this.append(Math.cos(a),Math.sin(a),-Math.sin(o),Math.cos(o),e,i),this.append(u*n,d*n,-d*r,u*r,0,0)):this.append(u*n,d*n,-d*r,u*r,e,i),(h||c)&&(this.tx-=h*this.a+c*this.c,this.ty-=h*this.b+c*this.d),this},e.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,s=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=s*e-this.ty*i,this.ty=s*i+this.ty*e,this},e.skew=function(e,i){return e*=t.DEG_TO_RAD,i*=t.DEG_TO_RAD,this.append(Math.cos(i),Math.sin(i),-Math.sin(e),Math.cos(e),0,0),this},e.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},e.translate=function(t,e){return this.tx+=t,this.ty+=e,this},e.identity=function(){return this.alpha=this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.shadow=this.compositeOperation=null,this},e.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,s=t*n-e*i;return this.a=n/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*this.ty-n*r)/s,this.ty=-(t*this.ty-e*r)/s,this},e.isIdentity=function(){return 0==this.tx&&0==this.ty&&1==this.a&&0==this.b&&0==this.c&&1==this.d},e.transformPoint=function(t,e,i){return i=i||{},i.x=t*this.a+e*this.c+this.tx,i.y=t*this.b+e*this.d+this.ty,i},e.decompose=function(e){null==e&&(e={}),e.x=this.tx,e.y=this.ty,e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var i=Math.atan2(-this.c,this.d),n=Math.atan2(this.b,this.a);return i==n?(e.rotation=n/t.DEG_TO_RAD,this.a<0&&this.d>=0&&(e.rotation+=e.rotation<=0?180:-180),e.skewX=e.skewY=0):(e.skewX=i/t.DEG_TO_RAD,e.skewY=n/t.DEG_TO_RAD),e},e.reinitialize=function(t,e,i,n,r,s,o,a,h){return this.initialize(t,e,i,n,r,s),this.alpha=null==o?1:o,this.shadow=a,this.compositeOperation=h,this},e.copy=function(t){return this.reinitialize(t.a,t.b,t.c,t.d,t.tx,t.ty,t.alpha,t.shadow,t.compositeOperation)},e.appendProperties=function(t,e,i){return this.alpha*=t,this.shadow=e||this.shadow,this.compositeOperation=i||this.compositeOperation,this},e.prependProperties=function(t,e,i){return this.alpha*=t,this.shadow=this.shadow||e,this.compositeOperation=this.compositeOperation||i,this},e.clone=function(){return(new t).copy(this)},e.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},t.identity=new t,createjs.Matrix2D=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e){this.initialize(t,e)},e=t.prototype;e.x=0,e.y=0,e.initialize=function(t,e){return this.x=null==t?0:t,this.y=null==e?0:e,this},e.copy=function(t){return this.initialize(t.x,t.y)},e.clone=function(){return new t(this.x,this.y)},e.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},createjs.Point=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i,n){this.initialize(t,e,i,n)},e=t.prototype;e.x=0,e.y=0,e.width=0,e.height=0,e.initialize=function(t,e,i,n){return this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this},e.copy=function(t){return this.initialize(t.x,t.y,t.width,t.height)},e.clone=function(){return new t(this.x,this.y,this.width,this.height)},e.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"},createjs.Rectangle=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i,n,r,s,o){this.initialize(t,e,i,n,r,s,o)},e=t.prototype;e.target=null,e.overLabel=null,e.outLabel=null,e.downLabel=null,e.play=!1,e._isPressed=!1,e._isOver=!1,e.initialize=function(t,e,i,n,r,s,o){t.addEventListener&&(this.target=t,t.cursor="pointer",this.overLabel=null==i?"over":i,this.outLabel=null==e?"out":e,this.downLabel=null==n?"down":n,this.play=r,this.setEnabled(!0),this.handleEvent({}),s&&(o&&(s.actionsEnabled=!1,s.gotoAndStop&&s.gotoAndStop(o)),t.hitArea=s))},e.setEnabled=function(t){var e=this.target;t?(e.addEventListener("rollover",this),e.addEventListener("rollout",this),e.addEventListener("mousedown",this),e.addEventListener("pressup",this)):(e.removeEventListener("rollover",this),e.removeEventListener("rollout",this),e.removeEventListener("mousedown",this),e.removeEventListener("pressup",this))},e.toString=function(){return"[ButtonHelper]"},e.handleEvent=function(t){var e,i=this.target,n=t.type;"mousedown"==n?(this._isPressed=!0,e=this.downLabel):"pressup"==n?(this._isPressed=!1,e=this._isOver?this.overLabel:this.outLabel):"rollover"==n?(this._isOver=!0,e=this._isPressed?this.downLabel:this.overLabel):(this._isOver=!1,e=this._isPressed?this.overLabel:this.outLabel),this.play?i.gotoAndPlay&&i.gotoAndPlay(e):i.gotoAndStop&&i.gotoAndStop(e)},createjs.ButtonHelper=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i,n){this.initialize(t,e,i,n)},e=t.prototype;t.identity=null,e.color=null,e.offsetX=0,e.offsetY=0,e.blur=0,e.initialize=function(t,e,i,n){this.color=t,this.offsetX=e,this.offsetY=i,this.blur=n},e.toString=function(){return"[Shadow]"},e.clone=function(){return new t(this.color,this.offsetX,this.offsetY,this.blur)},t.identity=new t("transparent",0,0,0),createjs.Shadow=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t){this.initialize(t)},e=t.prototype=new createjs.EventDispatcher;e.complete=!0,e.framerate=0,e._animations=null,e._frames=null,e._images=null,e._data=null,e._loadCount=0,e._frameHeight=0,e._frameWidth=0,e._numFrames=0,e._regX=0,e._regY=0,e.initialize=function(t){var e,i,n,r;if(null!=t){if(this.framerate=t.framerate||0,t.images&&(i=t.images.length)>0)for(r=this._images=[],e=0;i>e;e++){var s=t.images[e];if("string"==typeof s){var o=s;s=document.createElement("img"),s.src=o}r.push(s),s.getContext||s.complete||(this._loadCount++,this.complete=!1,function(t){s.onload=function(){t._handleImageLoad()}}(this))}if(null==t.frames);else if(t.frames instanceof Array)for(this._frames=[],r=t.frames,e=0,i=r.length;i>e;e++){var a=r[e];this._frames.push({image:this._images[a[4]?a[4]:0],rect:new createjs.Rectangle(a[0],a[1],a[2],a[3]),regX:a[5]||0,regY:a[6]||0})}else n=t.frames,this._frameWidth=n.width,this._frameHeight=n.height,this._regX=n.regX||0,this._regY=n.regY||0,this._numFrames=n.count,0==this._loadCount&&this._calculateFrames();if(this._animations=[],null!=(n=t.animations)){this._data={};var h;for(h in n){var c={name:h},l=n[h];if("number"==typeof l)r=c.frames=[l];else if(l instanceof Array)if(1==l.length)c.frames=[l[0]];else for(c.speed=l[3],c.next=l[2],r=c.frames=[],e=l[0];e<=l[1];e++)r.push(e);else{c.speed=l.speed,c.next=l.next;var u=l.frames;r=c.frames="number"==typeof u?[u]:u.slice(0)}(!0===c.next||void 0===c.next)&&(c.next=h),(!1===c.next||r.length<2&&c.next==h)&&(c.next=null),c.speed||(c.speed=1),this._animations.push(h),this._data[h]=c}}}},e.getNumFrames=function(t){if(null==t)return this._frames?this._frames.length:this._numFrames;var e=this._data[t];return null==e?0:e.frames.length},e.getAnimations=function(){return this._animations.slice(0)},e.getAnimation=function(t){return this._data[t]},e.getFrame=function(t){var e;return this._frames&&(e=this._frames[t])?e:null},e.getFrameBounds=function(t,e){var i=this.getFrame(t);return i?(e||new createjs.Rectangle).initialize(-i.regX,-i.regY,i.rect.width,i.rect.height):null},e.toString=function(){return"[SpriteSheet]"},e.clone=function(){var e=new t;return e.complete=this.complete,e._animations=this._animations,e._frames=this._frames,e._images=this._images,e._data=this._data,e._frameHeight=this._frameHeight,e._frameWidth=this._frameWidth,e._numFrames=this._numFrames,e._loadCount=this._loadCount,e},e._handleImageLoad=function(){0==--this._loadCount&&(this._calculateFrames(),this.complete=!0,this.dispatchEvent("complete"))},e._calculateFrames=function(){if(!this._frames&&0!=this._frameWidth){this._frames=[];for(var t=0,e=this._frameWidth,i=this._frameHeight,n=0,r=this._images;n<r.length;n++){for(var s=r[n],o=0|s.width/e,a=0|s.height/i,h=this._numFrames>0?Math.min(this._numFrames-t,o*a):o*a,c=0;h>c;c++)this._frames.push({image:s,rect:new createjs.Rectangle(c%o*e,(0|c/o)*i,e,i),regX:this._regX,regY:this._regY});t+=h}this._numFrames=t}},createjs.SpriteSheet=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i){this.f=t,this.params=e,this.path=null==i||i}t.prototype.exec=function(t){this.f.apply(t,this.params)};var e=function(){this.initialize()},i=e.prototype;e.getRGB=function(t,e,i,n){return null!=t&&null==i&&(n=e,i=255&t,e=255&t>>8,t=255&t>>16),null==n?"rgb("+t+","+e+","+i+")":"rgba("+t+","+e+","+i+","+n+")"},e.getHSL=function(t,e,i,n){return null==n?"hsl("+t%360+","+e+"%,"+i+"%)":"hsla("+t%360+","+e+"%,"+i+"%,"+n+")"},e.Command=t,e.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63},e.STROKE_CAPS_MAP=["butt","round","square"],e.STROKE_JOINTS_MAP=["miter","round","bevel"];var n=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");if(n.getContext){var r=e._ctx=n.getContext("2d");e.beginCmd=new t(r.beginPath,[],!1),e.fillCmd=new t(r.fill,[],!1),e.strokeCmd=new t(r.stroke,[],!1),n.width=n.height=1}i._strokeInstructions=null,i._strokeStyleInstructions=null,i._strokeIgnoreScale=!1,i._fillInstructions=null,i._fillMatrix=null,i._instructions=null,i._oldInstructions=null,i._activeInstructions=null,i._active=!1,i._dirty=!1,i.initialize=function(){this.clear(),this._ctx=e._ctx},i.isEmpty=function(){return!(this._instructions.length||this._oldInstructions.length||this._activeInstructions.length)},i.draw=function(t){this._dirty&&this._updateInstructions();for(var e=this._instructions,i=0,n=e.length;n>i;i++)e[i].exec(t)},i.drawAsPath=function(t){this._dirty&&this._updateInstructions();for(var e,i=this._instructions,n=0,r=i.length;r>n;n++)((e=i[n]).path||0==n)&&e.exec(t)},i.moveTo=function(e,i){return this._activeInstructions.push(new t(this._ctx.moveTo,[e,i])),this},i.lineTo=function(e,i){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.lineTo,[e,i])),this},i.arcTo=function(e,i,n,r,s){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.arcTo,[e,i,n,r,s])),this},i.arc=function(e,i,n,r,s,o){return this._dirty=this._active=!0,null==o&&(o=!1),this._activeInstructions.push(new t(this._ctx.arc,[e,i,n,r,s,o])),this},i.quadraticCurveTo=function(e,i,n,r){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.quadraticCurveTo,[e,i,n,r])),this},i.bezierCurveTo=function(e,i,n,r,s,o){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.bezierCurveTo,[e,i,n,r,s,o])),this},i.rect=function(e,i,n,r){return this._dirty=this._active=!0,this._activeInstructions.push(new t(this._ctx.rect,[e,i,n,r])),this},i.closePath=function(){return this._active&&(this._dirty=!0,this._activeInstructions.push(new t(this._ctx.closePath,[]))),this},i.clear=function(){return this._instructions=[],this._oldInstructions=[],this._activeInstructions=[],this._strokeStyleInstructions=this._strokeInstructions=this._fillInstructions=this._fillMatrix=null,this._active=this._dirty=this._strokeIgnoreScale=!1,this},i.beginFill=function(e){return this._active&&this._newPath(),this._fillInstructions=e?[new t(this._setProp,["fillStyle",e],!1)]:null,this._fillMatrix=null,this},i.beginLinearGradientFill=function(e,i,n,r,s,o){this._active&&this._newPath();for(var a=this._ctx.createLinearGradient(n,r,s,o),h=0,c=e.length;c>h;h++)a.addColorStop(i[h],e[h]);return this._fillInstructions=[new t(this._setProp,["fillStyle",a],!1)],this._fillMatrix=null,this},i.beginRadialGradientFill=function(e,i,n,r,s,o,a,h){this._active&&this._newPath();for(var c=this._ctx.createRadialGradient(n,r,s,o,a,h),l=0,u=e.length;u>l;l++)c.addColorStop(i[l],e[l]);return this._fillInstructions=[new t(this._setProp,["fillStyle",c],!1)],this._fillMatrix=null,this},i.beginBitmapFill=function(e,i,n){this._active&&this._newPath(),i=i||"";var r=this._ctx.createPattern(e,i);return this._fillInstructions=[new t(this._setProp,["fillStyle",r],!1)],this._fillMatrix=n?[n.a,n.b,n.c,n.d,n.tx,n.ty]:null,this},i.endFill=function(){return this.beginFill()},i.setStrokeStyle=function(i,n,r,s,o){return this._active&&this._newPath(),this._strokeStyleInstructions=[new t(this._setProp,["lineWidth",null==i?"1":i],!1),new t(this._setProp,["lineCap",null==n?"butt":isNaN(n)?n:e.STROKE_CAPS_MAP[n]],!1),new t(this._setProp,["lineJoin",null==r?"miter":isNaN(r)?r:e.STROKE_JOINTS_MAP[r]],!1),new t(this._setProp,["miterLimit",null==s?"10":s],!1)],this._strokeIgnoreScale=o,this},i.beginStroke=function(e){return this._active&&this._newPath(),this._strokeInstructions=e?[new t(this._setProp,["strokeStyle",e],!1)]:null,this},i.beginLinearGradientStroke=function(e,i,n,r,s,o){this._active&&this._newPath();for(var a=this._ctx.createLinearGradient(n,r,s,o),h=0,c=e.length;c>h;h++)a.addColorStop(i[h],e[h]);return this._strokeInstructions=[new t(this._setProp,["strokeStyle",a],!1)],this},i.beginRadialGradientStroke=function(e,i,n,r,s,o,a,h){this._active&&this._newPath();for(var c=this._ctx.createRadialGradient(n,r,s,o,a,h),l=0,u=e.length;u>l;l++)c.addColorStop(i[l],e[l]);return this._strokeInstructions=[new t(this._setProp,["strokeStyle",c],!1)],this},i.beginBitmapStroke=function(e,i){this._active&&this._newPath(),i=i||"";var n=this._ctx.createPattern(e,i);return this._strokeInstructions=[new t(this._setProp,["strokeStyle",n],!1)],this},i.endStroke=function(){return this.beginStroke(),this},i.curveTo=i.quadraticCurveTo,i.drawRect=i.rect,i.drawRoundRect=function(t,e,i,n,r){return this.drawRoundRectComplex(t,e,i,n,r,r,r,r),this},i.drawRoundRectComplex=function(e,i,n,r,s,o,a,h){var c=(r>n?n:r)/2,l=0,u=0,d=0,f=0;0>s&&(s*=l=-1),s>c&&(s=c),0>o&&(o*=u=-1),o>c&&(o=c),0>a&&(a*=d=-1),a>c&&(a=c),0>h&&(h*=f=-1),h>c&&(h=c),this._dirty=this._active=!0;var g=this._ctx.arcTo,p=this._ctx.lineTo;return this._activeInstructions.push(new t(this._ctx.moveTo,[e+n-o,i]),new t(g,[e+n+o*u,i-o*u,e+n,i+o,o]),new t(p,[e+n,i+r-a]),new t(g,[e+n+a*d,i+r+a*d,e+n-a,i+r,a]),new t(p,[e+h,i+r]),new t(g,[e-h*f,i+r+h*f,e,i+r-h,h]),new t(p,[e,i+s]),new t(g,[e-s*l,i-s*l,e+s,i,s]),new t(this._ctx.closePath)),this},i.drawCircle=function(t,e,i){return this.arc(t,e,i,0,2*Math.PI),this},i.drawEllipse=function(e,i,n,r){this._dirty=this._active=!0;var s=.5522848,o=n/2*s,a=r/2*s,h=e+n,c=i+r,l=e+n/2,u=i+r/2;return this._activeInstructions.push(new t(this._ctx.moveTo,[e,u]),new t(this._ctx.bezierCurveTo,[e,u-a,l-o,i,l,i]),new t(this._ctx.bezierCurveTo,[l+o,i,h,u-a,h,u]),new t(this._ctx.bezierCurveTo,[h,u+a,l+o,c,l,c]),new t(this._ctx.bezierCurveTo,[l-o,c,e,u+a,e,u])),this},i.inject=function(e,i){return this._dirty=this._active=!0,this._activeInstructions.push(new t(e,[i])),this},i.drawPolyStar=function(e,i,n,r,s,o){this._dirty=this._active=!0,null==s&&(s=0),s=1-s,null==o?o=0:o/=180/Math.PI;var a=Math.PI/r
;this._activeInstructions.push(new t(this._ctx.moveTo,[e+Math.cos(o)*n,i+Math.sin(o)*n]));for(var h=0;r>h;h++)o+=a,1!=s&&this._activeInstructions.push(new t(this._ctx.lineTo,[e+Math.cos(o)*n*s,i+Math.sin(o)*n*s])),o+=a,this._activeInstructions.push(new t(this._ctx.lineTo,[e+Math.cos(o)*n,i+Math.sin(o)*n]));return this},i.decodePath=function(t){for(var i=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo,this.closePath],n=[2,2,4,6,0],r=0,s=t.length,o=[],a=0,h=0,c=e.BASE_64;s>r;){var l=t.charAt(r),u=c[l],d=u>>3,f=i[d];if(!f||3&u)throw"bad path data (@"+r+"): "+l;var g=n[d];d||(a=h=0),o.length=0,r++;for(var p=2+(1&u>>2),m=0;g>m;m++){var v=c[t.charAt(r)],y=v>>5?-1:1;v=(31&v)<<6|c[t.charAt(r+1)],3==p&&(v=v<<6|c[t.charAt(r+2)]),v=y*v/10,m%2?a=v+=a:h=v+=h,o[m]=v,r+=p}f.apply(this,o)}return this},i.clone=function(){var t=new e;return t._instructions=this._instructions.slice(),t._activeInstructions=this._activeInstructions.slice(),t._oldInstructions=this._oldInstructions.slice(),this._fillInstructions&&(t._fillInstructions=this._fillInstructions.slice()),this._strokeInstructions&&(t._strokeInstructions=this._strokeInstructions.slice()),this._strokeStyleInstructions&&(t._strokeStyleInstructions=this._strokeStyleInstructions.slice()),t._active=this._active,t._dirty=this._dirty,t._fillMatrix=this._fillMatrix,t._strokeIgnoreScale=this._strokeIgnoreScale,t},i.toString=function(){return"[Graphics]"},i.mt=i.moveTo,i.lt=i.lineTo,i.at=i.arcTo,i.bt=i.bezierCurveTo,i.qt=i.quadraticCurveTo,i.a=i.arc,i.r=i.rect,i.cp=i.closePath,i.c=i.clear,i.f=i.beginFill,i.lf=i.beginLinearGradientFill,i.rf=i.beginRadialGradientFill,i.bf=i.beginBitmapFill,i.ef=i.endFill,i.ss=i.setStrokeStyle,i.s=i.beginStroke,i.ls=i.beginLinearGradientStroke,i.rs=i.beginRadialGradientStroke,i.bs=i.beginBitmapStroke,i.es=i.endStroke,i.dr=i.drawRect,i.rr=i.drawRoundRect,i.rc=i.drawRoundRectComplex,i.dc=i.drawCircle,i.de=i.drawEllipse,i.dp=i.drawPolyStar,i.p=i.decodePath,i._updateInstructions=function(){this._instructions=this._oldInstructions.slice(),this._instructions.push(e.beginCmd),this._appendInstructions(this._fillInstructions),this._appendInstructions(this._strokeInstructions),this._appendInstructions(this._strokeInstructions&&this._strokeStyleInstructions),this._appendInstructions(this._activeInstructions),this._fillInstructions&&this._appendDraw(e.fillCmd,this._fillMatrix),this._strokeInstructions&&this._appendDraw(e.strokeCmd,this._strokeIgnoreScale&&[1,0,0,1,0,0])},i._appendInstructions=function(t){t&&this._instructions.push.apply(this._instructions,t)},i._appendDraw=function(e,i){i?this._instructions.push(new t(this._ctx.save,[],!1),new t(this._ctx.transform,i,!1),e,new t(this._ctx.restore,[],!1)):this._instructions.push(e)},i._newPath=function(){this._dirty&&this._updateInstructions(),this._oldInstructions=this._instructions,this._activeInstructions=[],this._active=this._dirty=!1},i._setProp=function(t,e){this[t]=e},createjs.Graphics=e}(),this.createjs=this.createjs||{},function(){var t=function(){this.initialize()},e=t.prototype=new createjs.EventDispatcher;t._MOUSE_EVENTS=["click","dblclick","mousedown","mouseout","mouseover","pressmove","pressup","rollout","rollover"],t.suppressCrossDomainErrors=!1;var i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");i.getContext&&(t._hitTestCanvas=i,t._hitTestContext=i.getContext("2d"),i.width=i.height=1),t._nextCacheID=1,e.alpha=1,e.cacheCanvas=null,e.id=-1,e.mouseEnabled=!0,e.tickEnabled=!0,e.name=null,e.parent=null,e.regX=0,e.regY=0,e.rotation=0,e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.shadow=null,e.visible=!0,e.x=0,e.y=0,e.compositeOperation=null,e.snapToPixel=!1,e.filters=null,e.cacheID=0,e.mask=null,e.hitArea=null,e.cursor=null,e._cacheOffsetX=0,e._cacheOffsetY=0,e._cacheScale=1,e._cacheDataURLID=0,e._cacheDataURL=null,e._matrix=null,e._rectangle=null,e._bounds=null,e.initialize=function(){this.id=createjs.UID.get(),this._matrix=new createjs.Matrix2D,this._rectangle=new createjs.Rectangle},e.isVisible=function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)},e.draw=function(t,e){var i=this.cacheCanvas;if(e||!i)return!1;var n,r=this._cacheScale,s=this._cacheOffsetX,o=this._cacheOffsetY;return(n=this._applyFilterBounds(s,o,0,0))&&(s=n.x,o=n.y),t.drawImage(i,s,o,i.width/r,i.height/r),!0},e.updateContext=function(t){var e,i=this.mask,n=this;i&&i.graphics&&!i.graphics.isEmpty()&&(e=i.getMatrix(i._matrix),t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty),i.graphics.drawAsPath(t),t.clip(),e.invert(),t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)),e=n._matrix.identity().appendTransform(n.x,n.y,n.scaleX,n.scaleY,n.rotation,n.skewX,n.skewY,n.regX,n.regY),createjs.Stage._snapToPixelEnabled&&n.snapToPixel?t.transform(e.a,e.b,e.c,e.d,0|e.tx+.5,0|e.ty+.5):t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha*=n.alpha,n.compositeOperation&&(t.globalCompositeOperation=n.compositeOperation),n.shadow&&this._applyShadow(t,n.shadow)},e.cache=function(t,e,i,n,r){r=r||1,this.cacheCanvas||(this.cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),this._cacheWidth=i,this._cacheHeight=n,this._cacheOffsetX=t,this._cacheOffsetY=e,this._cacheScale=r,this.updateCache()},e.updateCache=function(e){var i,n=this.cacheCanvas,r=this._cacheScale,s=this._cacheOffsetX*r,o=this._cacheOffsetY*r,a=this._cacheWidth,h=this._cacheHeight;if(!n)throw"cache() must be called before updateCache()";var c=n.getContext("2d");(i=this._applyFilterBounds(s,o,a,h))&&(s=i.x,o=i.y,a=i.width,h=i.height),a=Math.ceil(a*r),h=Math.ceil(h*r),a!=n.width||h!=n.height?(n.width=a,n.height=h):e||c.clearRect(0,0,a+1,h+1),c.save(),c.globalCompositeOperation=e,c.setTransform(r,0,0,r,-s,-o),this.draw(c,!0),this._applyFilters(),c.restore(),this.cacheID=t._nextCacheID++},e.uncache=function(){this._cacheDataURL=this.cacheCanvas=null,this.cacheID=this._cacheOffsetX=this._cacheOffsetY=0,this._cacheScale=1},e.getCacheDataURL=function(){return this.cacheCanvas?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURL=this.cacheCanvas.toDataURL()),this._cacheDataURL):null},e.getStage=function(){for(var t=this;t.parent;)t=t.parent;return t instanceof createjs.Stage?t:null},e.localToGlobal=function(t,e){var i=this.getConcatenatedMatrix(this._matrix);return null==i?null:(i.append(1,0,0,1,t,e),new createjs.Point(i.tx,i.ty))},e.globalToLocal=function(t,e){var i=this.getConcatenatedMatrix(this._matrix);return null==i?null:(i.invert(),i.append(1,0,0,1,t,e),new createjs.Point(i.tx,i.ty))},e.localToLocal=function(t,e,i){var n=this.localToGlobal(t,e);return i.globalToLocal(n.x,n.y)},e.setTransform=function(t,e,i,n,r,s,o,a,h){return this.x=t||0,this.y=e||0,this.scaleX=null==i?1:i,this.scaleY=null==n?1:n,this.rotation=r||0,this.skewX=s||0,this.skewY=o||0,this.regX=a||0,this.regY=h||0,this},e.getMatrix=function(t){var e=this;return(t?t.identity():new createjs.Matrix2D).appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY).appendProperties(e.alpha,e.shadow,e.compositeOperation)},e.getConcatenatedMatrix=function(t){t?t.identity():t=new createjs.Matrix2D;for(var e=this;null!=e;)t.prependTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY).prependProperties(e.alpha,e.shadow,e.compositeOperation),e=e.parent;return t},e.hitTest=function(e,i){var n=t._hitTestContext;n.setTransform(1,0,0,1,-e,-i),this.draw(n);var r=this._testHit(n);return n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,2,2),r},e.set=function(t){for(var e in t)this[e]=t[e];return this},e.getBounds=function(){if(this._bounds)return this._rectangle.copy(this._bounds);var t=this.cacheCanvas;if(t){var e=this._cacheScale;return this._rectangle.initialize(this._cacheOffsetX,this._cacheOffsetY,t.width/e,t.height/e)}return null},e.getTransformedBounds=function(){return this._getBounds()},e.setBounds=function(t,e,i,n){null==t&&(this._bounds=t),this._bounds=(this._bounds||new createjs.Rectangle).initialize(t,e,i,n)},e.clone=function(){var e=new t;return this.cloneProps(e),e},e.toString=function(){return"[DisplayObject (name="+this.name+")]"},e.cloneProps=function(t){t.alpha=this.alpha,t.name=this.name,t.regX=this.regX,t.regY=this.regY,t.rotation=this.rotation,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.shadow=this.shadow,t.skewX=this.skewX,t.skewY=this.skewY,t.visible=this.visible,t.x=this.x,t.y=this.y,t._bounds=this._bounds,t.mouseEnabled=this.mouseEnabled,t.compositeOperation=this.compositeOperation},e._applyShadow=function(t,e){e=e||Shadow.identity,t.shadowColor=e.color,t.shadowOffsetX=e.offsetX,t.shadowOffsetY=e.offsetY,t.shadowBlur=e.blur},e._tick=function(t){var e=this._listeners;if(e&&e.tick){var i=new createjs.Event("tick");i.params=t,this._dispatchEvent(i,this,2)}},e._testHit=function(e){try{var i=e.getImageData(0,0,1,1).data[3]>1}catch(e){if(!t.suppressCrossDomainErrors)throw"An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images."}return i},e._applyFilters=function(){if(this.filters&&0!=this.filters.length&&this.cacheCanvas)for(var t=this.filters.length,e=this.cacheCanvas.getContext("2d"),i=this.cacheCanvas.width,n=this.cacheCanvas.height,r=0;t>r;r++)this.filters[r].applyFilter(e,0,0,i,n)},e._applyFilterBounds=function(t,e,i,n){var r,s,o=this.filters;if(!o||!(s=o.length))return null;for(var a=0;s>a;a++){var h=this.filters[a],c=h.getBounds&&h.getBounds();c&&(r||(r=this._rectangle.initialize(t,e,i,n)),r.x+=c.x,r.y+=c.y,r.width+=c.width,r.height+=c.height)}return r},e._getBounds=function(t,e){return this._transformBounds(this.getBounds(),t,e)},e._transformBounds=function(t,e,i){if(!t)return t;var n=t.x,r=t.y,s=t.width,o=t.height,a=i?this._matrix.identity():this.getMatrix(this._matrix);(n||r)&&a.appendTransform(0,0,1,1,0,0,0,-n,-r),e&&a.prependMatrix(e);var h=s*a.a,c=s*a.b,l=o*a.c,u=o*a.d,d=a.tx,f=a.ty,g=d,p=d,m=f,v=f;return(n=h+d)<g?g=n:n>p&&(p=n),(n=h+l+d)<g?g=n:n>p&&(p=n),(n=l+d)<g?g=n:n>p&&(p=n),(r=c+f)<m?m=r:r>v&&(v=r),(r=c+u+f)<m?m=r:r>v&&(v=r),(r=u+f)<m?m=r:r>v&&(v=r),t.initialize(g,m,p-g,v-m)},e._hasMouseEventListener=function(){for(var e=t._MOUSE_EVENTS,i=0,n=e.length;n>i;i++)if(this.hasEventListener(e[i]))return!0;return!!this.cursor},createjs.DisplayObject=t}(),this.createjs=this.createjs||{},function(){var t=function(){this.initialize()},e=t.prototype=new createjs.DisplayObject;e.children=null,e.mouseChildren=!0,e.tickChildren=!0,e.DisplayObject_initialize=e.initialize,e.initialize=function(){this.DisplayObject_initialize(),this.children=[]},e.isVisible=function(){var t=this.cacheCanvas||this.children.length;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},e.DisplayObject_draw=e.draw,e.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;for(var i=this.children.slice(0),n=0,r=i.length;r>n;n++){var s=i[n];s.isVisible()&&(t.save(),s.updateContext(t),s.draw(t),t.restore())}return!0},e.addChild=function(t){if(null==t)return t;var e=arguments.length;if(e>1){for(var i=0;e>i;i++)this.addChild(arguments[i]);return arguments[e-1]}return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t),t},e.addChildAt=function(t,e){var i=arguments.length,n=arguments[i-1];if(0>n||n>this.children.length)return arguments[i-2];if(i>2){for(var r=0;i-1>r;r++)this.addChildAt(arguments[r],n+r);return arguments[i-2]}return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),t},e.removeChild=function(t){var e=arguments.length;if(e>1){for(var i=!0,n=0;e>n;n++)i=i&&this.removeChild(arguments[n]);return i}return this.removeChildAt(createjs.indexOf(this.children,t))},e.removeChildAt=function(t){var e=arguments.length;if(e>1){for(var i=[],n=0;e>n;n++)i[n]=arguments[n];i.sort(function(t,e){return e-t});for(var r=!0,n=0;e>n;n++)r=r&&this.removeChildAt(i[n]);return r}if(0>t||t>this.children.length-1)return!1;var s=this.children[t];return s&&(s.parent=null),this.children.splice(t,1),!0},e.removeAllChildren=function(){for(var t=this.children;t.length;)t.pop().parent=null},e.getChildAt=function(t){return this.children[t]},e.getChildByName=function(t){for(var e=this.children,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},e.sortChildren=function(t){this.children.sort(t)},e.getChildIndex=function(t){return createjs.indexOf(this.children,t)},e.getNumChildren=function(){return this.children.length},e.swapChildrenAt=function(t,e){var i=this.children,n=i[t],r=i[e];n&&r&&(i[t]=r,i[e]=n)},e.swapChildren=function(t,e){for(var i,n,r=this.children,s=0,o=r.length;o>s&&(r[s]==t&&(i=s),r[s]==e&&(n=s),null==i||null==n);s++);s!=o&&(r[i]=e,r[n]=t)},e.setChildIndex=function(t,e){var i=this.children,n=i.length;if(!(t.parent!=this||0>e||e>=n)){for(var r=0;n>r&&i[r]!=t;r++);r!=n&&r!=e&&(i.splice(r,1),i.splice(e,0,t))}},e.contains=function(t){for(;t;){if(t==this)return!0;t=t.parent}return!1},e.hitTest=function(t,e){return null!=this.getObjectUnderPoint(t,e)},e.getObjectsUnderPoint=function(t,e){var i=[],n=this.localToGlobal(t,e);return this._getObjectsUnderPoint(n.x,n.y,i),i},e.getObjectUnderPoint=function(t,e){var i=this.localToGlobal(t,e);return this._getObjectsUnderPoint(i.x,i.y)},e.DisplayObject_getBounds=e.getBounds,e.getBounds=function(){return this._getBounds(null,!0)},e.getTransformedBounds=function(){return this._getBounds()},e.clone=function(e){var i=new t;if(this.cloneProps(i),e)for(var n=i.children=[],r=0,s=this.children.length;s>r;r++){var o=this.children[r].clone(e);o.parent=i,n.push(o)}return i},e.toString=function(){return"[Container (name="+this.name+")]"},e.DisplayObject__tick=e._tick,e._tick=function(t){if(this.tickChildren)for(var e=this.children.length-1;e>=0;e--){var i=this.children[e];i.tickEnabled&&i._tick&&i._tick(t)}this.DisplayObject__tick(t)},e._getObjectsUnderPoint=function(e,i,n,r,s){var o=createjs.DisplayObject._hitTestContext,a=this._matrix;s=s||r&&this._hasMouseEventListener();for(var h=this.children,c=h.length,l=c-1;l>=0;l--){var u=h[l],d=u.hitArea;if(u.visible&&(d||u.isVisible())&&(!r||u.mouseEnabled))if(!d&&u instanceof t){var f=u._getObjectsUnderPoint(e,i,n,r,s);if(!n&&f)return r&&!this.mouseChildren?this:f}else{if(!s&&!u._hasMouseEventListener())continue;if(u.getConcatenatedMatrix(a),d&&(a.appendTransform(d.x,d.y,d.scaleX,d.scaleY,d.rotation,d.skewX,d.skewY,d.regX,d.regY),a.alpha=d.alpha),o.globalAlpha=a.alpha,o.setTransform(a.a,a.b,a.c,a.d,a.tx-e,a.ty-i),(d||u).draw(o),!this._testHit(o))continue;if(o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,2,2),!n)return r&&!this.mouseChildren?this:u;n.push(u)}}return null},e._getBounds=function(t,e){var i=this.DisplayObject_getBounds();if(i)return this._transformBounds(i,t,e);var n,r,s,o,a=e?this._matrix.identity():this.getMatrix(this._matrix);t&&a.prependMatrix(t);for(var h=this.children.length,c=0;h>c;c++){var l=this.children[c];if(l.visible&&(i=l._getBounds(a))){var u=i.x,d=i.y,f=u+i.width,g=d+i.height;(n>u||null==n)&&(n=u),(f>r||null==r)&&(r=f),(s>d||null==s)&&(s=d),(g>o||null==o)&&(o=g)}}return null==r?null:this._rectangle.initialize(n,s,r-n,o-s)},createjs.Container=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t){this.initialize(t)},e=t.prototype=new createjs.Container;t._snapToPixelEnabled=!1,e.autoClear=!0,e.canvas=null,e.mouseX=0,e.mouseY=0,e.snapToPixelEnabled=!1,e.mouseInBounds=!1,e.tickOnUpdate=!0,e.mouseMoveOutside=!1,e.nextStage=null,e._pointerData=null,e._pointerCount=0,e._primaryPointerID=null,e._mouseOverIntervalID=null,e.Container_initialize=e.initialize,e.initialize=function(t){this.Container_initialize(),this.canvas="string"==typeof t?document.getElementById(t):t,this._pointerData={},this.enableDOMEvents(!0)},e.update=function(){if(this.canvas){this.tickOnUpdate&&(this.dispatchEvent("tickstart"),this.tickEnabled&&this._tick(arguments.length?arguments:null),this.dispatchEvent("tickend")),this.dispatchEvent("drawstart"),t._snapToPixelEnabled=this.snapToPixelEnabled,this.autoClear&&this.clear();var e=this.canvas.getContext("2d");e.save(),this.updateContext(e),this.draw(e,!1),e.restore(),this.dispatchEvent("drawend")}},e.handleEvent=function(t){"tick"==t.type&&this.update(t)},e.clear=function(){if(this.canvas){var t=this.canvas.getContext("2d");t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}},e.toDataURL=function(t,e){e||(e="image/png");var i,n=this.canvas.getContext("2d"),r=this.canvas.width,s=this.canvas.height;if(t){i=n.getImageData(0,0,r,s);var o=n.globalCompositeOperation;n.globalCompositeOperation="destination-over",n.fillStyle=t,n.fillRect(0,0,r,s)}var a=this.canvas.toDataURL(e);return t&&(n.clearRect(0,0,r+1,s+1),n.putImageData(i,0,0),n.globalCompositeOperation=o),a},e.enableMouseOver=function(t){if(this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null,0==t&&this._testMouseOver(!0)),null==t)t=20;else if(0>=t)return;var e=this;this._mouseOverIntervalID=setInterval(function(){e._testMouseOver()},1e3/Math.min(50,t))},e.enableDOMEvents=function(t){null==t&&(t=!0);var e,i,n=this._eventListeners;if(!t&&n){for(e in n)i=n[e],i.t.removeEventListener(e,i.f,!1);this._eventListeners=null}else if(t&&!n&&this.canvas){var r=window.addEventListener?window:document,s=this;n=this._eventListeners={},n.mouseup={t:r,f:function(t){s._handleMouseUp(t)}},n.mousemove={t:r,f:function(t){s._handleMouseMove(t)}},n.dblclick={t:this.canvas,f:function(t){s._handleDoubleClick(t)}},n.mousedown={t:this.canvas,f:function(t){s._handleMouseDown(t)}};for(e in n)i=n[e],i.t.addEventListener(e,i.f,!1)}},e.clone=function(){var e=new t(null);return this.cloneProps(e),e},e.toString=function(){return"[Stage (name="+this.name+")]"},e._getElementRect=function(t){var e;try{e=t.getBoundingClientRect()}catch(i){e={top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight}}var i=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0),n=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0),r=window.getComputedStyle?getComputedStyle(t):t.currentStyle,s=parseInt(r.paddingLeft)+parseInt(r.borderLeftWidth),o=parseInt(r.paddingTop)+parseInt(r.borderTopWidth),a=parseInt(r.paddingRight)+parseInt(r.borderRightWidth),h=parseInt(r.paddingBottom)+parseInt(r.borderBottomWidth);return{left:e.left+i+s,right:e.right+i-a,top:e.top+n+o,bottom:e.bottom+n-h}},e._getPointerData=function(t){var e=this._pointerData[t];return e||(e=this._pointerData[t]={x:0,y:0},null==this._primaryPointerID&&(this._primaryPointerID=t),(null==this._primaryPointerID||-1==this._primaryPointerID)&&(this._primaryPointerID=t)),e},e._handleMouseMove=function(t){t||(t=window.event),this._handlePointerMove(-1,t,t.pageX,t.pageY)},e._handlePointerMove=function(t,e,i,n){if(this.canvas){var r=this._getPointerData(t),s=r.inBounds;if(this._updatePointerPosition(t,e,i,n),s||r.inBounds||this.mouseMoveOutside){-1==t&&r.inBounds==!s&&this._dispatchMouseEvent(this,s?"mouseleave":"mouseenter",!1,t,r,e),this._dispatchMouseEvent(this,"stagemousemove",!1,t,r,e),this._dispatchMouseEvent(r.target,"pressmove",!0,t,r,e);var o=r.event;o&&o.hasEventListener("mousemove")&&o.dispatchEvent(new createjs.MouseEvent("mousemove",!1,!1,r.x,r.y,e,t,t==this._primaryPointerID,r.rawX,r.rawY),r.target),this.nextStage&&this.nextStage._handlePointerMove(t,e,i,n)}}},e._updatePointerPosition=function(t,e,i,n){var r=this._getElementRect(this.canvas);i-=r.left,n-=r.top;var s=this.canvas.width,o=this.canvas.height;i/=(r.right-r.left)/s,n/=(r.bottom-r.top)/o;var a=this._getPointerData(t);(a.inBounds=i>=0&&n>=0&&s-1>=i&&o-1>=n)?(a.x=i,a.y=n):this.mouseMoveOutside&&(a.x=0>i?0:i>s-1?s-1:i,a.y=0>n?0:n>o-1?o-1:n),a.posEvtObj=e,a.rawX=i,a.rawY=n,t==this._primaryPointerID&&(this.mouseX=a.x,this.mouseY=a.y,this.mouseInBounds=a.inBounds)},e._handleMouseUp=function(t){this._handlePointerUp(-1,t,!1)},e._handlePointerUp=function(t,e,i){var n=this._getPointerData(t);this._dispatchMouseEvent(this,"stagemouseup",!1,t,n,e);var r=n.target;r&&(this._getObjectsUnderPoint(n.x,n.y,null,!0)==r&&this._dispatchMouseEvent(r,"click",!0,t,n,e),this._dispatchMouseEvent(r,"pressup",!0,t,n,e));var s=n.event;s&&s.hasEventListener("mouseup")&&s.dispatchEvent(new createjs.MouseEvent("mouseup",!1,!1,n.x,n.y,e,t,t==this._primaryPointerID,n.rawX,n.rawY),r),i?(t==this._primaryPointerID&&(this._primaryPointerID=null),delete this._pointerData[t]):n.event=n.target=null,this.nextStage&&this.nextStage._handlePointerUp(t,e,i)},e._handleMouseDown=function(t){this._handlePointerDown(-1,t,t.pageX,t.pageY)},e._handlePointerDown=function(t,e,i,n){null!=n&&this._updatePointerPosition(t,e,i,n);var r=this._getPointerData(t);this._dispatchMouseEvent(this,"stagemousedown",!1,t,r,e),r.target=this._getObjectsUnderPoint(r.x,r.y,null,!0),r.event=this._dispatchMouseEvent(r.target,"mousedown",!0,t,r,e),this.nextStage&&this.nextStage._handlePointerDown(t,e,i,n)},e._testMouseOver=function(t){if(-1==this._primaryPointerID&&(t||this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds)){var e,i,n,r,s=this._getPointerData(-1),o=s.posEvtObj,a=-1,h="";(t||this.mouseInBounds&&o&&o.target==this.canvas)&&(e=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,!0),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY);var c=this._mouseOverTarget||[],l=c[c.length-1],u=this._mouseOverTarget=[];for(i=e;i;)u.unshift(i),null!=i.cursor&&(h=i.cursor),i=i.parent;for(this.canvas.style.cursor=h,n=0,r=u.length;r>n&&u[n]==c[n];n++)a=n;for(l!=e&&this._dispatchMouseEvent(l,"mouseout",!0,-1,s,o),n=c.length-1;n>a;n--)this._dispatchMouseEvent(c[n],"rollout",!1,-1,s,o);for(n=u.length-1;n>a;n--)this._dispatchMouseEvent(u[n],"rollover",!1,-1,s,o);l!=e&&this._dispatchMouseEvent(e,"mouseover",!0,-1,s,o)}},e._handleDoubleClick=function(t){var e=this._getPointerData(-1),i=this._getObjectsUnderPoint(e.x,e.y,null,!0);this._dispatchMouseEvent(i,"dblclick",!0,-1,e,t),this.nextStage&&this.nextStage._handleDoubleClick(t)},e._dispatchMouseEvent=function(t,e,i,n,r,s){if(t&&(i||t.hasEventListener(e))){var o=new createjs.MouseEvent(e,i,!1,r.x,r.y,s,n,n==this._primaryPointerID,r.rawX,r.rawY);return t.dispatchEvent(o),o}},createjs.Stage=t}(),this.createjs=this.createjs||{},function(){var t=function(t){this.initialize(t)},e=t.prototype=new createjs.DisplayObject;e.image=null,e.snapToPixel=!0,e.sourceRect=null,e.DisplayObject_initialize=e.initialize,e.initialize=function(t){this.DisplayObject_initialize(),"string"==typeof t?(this.image=document.createElement("img"),this.image.src=t):this.image=t},e.isVisible=function(){var t=this.cacheCanvas||this.image&&(this.image.complete||this.image.getContext||this.image.readyState>=2);return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},e.DisplayObject_draw=e.draw,e.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;var i=this.sourceRect;return i?t.drawImage(this.image,i.x,i.y,i.width,i.height,0,0,i.width,i.height):t.drawImage(this.image,0,0),!0},e.DisplayObject_getBounds=e.getBounds,e.getBounds=function(){var t=this.DisplayObject_getBounds();if(t)return t;var e=this.sourceRect||this.image;return this.image&&(this.image.complete||this.image.getContext||this.image.readyState>=2)?this._rectangle.initialize(0,0,e.width,e.height):null},e.clone=function(){var e=new t(this.image);return this.sourceRect&&(e.sourceRect=this.sourceRect.clone()),this.cloneProps(e),e},e.toString=function(){return"[Bitmap (name="+this.name+")]"},createjs.Bitmap=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e){this.initialize(t,e)},e=t.prototype=new createjs.DisplayObject;e.currentFrame=0,e.currentAnimation=null,e.paused=!0,e.spriteSheet=null,e.snapToPixel=!0,e.offset=0,e.currentAnimationFrame=0,e.framerate=0,e._advanceCount=0,e._animation=null,e._currentFrame=null,e.DisplayObject_initialize=e.initialize,e.initialize=function(t,e){this.DisplayObject_initialize(),this.spriteSheet=t,e&&this.gotoAndPlay(e)},e.isVisible=function(){var t=this.cacheCanvas||this.spriteSheet.complete;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},e.DisplayObject_draw=e.draw,e.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;this._normalizeFrame();var i=this.spriteSheet.getFrame(0|this._currentFrame);if(!i)return!1;var n=i.rect;return t.drawImage(i.image,n.x,n.y,n.width,n.height,-i.regX,-i.regY,n.width,n.height),!0},e.play=function(){this.paused=!1},e.stop=function(){this.paused=!0},e.gotoAndPlay=function(t){this.paused=!1,this._goto(t)},e.gotoAndStop=function(t){this.paused=!0,this._goto(t)},e.advance=function(t){var e=this._animation&&this._animation.speed||1,i=this.framerate||this.spriteSheet.framerate,n=i&&null!=t?t/(1e3/i):1;this._animation?this.currentAnimationFrame+=n*e:this._currentFrame+=n*e,this._normalizeFrame()},e.DisplayObject_getBounds=e.getBounds,e.getBounds=function(){return this.DisplayObject_getBounds()||this.spriteSheet.getFrameBounds(this.currentFrame,this._rectangle)},e.clone=function(){var e=new t(this.spriteSheet);return this.cloneProps(e),e},e.toString=function(){return"[Sprite (name="+this.name+")]"},e.DisplayObject__tick=e._tick,e._tick=function(t){this.paused||this.advance(t&&t[0]&&t[0].delta),this.DisplayObject__tick(t)},e._normalizeFrame=function(){var t,e=this._animation,i=this.paused,n=this._currentFrame,r=this.currentAnimationFrame;if(e)if(t=e.frames.length,(0|r)>=t){var s=e.next;if(this._dispatchAnimationEnd(e,n,i,s,t-1));else{if(s)return this._goto(s,r-t);this.paused=!0,r=this.currentAnimationFrame=e.frames.length-1,this._currentFrame=e.frames[r]}}else this._currentFrame=e.frames[0|r];else if(t=this.spriteSheet.getNumFrames(),n>=t&&!this._dispatchAnimationEnd(e,n,i,t-1)&&(this._currentFrame-=t)>=t)return this._normalizeFrame();this.currentFrame=0|this._currentFrame},e._dispatchAnimationEnd=function(t,e,i,n,r){var s=t?t.name:null;if(this.hasEventListener("animationend")){var o=new createjs.Event("animationend");o.name=s,o.next=n,this.dispatchEvent(o)}var a=this._animation!=t||this._currentFrame!=e;return a||i||!this.paused||(this.currentAnimationFrame=r,a=!0),a},e.DisplayObject_cloneProps=e.cloneProps,e.cloneProps=function(t){this.DisplayObject_cloneProps(t),t.currentFrame=this.currentFrame,t._currentFrame=this._currentFrame,t.currentAnimation=this.currentAnimation,t.paused=this.paused,t._animation=this._animation,t.currentAnimationFrame=this.currentAnimationFrame,t.framerate=this.framerate},e._goto=function(t,e){if(isNaN(t)){var i=this.spriteSheet.getAnimation(t);i&&(this.currentAnimationFrame=e||0,this._animation=i,this.currentAnimation=t,this._normalizeFrame())}else this.currentAnimationFrame=0,this.currentAnimation=this._animation=null,this._currentFrame=t,this._normalizeFrame()},createjs.Sprite=t}(),this.createjs=this.createjs||{},function(){"use strict";var t="BitmapAnimation is deprecated in favour of Sprite. See VERSIONS file for info on changes.";if(!createjs.Sprite)throw t;(createjs.BitmapAnimation=function(e){console.log(t),this.initialize(e)}).prototype=new createjs.Sprite}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t){this.initialize(t)},e=t.prototype=new createjs.DisplayObject;e.graphics=null,e.DisplayObject_initialize=e.initialize,e.initialize=function(t){this.DisplayObject_initialize(),this.graphics=t||new createjs.Graphics},e.isVisible=function(){var t=this.cacheCanvas||this.graphics&&!this.graphics.isEmpty();return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},e.DisplayObject_draw=e.draw,e.draw=function(t,e){return!!this.DisplayObject_draw(t,e)||(this.graphics.draw(t),!0)},e.clone=function(e){var i=new t(e&&this.graphics?this.graphics.clone():this.graphics);return this.cloneProps(i),i},e.toString=function(){return"[Shape (name="+this.name+")]"},createjs.Shape=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i){this.initialize(t,e,i)},e=t.prototype=new createjs.DisplayObject,i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");i.getContext&&(t._workingContext=i.getContext("2d"),i.width=i.height=1),t.H_OFFSETS={start:0,left:0,center:-.5,end:-1,right:-1},t.V_OFFSETS={top:0,hanging:-.01,middle:-.4,alphabetic:-.8,ideographic:-.85,bottom:-1},e.text="",e.font=null,e.color=null,e.textAlign="left",e.textBaseline="top",e.maxWidth=null,e.outline=0,e.lineHeight=0,e.lineWidth=null,e.DisplayObject_initialize=e.initialize,e.initialize=function(t,e,i){this.DisplayObject_initialize(),this.text=t,this.font=e,this.color=i},e.isVisible=function(){var t=this.cacheCanvas||null!=this.text&&""!==this.text;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},e.DisplayObject_draw=e.draw,e.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;var i=this.color||"#000";return this.outline?(t.strokeStyle=i,t.lineWidth=1*this.outline):t.fillStyle=i,this._drawText(this._prepContext(t)),!0},e.getMeasuredWidth=function(){return this._prepContext(t._workingContext).measureText(this.text).width},e.getMeasuredLineHeight=function(){return 1.2*this._prepContext(t._workingContext).measureText("M").width},e.getMeasuredHeight=function(){return this._drawText(null,{}).height},e.DisplayObject_getBounds=e.getBounds,e.getBounds=function(){var e=this.DisplayObject_getBounds();if(e)return e;if(null==this.text||""==this.text)return null;var i=this._drawText(null,{}),n=this.maxWidth&&this.maxWidth<i.width?this.maxWidth:i.width,r=n*t.H_OFFSETS[this.textAlign||"left"],s=this.lineHeight||this.getMeasuredLineHeight(),o=s*t.V_OFFSETS[this.textBaseline||"top"];return this._rectangle.initialize(r,o,n,i.height)},e.clone=function(){var e=new t(this.text,this.font,this.color);return this.cloneProps(e),e},e.toString=function(){return"[Text (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"},e.DisplayObject_cloneProps=e.cloneProps,e.cloneProps=function(t){this.DisplayObject_cloneProps(t),t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.maxWidth=this.maxWidth,t.outline=this.outline,t.lineHeight=this.lineHeight,t.lineWidth=this.lineWidth},e._prepContext=function(t){return t.font=this.font,t.textAlign=this.textAlign||"left",t.textBaseline=this.textBaseline||"top",t},e._drawText=function(e,i){var n=!!e;n||(e=this._prepContext(t._workingContext));for(var r=this.lineHeight||this.getMeasuredLineHeight(),s=0,o=0,a=String(this.text).split(/(?:\r\n|\r|\n)/),h=0,c=a.length;c>h;h++){var l=a[h],u=null;if(null!=this.lineWidth&&(u=e.measureText(l).width)>this.lineWidth){var d=l.split(/(\s)/);l=d[0],u=e.measureText(l).width;for(var f=1,g=d.length;g>f;f+=2){var p=e.measureText(d[f]+d[f+1]).width;u+p>this.lineWidth?(n&&this._drawTextLine(e,l,o*r),u>s&&(s=u),l=d[f+1],u=e.measureText(l).width,o++):(l+=d[f]+d[f+1],u+=p)}}n&&this._drawTextLine(e,l,o*r),i&&null==u&&(u=e.measureText(l).width),u>s&&(s=u),o++}return i&&(i.count=o,i.width=s,i.height=o*r),i},e._drawTextLine=function(t,e,i){this.outline?t.strokeText(e,0,i,this.maxWidth||65535):t.fillText(e,0,i,this.maxWidth||65535)},createjs.Text=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e){this.initialize(t,e)}var e=t.prototype=new createjs.DisplayObject;e.text="",e.spriteSheet=null,e.lineHeight=0,e.letterSpacing=0,e.spaceWidth=0,e.DisplayObject_initialize=e.initialize,e.initialize=function(t,e){this.DisplayObject_initialize(),this.text=t,this.spriteSheet=e},e.DisplayObject_draw=e.draw,e.draw=function(t,e){return!!this.DisplayObject_draw(t,e)||void this._drawText(t)},e.isVisible=function(){var t=this.cacheCanvas||this.spriteSheet&&this.spriteSheet.complete&&this.text;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},e.getBounds=function(){var t=this._rectangle;return this._drawText(null,t),t.width?t:null},e._getFrame=function(t,e){var i,n=e.getAnimation(t);return n||(t!=(i=t.toUpperCase())||t!=(i=t.toLowerCase())||(i=null),i&&(n=e.getAnimation(i))),n&&e.getFrame(n.frames[0])},e._getLineHeight=function(t){
var e=this._getFrame("1",t)||this._getFrame("T",t)||this._getFrame("L",t)||t.getFrame(0);return e?e.rect.height:1},e._getSpaceWidth=function(t){var e=this._getFrame("1",t)||this._getFrame("l",t)||this._getFrame("e",t)||this._getFrame("a",t)||t.getFrame(0);return e?e.rect.width:1},e._drawText=function(t,e){var i,n,r,s=0,o=0,a=this.spaceWidth,h=this.lineHeight,c=this.spriteSheet,l=!!this._getFrame(" ",c);l||0!=a||(a=this._getSpaceWidth(c)),0==h&&(h=this._getLineHeight(c));for(var u=0,d=0,f=this.text.length;f>d;d++){var g=this.text.charAt(d);if(l||" "!=g)if("\n"!=g&&"\r"!=g){var p=this._getFrame(g,c);if(p){var m=p.rect;r=p.regX,i=m.width,t&&t.drawImage(p.image,m.x,m.y,i,n=m.height,s-r,o-p.regY,i,n),s+=i+this.letterSpacing}}else"\r"==g&&"\n"==this.text.charAt(d+1)&&d++,s-r>u&&(u=s-r),s=0,o+=h;else s+=a}s-r>u&&(u=s-r),e&&(e.width=u-this.letterSpacing,e.height=o+h)},createjs.BitmapText=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(){throw"SpriteSheetUtils cannot be instantiated"},e=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");e.getContext&&(t._workingCanvas=e,t._workingContext=e.getContext("2d"),e.width=e.height=1),t.addFlippedFrames=function(e,i,n,r){if(i||n||r){var s=0;i&&t._flip(e,++s,!0,!1),n&&t._flip(e,++s,!1,!0),r&&t._flip(e,++s,!0,!0)}},t.extractFrame=function(e,i){isNaN(i)&&(i=e.getAnimation(i).frames[0]);var n=e.getFrame(i);if(!n)return null;var r=n.rect,s=t._workingCanvas;s.width=r.width,s.height=r.height,t._workingContext.drawImage(n.image,r.x,r.y,r.width,r.height,0,0,r.width,r.height);var o=document.createElement("img");return o.src=s.toDataURL("image/png"),o},t.mergeAlpha=function(t,e,i){i||(i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),i.width=Math.max(e.width,t.width),i.height=Math.max(e.height,t.height);var n=i.getContext("2d");return n.save(),n.drawImage(t,0,0),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),n.restore(),i},t._flip=function(e,i,n,r){for(var s=e._images,o=t._workingCanvas,a=t._workingContext,h=s.length/i,c=0;h>c;c++){var l=s[c];l.__tmp=c,a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,o.width+1,o.height+1),o.width=l.width,o.height=l.height,a.setTransform(n?-1:1,0,0,r?-1:1,n?l.width:0,r?l.height:0),a.drawImage(l,0,0);var u=document.createElement("img");u.src=o.toDataURL("image/png"),u.width=l.width,u.height=l.height,s.push(u)}var d=e._frames,f=d.length/i;for(c=0;f>c;c++){l=d[c];var g=l.rect.clone();u=s[l.image.__tmp+h*i];var p={image:u,rect:g,regX:l.regX,regY:l.regY};n&&(g.x=u.width-g.x-g.width,p.regX=g.width-l.regX),r&&(g.y=u.height-g.y-g.height,p.regY=g.height-l.regY),d.push(p)}var m="_"+(n?"h":"")+(r?"v":""),v=e._animations,y=e._data,b=v.length/i;for(c=0;b>c;c++){var _=v[c];l=y[_];var w={name:_+m,speed:l.speed,next:l.next,frames:[]};l.next&&(w.next+=m),d=l.frames;for(var T=0,x=d.length;x>T;T++)w.frames.push(d[T]+f*i);y[w.name]=w,v.push(w.name)}},createjs.SpriteSheetUtils=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(){this.initialize()},e=t.prototype=new createjs.EventDispatcher;t.ERR_DIMENSIONS="frame dimensions exceed max spritesheet dimensions",t.ERR_RUNNING="a build is already running",e.maxWidth=2048,e.maxHeight=2048,e.spriteSheet=null,e.scale=1,e.padding=1,e.timeSlice=.3,e.progress=-1,e._frames=null,e._animations=null,e._data=null,e._nextFrameIndex=0,e._index=0,e._timerID=null,e._scale=1,e.initialize=function(){this._frames=[],this._animations={}},e.addFrame=function(e,i,n,r,s,o){if(this._data)throw t.ERR_RUNNING;var a=i||e.bounds||e.nominalBounds;return!a&&e.getBounds&&(a=e.getBounds()),a?(n=n||1,this._frames.push({source:e,sourceRect:a,scale:n,funct:r,params:s,scope:o,index:this._frames.length,height:a.height*n})-1):null},e.addAnimation=function(e,i,n,r){if(this._data)throw t.ERR_RUNNING;this._animations[e]={frames:i,next:n,frequency:r}},e.addMovieClip=function(e,i,n){if(this._data)throw t.ERR_RUNNING;var r=e.frameBounds,s=i||e.bounds||e.nominalBounds;if(!s&&e.getBounds&&(s=e.getBounds()),!s&&!r)return null;for(var o=this._frames.length,a=e.timeline.duration,h=0;a>h;h++){var c=r&&r[h]?r[h]:s;this.addFrame(e,c,n,function(t){var e=this.actionsEnabled;this.actionsEnabled=!1,this.gotoAndStop(t),this.actionsEnabled=e},[h],e)}var l=e.timeline._labels,u=[];for(var d in l)u.push({index:l[d],label:d});if(u.length){u.sort(function(t,e){return t.index-e.index});for(var h=0,f=u.length;f>h;h++){for(var g=u[h].label,p=o+u[h].index,m=o+(h==f-1?a:u[h+1].index),v=[],y=p;m>y;y++)v.push(y);this.addAnimation(g,v,!0)}}},e.build=function(){if(this._data)throw t.ERR_RUNNING;for(this._startBuild();this._drawNext(););return this._endBuild(),this.spriteSheet},e.buildAsync=function(e){if(this._data)throw t.ERR_RUNNING;this.timeSlice=e,this._startBuild();var i=this;this._timerID=setTimeout(function(){i._run()},50-50*Math.max(.01,Math.min(.99,this.timeSlice||.3)))},e.stopAsync=function(){clearTimeout(this._timerID),this._data=null},e.clone=function(){throw"SpriteSheetBuilder cannot be cloned."},e.toString=function(){return"[SpriteSheetBuilder]"},e._startBuild=function(){var e=this.padding||0;this.progress=0,this.spriteSheet=null,this._index=0,this._scale=this.scale;var i=[];this._data={images:[],frames:i,animations:this._animations};var n=this._frames.slice();if(n.sort(function(t,e){return t.height<=e.height?-1:1}),n[n.length-1].height+2*e>this.maxHeight)throw t.ERR_DIMENSIONS;for(var r=0,s=0,o=0;n.length;){var a=this._fillRow(n,r,o,i,e);if(a.w>s&&(s=a.w),r+=a.h,!a.h||!n.length){var h=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");h.width=this._getSize(s,this.maxWidth),h.height=this._getSize(r,this.maxHeight),this._data.images[o]=h,a.h||(s=r=0,o++)}}},e._getSize=function(t,e){for(var i=4;Math.pow(2,++i)<t;);return Math.min(e,Math.pow(2,i))},e._fillRow=function(e,i,n,r,s){var o=this.maxWidth,a=this.maxHeight;i+=s;for(var h=a-i,c=s,l=0,u=e.length-1;u>=0;u--){var d=e[u],f=this._scale*d.scale,g=d.sourceRect,p=d.source,m=Math.floor(f*g.x-s),v=Math.floor(f*g.y-s),y=Math.ceil(f*g.height+2*s),b=Math.ceil(f*g.width+2*s);if(b>o)throw t.ERR_DIMENSIONS;y>h||c+b>o||(d.img=n,d.rect=new createjs.Rectangle(c,i,b,y),l=l||y,e.splice(u,1),r[d.index]=[c,i,b,y,n,Math.round(-m+f*p.regX-s),Math.round(-v+f*p.regY-s)],c+=b)}return{w:c,h:l}},e._endBuild=function(){this.spriteSheet=new createjs.SpriteSheet(this._data),this._data=null,this.progress=1,this.dispatchEvent("complete")},e._run=function(){for(var t=50*Math.max(.01,Math.min(.99,this.timeSlice||.3)),e=(new Date).getTime()+t,i=!1;e>(new Date).getTime();)if(!this._drawNext()){i=!0;break}if(i)this._endBuild();else{var n=this;this._timerID=setTimeout(function(){n._run()},50-t)}var r=this.progress=this._index/this._frames.length;if(this.hasEventListener("progress")){var s=new createjs.Event("progress");s.progress=r,this.dispatchEvent(s)}},e._drawNext=function(){var t=this._frames[this._index],e=t.scale*this._scale,i=t.rect,n=t.sourceRect,r=this._data.images[t.img],s=r.getContext("2d");return t.funct&&t.funct.apply(t.scope,t.params),s.save(),s.beginPath(),s.rect(i.x,i.y,i.width,i.height),s.clip(),s.translate(Math.ceil(i.x-n.x*e),Math.ceil(i.y-n.y*e)),s.scale(e,e),t.source.draw(s),s.restore(),++this._index<this._frames.length},createjs.SpriteSheetBuilder=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t){this.initialize(t)},e=t.prototype=new createjs.DisplayObject;e.htmlElement=null,e._oldMtx=null,e._visible=!1,e.DisplayObject_initialize=e.initialize,e.initialize=function(t){"string"==typeof t&&(t=document.getElementById(t)),this.DisplayObject_initialize(),this.mouseEnabled=!1,this.htmlElement=t;var e=t.style;e.position="absolute",e.transformOrigin=e.WebkitTransformOrigin=e.msTransformOrigin=e.MozTransformOrigin=e.OTransformOrigin="0% 0%"},e.isVisible=function(){return null!=this.htmlElement},e.draw=function(){return this.visible&&(this._visible=!0),!0},e.cache=function(){},e.uncache=function(){},e.updateCache=function(){},e.hitTest=function(){},e.localToGlobal=function(){},e.globalToLocal=function(){},e.localToLocal=function(){},e.clone=function(){throw"DOMElement cannot be cloned."},e.toString=function(){return"[DOMElement (name="+this.name+")]"},e.DisplayObject__tick=e._tick,e._tick=function(t){var e=this.getStage();this._visible=!1,e&&e.on("drawend",this._handleDrawEnd,this,!0),this.DisplayObject__tick(t)},e._handleDrawEnd=function(){var t=this.htmlElement;if(t){var e=t.style,i=this._visible?"visible":"hidden";if(i!=e.visibility&&(e.visibility=i),this._visible){var n=this.getConcatenatedMatrix(this._matrix),r=this._oldMtx,s=1e4;if(r&&r.alpha==n.alpha||(e.opacity=""+(0|n.alpha*s)/s,r&&(r.alpha=n.alpha)),!r||r.tx!=n.tx||r.ty!=n.ty||r.a!=n.a||r.b!=n.b||r.c!=n.c||r.d!=n.d){var o="matrix("+(0|n.a*s)/s+","+(0|n.b*s)/s+","+(0|n.c*s)/s+","+(0|n.d*s)/s+","+(0|n.tx+.5);e.transform=e.WebkitTransform=e.OTransform=e.msTransform=o+","+(0|n.ty+.5)+")",e.MozTransform=o+"px,"+(0|n.ty+.5)+"px)",this._oldMtx=r?r.copy(n):n.clone()}}}},createjs.DOMElement=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(){this.initialize()},e=t.prototype;e.initialize=function(){},e.getBounds=function(){return null},e.applyFilter=function(){},e.toString=function(){return"[Filter]"},e.clone=function(){return new t},createjs.Filter=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i){this.initialize(t,e,i)},e=t.prototype=new createjs.Filter;e.initialize=function(t,e,i){(isNaN(t)||0>t)&&(t=0),this.blurX=0|t,(isNaN(e)||0>e)&&(e=0),this.blurY=0|e,(isNaN(i)||1>i)&&(i=1),this.quality=0|i},e.blurX=0,e.blurY=0,e.quality=1,e.mul_table=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1],e.shg_table=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9],e.getBounds=function(){var t=.5*Math.pow(this.quality,.6);return new createjs.Rectangle(-this.blurX*t,-this.blurY*t,2*this.blurX*t,2*this.blurY*t)},e.applyFilter=function(t,e,i,n,r,s,o,a){s=s||t,null==o&&(o=e),null==a&&(a=i);try{var h=t.getImageData(e,i,n,r)}catch(t){return!1}var c=this.blurX/2;if(isNaN(c)||0>c)return!1;c|=0;var l=this.blurY/2;if(isNaN(l)||0>l)return!1;if(l|=0,0==c&&0==l)return!1;var u=this.quality;(isNaN(u)||1>u)&&(u=1),u|=0,u>3&&(u=3),1>u&&(u=1);var e,i,d,f,g,p,m,v,y,b,_,w,T,x,S,C=h.data,E=c+c+1,O=l+l+1,A=n-1,P=r-1,k=c+1,L=l+1,I={r:0,b:0,g:0,a:0,next:null},D=I;for(d=1;E>d;d++)D=D.next={r:0,b:0,g:0,a:0,next:null};D.next=I;var M={r:0,b:0,g:0,a:0,next:null},j=M;for(d=1;O>d;d++)j=j.next={r:0,b:0,g:0,a:0,next:null};j.next=M;for(var R=null;u-- >0;){m=p=0;var N=this.mul_table[c],F=this.shg_table[c];for(i=r;--i>-1;){for(v=k*(w=C[p]),y=k*(T=C[p+1]),b=k*(x=C[p+2]),_=k*(S=C[p+3]),D=I,d=k;--d>-1;)D.r=w,D.g=T,D.b=x,D.a=S,D=D.next;for(d=1;k>d;d++)f=p+((d>A?A:d)<<2),v+=D.r=C[f],y+=D.g=C[f+1],b+=D.b=C[f+2],_+=D.a=C[f+3],D=D.next;for(R=I,e=0;n>e;e++)C[p++]=v*N>>>F,C[p++]=y*N>>>F,C[p++]=b*N>>>F,C[p++]=_*N>>>F,f=m+((f=e+c+1)<A?f:A)<<2,v-=R.r-(R.r=C[f]),y-=R.g-(R.g=C[f+1]),b-=R.b-(R.b=C[f+2]),_-=R.a-(R.a=C[f+3]),R=R.next;m+=n}for(N=this.mul_table[l],F=this.shg_table[l],e=0;n>e;e++){for(p=e<<2,v=L*(w=C[p]),y=L*(T=C[p+1]),b=L*(x=C[p+2]),_=L*(S=C[p+3]),j=M,d=0;L>d;d++)j.r=w,j.g=T,j.b=x,j.a=S,j=j.next;for(g=n,d=1;l>=d;d++)p=g+e<<2,v+=j.r=C[p],y+=j.g=C[p+1],b+=j.b=C[p+2],_+=j.a=C[p+3],j=j.next,P>d&&(g+=n);if(p=e,R=M,u>0)for(i=0;r>i;i++)f=p<<2,C[f+3]=S=_*N>>>F,S>0?(C[f]=v*N>>>F,C[f+1]=y*N>>>F,C[f+2]=b*N>>>F):C[f]=C[f+1]=C[f+2]=0,f=e+((f=i+L)<P?f:P)*n<<2,v-=R.r-(R.r=C[f]),y-=R.g-(R.g=C[f+1]),b-=R.b-(R.b=C[f+2]),_-=R.a-(R.a=C[f+3]),R=R.next,p+=n;else for(i=0;r>i;i++)f=p<<2,C[f+3]=S=_*N>>>F,S>0?(S=255/S,C[f]=(v*N>>>F)*S,C[f+1]=(y*N>>>F)*S,C[f+2]=(b*N>>>F)*S):C[f]=C[f+1]=C[f+2]=0,f=e+((f=i+L)<P?f:P)*n<<2,v-=R.r-(R.r=C[f]),y-=R.g-(R.g=C[f+1]),b-=R.b-(R.b=C[f+2]),_-=R.a-(R.a=C[f+3]),R=R.next,p+=n}}return s.putImageData(h,o,a),!0},e.clone=function(){return new t(this.blurX,this.blurY,this.quality)},e.toString=function(){return"[BlurFilter]"},createjs.BlurFilter=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t){this.initialize(t)},e=t.prototype=new createjs.Filter;e.initialize=function(t){this.alphaMap=t},e.alphaMap=null,e._alphaMap=null,e._mapData=null,e.applyFilter=function(t,e,i,n,r,s,o,a){if(!this.alphaMap)return!0;if(!this._prepAlphaMap())return!1;s=s||t,null==o&&(o=e),null==a&&(a=i);try{var h=t.getImageData(e,i,n,r)}catch(t){return!1}for(var c=h.data,l=this._mapData,u=c.length,d=0;u>d;d+=4)c[d+3]=l[d]||0;return s.putImageData(h,o,a),!0},e.clone=function(){return new t(this.alphaMap)},e.toString=function(){return"[AlphaMapFilter]"},e._prepAlphaMap=function(){if(!this.alphaMap)return!1;if(this.alphaMap==this._alphaMap&&this._mapData)return!0;this._mapData=null;var t,e=this._alphaMap=this.alphaMap,i=e;e instanceof HTMLCanvasElement?t=i.getContext("2d"):(i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),i.width=e.width,i.height=e.height,t=i.getContext("2d"),t.drawImage(e,0,0));try{var n=t.getImageData(0,0,e.width,e.height)}catch(t){return!1}return this._mapData=n.data,!0},createjs.AlphaMapFilter=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t){this.initialize(t)},e=t.prototype=new createjs.Filter;e.initialize=function(t){this.mask=t},e.mask=null,e.applyFilter=function(t,e,i,n,r,s,o,a){return!this.mask||(s=s||t,null==o&&(o=e),null==a&&(a=i),s.save(),s.globalCompositeOperation="destination-in",s.drawImage(this.mask,o,a),s.restore(),!0)},e.clone=function(){return new t(this.mask)},e.toString=function(){return"[AlphaMaskFilter]"},createjs.AlphaMaskFilter=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i,n,r,s,o,a){this.initialize(t,e,i,n,r,s,o,a)},e=t.prototype=new createjs.Filter;e.redMultiplier=1,e.greenMultiplier=1,e.blueMultiplier=1,e.alphaMultiplier=1,e.redOffset=0,e.greenOffset=0,e.blueOffset=0,e.alphaOffset=0,e.initialize=function(t,e,i,n,r,s,o,a){this.redMultiplier=null!=t?t:1,this.greenMultiplier=null!=e?e:1,this.blueMultiplier=null!=i?i:1,this.alphaMultiplier=null!=n?n:1,this.redOffset=r||0,this.greenOffset=s||0,this.blueOffset=o||0,this.alphaOffset=a||0},e.applyFilter=function(t,e,i,n,r,s,o,a){s=s||t,null==o&&(o=e),null==a&&(a=i);try{var h=t.getImageData(e,i,n,r)}catch(t){return!1}for(var c=h.data,l=c.length,u=0;l>u;u+=4)c[u]=c[u]*this.redMultiplier+this.redOffset,c[u+1]=c[u+1]*this.greenMultiplier+this.greenOffset,c[u+2]=c[u+2]*this.blueMultiplier+this.blueOffset,c[u+3]=c[u+3]*this.alphaMultiplier+this.alphaOffset;return s.putImageData(h,o,a),!0},e.toString=function(){return"[ColorFilter]"},e.clone=function(){return new t(this.redMultiplier,this.greenMultiplier,this.blueMultiplier,this.alphaMultiplier,this.redOffset,this.greenOffset,this.blueOffset,this.alphaOffset)},createjs.ColorFilter=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i,n){this.initialize(t,e,i,n)},e=t.prototype;t.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],t.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],t.LENGTH=t.IDENTITY_MATRIX.length,e.initialize=function(t,e,i,n){return this.reset(),this.adjustColor(t,e,i,n),this},e.reset=function(){return this.copyMatrix(t.IDENTITY_MATRIX)},e.adjustColor=function(t,e,i,n){return this.adjustHue(n),this.adjustContrast(e),this.adjustBrightness(t),this.adjustSaturation(i)},e.adjustBrightness=function(t){return 0==t||isNaN(t)?this:(t=this._cleanValue(t,255),this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1]),this)},e.adjustContrast=function(e){if(0==e||isNaN(e))return this;e=this._cleanValue(e,100);var i;return 0>e?i=127+e/100*127:(i=e%1,i=0==i?t.DELTA_INDEX[e]:t.DELTA_INDEX[e<<0]*(1-i)+t.DELTA_INDEX[1+(e<<0)]*i,i=127*i+127),this._multiplyMatrix([i/127,0,0,0,.5*(127-i),0,i/127,0,0,.5*(127-i),0,0,i/127,0,.5*(127-i),0,0,0,1,0,0,0,0,0,1]),this},e.adjustSaturation=function(t){if(0==t||isNaN(t))return this;t=this._cleanValue(t,100);var e=1+(t>0?3*t/100:t/100),i=.3086,n=.6094,r=.082;return this._multiplyMatrix([i*(1-e)+e,n*(1-e),r*(1-e),0,0,i*(1-e),n*(1-e)+e,r*(1-e),0,0,i*(1-e),n*(1-e),r*(1-e)+e,0,0,0,0,0,1,0,0,0,0,0,1]),this},e.adjustHue=function(t){if(0==t||isNaN(t))return this;t=this._cleanValue(t,180)/180*Math.PI;var e=Math.cos(t),i=Math.sin(t),n=.213,r=.715,s=.072;return this._multiplyMatrix([n+e*(1-n)+i*-n,r+e*-r+i*-r,s+e*-s+i*(1-s),0,0,n+e*-n+.143*i,r+e*(1-r)+.14*i,s+e*-s+-.283*i,0,0,n+e*-n+-.787*i,r+e*-r+i*r,s+e*(1-s)+i*s,0,0,0,0,0,1,0,0,0,0,0,1]),this},e.concat=function(e){return e=this._fixMatrix(e),e.length!=t.LENGTH?this:(this._multiplyMatrix(e),this)},e.clone=function(){return(new t).copyMatrix(this)},e.toArray=function(){for(var e=[],i=0,n=t.LENGTH;n>i;i++)e[i]=this[i];return e},e.copyMatrix=function(e){for(var i=t.LENGTH,n=0;i>n;n++)this[n]=e[n];return this},e.toString=function(){return"[ColorMatrix]"},e._multiplyMatrix=function(t){for(var e=[],i=0;5>i;i++){for(var n=0;5>n;n++)e[n]=this[n+5*i];for(var n=0;5>n;n++){for(var r=0,s=0;5>s;s++)r+=t[n+5*s]*e[s];this[n+5*i]=r}}},e._cleanValue=function(t,e){return Math.min(e,Math.max(-e,t))},e._fixMatrix=function(e){return e instanceof t&&(e=e.toArray()),e.length<t.LENGTH?e=e.slice(0,e.length).concat(t.IDENTITY_MATRIX.slice(e.length,t.LENGTH)):e.length>t.LENGTH&&(e=e.slice(0,t.LENGTH)),e},createjs.ColorMatrix=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t){this.initialize(t)},e=t.prototype=new createjs.Filter;e.matrix=null,e.initialize=function(t){this.matrix=t},e.applyFilter=function(t,e,i,n,r,s,o,a){s=s||t,null==o&&(o=e),null==a&&(a=i);try{var h=t.getImageData(e,i,n,r)}catch(t){return!1}for(var c,l,u,d,f=h.data,g=f.length,p=this.matrix,m=p[0],v=p[1],y=p[2],b=p[3],_=p[4],w=p[5],T=p[6],x=p[7],S=p[8],C=p[9],E=p[10],O=p[11],A=p[12],P=p[13],k=p[14],L=p[15],I=p[16],D=p[17],M=p[18],j=p[19],R=0;g>R;R+=4)c=f[R],l=f[R+1],u=f[R+2],d=f[R+3],f[R]=c*m+l*v+u*y+d*b+_,f[R+1]=c*w+l*T+u*x+d*S+C,f[R+2]=c*E+l*O+u*A+d*P+k,f[R+3]=c*L+l*I+u*D+d*M+j;return s.putImageData(h,o,a),!0},e.toString=function(){return"[ColorMatrixFilter]"},e.clone=function(){return new t(this.matrix)},createjs.ColorMatrixFilter=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(){throw"Touch cannot be instantiated"};t.isSupported=function(){return"ontouchstart"in window||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0},t.enable=function(e,i,n){return!!(e&&e.canvas&&t.isSupported())&&(e.__touch={pointers:{},multitouch:!i,preventDefault:!n,count:0},"ontouchstart"in window?t._IOS_enable(e):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&t._IE_enable(e),!0)},t.disable=function(e){e&&("ontouchstart"in window?t._IOS_disable(e):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&t._IE_disable(e))},t._IOS_enable=function(e){var i=e.canvas,n=e.__touch.f=function(i){t._IOS_handleEvent(e,i)};i.addEventListener("touchstart",n,!1),i.addEventListener("touchmove",n,!1),i.addEventListener("touchend",n,!1),i.addEventListener("touchcancel",n,!1)},t._IOS_disable=function(t){var e=t.canvas;if(e){var i=t.__touch.f;e.removeEventListener("touchstart",i,!1),e.removeEventListener("touchmove",i,!1),e.removeEventListener("touchend",i,!1),e.removeEventListener("touchcancel",i,!1)}},t._IOS_handleEvent=function(t,e){if(t){t.__touch.preventDefault&&e.preventDefault&&e.preventDefault();for(var i=e.changedTouches,n=e.type,r=0,s=i.length;s>r;r++){var o=i[r],a=o.identifier;o.target==t.canvas&&("touchstart"==n?this._handleStart(t,a,e,o.pageX,o.pageY):"touchmove"==n?this._handleMove(t,a,e,o.pageX,o.pageY):("touchend"==n||"touchcancel"==n)&&this._handleEnd(t,a,e))}}},t._IE_enable=function(e){var i=e.canvas,n=e.__touch.f=function(i){t._IE_handleEvent(e,i)};void 0===window.navigator.pointerEnabled?(i.addEventListener("MSPointerDown",n,!1),window.addEventListener("MSPointerMove",n,!1),window.addEventListener("MSPointerUp",n,!1),window.addEventListener("MSPointerCancel",n,!1),e.__touch.preventDefault&&(i.style.msTouchAction="none")):(i.addEventListener("pointerdown",n,!1),window.addEventListener("pointermove",n,!1),window.addEventListener("pointerup",n,!1),window.addEventListener("pointercancel",n,!1),e.__touch.preventDefault&&(i.style.touchAction="none")),e.__touch.activeIDs={}},t._IE_disable=function(t){var e=t.__touch.f;void 0===window.navigator.pointerEnabled?(window.removeEventListener("MSPointerMove",e,!1),window.removeEventListener("MSPointerUp",e,!1),window.removeEventListener("MSPointerCancel",e,!1),t.canvas&&t.canvas.removeEventListener("MSPointerDown",e,!1)):(window.removeEventListener("pointermove",e,!1),window.removeEventListener("pointerup",e,!1),window.removeEventListener("pointercancel",e,!1),t.canvas&&t.canvas.removeEventListener("pointerdown",e,!1))},t._IE_handleEvent=function(t,e){if(t){t.__touch.preventDefault&&e.preventDefault&&e.preventDefault();var i=e.type,n=e.pointerId,r=t.__touch.activeIDs;if("MSPointerDown"==i||"pointerdown"==i){if(e.srcElement!=t.canvas)return;r[n]=!0,this._handleStart(t,n,e,e.pageX,e.pageY)}else r[n]&&("MSPointerMove"==i||"pointermove"==i?this._handleMove(t,n,e,e.pageX,e.pageY):("MSPointerUp"==i||"MSPointerCancel"==i||"pointerup"==i||"pointercancel"==i)&&(delete r[n],this._handleEnd(t,n,e)))}},t._handleStart=function(t,e,i,n,r){var s=t.__touch;if(s.multitouch||!s.count){var o=s.pointers;o[e]||(o[e]=!0,s.count++,t._handlePointerDown(e,i,n,r))}},t._handleMove=function(t,e,i,n,r){t.__touch.pointers[e]&&t._handlePointerMove(e,i,n,r)},t._handleEnd=function(t,e,i){var n=t.__touch,r=n.pointers;r[e]&&(n.count--,t._handlePointerUp(e,i,!0),delete r[e])},createjs.Touch=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=createjs.EaselJS=createjs.EaselJS||{};t.version="0.7.1",t.buildDate="Thu, 12 Dec 2013 23:33:39 GMT"}(),define("easel",function(t){return function(){return t.createjs}}(this)),define("shared/eventManager",[],function(){var t=function(t,e,i,n,r){this.emitterName=t,this.type=e,this.target=i,this.data=n,this.async=r},e=function(){var i=this;i.__ALL="*",i.__Constructor=e,i.__EventConstructor=t;i.topics={},i.topics["*"]={},i.register=function(t){return void 0==i.topics[t]&&(i.topics[t]={},!0)},i.subscribe=function(t,e,n,r){var s=i.register(t);return i.ensureTopicExists(t,e),i.topics[t][e][i.getSyncType(r)].push(n),s},i.unsubscribe=function(t,e,n,r){if(void 0!=i.topics[t]&&void 0!=i.topics[t][e]){var s=i.topics[t][e][i.getSyncType(r)].indexOf(n);s>-1&&i.topics[t][e][i.getSyncType(r)].splice(s,1)}},i.getSyncType=function(t){return t?"async":"sync"},i.emit=function(e,n,r,s){i.register(e),i.ensureTopicExists(e,n);var o=[],a=[],h=new t(e,n,r,s,!0),c=new t(e,n,r,s,!1);if("*"!=e)o=o.concat(i.topics[e][n].async),a=a.concat(i.topics[e][n].sync),o=o.concat(i.topics["*"][n].async),a=a.concat(i.topics["*"][n].sync);else for(var l in i.topics)void 0!=i.topics[l][n]&&(o=o.concat(i.topics[l][n].async),a=a.concat(i.topics[l][n].sync));for(var u=0;u<o.length;u++)i.rawEmit(h,o[u]);for(u=0;u<a.length;u++)i.rawEmit(c,a[u])},i.rawEmit=function(t,e){t.async?setTimeout(function(){e(t)},0):e(t)},i.ensureTopicExists=function(t,e){void 0==i.topics[t][e]&&(i.topics[t][e]={},i.topics[t][e].async=[],i.topics[t][e].sync=[]),"*"!=t&&void 0==i.topics["*"][e]&&(i.topics["*"][e]={},i.topics["*"][e].async=[],i.topics["*"][e].sync=[])},i.isSubscribed=function(t,e,n,r){return void 0!=i.topics[t]&&void 0!=i.topics[t][e]&&i.topics[t][e][i.getSyncType(r)].indexOf(n)>-1},i.bind=function(t){t.subscribe=i.subscribe,t.unsubscribe=i.unsubscribe,t.emit=i.emit,t.register=i.register,t.rawEmit=i.rawEmit,t.getSyncType=i.getSyncType,t.isSubscribed=i.isSubscribed}};return new e}),define("shared/utils/eventUtils",[],function(){return{callback:function(t,e){var i=t,n=e,r=Array.prototype.slice.call(arguments,2);return r.length>0?function(){return n.apply(i,r.concat(Array.prototype.slice.call(arguments)))}:function(){return n.apply(i,arguments)}},yuduAddEventListener:function(t){var e=Array.prototype.slice.call(arguments,1);t.addEventListener.apply(t,e)},yuduOn:function(t){var e=Array.prototype.slice.call(arguments,1);t.on.apply(t,e)}}}),define("shared/events",["shared/utils/eventUtils","jquery"],function(t,e){var i={CRITICAL_ERROR:"criticalError",YUDU_BOOK_LOADED:"yuduBookLoaded",TAP:"tap",LOADING_ACTIONS_DONE:"loadingActionsDone",RESIZE:"resize",SHOWHIDE_TOOLBAR:"showhideToolbar",SHARE_TO:{EMAIL:"email",FACEBOOK:"facebook",TWITTER:"twitter",LINKED_IN:"linkedIn"},SHARE_EMAIL_DIALOG_OPEN:"shareEmailOpen",SHARE_EMAIL_DIALOG_CLOSE:"shareEmailClose",CLOSE_ACTIVE:"closeActive"};return new function(){var n=this;e.extend(n,i),n.callback=t.callback,n.yuduAddEventListener=t.yuduAddEventListener,n.yuduOn=t.yuduOn}}),define("events",["shared/eventManager","shared/events","jquery"],function(t,e,i){var n={TILE_FETCHED:"tileFetched",TILE_FADE_START:"tileFadeStart",TILE_FADE_END:"tileFadeEnd",FETCH_TILE:"fetchTile",TOGGLE_KEY_NAVIGATION:"toggleKeyNavigation",ZOOM:"zoom",ZOOM_SCALE:"zoomScale",BROWSER_ZOOM_LEVEL_CHANGED:"browserZoomLevelChanged",TOUCH:"touch",LEVEL_DRAGGED:"levelDragged",LOAD:"load",PAGE_CHANGED:"pageChanged",GOTO_PAGE:"goToPage",GOTO_PREVIOUS_PAGE:"goToPreviousPage",GOTO_NEXT_PAGE:"goToNextPage",READER_STARTED:"readerStarted",READER_LOADED:"readerLoaded",QUERY_STRING_PARSED:"queryStringParsed",ZOOMLEVEL_TILESLOADED:"zoomLevelTilesLoaded",SHIFTER_SPRINGING:"shifterSpringing",TWO_UP_CHANGED:"twoUpChanged",DRAG:"drag",DRAG_END:"dragEnd",DRAG_START:"dragStart",HISTORY_CHANGE:"historyChange",MOUSE_MOVE_STOP:"mouseMoveStop",INFORMATION_LOADED:"informationLoaded",HIDE_INFORMATION:"hideInformation",FIT_CHANGED:"fitChanged",SHOW_LOGIN:"showLogin",LOGIN_SUCCESS:"loginSuccess",NEEDS_BACKGROUND_LOGIN_ATTEMPT:"needsBackgroundLoginAttempt",CHANGE_FOR_LOGIN_DETAILS:"changeForLoginDetails",LOGIN_DETAILS_CHANGED:"loginDetailsChanged",LOGIN_DETAILS_FROM_LOCAL_STORAGE:"loginDetailsFromLocalStorage",REQUEST_LOGIN_DETAILS:"requestLoginDetails",DECRYPT_ALL_PAGES:"decryptAllPages",PAGE_DECRYPTED:"pageDecrypted",LOADING_FINISHED:"loadingFinished",TRIGGER:"trigger",YUDU_PREFIXED_MESSAGE_RECEIVED:"yuduPrefixedMessageReceived",MESSAGE_RECEIVED_FROM_ARTICLE_VIEW:"messageReceivedFromArticleView",OPEN_ARTICLE:"openArticle",VIEW_NOTE:"viewNote",NOTE_MOVED:"noteMoved",NOTE_TRANSFORM_CHANGED:"noteTransformChanged",NOTE_TRANSFORM_CHECK:"noteTransformCheck",NOTE_DRAG_START:"noteDragStart",NOTES_BACKGROUND_INTERACTION:"notesBackgroundInteraction",UGC_CHANGED:"ugcChanged",LIVE_URL_RECEIVED:"liveUrlReceived",PUBLIC_API_LOGIN_STATE_CHANGED:"publicApiLoginStateChanged",CLOSE_LIGHTBOX:"closeLightbox",OVERLAY_FADE_START:"overlayFadeStart",OVERLAY_FADE_END:"overlayFadeEnd",OVERLAY_FADE_OUT_START:"overlayFadeOutStart",OVERLAY_FADE_OUT_END:"overlayFadeOutEnd",OVERLAY_FLASH_START:"overlayFlashStart",OVERLAY_FLASH_END:"overlayFlashEnd",OVERLAY_TWEENS_REMOVED:"overlayTweensRemoved"},r={COMMON:{RESIZE:"brandableResize",TOUCH:"brandableTouch",UGC_BOOKMARKS_CHANGED:"ugcBookmarksChanged",UGC_PAGE_HIGHLIGHTS_CHANGED:"ugcPageHighlightsChanged",UGC_NOTES_CHANGED:"ugcNotesChanged",LOGIN_SUCCESS:"brandableLoginSuccess",LOGIN_APPROVED:"brandableLoginApproved"},TOOLBAR:{FIT_WIDTH_OR_SCREEN_ACTION:"fitWidthOrScreenAction",UPDATE_SHOPPING_CART_BUTTON:"updateShoppingCartButton",UPDATE_BOOKMARK_BUTTON:"updateBookmarkButton",SEARCH_READY:"searchReady",LOADED:"brandableToolbarLoaded"},THUMBNAILS:{PAGE_CHANGED:"brandablePageChanged",TOGGLE_THUMBNAILS:"toggleThumbnails",UPDATE_THUMBNAIL:"updateThumbnail"},DRAWING_TOOLBARS:{TOGGLE_TOOLBARS:"toggleToolbars"},LOADING:{DISPLAY_PROGRESS:"displayProgress",END_LOADING:"endLoading"},STATISTICS:{VISITED:"yuduStats_visited",PAGE_VIEWED:"yuduStats_page_viewed",SEARCHED:"yuduStats_searched",EMAIL_LINK_CLICKED:"yuduStats_overlay_email",WEB_LINK_CLICKED:"yuduStats_overlay_weblink",PAGE_LINK_CLICKED:"yuduStats_overlay_pagelink",LOGO_CLICKED:"yuduStats_logo_clicked",VIDEO_WATCHED:"yuduStats_video_watched",VIDEO_RESUMED:"yuduStats_video_resumed",VIDEO_MILESTONE_REACHED:"yuduStats_video_milestone_reached",VIDEO_FINISHED:"yuduStats_video_finished",EMAILED:"yuduStats_emailed",SUBSCRIBED:"yuduStats_subscribed",TWEETED:"yuduStats_tweeted",FACEBOOKED:"yuduStats_facebooked"}},s=function(){var n=e;return i.extend(n,r),n.subscribe=t.subscribe,n.unsubscribe=t.unsubscribe,n.isSubscribed=t.isSubscribed,n.ALL=t.__ALL,n};window.yudu_events=new s;return function(){var r=e;return i.extend(r,n),t.bind(r),r.EventManager=t.__Constructor,r.ALL=t.__ALL,r}()}),define("shared/config",[],function(){var t=function(t){var e=t;this.shouldUseHighRes=function(){return e.pixelDensity>=1.5}};return new function(){var e=this;e.__helpers=new t(e);e.width=800,e.height=450,e.pixelDensity=window.devicePixelRatio||1,e.shouldUseHighRes=e.__helpers.shouldUseHighRes,e.isDesktop=!1,e.clickAction=!1,e.deviceUsesClicks=!0,e.urlNavigationTarget="_blank",e.queryObject={},e.getQueryObject=function(){return e.queryObject},e.setQueryObject=function(t){e.queryObject=t},e.getFromQuery=function(t){return e.queryObject[t]},e.setIsDesktop=function(t){e.isDesktop=t,e.deviceUsesClicks=t||!("ontouchstart"in document.documentElement),e.clickAction=e.deviceUsesClicks?"click":"touchstart"},e.isLoggedIn=!1}}),define("config",["events","shared/config","jquery"],function(t,e,i){function n(){var e=window.devicePixelRatio||1,i={},n=document.body.requestFullscreen||document.body.msRequestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullscreen,r=function(e){this.fitOnlyWidth!=e&&(this.fitOnlyWidth=e,t.emit(t.ALL,t.FIT_CHANGED,this,{}),t.emit(t.ALL,t.TOOLBAR.FIT_WIDTH_OR_SCREEN_ACTION,this,{fitOnlyWidth:e}))},s={};return{orientation:0,readerYOffset:0,overlap:1,twoPageMode:!0,pageModeStopToggle:!1,canvasResizeWidth:800,canvasResizeHeight:450,pixelDensity:e,lowestZoomLevel:0,fitOnlyWidth:!1,setFitOnlyWidth:r,bgTopColour:"1B1B1B",bgBottomColour:"1B1B1B",emailLinkOverlayColour:"00FF00",phoneOverlayColour:"B3B1DE",pageLinkOverlayColour:"0000FF",
productOverlayColour:"FFFF00",webLinkOverlayColour:"FF0000",launchableHtmlOverlayColour:"FF9900",contentOverlayColour:"FF00FF",searchOverlayColour:"008000",overlayAlpha:.2,transparentProductOverlays:!1,logoLinkUrl:!1,isPreviewEdition:!1,decryptionKey:!1,contentDecryptionHeaders:i,pageDecrypted:!1,hasIntroPage:!1,editionListUrl:"edition_list/editions.html",orderFormEnabled:!1,bookmarksEnabled:!1,notesEnabled:!1,highlightsEnabled:!1,highlightLinksOnLoadEnabled:!0,disableToggleToolbar:!1,fullscreenCompatible:n,tryToOpenWebOverlaysInNewWindow:!0,disableExtraZoom:!1,rememberedPageDisabled:!1,emailCollectionEnabled:!1,pageTurnEnabled:!1,pageTurnAudioEnabled:!1,pageTurnDurationMs:!1,userPreferences:s,updateUserPreferenceSetting:function(t,e){s[t]=e}}}return i.extend(e,new n)}),define("shared/constants",[],function(){return{toolbarIconBasePath:"./resources/artwork/",toolbarIconFileExtension:".png",toolbarIconHighResPrefix:"high_",baseResourcesFolder:"resources/",baseRequiredFolder:"required/",maxYuduBookFetchAttempts:3,messageTypes:{failure:"yudu_failure",success:"yudu_success",default:"yudu_default"},baseThumbnailFolder:"thumbnails/",shareSiteTimeout:3e3,brandingConfigFiles:{toolbar:"./resources/toolbar/toolbarConfig.json",toolbarPhoneview:"./resources/toolbarPhoneview/toolbarPhoneviewConfig.json",thumbnails:"./resources/thumbnails/thumbnailsConfig.json",drawingToolbars:"./resources/drawingToolbars/drawingToolbarsConfig.json",loading:"./resources/loading/loadingConfig.json"}}}),define("constants",["shared/constants","jquery"],function(t,e){var i={fps:60,tickTimeMs:1e3/60,fetchHandlerpps:5,pps:3,daemonpps:30,swapTweenTime:400,tileFadeTime:200,overlayFadeInTime:150,overlayFadeOutTime:500,pauseBeforeOverlayFlash:400,toolbarTimeout:4e3,pageNumTransTime:600,tileFetchBatchSize:8,daemonTileFetchBatchSize:16,maxNumTilesInQueue:20,maxPhoneWidth:480,boundaryWidth:100,minAudioVideoWidth:200,turnPageScreenTapThreshold:.1,tileFailureColour:"#FF0000",overlayFocusAlpha:.5,baseTileFolder:"tiles/",overlayBackgroundUrl:"./required/pixel.png",tileBackgroundUrl:"./resources/artwork/tileBackground.png",tileErrorUrl:"./resources/artwork/tileError.png",priceListUrl:"./pricelist.json",rolloversUrl:"./rollovers.json",customStringsPackURL:"./resources/customStringsPack.json",informationDesktop:"./resources/info/desktop.html",informationTouch:"./resources/info/touch.html",rolloverTemplate:"./resources/rollovers/productDetailsTemplate.html",stringsUrl:"./resources/strings.json",placeholderBackgroundUrl:"./resources/artwork/placeholderBackground.png",playButtonUrl:"./resources/artwork/playButton.png",playButtonTranslucentUrl:"./resources/artwork/playButtonTranslucent.png",logoUrl:"./resources/logo.png",wordPositionsFolder:"wordPositions/",basePrintablesFolder:"./print/",articleViewerPage:"./htmlArticles/index.html",audioResourcesFolder:"./resources/assets/audio/",tileFetcherDaemonLocation:"readerDaemon.min.js",orientations:{landscape:0,portrait:1},ugcNoteDragTimeout:700,ugcNotePlaceholderUrl:"./resources/artwork/note_placeholder.png",ugcNotePlaceholderDragUrl:"./resources/artwork/note_placeholder_drag.png",ugcSyncRetryTimer:3e4,ugcSyncRefreshTimer:18e5,maxOptionalJsonFetchAttempts:2,maxWordPosFetchAttempts:2,tileFetchRetryCount:3,tileCheckRetryCount:6,urlContentOverlayTypes:{image:"image",video:"video",audio:"audio",youTube:"youTube",unknown:"unknown"}};return e.extend(t,i)}),define("shared/resources",["shared/events"],function(t){return new function(){var t=this;t.yuduBook=!1,t.toolbarConfig=!1,t.toolbarHtml=!1,t.setYuduBook=function(e){t.yuduBook=e},t.getYuduBook=function(){return t.yuduBook}}}),define("resources",["shared/resources","jquery"],function(t,e){return new function(){var i=this;e.extend(i,t),i.overlayBackground=!1,i.tileBackground=!1,i.tileError=!1,i.placeholderBackground=!1,i.playButton=!1,i.playButtonTranslucent=!1,i.logo=!1,i.priceList=!1,i.rollovers=!1,i.infoPage=!1,i.wordPositions=!1,i.thumbnailsConfig=!1,i.thumbnailsHtml=!1,i.drawingToolbarsConfig=!1,i.drawingToolbarsHtml=!1,i.loadingConfig=!1,i.loadingHtml=!1,i.setYuduBook=function(e){i.yuduBook=e,t.setYuduBook(e)}}}),define("model/zoomLevel",[],function(){return{ZoomLevel:function(t,e,i,n,r,s,o){this.z=t,this.width=e,this.height=i,this.tileWidth=n,this.tileHeight=r,this.baseURL=s,this.filePattern=o,this.size={x:Math.ceil(this.width/this.tileWidth),y:Math.ceil(this.height/this.tileHeight)}}}}),define("views/zoomLevelView",["easel","config","resources","jquery","events"],function(t,e,i,n,r){return{ZoomLevelView:function(n,r){this.container=new t.Container,this.container.regX=n/2,this.container.regY=r/2,this.container.x=0,this.container.y=0,this.width=n,this.height=r,this.background=new t.Shape,this.background.graphics.beginBitmapFill(i.tileBackground).drawRect(1,1,this.width-2,this.height-2),this.container.addChild(this.background),this.drawTile=function(t){this.container.addChildAt(t.image,1);var i=!0,n=this.container.localToGlobal(t.x,t.y),r=this.container.localToGlobal(t.x+t.width,t.y+t.width);(r.y<0||r.x<0||n.y>e.height||n.x>e.width)&&(i=!1),i&&t.triggerFadeIn()},this.removeBackground=function(){this.container.removeChild(this.background)},this.hide=function(){this.container.visible=!1},this.setAlignment=function(e){var i=this.width/2;switch(e){case t.Alignment.LEFT:i=0;break;case t.Alignment.RIGHT:i=this.width}this.container.regX=i,this.container.regY=this.height/2},this.show=function(){this.container.visible=!0},this.unload=function(){this.removeBackground(),this.container.removeAllChildren(),this.container.parent.removeChild(this.container),this.background=null,this.container=null}}}}),define("fetching/tileFetcher",["events","config","constants","resources"],function(t,e,i,n){return{TileFetcher:function(){this.totalDownloaded=0,this.averageDownloadTime=-1,this.start=function(){},this.stop=function(){},this.enqueue=function(t){},this.flushQueues=function(){},this.fetchQueueSize=function(){},this.isBusy=function(){},this.fetch=function(e,i,n){for(var r=function(){this.zoomLevel.tileLoaded(this.tile),t.emit("tileFetcher",t.TILE_FETCHED,this,{tile:this.tile,numTiles:e.length,zoomLevel:this.zoomLevel})},s=0;s<e.length;s++){var o={tiles:e,tile:e[s],zoomLevel:i,fetchFailureCount:0,checkFailureCount:0,id:null};o.onFinished=t.callback(o,r),o.priority=!!n,e[s].setQueued(),this.enqueue(o)}},this.requestSuccess=function(t,e,i){this.totalDownloaded++;var n=Date.now()-e;this.averageDownloadTime=this.averageDownloadTime>0?(this.averageDownloadTime+n)/2:n,i.tile.imageWidth=t.width,i.tile.imageHeight=t.height,i.tile.image=new createjs.Bitmap(t),i.tile.image.set({x:i.tile.x,y:i.tile.y,width:i.tile.width,height:i.tile.height}),i.tile.setFetched(),i.onFinished()},this.requestFailed=function(t){if(t.tile.imageWidth=t.tile.width,t.tile.imageHeight=t.tile.height,n.tileError){t.tile.image=new createjs.Shape;var e=new createjs.Matrix2D,r=t.tile.width/n.tileError.width,s=t.tile.height/n.tileError.height;e.scale(r,s),t.tile.image.graphics.beginBitmapFill(n.tileError,"no-repeat",e).drawRect(0,0,t.tile.width,t.tile.height)}else t.tile.image=new createjs.Shape,t.tile.image.graphics.beginFill(i.tileFailureColour).drawRect(0,0,t.tile.width,t.tile.height);t.tile.image.set({x:t.tile.x,y:t.tile.y,width:t.tile.width,height:t.tile.height}),t.tile.setFetched(),t.onFinished()},this.isFetchQueueEmpty=function(){return 0==this.fetchQueueSize()},this.getAverageDownloadTime=function(){return this.averageDownloadTime}}}});var CryptoJS=CryptoJS||function(t,e){var i={},n=i.lib={},r=function(){},s=n.Base={extend:function(t){r.prototype=this;var e=new r;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=n.WordArray=s.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:4*t.length},toString:function(t){return(t||h).stringify(this)},concat:function(t){var e=this.words,i=t.words,n=this.sigBytes;if(t=t.sigBytes,this.clamp(),n%4)for(var r=0;r<t;r++)e[n+r>>>2]|=(i[r>>>2]>>>24-r%4*8&255)<<24-(n+r)%4*8;else if(65535<i.length)for(r=0;r<t;r+=4)e[n+r>>>2]=i[r>>>2];else e.push.apply(e,i);return this.sigBytes+=t,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-i%4*8,e.length=t.ceil(i/4)},clone:function(){var t=s.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var i=[],n=0;n<e;n+=4)i.push(4294967296*t.random()|0);return new o.init(i,e)}}),a=i.enc={},h=a.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var i=[],n=0;n<t;n++){var r=e[n>>>2]>>>24-n%4*8&255;i.push((r>>>4).toString(16)),i.push((15&r).toString(16))}return i.join("")},parse:function(t){for(var e=t.length,i=[],n=0;n<e;n+=2)i[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new o.init(i,e/2)}},c=a.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var i=[],n=0;n<t;n++)i.push(String.fromCharCode(e[n>>>2]>>>24-n%4*8&255));return i.join("")},parse:function(t){for(var e=t.length,i=[],n=0;n<e;n++)i[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new o.init(i,e)}},l=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},u=n.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=l.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var i=this._data,n=i.words,r=i.sigBytes,s=this.blockSize,a=r/(4*s),a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0);if(e=a*s,r=t.min(4*e,r),e){for(var h=0;h<e;h+=s)this._doProcessBlock(n,h);h=n.splice(0,e),i.sigBytes-=r}return new o.init(h,r)},clone:function(){var t=s.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});n.Hasher=u.extend({cfg:s.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,i){return new t.init(i).finalize(e)}},_createHmacHelper:function(t){return function(e,i){return new d.HMAC.init(t,i).finalize(e)}}});var d=i.algo={};return i}(Math);!function(){var t=CryptoJS,e=t.lib.WordArray;t.enc.Base64={stringify:function(t){var e=t.words,i=t.sigBytes,n=this._map;t.clamp(),t=[];for(var r=0;r<i;r+=3)for(var s=(e[r>>>2]>>>24-r%4*8&255)<<16|(e[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|e[r+2>>>2]>>>24-(r+2)%4*8&255,o=0;4>o&&r+.75*o<i;o++)t.push(n.charAt(s>>>6*(3-o)&63));if(e=n.charAt(64))for(;t.length%4;)t.push(e);return t.join("")},parse:function(t){var i=t.length,n=this._map,r=n.charAt(64);r&&-1!=(r=t.indexOf(r))&&(i=r);for(var r=[],s=0,o=0;o<i;o++)if(o%4){var a=n.indexOf(t.charAt(o-1))<<o%4*2,h=n.indexOf(t.charAt(o))>>>6-o%4*2;r[s>>>2]|=(a|h)<<24-s%4*8,s++}return e.create(r,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(t){function e(t,e,i,n,r,s,o){return((t=t+(e&i|~e&n)+r+o)<<s|t>>>32-s)+e}function i(t,e,i,n,r,s,o){return((t=t+(e&n|i&~n)+r+o)<<s|t>>>32-s)+e}function n(t,e,i,n,r,s,o){return((t=t+(e^i^n)+r+o)<<s|t>>>32-s)+e}function r(t,e,i,n,r,s,o){return((t=t+(i^(e|~n))+r+o)<<s|t>>>32-s)+e}for(var s=CryptoJS,o=s.lib,a=o.WordArray,h=o.Hasher,o=s.algo,c=[],l=0;64>l;l++)c[l]=4294967296*t.abs(t.sin(l+1))|0;o=o.MD5=h.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,s){for(var o=0;16>o;o++){var a=s+o,h=t[a];t[a]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}var o=this._hash.words,a=t[s+0],h=t[s+1],l=t[s+2],u=t[s+3],d=t[s+4],f=t[s+5],g=t[s+6],p=t[s+7],m=t[s+8],v=t[s+9],y=t[s+10],b=t[s+11],_=t[s+12],w=t[s+13],T=t[s+14],x=t[s+15],S=o[0],C=o[1],E=o[2],O=o[3],S=e(S,C,E,O,a,7,c[0]),O=e(O,S,C,E,h,12,c[1]),E=e(E,O,S,C,l,17,c[2]),C=e(C,E,O,S,u,22,c[3]),S=e(S,C,E,O,d,7,c[4]),O=e(O,S,C,E,f,12,c[5]),E=e(E,O,S,C,g,17,c[6]),C=e(C,E,O,S,p,22,c[7]),S=e(S,C,E,O,m,7,c[8]),O=e(O,S,C,E,v,12,c[9]),E=e(E,O,S,C,y,17,c[10]),C=e(C,E,O,S,b,22,c[11]),S=e(S,C,E,O,_,7,c[12]),O=e(O,S,C,E,w,12,c[13]),E=e(E,O,S,C,T,17,c[14]),C=e(C,E,O,S,x,22,c[15]),S=i(S,C,E,O,h,5,c[16]),O=i(O,S,C,E,g,9,c[17]),E=i(E,O,S,C,b,14,c[18]),C=i(C,E,O,S,a,20,c[19]),S=i(S,C,E,O,f,5,c[20]),O=i(O,S,C,E,y,9,c[21]),E=i(E,O,S,C,x,14,c[22]),C=i(C,E,O,S,d,20,c[23]),S=i(S,C,E,O,v,5,c[24]),O=i(O,S,C,E,T,9,c[25]),E=i(E,O,S,C,u,14,c[26]),C=i(C,E,O,S,m,20,c[27]),S=i(S,C,E,O,w,5,c[28]),O=i(O,S,C,E,l,9,c[29]),E=i(E,O,S,C,p,14,c[30]),C=i(C,E,O,S,_,20,c[31]),S=n(S,C,E,O,f,4,c[32]),O=n(O,S,C,E,m,11,c[33]),E=n(E,O,S,C,b,16,c[34]),C=n(C,E,O,S,T,23,c[35]),S=n(S,C,E,O,h,4,c[36]),O=n(O,S,C,E,d,11,c[37]),E=n(E,O,S,C,p,16,c[38]),C=n(C,E,O,S,y,23,c[39]),S=n(S,C,E,O,w,4,c[40]),O=n(O,S,C,E,a,11,c[41]),E=n(E,O,S,C,u,16,c[42]),C=n(C,E,O,S,g,23,c[43]),S=n(S,C,E,O,v,4,c[44]),O=n(O,S,C,E,_,11,c[45]),E=n(E,O,S,C,x,16,c[46]),C=n(C,E,O,S,l,23,c[47]),S=r(S,C,E,O,a,6,c[48]),O=r(O,S,C,E,p,10,c[49]),E=r(E,O,S,C,T,15,c[50]),C=r(C,E,O,S,f,21,c[51]),S=r(S,C,E,O,_,6,c[52]),O=r(O,S,C,E,u,10,c[53]),E=r(E,O,S,C,y,15,c[54]),C=r(C,E,O,S,h,21,c[55]),S=r(S,C,E,O,m,6,c[56]),O=r(O,S,C,E,x,10,c[57]),E=r(E,O,S,C,g,15,c[58]),C=r(C,E,O,S,w,21,c[59]),S=r(S,C,E,O,d,6,c[60]),O=r(O,S,C,E,b,10,c[61]),E=r(E,O,S,C,l,15,c[62]),C=r(C,E,O,S,v,21,c[63]);o[0]=o[0]+S|0,o[1]=o[1]+C|0,o[2]=o[2]+E|0,o[3]=o[3]+O|0},_doFinalize:function(){var e=this._data,i=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;i[r>>>5]|=128<<24-r%32;var s=t.floor(n/4294967296);for(i[15+(r+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),i[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(i.length+1),this._process(),e=this._hash,i=e.words,n=0;4>n;n++)r=i[n],i[n]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return e},clone:function(){var t=h.clone.call(this);return t._hash=this._hash.clone(),t}}),s.MD5=h._createHelper(o),s.HmacMD5=h._createHmacHelper(o)}(Math),function(){var t=CryptoJS,e=t.lib,i=e.Base,n=e.WordArray,e=t.algo,r=e.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var i=this.cfg,r=i.hasher.create(),s=n.create(),o=s.words,a=i.keySize,i=i.iterations;o.length<a;){h&&r.update(h);var h=r.update(t).finalize(e);r.reset();for(var c=1;c<i;c++)h=r.finalize(h),r.reset();s.concat(h)}return s.sigBytes=4*a,s}});t.EvpKDF=function(t,e,i){return r.create(i).compute(t,e)}}(),CryptoJS.lib.Cipher||function(t){var e=CryptoJS,i=e.lib,n=i.Base,r=i.WordArray,s=i.BufferedBlockAlgorithm,o=e.enc.Base64,a=e.algo.EvpKDF,h=i.Cipher=s.extend({cfg:n.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,i){this.cfg=this.cfg.extend(i),this._xformMode=t,this._key=e,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(t){return{encrypt:function(e,i,n){return("string"==typeof i?g:f).encrypt(t,e,i,n)},decrypt:function(e,i,n){return("string"==typeof i?g:f).decrypt(t,e,i,n)}}}});i.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=e.mode={},l=function(t,e,i){var n=this._iv;n?this._iv=void 0:n=this._prevBlock;for(var r=0;r<i;r++)t[e+r]^=n[r]},u=(i.BlockCipherMode=n.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}})).extend();u.Encryptor=u.extend({processBlock:function(t,e){var i=this._cipher,n=i.blockSize;l.call(this,t,e,n),i.encryptBlock(t,e),this._prevBlock=t.slice(e,e+n)}}),u.Decryptor=u.extend({processBlock:function(t,e){var i=this._cipher,n=i.blockSize,r=t.slice(e,e+n);i.decryptBlock(t,e),l.call(this,t,e,n),this._prevBlock=r}}),c=c.CBC=u,u=(e.pad={}).Pkcs7={pad:function(t,e){for(var i=4*e,i=i-t.sigBytes%i,n=i<<24|i<<16|i<<8|i,s=[],o=0;o<i;o+=4)s.push(n);i=r.create(s,i),t.concat(i)},unpad:function(t){t.sigBytes-=255&t.words[t.sigBytes-1>>>2]}},i.BlockCipher=h.extend({cfg:h.cfg.extend({mode:c,padding:u}),reset:function(){h.reset.call(this);var t=this.cfg,e=t.iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var i=t.createEncryptor;else i=t.createDecryptor,this._minBufferSize=1;this._mode=i.call(t,this,e&&e.words)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else e=this._process(!0),t.unpad(e);return e},blockSize:4});var d=i.CipherParams=n.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),c=(e.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext;return t=t.salt,(t?r.create([1398893684,1701076831]).concat(t).concat(e):e).toString(o)},parse:function(t){t=o.parse(t);var e=t.words;if(1398893684==e[0]&&1701076831==e[1]){var i=r.create(e.slice(2,4));e.splice(0,4),t.sigBytes-=16}return d.create({ciphertext:t,salt:i})}},f=i.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(t,e,i,n){n=this.cfg.extend(n);var r=t.createEncryptor(i,n);return e=r.finalize(e),r=r.cfg,d.create({ciphertext:e,key:i,iv:r.iv,algorithm:t,mode:r.mode,padding:r.padding,blockSize:t.blockSize,formatter:n.format})},decrypt:function(t,e,i,n){return n=this.cfg.extend(n),e=this._parse(e,n.format),t.createDecryptor(i,n).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),e=(e.kdf={}).OpenSSL={execute:function(t,e,i,n){return n||(n=r.random(8)),t=a.create({keySize:e+i}).compute(t,n),i=r.create(t.words.slice(e),4*i),t.sigBytes=4*e,d.create({key:t,iv:i,salt:n})}},g=i.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:e}),encrypt:function(t,e,i,n){return n=this.cfg.extend(n),i=n.kdf.execute(i,t.keySize,t.ivSize),n.iv=i.iv,t=f.encrypt.call(this,t,e,i.key,n),t.mixIn(i),t},decrypt:function(t,e,i,n){return n=this.cfg.extend(n),e=this._parse(e,n.format),i=n.kdf.execute(i,t.keySize,t.ivSize,e.salt),n.iv=i.iv,f.decrypt.call(this,t,e,i.key,n)}})}(),function(){for(var t=CryptoJS,e=t.lib.BlockCipher,i=t.algo,n=[],r=[],s=[],o=[],a=[],h=[],c=[],l=[],u=[],d=[],f=[],g=0;256>g;g++)f[g]=128>g?g<<1:g<<1^283;for(var p=0,m=0,g=0;256>g;g++){var v=m^m<<1^m<<2^m<<3^m<<4,v=v>>>8^255&v^99;n[p]=v,r[v]=p;var y=f[p],b=f[y],_=f[b],w=257*f[v]^16843008*v;s[p]=w<<24|w>>>8,o[p]=w<<16|w>>>16,a[p]=w<<8|w>>>24,h[p]=w,w=16843009*_^65537*b^257*y^16843008*p,c[v]=w<<24|w>>>8,l[v]=w<<16|w>>>16,u[v]=w<<8|w>>>24,d[v]=w,p?(p=y^f[f[f[_^y]]],m^=f[f[m]]):p=m=1}var T=[0,1,2,4,8,16,32,64,128,27,54],i=i.AES=e.extend({_doReset:function(){for(var t=this._key,e=t.words,i=t.sigBytes/4,t=4*((this._nRounds=i+6)+1),r=this._keySchedule=[],s=0;s<t;s++)if(s<i)r[s]=e[s];else{var o=r[s-1];s%i?6<i&&4==s%i&&(o=n[o>>>24]<<24|n[o>>>16&255]<<16|n[o>>>8&255]<<8|n[255&o]):(o=o<<8|o>>>24,o=n[o>>>24]<<24|n[o>>>16&255]<<16|n[o>>>8&255]<<8|n[255&o],o^=T[s/i|0]<<24),r[s]=r[s-i]^o}for(e=this._invKeySchedule=[],i=0;i<t;i++)s=t-i,o=i%4?r[s]:r[s-4],e[i]=4>i||4>=s?o:c[n[o>>>24]]^l[n[o>>>16&255]]^u[n[o>>>8&255]]^d[n[255&o]]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,s,o,a,h,n)},decryptBlock:function(t,e){var i=t[e+1];t[e+1]=t[e+3],t[e+3]=i,this._doCryptBlock(t,e,this._invKeySchedule,c,l,u,d,r),i=t[e+1],t[e+1]=t[e+3],t[e+3]=i},_doCryptBlock:function(t,e,i,n,r,s,o,a){for(var h=this._nRounds,c=t[e]^i[0],l=t[e+1]^i[1],u=t[e+2]^i[2],d=t[e+3]^i[3],f=4,g=1;g<h;g++)var p=n[c>>>24]^r[l>>>16&255]^s[u>>>8&255]^o[255&d]^i[f++],m=n[l>>>24]^r[u>>>16&255]^s[d>>>8&255]^o[255&c]^i[f++],v=n[u>>>24]^r[d>>>16&255]^s[c>>>8&255]^o[255&l]^i[f++],d=n[d>>>24]^r[c>>>16&255]^s[l>>>8&255]^o[255&u]^i[f++],c=p,l=m,u=v;p=(a[c>>>24]<<24|a[l>>>16&255]<<16|a[u>>>8&255]<<8|a[255&d])^i[f++],m=(a[l>>>24]<<24|a[u>>>16&255]<<16|a[d>>>8&255]<<8|a[255&c])^i[f++],v=(a[u>>>24]<<24|a[d>>>16&255]<<16|a[c>>>8&255]<<8|a[255&l])^i[f++],d=(a[d>>>24]<<24|a[c>>>16&255]<<16|a[l>>>8&255]<<8|a[255&u])^i[f++],t[e]=p,t[e+1]=m,t[e+2]=v,t[e+3]=d},keySize:8});t.AES=e._createHelper(i)}(),define("crypto",function(t){return function(){return t.CryptoJS}}(this)),define("shared/utils/queryStringUtils",[],function(){return new function(){var t=this;t.splitUrl=function(t){var e={},i=t.indexOf("#");i>=0&&(e.hash=t.substr(i),t=t.substr(0,i));var n=t.indexOf("?");return n>=0&&(e.query=t.substr(n),t=t.substr(0,n)),e.url=t,e},t.joinUrl=function(t){var e=t.url;return t.query&&("?"!==t.query.charAt(0)&&(e+="?"),e+=t.query),t.hash&&("#"!==t.hash.charAt(0)&&(e+="#"),e+=t.hash),e},t.parseQueryString=function(e,i){return"?"===e.charAt(0)&&(e=e.slice(1)),e.length?i?t.parseQueryStringComplex(e,i):t.parseQueryStringSimple(e):{}},t.parseQueryStringSimple=function(t){for(var e={},i=t.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");2===r.length&&(e[r[0]]=decodeURIComponent(r[1].replace(/\+/g," ")))}return e},t.parseQueryStringComplex=function(t,e){for(var i=!!e.assumeSanity,n=!!e.allowMultiples,r=!!e.trueForValueless,s=!!r||(void 0!==e.customValueless?e.customValueless:""),o={},a=t.split("&"),h=0;h<a.length;h++){var c=a[h].split("="),l=c[0];if(i||!(l.length<1)){var u=!1,d=s;if(c.length>1){var f;f=i?c[1]:c.slice(1).join("="),f.length>0&&(d=decodeURIComponent(f.replace(/\+/g," ")),u=!0)}n?(o[l]||(o[l]=[]),o[l].push(d)):(u||void 0===o[l])&&(o[l]=d)}}return o},t.stringifyQueryStringHash=function(t){var i=!1,n=!1,r="";for(var s in t)if(t.hasOwnProperty(s)){var o=t[s],a=i?"&":"?";i||("object"==typeof o&&(n=!0),i=!0);try{a+=e(s,o,!n),r+=a}catch(t){r.length<1&&(i=!1)}}return r};var e=function(t,i,n){var r="";if(n){if(r+=t,!0===i)return r;if("string"!=typeof i)throw"Invalid query string format";r+="="+encodeURIComponent(i).replace(/ /g,"+")}else{if(!i.length)throw"Invalid query string format";for(var s=0;s<i.length;s++)s>0&&(r+="&"),r+=e(t,i[s],!0)}return r};t.addQueryStringToURL=function(t,e){if(!t)return t;var i=t.lastIndexOf("?"),n=t.lastIndexOf("&"),r="";return-1==i?r="?":i!=t.length-1&&n!=t.length-1&&(r="&"),t+r+e},t.addToUrlQueryString=function(t,e){var i=[];for(var n in e)if(e.hasOwnProperty(n)){if("string"!=typeof e[n])continue;i.push(n+"="+e[n])}if(i.length<1)return t;var r=t.lastIndexOf("?"),s=t.lastIndexOf("&");return-1==r?t+="?":r!=t.length-1&&s!=t.length-1&&(t+="&"),t+i.join("&")},t.addRandomQueryStringParameter=function(e,i){var n=Math.random().toString(36).substr(2),r={};return r[i]=n,t.addToUrlQueryString(e,r)},t.replaceForKeyInQuery=function(e,i,n){var r={};return r[i]=n,t.replaceInQuery(e,r,!1)},t.replaceInQuery=function(e,i,n){var r;if(e.query){var s={allowMultiples:n,trueForValueless:!0};r=t.parseQueryString(e.query,s)}else r={};for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o]);var a={url:e.url};return a.query=t.stringifyQueryStringHash(r),e.hash&&(a.hash=e.hash),a}}}),define("utils/encryptedResourceFetchingUtils",["crypto","config","shared/utils/queryStringUtils","jquery"],function(t,e,i,n){var r=function(e){var i=t.enc.Base64.parse(e),n=t.MD5(i);return t.enc.Base64.stringify(n)},s=function(t,r,s){var o=function(t){var e=window.URL||window.webkitURL;r.src=e.createObjectURL(t)};n.isEmptyObject(e.contentDecryptionHeaders)?r.src=t:a(i.addRandomQueryStringParameter(t,"encCacheRand"),e.contentDecryptionHeaders,o,s)},o=function(t,r,s){var o=function(t){var e=window.URL||window.webkitURL;r(e.createObjectURL(t))};n.isEmptyObject(e.contentDecryptionHeaders)?r(t):a(i.addRandomQueryStringParameter(t,"encCacheRand"),e.contentDecryptionHeaders,o,s)},a=function(t,e,i,r){n.ajax({url:t,type:"GET",headers:e,xhrFields:{responseType:"blob"},success:function(t){i(t)},error:function(t,e,i){r&&r(t,e,i)}})};return{RANDOM_QUERY_STRING_PARAM_KEY:"encCacheRand",getBase64MD5DigestOfBase64Message:r,useResourceAsHtmlElementSource:s,useResourceAsCallbackArgument:o}}),define("fetching/tileFetcherSync",["events","config","constants","resources","fetching/tileFetcher","utils/encryptedResourceFetchingUtils"],function(t,e,i,n,r,s){var o=function(){r.TileFetcher.call(this),this.priorityQueue=[],this.queue=[],this.fetchingLookup={},this.active=0,this.nextRequestID=0,this.start=function(){var e=1e3/i.pps;this.timer=setInterval(t.callback(this,this.processQueues),e)},this.stop=function(){clearInterval(this.timer)},this.enqueue=function(t){t.priority?this.priorityQueue.push(t):this.queue.push(t)},this.flushQueues=function(){for(var t=0;t<this.queue.length;t++)this.queue[t].tile.reset();for(var t=0;t<this.priorityQueue.length;t++)this.priorityQueue[t].tile.reset();this.queue=[],this.priorityQueue=[]},this.fetchQueueSize=function(){return this.queue.length+this.priorityQueue.length},this.isBusy=function(){return this.priorityQueue.length>0||this.queue.length>i.maxNumTilesInQueue},this.fetchTile=function(e){null==e.id&&(e.id=this.nextRequestID++,this.fetchingLookup[e.id]=e),e.tile.setFetching();var i=new Image;i.onload=t.callback(this,this.onFetchedImage,i,Date.now(),e),i.onerror=t.callback(this,this.onFetchError,e),s.useResourceAsHtmlElementSource(e.tile.url,i,i.onerror)},this.processQueues=function(){if(!(this.active>i.tileFetchBatchSize)){var t=i.tileFetchBatchSize-this.active,e=this.priorityQueue.splice(0,t);t=Math.max(0,t-e.length);for(var n=e.concat(this.queue.splice(0,t)),r=0;r<n.length;r++)this.fetchTile(n[r]);this.active+=n.length}},this.onFetchError=function(t){t.fetchFailureCount++,delete this.fetchingLookup[t.id],this.active--,t.fetchFailureCount<i.tileFetchRetryCount?(t.tile.setQueued(),this.enqueue(t)):this.requestFailed(t)},this.onFetchedImage=function(t,e,i){delete this.fetchingLookup[i.id],this.active--,this.requestSuccess(t,e,i)}};return o.prototype=r.TileFetcher.prototype,{TileFetcherSync:o,EMITTER_NAME:"tileFetcherSync"}}),define("shared/localisation",["jquery"],function(t){var e=globalLanguagePack,i=!1;return new function(){var n=this;n.loadResources=function(e,n){t.getJSON(e,function(t){i=t,n()}).fail(function(){i=!1,n()})},n.get=function(t){var n=i[t];if(n)return n;var r=e[t];return void 0!=r?r:t},n.localiseHtml=function(e){t(e).find(".yudu_localisable").each(function(){var e=t(this);e.text(n.get(e.text()))});var i="yudu_localisable-";t(e).find('*[class^="'+i+'"]').each(function(){for(var e=t(this),r=e.attr("class").split(" "),s=!1,o=0,a=r.length;o<a;o++)if(0===r[o].lastIndexOf(i,0)){s=r[o].substring(i.length);break}s&&e.attr(s,n.get(e.attr(s)))})},n._private={setDummyDataForTesting:function(t,n){e=t,i=n}}}}),define("shared/hammerManager",[],function(){return new function(){var t=this,e=null;t.recogniserPresets={TAP_ONLY:[]},t.setupLibraries=function(i){e=i,t.createPresetsObject(t.recogniserPresets)},t.createPresetsObject=function(t){t.TAP_ONLY=[[e.Tap]]},t.createManager=function(t){return e?new e(t):null},t.createManagerWithRecognisers=function(i,n){return e?n?new e.Manager(i,{recognizers:n}):t.createManager(i):null},t.createManagerWithOptions=function(i,n){return e?n?new e.Manager(i,n):t.createManager(i):null},t.createTapManager=function(e){return t.createManagerWithRecognisers(e,t.recogniserPresets.TAP_ONLY)}}}),define("shared/ui/messageBox",["jquery","shared/config","shared/constants","shared/events","shared/localisation","shared/hammerManager"],function(t,e,i,n,r,s){var o=t("#yudu_messageBackground"),a=t("#yudu_messageBox"),h=t("#yudu_message"),c=t("#yudu_messageClose"),l=t("#yudu_messageOk"),u=t("#yudu_messageCancel"),d=[],f=function(){},g=f,p=function(){o.show(),a.slideDown(),n.subscribe(n.ALL,n.CLOSE_ACTIVE,m)},m=function(){n.unsubscribe(n.ALL,n.CLOSE_ACTIVE,m),o.hide(),a.hide(),h.empty(),C(),g(),g=f,y(i.messageTypes.default)},v=function(t){h.text(t)},y=function(t){h.removeClass(),h.addClass(t)},b=function(t,e){a.removeClass("yudu_twoButton"),v(t),y(e),p()},_=function(t,e){b(r.get(t),e)},w=function(t,e,i){a.addClass("yudu_twoButton"),S(l,e),S(u,i),v(t),p()},T=function(t){a.addClass("yudu_twoButton"),v(t.text);var e=!1;t.leftLabel&&(e=u.text(),u.text(t.leftLabel)),t.leftCallback&&S(u,t.leftCallback);var i=!1;t.rightLabel&&(i=l.text(),l.text(t.rightLabel)),t.rightCallback&&S(l,t.rightCallback),t.backgroundCallback&&S(o,t.backgroundCallback),g=function(){e&&u.text(e),i&&l.text(i)},p()},x=function(t,e){return{button:t,callback:e}},S=function(t,i){n.yuduOn(t,e.clickAction,i),d.push(new x(t,i))},C=function(){for(;d.length>0;){var t=d.pop();t.button.off(e.clickAction,t.callback)}};return{init:function(){n.yuduOn(c,e.clickAction,m),n.yuduOn(u,e.clickAction,m),n.yuduOn(l,e.clickAction,m),n.yuduOn(o,e.clickAction,m),r.localiseHtml(a)},show:p,hide:m,setMessage:v,setType:y,display:b,displayByCode:_,displayTwoButtonPopup:w,displayAdvancedTwoButtonPopup:T}}),define("shared/utils/appUtils",[],function(){return new function(){var t=this;t.nativeWrapperPrefixPrototcol="yudu:",t.nativeWindowsAdditionalPrefixPrototcol="ms-appx-web:///",t.isThisAnApp=function(e){return e&&"true"===e.isApp||t.deviceType.isMetro()||t.deviceType.isAndroid()},t.deviceType={isMetro:function(){return window.external&&"notify"in window.external},isAndroid:function(){return window.yuduinterface&&"android"===window.yuduinterface.getPlatform()}},t.getVersion=function(e){var i,n,r,s,o=e.components.app;if(t.deviceType.isMetro());else if(t.deviceType.isAndroid()){o=e.components.appAndroid;var a=window.top.yuduinterface&&window.top.yuduinterface.getVersion&&window.top.yuduinterface.getVersion()||0;s=a%100,a=Math.floor(a/100),r=a%100,a=Math.floor(a/100),n=a%100,i=Math.floor(a/100)}return new e.VersionNumber(o,i,n,r,s)};var e="_uninitialised",i={};t.targets={_uninitialised:"_uninitialised",_native:"_native",_app:"_app",htmlReader:"htmlReader",articleView:"articleView"},t.designateOrigin=function(i){return t.targets[e]===e&&(e=i,!0)},t.registerMessageResponder=function(t,e){"function"==typeof e&&(i[t]=e)},t.sendMessage=function(i,r,s){var o=t.prepareMessage(i,r,s);""!==o&&(e===r?t.api.handleMessage(o):n(o))};var n=function(e){e.length>2e3&&t.deviceType.isMetro()?r(e):o(e)};t.prepareMessage=function(i,n,r){var s="";return e===t.targets._uninitialised?s:"string"!=typeof i||t.targets[n]!==n?s:(r=r||{},t.deviceType.isMetro()&&(s+="ms-appx-web:///"),s+=["yudu",i,n,e,encodeURIComponent(JSON.stringify(r))].join(":"))};var r=function(i){for(var n=c(100,999),r=s(i,!0),a=0;a<r.length;a++){var h={mmid:n,mmcp:a,mmtn:r.length,mmmp:r[a]},l=["ms-appx-web:///yudu","multipart-v2",t.targets._native,e,encodeURIComponent(JSON.stringify(h))].join(":");o(l)}},s=function(t,e,i){void 0===i&&(void 0===e?(i=1970,e=!1):i=1830);var n;n=e?encodeURIComponent(t):t;for(var r=0,s=[];r<n.length;){var o=r+i,a=n.substring(r,o),h=a.indexOf("%",a.length-2);h>=0&&a.length==i&&(o=r+h,a=n.substring(r,o)),s.push(a),r=o}return e&&(s=s.map(decodeURIComponent)),s},o=function(t){window.location.href=t};t.handleMessage=function(e){var i=t.parseMessage(e);a(i.messageType,i.origin,i.parameters)},t.parseMessage=function(t){t=h(t);var e=t.split(":",4);if(e.length<4)return{};var i=":".length*e.length;e.map(function(t){i+=t.length});var n=JSON.parse(decodeURIComponent(t.substring(i)));return{prefix:e[0],messageType:e[1],intendedTarget:e[2],origin:e[3],parameters:n}};var a=function(t,e,n){i[t]&&i[t](e,n)},h=function(e){return e.substr(0,t.nativeWindowsAdditionalPrefixPrototcol.length)===t.nativeWindowsAdditionalPrefixPrototcol&&(e=e.substr(t.nativeWindowsAdditionalPrefixPrototcol.length)),e},c=function(t,e){var i=Math.floor(Math.random()*(e-t+1))+t;return Date.now().toString(36).toUpperCase()+"-"+i};t.api={},t.api.handleMessage=t.handleMessage,
t.api.parseMessage=t.parseMessage}}),function(t,e,i){"undefined"!=typeof module&&module.exports?module.exports=i():"function"==typeof define&&define.amd?define(e,i):t[e]=i()}(this,"bowser",function(){function t(t){function e(e){var i=t.match(e);return i&&i.length>1&&i[1]||""}var i,n=e(/(ipod|iphone|ipad)/i).toLowerCase(),r=/like android/i.test(t),s=!r&&/android/i.test(t),a=/nexus\s*[0-6]\s*/i.test(t),h=!a&&/nexus\s*[0-9]+/i.test(t),c=/CrOS/.test(t),l=/silk/i.test(t),u=/sailfish/i.test(t),d=/tizen/i.test(t),f=/(web|hpw)os/i.test(t),g=/windows phone/i.test(t),p=(/SamsungBrowser/i.test(t),!g&&/windows/i.test(t)),m=!n&&!l&&/macintosh/i.test(t),v=!s&&!u&&!d&&!f&&/linux/i.test(t),y=e(/edge\/(\d+(\.\d+)?)/i),b=e(/version\/(\d+(\.\d+)?)/i),_=/tablet/i.test(t),w=!_&&/[^-]mobi/i.test(t),T=/xbox/i.test(t);/opera/i.test(t)?i={name:"Opera",opera:o,version:b||e(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr|opios/i.test(t)?i={name:"Opera",opera:o,version:e(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||b}:/SamsungBrowser/i.test(t)?i={name:"Samsung Internet for Android",samsungBrowser:o,version:b||e(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(t)?i={name:"Opera Coast",coast:o,version:b||e(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(t)?i={name:"Yandex Browser",yandexbrowser:o,version:b||e(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(t)?i={name:"UC Browser",ucbrowser:o,version:e(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(t)?i={name:"Maxthon",maxthon:o,version:e(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(t)?i={name:"Epiphany",epiphany:o,version:e(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(t)?i={name:"Puffin",puffin:o,version:e(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(t)?i={name:"Sleipnir",sleipnir:o,version:e(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(t)?i={name:"K-Meleon",kMeleon:o,version:e(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:g?(i={name:"Windows Phone",windowsphone:o},y?(i.msedge=o,i.version=y):(i.msie=o,i.version=e(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?i={name:"Internet Explorer",msie:o,version:e(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:c?i={name:"Chrome",chromeos:o,chromeBook:o,chrome:o,version:e(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(t)?i={name:"Microsoft Edge",msedge:o,version:y}:/vivaldi/i.test(t)?i={name:"Vivaldi",vivaldi:o,version:e(/vivaldi\/(\d+(\.\d+)?)/i)||b}:u?i={name:"Sailfish",sailfish:o,version:e(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?i={name:"SeaMonkey",seamonkey:o,version:e(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(t)?(i={name:"Firefox",firefox:o,version:e(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(i.firefoxos=o)):l?i={name:"Amazon Silk",silk:o,version:e(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(t)?i={name:"PhantomJS",phantom:o,version:e(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(t)?i={name:"SlimerJS",slimer:o,version:e(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?i={name:"BlackBerry",blackberry:o,version:b||e(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(i={name:"WebOS",webos:o,version:b||e(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(i.touchpad=o)):/bada/i.test(t)?i={name:"Bada",bada:o,version:e(/dolfin\/(\d+(\.\d+)?)/i)}:d?i={name:"Tizen",tizen:o,version:e(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||b}:/qupzilla/i.test(t)?i={name:"QupZilla",qupzilla:o,version:e(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||b}:/chromium/i.test(t)?i={name:"Chromium",chromium:o,version:e(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||b}:/chrome|crios|crmo/i.test(t)?i={name:"Chrome",chrome:o,version:e(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:s?i={name:"Android",version:b}:/safari|applewebkit/i.test(t)?(i={name:"Safari",safari:o},b&&(i.version=b)):n?(i={name:"iphone"==n?"iPhone":"ipad"==n?"iPad":"iPod"},b&&(i.version=b)):i=/googlebot/i.test(t)?{name:"Googlebot",googlebot:o,version:e(/googlebot\/(\d+(\.\d+))/i)||b}:{name:e(/^(.*)\/(.*) /),version:function(e){var i=t.match(e);return i&&i.length>1&&i[2]||""}(/^(.*)\/(.*) /)},!i.msedge&&/(apple)?webkit/i.test(t)?(/(apple)?webkit\/537\.36/i.test(t)?(i.name=i.name||"Blink",i.blink=o):(i.name=i.name||"Webkit",i.webkit=o),!i.version&&b&&(i.version=b)):!i.opera&&/gecko\//i.test(t)&&(i.name=i.name||"Gecko",i.gecko=o,i.version=i.version||e(/gecko\/(\d+(\.\d+)?)/i)),i.windowsphone||i.msedge||!s&&!i.silk?i.windowsphone||i.msedge||!n?m?i.mac=o:T?i.xbox=o:p?i.windows=o:v&&(i.linux=o):(i[n]=o,i.ios=o):i.android=o;var x="";i.windowsphone?x=e(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n?(x=e(/os (\d+([_\s]\d+)*) like mac os x/i),x=x.replace(/[_\s]/g,".")):s?x=e(/android[ \/-](\d+(\.\d+)*)/i):i.webos?x=e(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):i.blackberry?x=e(/rim\stablet\sos\s(\d+(\.\d+)*)/i):i.bada?x=e(/bada\/(\d+(\.\d+)*)/i):i.tizen&&(x=e(/tizen[\/\s](\d+(\.\d+)*)/i)),x&&(i.osversion=x);var S=x.split(".")[0];return _||h||"ipad"==n||s&&(3==S||S>=4&&!w)||i.silk?i.tablet=o:(w||"iphone"==n||"ipod"==n||s||a||i.blackberry||i.webos||i.bada)&&(i.mobile=o),i.msedge||i.msie&&i.version>=10||i.yandexbrowser&&i.version>=15||i.vivaldi&&i.version>=1||i.chrome&&i.version>=20||i.samsungBrowser&&i.version>=4||i.firefox&&i.version>=20||i.safari&&i.version>=6||i.opera&&i.version>=10||i.ios&&i.osversion&&i.osversion.split(".")[0]>=6||i.blackberry&&i.version>=10.1||i.chromium&&i.version>=20?i.a=o:i.msie&&i.version<10||i.chrome&&i.version<20||i.firefox&&i.version<20||i.safari&&i.version<6||i.opera&&i.version<10||i.ios&&i.osversion&&i.osversion.split(".")[0]<6||i.chromium&&i.version<20?i.c=o:i.x=o,i}function e(t){return t.split(".").length}function i(t,e){var i,n=[];if(Array.prototype.map)return Array.prototype.map.call(t,e);for(i=0;i<t.length;i++)n.push(e(t[i]));return n}function n(t){for(var n=Math.max(e(t[0]),e(t[1])),r=i(t,function(t){var r=n-e(t);return t+=new Array(r+1).join(".0"),i(t.split("."),function(t){return new Array(20-t.length).join("0")+t}).reverse()});--n>=0;){if(r[0][n]>r[1][n])return 1;if(r[0][n]!==r[1][n])return-1;if(0===n)return 0}}function r(e,i,r){var s=a;"string"==typeof i&&(r=i,i=void 0),void 0===i&&(i=!1),r&&(s=t(r));var o=""+s.version;for(var h in e)if(e.hasOwnProperty(h)&&s[h]){if("string"!=typeof e[h])throw new Error("Browser version in the minVersion map should be a string: "+h+": "+String(e));return n([o,e[h]])<0}return i}function s(t,e,i){return!r(t,e,i)}var o=!0,a=t("undefined"!=typeof navigator?navigator.userAgent||"":"");return a.test=function(t){for(var e=0;e<t.length;++e){var i=t[e];if("string"==typeof i&&i in a)return!0}return!1},a.isUnsupportedBrowser=r,a.compareVersions=n,a.check=s,a._detect=t,a}),define("bowser",function(){}),define("shared/utils/urlUtils",["shared/constants","shared/config","shared/ui/messageBox","bowser"],function(t,e,i,n){return new function(){var t=this;t.openURL=function(r,s){if(e.getFromQuery("isApp"))return void t.navigateToUrl(r);if(s){if(!window.open(r,e.urlNavigationTarget))if(n.msie||n.msedge){var o={leftLabel:localisation.get("info.unableToOpenLink.back"),rightLabel:localisation.get("info.unableToOpenLink.forward"),rightCallback:events.callback(this,t.navigateToUrl,r),text:localisation.get("info.unableToOpenLink.message")};i.displayAdvancedTwoButtonPopup(o)}else t.navigateToUrl(r)}else t.navigateToUrl(r)},t.navigateToUrl=function(t){window.top.location=t}}}),define("shared/storage",[],function(){try{return window.localStorage.setItem("localStorageTest",1),window.localStorage.removeItem("localStorageTest"),window.localStorage}catch(e){var t=function(){var t=this;t.storage={},t.setItem=function(e,i){var n;switch(i){case void 0:n="undefined";break;case null:n="null";break;default:n=i.toString()}t.storage[e]=n},t.getItem=function(e){return t.storage.hasOwnProperty(e)?t.storage[e]:null},t.removeItem=function(e){delete t.storage[e]},t.clear=function(){t.storage={}},t.key=function(e){for(var i in t.storage)if(t.storage.hasOwnProperty(i))return i}};return new t}}),define("utils/tools",["jquery","config","crypto","constants","resources","events","shared/ui/messageBox","shared/localisation","shared/utils/appUtils","shared/utils/queryStringUtils","shared/utils/urlUtils","bowser","shared/storage"],function($,config,crypto,constants,resources,events,messageBox,localisation,appUtils,queryStringUtils,urlUtils,bowser,storage){function createUID(){var t=function(t){return Math.floor(t).toString(16).toUpperCase()},e=function(e){return t((1+Math.random())*Math.pow(16,e)).substring(1)},i=function(e){return t((1+Math.random())*Math.pow(16,e)^Date.now()).slice(-e)};return i(4)+i(4)+"-"+e(4)+"-4"+e(3)+"-"+function(e,i){return t(e+(i-e)*Math.random())}(8,12)+e(3)+"-"+e(2)+Date.now().toString(16).slice(-10)}var getPrettyQueryString=function(t){var e=config.queryObject,i=["distributorId"];resources.yuduBook.orderForm&&resources.yuduBook.orderForm.submitToCustomUrl&&resources.yuduBook.orderForm.customUrlQueryParams&&(i=$.inArray("distributorId",resources.yuduBook.orderForm.customUrlQueryParams)>=0?resources.yuduBook.orderForm.customUrlQueryParams:i.concat(resources.yuduBook.orderForm.customUrlQueryParams));for(var n={},r=0,s=i.length;r<s;r++){var o=i[r];void 0!==e[o]&&null!=e[o]&&(n[o]=e[o])}return t>(config.hasIntroPage?0:1)&&(n.page=t),n.origin="reader",$.param(n)},clamp=function(t,e,i){return e<t?t:e>i?i:e},isThisIE=function(){var t=window.navigator.userAgent||"";return t.indexOf("MSIE ")>0||(t.indexOf("Trident/")>0||t.indexOf("Edge/")>0)},isThisAnApp=function(){return appUtils.isThisAnApp(config.getQueryObject())},isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}},decryptPage=function(t,e){if(!t.isEnc||!t.data||!t.iv)return null;var i=crypto.lib.CipherParams.create({ciphertext:crypto.enc.Base64.parse(t.data)}),n=crypto.AES.decrypt(i,crypto.enc.Hex.parse(e),{iv:crypto.enc.Hex.parse(t.iv)}),r=n.toString(crypto.enc.Utf8);try{return JSON.parse(r)}catch(t){return null}},showHideElement=function(t,e){e?t.show():t.hide()},isVisible=function(t){return!t.is(":hidden")&&t.is(":visible")},openURL=urlUtils.openURL,getContentTypeFromUrl=function(t){if(t=t.toLowerCase(),getYouTubeUrlPattern().test(t))return constants.urlContentOverlayTypes.youTube;var e=t.indexOf("?"),i=e<0?t:t.substring(0,e),n=i.lastIndexOf(".");if(n<0)return constants.urlContentOverlayTypes.unknown;switch(i.substring(n+1)){case"jpg":case"jpeg":case"png":case"gif":return constants.urlContentOverlayTypes.image;case"mp4":case"ogv":case"ogg":case"webm":return constants.urlContentOverlayTypes.video;case"mp3":return constants.urlContentOverlayTypes.audio;default:return constants.urlContentOverlayTypes.unknown}},getYouTubeUrlPattern=function(){return/(?:^http:\/\/www\.youtube\.com\/v\/)([\w\-]{11})(?:\?version=\d$)/gi},isElementFullScreen=function(t){return t?!!t.webkitDisplayingFullscreen||document.fullScreenElement===t||document.msFullscreenElement===t||document.mozFullScreenElement===t||document.webkitFullscreenElement===t:!!(document.fullScreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement)},overrideProperty=function(ancestorObject,propertyParent,propertyName,newName,getHook,setHook){eval("ancestorObject."+newName+" = propertyParent."+propertyName+";"),Object.defineProperty(propertyParent,propertyName,{get:function(){getHook(),eval("return ancestorObject."+newName+";")},set:function(value){setHook(),eval("ancestorObject."+newName+" = value;")}})},calculateDynamicValue=function(t){return"function"==typeof t?t():t},returnDynamicInput=function(t){return function(){return calculateDynamicValue(t)}},returnFunctionWithDynamicArgs=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(this,e.map(calculateDynamicValue))}},articlesAvailable=function(){return resources.yuduBook.settings.phoneview&&resources.yuduBook.settings.phoneview.isAvailable&&(!resources.yuduBook.settings.hasProtectedPages||!!config.decryptionKey&&config.pageDecrypted)},getLastPathComponent=function(){if(!document.location.pathname)return null;var t=document.location.pathname.match(/[^\/]+$/);return t&&0!=t.length?t[0]:null},addPageToQueryObjectAndPushPageHistory=function(t,e){var i=config.hasIntroPage?0:1;if(t!=i||!e){var n=config.getQueryObject();n.page=t;var r=getLastPathComponent()+"?"+$.param(n);history.pushState({page:t-i},document.title,r)}};return{parseQueryString:queryStringUtils.parseQueryString,getPrettyQueryString:getPrettyQueryString,clamp:clamp,decryptPage:decryptPage,openURL:openURL,showHideElement:showHideElement,isVisible:isVisible,getContentTypeFromUrl:getContentTypeFromUrl,getYouTubeUrlPattern:getYouTubeUrlPattern,isElementFullScreen:isElementFullScreen,isThisIE:isThisIE,isThisAnApp:isThisAnApp,deviceType:appUtils.deviceType,addQueryStringToURL:queryStringUtils.addQueryStringToURL,addToUrlQueryString:queryStringUtils.addToUrlQueryString,createUID:createUID,overrideProperty:overrideProperty,calculateDynamicValue:calculateDynamicValue,returnDynamicInput:returnDynamicInput,returnFunctionWithDynamicArgs:returnFunctionWithDynamicArgs,articlesAvailable:articlesAvailable,isMobile:isMobile,getLastPathComponent:getLastPathComponent,addPageToQueryObjectAndPushPageHistory:addPageToQueryObjectAndPushPageHistory}}),define("fetching/tileFetcherAsync",["events","constants","resources","fetching/tileFetcher","utils/tools","config","shared/utils/queryStringUtils","utils/encryptedResourceFetchingUtils"],function(t,e,i,n,r,s,o,a){var h=function(){n.TileFetcher.call(this),this.fetchingLookup={},this.nextRequestID=0,this.worker=null,this.url=window.URL||window.webkitURL,this.makeBlob=c(),this.start=function(){this.url=window.URL||window.webkitURL,this.worker||(this.worker=new Worker(e.tileFetcherDaemonLocation)),this.worker.postMessage({cmd:"start",pps:e.daemonpps,batchSize:e.daemonTileFetchBatchSize}),this.worker&&t.yuduAddEventListener(this.worker,"message",t.callback(this,this.daemonEventResponder),!1)},this.stop=function(){this.worker.postMessage({cmd:"stop"}),this.worker=null},this.enqueue=function(t){if(t.id=this.nextRequestID++,this.fetchingLookup[t.id]=t,this.worker){var e=t.tile.url;$.isEmptyObject(s.contentDecryptionHeaders)||(e=o.addRandomQueryStringParameter(e,a.RANDOM_QUERY_STRING_PARAM_KEY))}this.worker.postMessage({cmd:"fetch",url:e,id:t.id,priority:t.priority,headers:s.contentDecryptionHeaders})},this.flushQueues=function(){this.worker&&this.worker.postMessage({cmd:"clear"});for(var t in this.fetchingLookup)this.fetchingLookup.hasOwnProperty(t)&&this.fetchingLookup[t].tile.reset();this.fetchingLookup={}},this.fetchQueueSize=function(){var t=0;for(var e in this.fetchingLookup)this.fetchingLookup.hasOwnProperty(e)&&(t+=1);return t},this.isBusy=function(){return this.fetchQueueSize()>e.maxNumTilesInQueue},this.daemonEventResponder=function(t){var e=t.data,i=this.fetchingLookup[Number(e.id)];if(i||"log"==e.cmd)switch(e.cmd){case"fetched":this.loadImageAndCheckAgain(i,e.url,e.startTime);break;case"fetchedCreate":var n=this.url.createObjectURL(this.makeBlob(e.response));this.loadImageAndCheckAgain(i,n,e.startTime);break;case"fetchFail":this.tileFetchError(i)}},this.loadImageAndCheckAgain=function(e,i,n){function r(t,e,n){if(n.timeoutCall=null,n.hasLoaded&&t.complete&&(void 0===t.naturalWidth||0!=t.naturalWidth))return delete this.fetchingLookup[n.id],this.requestSuccess(t,e,n),void this.url.revokeObjectURL(i);this.tileCheckError(n)}var s=new Image;s.onerror=s.onabort=t.callback(this,function(){e.timeoutCall&&(clearInterval(e.timeoutCall),this.tileCheckError(e))}),s.onload=function(){e.timeoutCall&&(clearInterval(e.timeoutCall),e.hasLoaded=!0,e.finalCheckFunction())},e.finalCheckFunction=r.bind(this,s,n,e),e.timeoutCall=setTimeout(e.finalCheckFunction.bind(e),1500),s.src=i},this.tileFetchError=function(t){t.fetchFailureCount++,delete this.fetchingLookup[t.id],t.fetchFailureCount<e.tileFetchRetryCount?(t.tile.setQueued(),this.enqueue(t)):this.requestFailed(t)},this.tileCheckError=function(t){t.checkFailureCount+=1,delete this.fetchingLookup[t.id],t.checkFailureCount<e.tileCheckRetryCount?(t.tile.setQueued(),this.enqueue(t)):this.requestFailed(t)}};h.prototype=n.TileFetcher.prototype;var c=function(){try{if(window.Blob&&null!=new Blob(["var doge = 'woo'"],{type:"text/javascript"}))return function(t){return new Blob([t],{type:"image/jpeg"})}}catch(t){}var t=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;return function(e){var i=new t;return i.append(e),i.getBlob("image/jpeg")}};return{TileFetcherAsync:h,asyncSupported:function(){try{var t=window.URL||window.webkitURL;return"undefined"!=typeof Worker&&"Worker"in window&&!navigator.userAgent.match(/iemobile/i)&&!(r.isThisAnApp()&&r.isThisIE())&&!r.deviceType.isAndroid()&&void 0!=t&&void 0!=t.createObjectURL&&(window.Blob&&null!=new Blob(["var doge = 'woo'"],{type:"text/javascript"})||window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)}catch(t){return!1}},EMITTER_NAME:"tileFetcherAsync"}}),define("fetching/fetchHandler",["events","config","constants","fetching/tileFetcherSync","fetching/tileFetcherAsync","utils/tools","easel","jquery"],function(t,e,i,n,r,s,o,a){var h=null;h=r.asyncSupported()?new r.TileFetcherAsync:new n.TileFetcherSync;var c=function(){this.reader=null,this.loadStatus=[];var n={unknown:0,low:1,high:2};this.lastPurgedTime=(new Date).getTime(),this.minTimeBetweenPurges=2e3,s.isMobile.Windows()?(this.maxTilesBeforePurge=210,this.maxLookAhead=5,this.maxLookBack=2):(this.maxTilesBeforePurge=500,this.maxLookAhead=10,this.maxLookBack=2),this.tilesFetched=0,this.purgeFrameRate=20,this.purgeFrameRateCount=0,this.purgeFrameRateMax=5,this.loadTiles=function(t,e,i){var n=this.getLoadStatus(t.pageNumber,t.z),r=[];e?(r=e.requireLoading,n.waitingFor=e.waitingFor,n.numberVisibleTiles=e.visibleTiles.length):(r=t.getUnfetchedTiles(),n.waitingFor=r,n.numberVisibleTiles=0),r.length>0&&h.fetch(r,t,i)},this.newRequests=function(){h.flushQueues()},this.getLoadStatus=function(t,e){if(void 0==this.loadStatus[t]&&(this.loadStatus[t]={zoomLevels:[]}),void 0==this.loadStatus[t].zoomLevels[e]){var i=this.reader.pages[t].zoomLevels[e].zoomLevel.size;this.loadStatus[t].zoomLevels[e]={z:e,waitingFor:[],numberVisibleTiles:0,totalTiles:i.x*i.y,numberLoaded:0}}return this.loadStatus[t].zoomLevels[e]},this.classifyDownloadRate=function(){var t=h.getAverageDownloadTime();return t<=0?n.unknown:t<200?n.high:n.low},this.getAdjacentPagesToLoad=function(t,e,i){for(var n=Math.max(i-this.maxLookBack,0),r=Math.min(i+this.maxLookAhead,this.reader.pages.length-1),s=i+1;s<=r;s++)e[s]||(t.push(s),e[s]=!0);for(var s=i-1;s>=n;s--)e[s]||(t.push(s),e[s]=!0)},this.getOptimisticFetchList=function(){var t=[],i={},n=this.reader.shifter.getBasePage();this.getAdjacentPagesToLoad(t,i,n);for(var r=e.lowestZoomLevel,s=[],o=0,a=t.length;o<a;o++){var h=t[o];if(this.reader.pages[h]){var c=this.reader.shifter.getPage(h);c&&!this.isFullyLoaded(h,r)&&(c.prepareZoomLevel(r),s.push(c.zoomLevels[r]))}}return s},this.isFullyLoaded=function(t,e){if(this.loadStatus[t]&&this.loadStatus[t].zoomLevels[e]){var i=this.loadStatus[t].zoomLevels[e];return i.totalTiles==i.numberLoaded}return!1},this.manageLoadings=function(){if(!h.isBusy()){this.purgeIfNeeded();for(var t=this.getOptimisticFetchList(),e=0,i=t.length;e<i;e++)this.loadTiles(t[e],!1)}},this.purgeIfNeeded=function(){var t=o.Ticker.getMeasuredFPS();return this.tilesFetched>this.maxTilesBeforePurge?(this.tryPurge(),!0):t<this.purgeFrameRate?(this.purgeFrameRateCount+=1,this.purgeFrameRateCount>this.purgeFrameRateMax&&(this.purgeFrameRateCount=0,this.tryPurge()),!0):(this.purgeFrameRateCount=0,!1)},this.tryPurge=function(){var t=(new Date).getTime();if(!(t-this.lastPurgedTime<this.minTimeBetweenPurges)){this.lastPurgedTime=t;for(var e=this.reader.shifter.getBasePage(),i=e-this.maxLookBack-1,n=e+this.maxLookAhead+1,r=0;r<i;r++)this.reader.pages[r]&&(this.tilesFetched-=this.reader.shifter.getPage(r).unloadAllTiles(),delete this.loadStatus[r]);for(var r=n;r<this.reader.pages.length;r++)this.reader.pages[r]&&(this.tilesFetched-=this.reader.shifter.getPage(r).unloadAllTiles(),delete this.loadStatus[r])}},this.tileFetched=function(e){var i=e.data.zoomLevel.pageNumber,n=e.data.zoomLevel.z,r=this.getLoadStatus(i,n);r.numberLoaded++;var s=a.inArray(e.data.tile,r.waitingFor);this.tilesFetched+=1,s>=0&&r.waitingFor.splice(s,1),0==r.waitingFor.length&&t.emit("fetchHandler",t.ZOOMLEVEL_TILESLOADED,this,{pageNumber:i,z:n})},this.start=function(){h.start()},this.activatePreloader=function(){var e=1e3/i.fetchHandlerpps;this.timer=setInterval(t.callback(this,this.manageLoadings),e)},this.stop=function(){h.stop(),this.timer&&clearInterval(this.timer),h=null}},l=new c;return t.subscribe(t.ALL,t.TILE_FETCHED,t.callback(l,l.tileFetched)),{start:t.callback(l,l.start),stop:t.callback(l,l.stop),loadTiles:t.callback(l,l.loadTiles),isFullyLoaded:t.callback(l,l.isFullyLoaded),getLoadStatus:t.callback(l,l.getLoadStatus),newRequests:t.callback(l,l.newRequests),setReader:t.callback(l,function(t){this.reader=t}),activatePreloader:t.callback(l,l.activatePreloader),EMITTER_NAME:"fetchHandler",_private:{getAdjacentPagesToLoad:t.callback(l,l.getAdjacentPagesToLoad),getOptimisticFetchList:t.callback(l,l.getOptimisticFetchList),tileFetcher:h,maxLookAhead:l.maxLookAhead}}}),define("model/tile",["easel","constants","events"],function(t,e,i){var n={start:0,queued:1,fetching:2,fetched:3},r=function(t,e,i,r,s){this.x=t,this.y=e,this.width=i,this.height=r,this.imageWidth=this.width,this.imageHeight=this.height,this.url=s,this.image=null,this.state=n.start};return r.prototype.triggerFadeIn=function(){if(this.image){this.image.alpha=0;var n=this.image.id;t.Tween.get(this.image,{override:!0}).call(function(){i.emit("tile",i.TILE_FADE_START,this,{id:n})}).to({alpha:1},e.tileFadeTime).wait(500).call(function(){i.emit("tile",i.TILE_FADE_END,this,{id:n})})}},r.prototype.isComplete=function(){return this.state==n.fetched},r.prototype.isEnroute=function(){return this.state==n.fetching||this.state==n.queued},r.prototype.setFetched=function(){this.state=n.fetched},r.prototype.setQueued=function(){this.state=n.queued},r.prototype.setFetching=function(){this.state=n.fetching},r.prototype.reset=function(){this.state=n.start},{Tile:r}}),define("controllers/zoomLevelController",["jquery","events","config","constants","model/zoomLevel","views/zoomLevelView","fetching/fetchHandler","model/tile"],function(t,e,i,n,r,s,o,a){return{ZoomLevelController:function(t,e,h,c,l,u){this.initialised=!1,this.zoomLevel=new r.ZoomLevel(t,h.w,h.h,e.tileW,e.tileH,c,l),this.tiles=[],this.pageNumber=u,this.z=t,this.alignment=-1,this.init=function(){this.initialised=!0,this.createTiles(),this.alignment>=0&&this.setAlignment(this.alignment)},this.tileLoaded=function(t){this.zoomLevelView.drawTile(t)},this.createURL=function(t,e){var i=this.zoomLevel.filePattern.replace("{$z}",this.zoomLevel.z).replace("{$x}",t).replace("{$y}",e);return n.baseTileFolder+this.zoomLevel.baseURL+"/"+i},this.createTiles=function(){this.zoomLevelView=new s.ZoomLevelView(this.zoomLevel.width,this.zoomLevel.height);for(var t=0;t<this.zoomLevel.size.x;t++){this.tiles[t]=[];for(var e=0;e<this.zoomLevel.size.y;e++){var i=this.calculateTileWidth(t),n=this.calculateTileHeight(e),r=this.zoomLevel.tileWidth*t,o=this.zoomLevel.tileHeight*e,h=this.createURL(t,e);this.tiles[t][e]=new a.Tile(r,o,i,n,h)}}},this.calculateTileWidth=function(t){return t==this.zoomLevel.size.x-1?this.zoomLevel.tileWidth-((t+1)*this.zoomLevel.tileWidth-this.zoomLevel.width):this.zoomLevel.tileWidth+i.overlap},this.calculateTileHeight=function(t){return t==this.zoomLevel.size.y-1?this.zoomLevel.tileHeight-((t+1)*this.zoomLevel.tileHeight-this.zoomLevel.height):this.zoomLevel.tileHeight+i.overlap},this.load=function(t,e){o.loadTiles(this,this.getVisibleTiles(t,e),!0)},this.getVisibleTiles=function(t,e){t=t||0,e=e||0;for(var n=[],r=[],s=[],o=this.getContainer(),a=this.tiles[0][0],h=o.localToGlobal(a.x+t,a.y+e),c=o.localToGlobal(a.x+t+a.width,a.y+e+a.height),l=h.x,u=c.x-h.x,d=h.y,f=c.y-h.y,g=Math.max(0,Math.ceil((-u-l)/u)),p=Math.max(0,Math.ceil((-f-d)/f)),m=l+g*u,v=d+p*f,y=Math.min(g+Math.ceil((i.width-m)/u),this.zoomLevel.size.x),b=Math.min(p+Math.ceil((i.height-v)/f),this.zoomLevel.size.y),_=g;_<y;_++)for(var w=p;w<b;w++){var a=this.tiles[_][w];a.isComplete()||(s.push(a),a.isEnroute()||r.push(a)),n.push(a)}return{visibleTiles:n,requireLoading:r,waitingFor:s}},this.getUnfetchedTiles=function(){for(var t=[],e=0;e<this.zoomLevel.size.x;e++)for(var i=0;i<this.zoomLevel.size.y;i++){var n=this.tiles[e][i];n.isComplete()||n.isEnroute()||t.push(n)}return t},this.hide=function(){this.zoomLevelView.hide()},this.show=function(){this.zoomLevelView.show()},this.setAlignment=function(t){this.alignment=t,this.initialised&&this.zoomLevelView.setAlignment(t)},this.getContainer=function(){return this.zoomLevelView.container},this.unload=function(){if(!this.initialised)return 0;this.initialised=!1,this.zoomLevelView.unload(),this.zoomLevelView=null;for(var t=0,e=0;e<this.zoomLevel.size.x;e++){for(var i=0;i<this.zoomLevel.size.y;i++)this.tiles[e][i].isComplete()&&(t+=1),this.tiles[e][i]=null;this.tiles[e]=[]}return this.tiles=null,this.tiles=[],t}},EMITTER_NAME:"zoomLevelController"}}),define("model/page",[],function(){return{Page:function(t,e,i,n,r,s){this.number=t,this.label=e,this.width=i,this.height=n,this.baseURL=r,this.filePattern=s}}}),define("views/pageView",["easel"],function(t){return{PageView:function(){this.container=new t.Container,this.hide=function(){this.container.visible=!1},this.show=function(){this.container.visible=!0},this.isShowing=function(){return this.container.visible}}}}),define("shared/utils/stringUtils",[],function(){return new function(){var t=this;t.capitalizeFirstLetter=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},t.startsWith=function(t,e){return"string"==typeof t&&"string"==typeof e&&t.substr(0,e.length)===e},t.unEscapeXml=function(t){return t.replace("&amp;","&").replace("&lt;","<").replace("&gt;",">").replace("&apos;","'").replace("&quot;",'"').replace("\n","\r\n")}}}),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i){this.initialize(t,e,i)},e=t.prototype;e.type=null,e.target=null,e.currentTarget=null,e.eventPhase=0,e.bubbles=!1,e.cancelable=!1,e.timeStamp=0,e.defaultPrevented=!1,e.propagationStopped=!1,e.immediatePropagationStopped=!1,e.removed=!1,e.initialize=function(t,e,i){this.type=t,this.bubbles=e,this.cancelable=i,this.timeStamp=(new Date).getTime()},e.preventDefault=function(){this.defaultPrevented=!0},e.stopPropagation=function(){this.propagationStopped=!0},e.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},e.remove=function(){this.removed=!0},e.clone=function(){return new t(this.type,this.bubbles,this.cancelable)},e.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(){},e=t.prototype;t.initialize=function(t){t.addEventListener=e.addEventListener,t.on=e.on,t.removeEventListener=t.off=e.removeEventListener,t.removeAllEventListeners=e.removeAllEventListeners,t.hasEventListener=e.hasEventListener,t.dispatchEvent=e.dispatchEvent,t._dispatchEvent=e._dispatchEvent,t.willTrigger=e.willTrigger},e._listeners=null,e._captureListeners=null,e.initialize=function(){},e.addEventListener=function(t,e,i){var n;n=i?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var r=n[t];return r&&this.removeEventListener(t,e,i),r=n[t],r?r.push(e):n[t]=[e],e},e.on=function(t,e,i,n,r,s){return e.handleEvent&&(i=i||e,e=e.handleEvent),i=i||this,this.addEventListener(t,function(t){e.call(i,t,r),n&&t.remove()},s)},e.removeEventListener=function(t,e,i){var n=i?this._captureListeners:this._listeners;if(n){var r=n[t];if(r)for(var s=0,o=r.length;o>s;s++)if(r[s]==e){1==o?delete n[t]:r.splice(s,1);break}}},e.off=e.removeEventListener,e.removeAllEventListeners=function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null},e.dispatchEvent=function(t,e){if("string"==typeof t){var i=this._listeners;if(!i||!i[t])return!1;t=new createjs.Event(t)}if(t.target=e||this,t.bubbles&&this.parent){for(var n=this,r=[n];n.parent;)r.push(n=n.parent);var s,o=r.length;for(s=o-1;s>=0&&!t.propagationStopped;s--)r[s]._dispatchEvent(t,1+(0==s));for(s=1;o>s&&!t.propagationStopped;s++)r[s]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return t.defaultPrevented},e.hasEventListener=function(t){var e=this._listeners,i=this._captureListeners;return!!(e&&e[t]||i&&i[t])},e.willTrigger=function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.parent}return!1},e.toString=function(){return"[EventDispatcher]"},e._dispatchEvent=function(t,e){var i,n=1==e?this._captureListeners:this._listeners;if(t&&n){var r=n[t.type];if(!r||!(i=r.length))return;t.currentTarget=this,t.eventPhase=e,t.removed=!1,r=r.slice();for(var s=0;i>s&&!t.immediatePropagationStopped;s++){var o=r[s];o.handleEvent?o.handleEvent(t):o(t),t.removed&&(this.off(t.type,o,1==e),t.removed=!1)}}},createjs.EventDispatcher=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i){this.initialize(t,e,i)},e=t.prototype=new createjs.EventDispatcher;t.NONE=0,t.LOOP=1,t.REVERSE=2,t.IGNORE={},t._tweens=[],t._plugins={},t.get=function(e,i,n,r){return r&&t.removeTweens(e),new t(e,i,n)},t.tick=function(e,i){for(var n=t._tweens.slice(),r=n.length-1;r>=0;r--){var s=n[r];i&&!s.ignoreGlobalPause||s._paused||s.tick(s._useTicks?1:e)}},t.handleEvent=function(t){"tick"==t.type&&this.tick(t.delta,t.paused)},t.removeTweens=function(e){if(e.tweenjs_count){for(var i=t._tweens,n=i.length-1;n>=0;n--)i[n]._target==e&&(i[n]._paused=!0,i.splice(n,1));e.tweenjs_count=0}},t.removeAllTweens=function(){for(var e=t._tweens,i=0,n=e.length;n>i;i++){var r=e[i];r.paused=!0,r.target.tweenjs_count=0}e.length=0},t.hasActiveTweens=function(e){return e?e.tweenjs_count:t._tweens&&!!t._tweens.length},t.installPlugin=function(e,i){var n=e.priority;null==n&&(e.priority=n=0);for(var r=0,s=i.length,o=t._plugins;s>r;r++){var a=i[r];if(o[a]){for(var h=o[a],c=0,l=h.length;l>c&&!(n<h[c].priority);c++);o[a].splice(c,0,e)}else o[a]=[e]}},t._register=function(e,i){var n=e._target,r=t._tweens;if(i)n&&(n.tweenjs_count=n.tweenjs_count?n.tweenjs_count+1:1),r.push(e),!t._inited&&createjs.Ticker&&(createjs.Ticker.addEventListener("tick",t),t._inited=!0);else{n&&n.tweenjs_count--;for(var s=r.length;s--;)if(r[s]==e)return void r.splice(s,1)}},e.ignoreGlobalPause=!1,e.loop=!1,e.duration=0,e.pluginData=null,e.target=null,e.position=null,e.passive=!1,e._paused=!1,e._curQueueProps=null,e._initQueueProps=null,e._steps=null,e._actions=null,e._prevPosition=0,e._stepPosition=0,e._prevPos=-1,e._target=null,e._useTicks=!1,e._inited=!1,e.initialize=function(e,i,n){this.target=this._target=e,i&&(this._useTicks=i.useTicks,this.ignoreGlobalPause=i.ignoreGlobalPause,this.loop=i.loop,i.onChange&&this.addEventListener("change",i.onChange),i.override&&t.removeTweens(e)),this.pluginData=n||{},this._curQueueProps={},this._initQueueProps={},this._steps=[],this._actions=[],i&&i.paused?this._paused=!0:t._register(this,!0),i&&null!=i.position&&this.setPosition(i.position,t.NONE)},e.wait=function(t,e){if(null==t||0>=t)return this;var i=this._cloneProps(this._curQueueProps)
;return this._addStep({d:t,p0:i,e:this._linearEase,p1:i,v:e})},e.to=function(t,e,i){return(isNaN(e)||0>e)&&(e=0),this._addStep({d:e||0,p0:this._cloneProps(this._curQueueProps),e:i,p1:this._cloneProps(this._appendQueueProps(t))})},e.call=function(t,e,i){return this._addAction({f:t,p:e||[this],o:i||this._target})},e.set=function(t,e){return this._addAction({f:this._set,o:this,p:[t,e||this._target]})},e.play=function(t){return t||(t=this),this.call(t.setPaused,[!1],t)},e.pause=function(t){return t||(t=this),this.call(t.setPaused,[!0],t)},e.setPosition=function(t,e){0>t&&(t=0),null==e&&(e=1);var i=t,n=!1;if(i>=this.duration&&(this.loop?i%=this.duration:(i=this.duration,n=!0)),i==this._prevPos)return n;var r=this._prevPos;if(this.position=this._prevPos=i,this._prevPosition=t,this._target)if(n)this._updateTargetProps(null,1);else if(this._steps.length>0){for(var s=0,o=this._steps.length;o>s&&!(this._steps[s].t>i);s++);var a=this._steps[s-1];this._updateTargetProps(a,(this._stepPosition=i-a.t)/a.d)}return 0!=e&&this._actions.length>0&&(this._useTicks?this._runActions(i,i):1==e&&r>i?(r!=this.duration&&this._runActions(r,this.duration),this._runActions(0,i,!0)):this._runActions(r,i)),n&&this.setPaused(!0),this.dispatchEvent("change"),n},e.tick=function(t){this._paused||this.setPosition(this._prevPosition+t)},e.setPaused=function(e){return this._paused=!!e,t._register(this,!e),this},e.w=e.wait,e.t=e.to,e.c=e.call,e.s=e.set,e.toString=function(){return"[Tween]"},e.clone=function(){throw"Tween can not be cloned."},e._updateTargetProps=function(e,i){var n,r,s,o,a,h;if(e||1!=i){if(this.passive=!!e.v,this.passive)return;e.e&&(i=e.e(i,0,1,1)),n=e.p0,r=e.p1}else this.passive=!1,n=r=this._curQueueProps;for(var c in this._initQueueProps){null==(o=n[c])&&(n[c]=o=this._initQueueProps[c]),null==(a=r[c])&&(r[c]=a=o),s=o==a||0==i||1==i||"number"!=typeof o?1==i?a:o:o+(a-o)*i;var l=!1;if(h=t._plugins[c])for(var u=0,d=h.length;d>u;u++){var f=h[u].tween(this,c,s,n,r,i,!!e&&n==r,!e);f==t.IGNORE?l=!0:s=f}l||(this._target[c]=s)}},e._runActions=function(t,e,i){var n=t,r=e,s=-1,o=this._actions.length,a=1;for(t>e&&(n=e,r=t,s=o,o=a=-1);(s+=a)!=o;){var h=this._actions[s],c=h.t;(c==r||c>n&&r>c||i&&c==t)&&h.f.apply(h.o,h.p)}},e._appendQueueProps=function(e){var i,n,r,s,o;for(var a in e)if(void 0===this._initQueueProps[a]){if(n=this._target[a],i=t._plugins[a])for(r=0,s=i.length;s>r;r++)n=i[r].init(this,a,n);this._initQueueProps[a]=this._curQueueProps[a]=void 0===n?null:n}else n=this._curQueueProps[a];for(var a in e){if(n=this._curQueueProps[a],i=t._plugins[a])for(o=o||{},r=0,s=i.length;s>r;r++)i[r].step&&i[r].step(this,a,n,e[a],o);this._curQueueProps[a]=e[a]}return o&&this._appendQueueProps(o),this._curQueueProps},e._cloneProps=function(t){var e={};for(var i in t)e[i]=t[i];return e},e._addStep=function(t){return t.d>0&&(this._steps.push(t),t.t=this.duration,this.duration+=t.d),this},e._addAction=function(t){return t.t=this.duration,this._actions.push(t),this},e._set=function(t,e){for(var i in t)e[i]=t[i]},createjs.Tween=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i){this.initialize(t,e,i)},e=t.prototype=new createjs.EventDispatcher;e.ignoreGlobalPause=!1,e.duration=0,e.loop=!1,e.position=null,e._paused=!1,e._tweens=null,e._labels=null,e._labelList=null,e._prevPosition=0,e._prevPos=-1,e._useTicks=!1,e.initialize=function(t,e,i){this._tweens=[],i&&(this._useTicks=i.useTicks,this.loop=i.loop,this.ignoreGlobalPause=i.ignoreGlobalPause,i.onChange&&this.addEventListener("change",i.onChange)),t&&this.addTween.apply(this,t),this.setLabels(e),i&&i.paused?this._paused=!0:createjs.Tween._register(this,!0),i&&null!=i.position&&this.setPosition(i.position,createjs.Tween.NONE)},e.addTween=function(t){var e=arguments.length;if(e>1){for(var i=0;e>i;i++)this.addTween(arguments[i]);return arguments[0]}return 0==e?null:(this.removeTween(t),this._tweens.push(t),t.setPaused(!0),t._paused=!1,t._useTicks=this._useTicks,t.duration>this.duration&&(this.duration=t.duration),this._prevPos>=0&&t.setPosition(this._prevPos,createjs.Tween.NONE),t)},e.removeTween=function(t){var e=arguments.length;if(e>1){for(var i=!0,n=0;e>n;n++)i=i&&this.removeTween(arguments[n]);return i}if(0==e)return!1;for(var r=this._tweens,n=r.length;n--;)if(r[n]==t)return r.splice(n,1),t.duration>=this.duration&&this.updateDuration(),!0;return!1},e.addLabel=function(t,e){this._labels[t]=e;var i=this._labelList;if(i){for(var n=0,r=i.length;r>n&&!(e<i[n].position);n++);i.splice(n,0,{label:t,position:e})}},e.setLabels=function(t){this._labels=t||{}},e.getLabels=function(){var t=this._labelList;if(!t){t=this._labelList=[];var e=this._labels;for(var i in e)t.push({label:i,position:e[i]});t.sort(function(t,e){return t.position-e.position})}return t},e.getCurrentLabel=function(){var t=this.getLabels(),e=this.position,i=t.length;if(i){for(var n=0;i>n&&!(e<t[n].position);n++);return 0==n?null:t[n-1].label}return null},e.gotoAndPlay=function(t){this.setPaused(!1),this._goto(t)},e.gotoAndStop=function(t){this.setPaused(!0),this._goto(t)},e.setPosition=function(t,e){0>t&&(t=0);var i=this.loop?t%this.duration:t,n=!this.loop&&t>=this.duration;if(i==this._prevPos)return n;this._prevPosition=t,this.position=this._prevPos=i;for(var r=0,s=this._tweens.length;s>r;r++)if(this._tweens[r].setPosition(i,e),i!=this._prevPos)return!1;return n&&this.setPaused(!0),this.dispatchEvent("change"),n},e.setPaused=function(t){this._paused=!!t,createjs.Tween._register(this,!t)},e.updateDuration=function(){this.duration=0;for(var t=0,e=this._tweens.length;e>t;t++){var i=this._tweens[t];i.duration>this.duration&&(this.duration=i.duration)}},e.tick=function(t){this.setPosition(this._prevPosition+t)},e.resolve=function(t){var e=parseFloat(t);return isNaN(e)&&(e=this._labels[t]),e},e.toString=function(){return"[Timeline]"},e.clone=function(){throw"Timeline can not be cloned."},e._goto=function(t){var e=this.resolve(t);null!=e&&this.setPosition(e)},createjs.Timeline=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(){throw"Ease cannot be instantiated."};t.linear=function(t){return t},t.none=t.linear,t.get=function(t){return-1>t&&(t=-1),t>1&&(t=1),function(e){return 0==t?e:0>t?e*(e*-t+1+t):e*((2-e)*t+(1-t))}},t.getPowIn=function(t){return function(e){return Math.pow(e,t)}},t.getPowOut=function(t){return function(e){return 1-Math.pow(1-e,t)}},t.getPowInOut=function(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}},t.quadIn=t.getPowIn(2),t.quadOut=t.getPowOut(2),t.quadInOut=t.getPowInOut(2),t.cubicIn=t.getPowIn(3),t.cubicOut=t.getPowOut(3),t.cubicInOut=t.getPowInOut(3),t.quartIn=t.getPowIn(4),t.quartOut=t.getPowOut(4),t.quartInOut=t.getPowInOut(4),t.quintIn=t.getPowIn(5),t.quintOut=t.getPowOut(5),t.quintInOut=t.getPowInOut(5),t.sineIn=function(t){return 1-Math.cos(t*Math.PI/2)},t.sineOut=function(t){return Math.sin(t*Math.PI/2)},t.sineInOut=function(t){return-.5*(Math.cos(Math.PI*t)-1)},t.getBackIn=function(t){return function(e){return e*e*((t+1)*e-t)}},t.backIn=t.getBackIn(1.7),t.getBackOut=function(t){return function(e){return--e*e*((t+1)*e+t)+1}},t.backOut=t.getBackOut(1.7),t.getBackInOut=function(t){return t*=1.525,function(e){return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)}},t.backInOut=t.getBackInOut(1.7),t.circIn=function(t){return-(Math.sqrt(1-t*t)-1)},t.circOut=function(t){return Math.sqrt(1- --t*t)},t.circInOut=function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},t.bounceIn=function(e){return 1-t.bounceOut(1-e)},t.bounceOut=function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},t.bounceInOut=function(e){return.5>e?.5*t.bounceIn(2*e):.5*t.bounceOut(2*e-1)+.5},t.getElasticIn=function(t,e){var i=2*Math.PI;return function(n){if(0==n||1==n)return n;var r=e/i*Math.asin(1/t);return-t*Math.pow(2,10*(n-=1))*Math.sin((n-r)*i/e)}},t.elasticIn=t.getElasticIn(1,.3),t.getElasticOut=function(t,e){var i=2*Math.PI;return function(n){if(0==n||1==n)return n;var r=e/i*Math.asin(1/t);return t*Math.pow(2,-10*n)*Math.sin((n-r)*i/e)+1}},t.elasticOut=t.getElasticOut(1,.3),t.getElasticInOut=function(t,e){var i=2*Math.PI;return function(n){var r=e/i*Math.asin(1/t);return(n*=2)<1?-.5*t*Math.pow(2,10*(n-=1))*Math.sin((n-r)*i/e):.5*t*Math.pow(2,-10*(n-=1))*Math.sin((n-r)*i/e)+1}},t.elasticInOut=t.getElasticInOut(1,.3*1.5),createjs.Ease=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(){throw"MotionGuidePlugin cannot be instantiated."};t.priority=0,t.install=function(){return createjs.Tween.installPlugin(t,["guide","x","y","rotation"]),createjs.Tween.IGNORE},t.init=function(t,e,i){var n=t.target;return n.hasOwnProperty("x")||(n.x=0),n.hasOwnProperty("y")||(n.y=0),n.hasOwnProperty("rotation")||(n.rotation=0),"rotation"==e&&(t.__needsRot=!0),"guide"==e?null:i},t.step=function(e,i,n,r,s){if("rotation"==i&&(e.__rotGlobalS=n,e.__rotGlobalE=r,t.testRotData(e,s)),"guide"!=i)return r;var o,a=r;a.hasOwnProperty("path")||(a.path=[]);var h=a.path;if(a.hasOwnProperty("end")||(a.end=1),a.hasOwnProperty("start")||(a.start=n&&n.hasOwnProperty("end")&&n.path===h?n.end:0),a.hasOwnProperty("_segments")&&a._length)return r;var c=h.length;if(!(c>=6&&0==(c-2)%4))throw"invalid 'path' data, please see documentation for valid paths";a._segments=[],a._length=0;for(var l=2;c>l;l+=4){for(var u,d,f=h[l-2],g=h[l-1],p=h[l+0],m=h[l+1],v=h[l+2],y=h[l+3],b=f,_=g,w=0,T=[],x=1;10>=x;x++){var S=x/10,C=1-S;u=C*C*f+2*C*S*p+S*S*v,d=C*C*g+2*C*S*m+S*S*y,w+=T[T.push(Math.sqrt((o=u-b)*o+(o=d-_)*o))-1],b=u,_=d}a._segments.push(w),a._segments.push(T),a._length+=w}o=a.orient,a.orient=!0;var E={};return t.calc(a,a.start,E),e.__rotPathS=Number(E.rotation.toFixed(5)),t.calc(a,a.end,E),e.__rotPathE=Number(E.rotation.toFixed(5)),a.orient=!1,t.calc(a,a.end,s),a.orient=o,a.orient?(e.__guideData=a,t.testRotData(e,s),r):r},t.testRotData=function(t,e){if(void 0===t.__rotGlobalS||void 0===t.__rotGlobalE){if(t.__needsRot)return;t.__rotGlobalS=t.__rotGlobalE=void 0!==t._curQueueProps.rotation?t._curQueueProps.rotation:e.rotation=t.target.rotation||0}if(void 0!==t.__guideData){var i=t.__guideData,n=t.__rotGlobalE-t.__rotGlobalS,r=t.__rotPathE-t.__rotPathS,s=n-r;if("auto"==i.orient)s>180?s-=360:-180>s&&(s+=360);else if("cw"==i.orient){for(;0>s;)s+=360;0==s&&n>0&&180!=n&&(s+=360)}else if("ccw"==i.orient){for(s=n-(r>180?360-r:r);s>0;)s-=360;0==s&&0>n&&-180!=n&&(s-=360)}i.rotDelta=s,i.rotOffS=t.__rotGlobalS-t.__rotPathS,t.__rotGlobalS=t.__rotGlobalE=t.__guideData=t.__needsRot=void 0}},t.tween=function(e,i,n,r,s,o,a){var h=s.guide;if(void 0==h||h===r.guide)return n;if(h.lastRatio!=o){var c=(h.end-h.start)*(a?h.end:o)+h.start;switch(t.calc(h,c,e.target),h.orient){case"cw":case"ccw":case"auto":e.target.rotation+=h.rotOffS+h.rotDelta*o;break;case"fixed":default:e.target.rotation+=h.rotOffS}h.lastRatio=o}return"rotation"!=i||h.orient&&"false"!=h.orient?e.target[i]:n},t.calc=function(e,i,n){void 0==e._segments&&t.validate(e),void 0==n&&(n={x:0,y:0,rotation:0});for(var r=e._segments,s=e.path,o=e._length*i,a=r.length-2,h=0;o>r[h]&&a>h;)o-=r[h],h+=2;var c=r[h+1],l=0;for(a=c.length-1;o>c[l]&&a>l;)o-=c[l],l++;var u=l/++a+o/(a*c[l]);h=2*h+2;var d=1-u;return n.x=d*d*s[h-2]+2*d*u*s[h+0]+u*u*s[h+2],n.y=d*d*s[h-1]+2*d*u*s[h+1]+u*u*s[h+3],e.orient&&(n.rotation=57.2957795*Math.atan2((s[h+1]-s[h-1])*d+(s[h+3]-s[h+1])*u,(s[h+0]-s[h-2])*d+(s[h+2]-s[h+0])*u)),n},createjs.MotionGuidePlugin=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=createjs.TweenJS=createjs.TweenJS||{};t.version="0.5.1",t.buildDate="Thu, 12 Dec 2013 23:33:38 GMT"}(),define("tween",["easel"],function(t){return function(){return t.createjs}}(this)),define("model/overlay",["events","constants","config","resources","tween","jquery","utils/encryptedResourceFetchingUtils"],function(t,e,i,n,r,s,o){var a=function(h,c,l,u,d,f,g,p){this.id=p,this.x=Number(h),this.y=Number(c),this.width=Number(l),this.height=Number(u),this.zIndex=Number(d),this.info=f,this.pageNumber=g,this.rect=null,this.hitArea=null,this.htmlElement=null,this.htmlElementVisible=!1,this.rectColour="FF00FF",this.defaultAlpha=i.overlayAlpha,this.highlightLinksOnLoadEnabled=i.highlightLinksOnLoadEnabled,this.overlayContainer=s("#yudu_overlays")[0],this.interactiveOverlayContainer=s("#yudu_interactiveOverlays")[0],this.isMouseIn=!1,this.createRectAndHitArea=function(){return this.rect=new r.Shape,this.rect.graphics.beginFill("#"+this.rectColour).drawRect(this.x,this.y,this.width,this.height),this.rect.alpha=this.defaultAlpha,this.rect.setBounds(this.x,this.y,this.width,this.height),this.hitArea=new r.Shape,this.hitArea.graphics.beginBitmapFill(n.overlayBackground).drawRect(this.x,this.y,this.width,this.height),this.rect.hitArea=this.hitArea,this.rect},this.intersect=function(t){if(!this.rect)return!1;var e=this.rect.localToGlobal(this.x,this.y),i=this.rect.localToGlobal(this.x+this.width,this.y+this.height);return t.x>e.x&&t.y>e.y&&t.x<i.x&&t.y<i.y},this.getScreenDimensions=function(){if(!this.rect)return null;var t=this.rect.localToGlobal(this.x,this.y),e=this.rect.localToGlobal(this.x+this.width,this.y+this.height);return{x:t.x/i.pixelDensity,y:t.y/i.pixelDensity,w:(e.x-t.x)/i.pixelDensity,h:(e.y-t.y)/i.pixelDensity}},this.handleTap=function(t){return!!this.intersect(t)&&(this.clicked(),!0)},a.prototype.handleTap=this.handleTap,this.createDOMMediaElement=function(e,i,n){var r=document.createElement(e);if(r.controls=!0,r.preload="none",t.yuduAddEventListener(r,"play",t.callback(this,this.onPlay),!1),n){if(i){var s=document.createElement("source");o.useResourceAsHtmlElementSource(i,s),s.type="video/"+i.substr(i.lastIndexOf(".")+1),r.appendChild(s)}var a=document.createElement("source");o.useResourceAsHtmlElementSource(n,a);var h=n.substr(n.lastIndexOf(".")+1);a.type="video/"+("webm"==h?"webm":"ogg"),r.appendChild(a)}else o.useResourceAsHtmlElementSource(i,r);return r},this.onPlay=function(){},this.setMinWidth=function(t){var e=Math.max(t,parseInt(this.width));isNaN(e)||(this.width=e)},this.flash=function(i){this.rect&&this.highlightLinksOnLoadEnabled&&(i=i||0,this.removeTweens(),r.Tween.get(this.rect,{override:!0}).call(function(){t.emit("overlay",t.OVERLAY_FLASH_START,this,{id:p})}).wait(i).to({alpha:e.overlayFocusAlpha},e.overlayFadeInTime).to({alpha:this.defaultAlpha},e.overlayFadeOutTime).wait(500).call(function(){t.emit("overlay",t.OVERLAY_FLASH_END,this,{id:p})}))},a.prototype.flash=this.flash,this.fadeIn=function(){this.rect&&(this.removeTweens(),r.Tween.get(this.rect,{override:!0}).call(function(){t.emit("overlay",t.OVERLAY_FADE_START,this,{id:p})}).to({alpha:e.overlayFocusAlpha},e.overlayFadeInTime).wait(500).call(function(){t.emit("overlay",t.OVERLAY_FADE_END,this,{id:p})}))},a.prototype.fadeIn=this.fadeIn,this.fadeOut=function(){this.rect&&(this.removeTweens(),r.Tween.get(this.rect,{override:!0}).call(function(){t.emit("overlay",t.OVERLAY_FADE_OUT_START,this,{id:p})}).to({alpha:this.defaultAlpha},e.overlayFadeOutTime).wait(500).call(function(){t.emit("overlay",t.OVERLAY_FADE_OUT_END,this,{id:p})}))},a.prototype.fadeOut=this.fadeOut,this.mouseIn=function(){this.isMouseIn=!0,this.fadeIn()},this.mouseOut=function(){this.isMouseIn=!1,this.fadeOut()},this.clicked=function(){},this.isFading=function(){return r.Tween.hasActiveTweens(this.rect)>0},this.triggerAutoPlay=function(){},this.triggerToggle=function(){},this.triggerOff=function(){},this.createMediaPlaceHolder=function(){function t(){e(n.placeholderBackground,n.playButton)}function e(t,e){i.background=new r.Bitmap(t),i.background.scaleX=i.width/t.width,i.background.scaleY=i.height/t.height,i.background.set({x:i.x,y:i.y}),i.button=new r.Bitmap(e);var n=.5*i.width/e.width,s=.5*i.height/e.height,o=Math.min(n,s);i.button.scaleX=i.button.scaleY=o,i.button.set({x:i.x+i.width/2-o*e.width*.5,y:i.y+i.height/2-o*e.height*.5}),i.rect.addChild(i.background),i.rect.addChild(i.button)}this.rect=new r.Container;var i=this;if(f["@tp"]){var s=new Image;s.onload=function(){e(s,n.playButtonTranslucent)},s.onerror=t,o.useResourceAsHtmlElementSource(f["@tp"],s)}else t()},this.subscribeToInteractionEvents=function(e){t.subscribe(t.ALL,t.SHOWHIDE_TOOLBAR,e,!1),t.subscribe(t.ALL,t.DRAG,e,!1),t.subscribe(t.ALL,t.PAGE_CHANGED,e,!1),t.subscribe(t.ALL,t.ZOOM,e,!1),t.subscribe(t.ALL,t.ZOOM_SCALE,e,!1),t.subscribe(t.ALL,t.TWO_UP_CHANGED,e,!1),t.subscribe(t.ALL,t.FIT_CHANGED,e,!1),t.subscribe(t.ALL,t.SHIFTER_SPRINGING,e,!1),t.subscribe(t.ALL,t.TRIGGER,e,!1)},this.removeTweens=function(){r.Tween.removeTweens(this.rect),t.emit("overlay",t.OVERLAY_TWEENS_REMOVED,this,{id:p})},this.isValid=!0,a.zIndexComparator=function(t,e){return t.zIndex-e.zIndex}};return{Overlay:a}}),define("shared/tools",["config","shared/storage"],function(t,e){var i=null,n=function(){var e=t.getFromQuery("refUrl");return e?decodeURIComponent(e):document.referrer},r=function(){var n=t.getFromQuery("deviceId");if(n)return i=n;if(null!=i)return i;var r=e.getItem("html_uid");return r?i=r:(i=Math.floor(1e8*Math.random()+1),e.setItem("html_uid",i),i)},s=function(){var t=navigator.oscpu,e=null;return t&&(e=o(t))?e:(e=o(navigator.userAgent))||(t||navigator.platform)},o=function(t){for(var e=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 10",r:/(Windows 10|Windows NT 10.0)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/}],i=0,n=e.length;i<n;i++){var r=e[i];if(r.r.test(t))return r.s}return null};return{getUniqueUserId:r,getReferral:n,getOS:s}}),define("utils/stats/yuduReporting",["jquery","shared/tools"],function(t,e){var i=null,n={},r=-1,s=null,o=null,a=null,h=null,c=function(t){return n=t.events,i=t.yuduBookSettings,!0},l={visit:"/Visit",action:"/Action",pageview:"/PageView",search:"/Search",email:"/EmailAddress",link:"/Link"},u=function(t){return i.statsUrl+l[t]},d=function(n){if(i.preview)return void f();var r=u("visit");s=n.startPage,o=n.startLabel,a=n.secondStartPage,h=n.secondStartLabel;var c={operatingSystem:e.getOS(),startPageNumber:n.startPage,startPageLabel:n.startLabel,bookId:i.id,referrerUrl:e.getReferral(),browser:navigator.userAgent,uniqueUserId:e.getUniqueUserId(),screenResolution:screen.width+"x"+screen.height,flashVersion:"unknown",hierarchyPosition:i.hierarchyPosition,appType:"HTML-Reader"};t.post(r,c,g,"text")},f=function(){var e=i.statsUrl;t.get(e,{bookId:i.id})},g=function(t){r=t;var e={newPage:s,newPageLabel:o};a&&h&&(e.newPage2=a,e.newPageLabel2=h),p(e)},p=function(e){if(!(r<0)){var i=u("pageview"),n={visitId:r,firstPageNumber:e.newPage,firstPageLabel:e.newPageLabel};e.newPage2&&(n.secondPageNumber=e.newPage2,n.secondPageLabel=e.newPageLabel2,a=e.newPage2,h=e.newPageLabel2),s=e.newPage,o=e.newPageLabel,t.post(i,n)}},m=function(t){switch(t.actionType){case n.video_resumed:case n.video_milestone_reached:case n.video_finished:return!1}return!0},v=function(e,i){if(!(r<0)){var n=u("link");i.url=e||"",t.post(n,i)}};return{init:c,newVisit:d,pageView:p,action:function(e){if(!(r<0)&&m(e)){var i=u("action"),c=e.extraInfo||"";if(void 0!==e.pageNumber&&null!=a&&e.pageNumber==a)var l={visitId:r,pageNumber:a,pageLabel:h};else var l={visitId:r,pageNumber:s,pageLabel:o};if(e.actionType==n.overlay_weblink)return void v(c,l);l.actionType=e.actionType,l.extraInfo=c,t.post(i,l)}},search:function(e){if(!(r<0)){var i=u("search"),n={visitId:r,pageNumber:s,pageLabel:o,searchPhrase:e.searchPhrase};t.post(i,n)}},email:function(e){var n=u("email"),r=i.dataCollectionAtPubNode?i.pubId:i.id,s={emailAddress:e,bookId:r,readerPlatform:"HTML-Reader"};t.post(n,s)}}}),define("environmentActive",[],function(){return{mode:"production"}}),define("environment",["environmentActive"],function(t){var e={dev:"development",prod:"production",test:"test"};return{modes:e,isDevelopment:t.mode===e.dev,isTest:t.mode===e.test,isProduction:t.mode===e.prod,currentMode:t.mode}}),define("utils/stats/gaIntegration",["require","environment","constants","shared/utils/eventUtils","shared/utils/appUtils"],function(t,e,i,n,r){var s,o,a=!1,h=[],c={},l={},u={newVisit:"new visit",search:"text search"},d={reader:"Edition",overlay:"Overlay"},f={email:"Email",facebook:"Facebook",twitter:"Twitter",unknown:"Unknown"},g=function(t){if(l=t.events,c=t.yuduBookSettings,a)return!1;P(),s=c.googleAnalyticsTrackerId;var e=c.gaEditionDimensionIndex,i=c.gaPlatformDimensionIndex;return s&&m(s,"uTracker",e,i),h.length>0&&(p(),v("set","anonymizeIp",!0),v("send","pageview"),!0)},p=function(){if(history.pushState&&window.addEventListener){var t=location.pathname+location.search,e=function(t){return"object"==typeof t&&null!==t},i=function(i){i=!1!==i,setTimeout(function(){var n=t,r=location.pathname+location.search;n!=r&&(t=r,v("set",{page:r,title:e(history.state)&&history.state.title||document.title}),i&&v("send","pageview"))},0)},r=history.pushState;history.pushState=function(t,n,s){var o=Array.prototype.slice.call(arguments);e(o[0])&&o[1]&&(o[0].title=o[1]),r.apply(history,o),i()};var s=history.replaceState;history.replaceState=function(t,n,r){var o=Array.prototype.slice.call(arguments);e(o[0])&&o[1]&&(o[0].title=o[1]),s.apply(history,o),i(!1)},n.yuduAddEventListener(window,"popstate",i)}},m=function(t,e,i,n){ga("create",{trackingId:t,cookieDomain:"auto",name:e}),i>0&&(c.gaReportNameInsteadOfNodeId?ga(e+".set","dimension"+i,c.name):ga(e+".set","dimension"+i,""+c.id)),n>0&&ga(e+".set","dimension"+n,o),h.push(e)},v=function(){if(!(arguments.length<2))for(var t=0,e=h.length;t<e;t++){var i=Array.prototype.slice.call(arguments);i[0]=h[t]+"."+i[0],ga.apply(this,i)}},y=function(){v("send",{hitType:"event",eventCategory:d.reader,eventAction:u.newVisit,eventLabel:""+c.id})},b=function(){},_=function(t){w(t)&&(v("send",T(t)),C(t)&&v("send",E(t)))},w=function(t){switch(t.actionType){case l.video_resumed:case l.video_milestone_reached:case l.video_finished:return!1}return!0},T=function(t){return{hitType:"event",eventCategory:x(t.actionType),eventAction:S(t.actionType),eventLabel:t.extraInfo}},x=function(t){switch(t){case l.overlay_email:case l.overlay_pagelink:case l.overlay_weblink:case l.video_watched:return d.overlay;default:return d.reader}},S=function(t){return t.toLowerCase().replace(/_/g," ")},C=function(t){switch(t.actionType){case l.emailed:case l.facebooked:case l.tweeted:return!0;default:return!1}},E=function(t){return{hitType:"social",socialNetwork:O(t.actionType),socialAction:S(t.actionType),socialTarget:t.extraInfo}},O=function(t){switch(t.actionType){case l.emailed:return f.email;case l.facebooked:return f.facebook;case l.tweeted:return f.twitter;default:return f.unknown}},A=function(t){v("send",{hitType:"event",eventCategory:d.reader,eventAction:u.search,eventLabel:t.searchPhrase})},P=function(){o=r.deviceType.isAndroid()?"Android Reader":r.deviceType.isMetro()?"Windows Reader":"Html Reader"};return function(){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,e.isTest||t(["https://www.google-analytics.com/analytics.js"],function(){},function(t){a=!0})}(),{init:g,newVisit:y,pageView:b,action:_,search:A}}),define("utils/stats/adobeDtmIntegration",[],function(){var t=!0,e={},i={},n={},r=function(r){if(n=r.events,e=r.yuduBookSettings,e.stats&&e.stats.integrationSettings){var s=e.stats.integrationSettings;if(s.integrationsEnabled&&!(t=!!s.integrationsEnabled.ADOBE_DTM))return!1;s.ADOBE_DTM&&(i=s.ADOBE_DTM)}return!0},s=function(){},o=function(){},a=function(t){h(t)&&window._satellite&&window._satellite.track&&window._satellite.track(i.ruleNames[t.actionType])},h=function(t){return i.ruleNames&&i.ruleNames[t.actionType]};return{init:r,newVisit:s,pageView:o,action:a,search:function(t){a({actionType:n.searched,extraInfo:t.searchPhrase})}}}),define("utils/stats/customEventIntegration",["events"],function(t){return new function(){var e=this,i={},n={};e.init=function(t){return n=t.events,i=t.yuduBookSettings,!0},e.newVisit=function(i){var n={page1:{index:i.startPage,number:i.startPage+i.indexOffset,label:i.startLabel}};void 0!==i.secondStartPage&&(n.page2={index:i.secondStartPage,number:i.secondStartPage+i.indexOffset,label:i.secondStartLabel}),n.pretty=s(n),t.emit(yudu_events.ALL,yudu_events.STATISTICS.VISITED,e,n)},e.pageView=function(i){var n={page1:{index:i.newPage,number:i.newPage+i.indexOffset,label:i.newPageLabel}};void 0!==i.newPage2&&(n.page2={index:i.newPage2,number:i.newPage2+i.indexOffset,label:i.newPageLabel2}),n.pretty=s(n),t.emit(yudu_events.ALL,yudu_events.STATISTICS.PAGE_VIEWED,e,n)},e.action=function(i){var n=yudu_events.STATISTICS[i.actionType];n&&t.emit(yudu_events.ALL,n,e,r(i))};var r=function(t){var e={};switch(t.actionType){case n.overlay_email:case n.overlay_weblink:case n.overlay_pagelink:case n.logo_clicked:case n.subscribed:case n.tweeted:case n.facebooked:e.target=t.extraInfo;break;case n.video_watched:case n.video_resumed:case n.video_finished:e.url=t.extraInfo,e.videoName=t.videoName;break;case n.video_milestone_reached:e.milestone=t.extraInfo,e.url=t.src,e.videoName=t.videoName;break;case n.emailed:e.sharedUrl=t.extraInfo;break;default:e.extraInfo=t.extraInfo}return e};e.search=function(i){var n={searchPhrase:i.searchPhrase};t.emit(yudu_events.ALL,yudu_events.STATISTICS.SEARCHED,e,n)};var s=function(t){var e={};return t.page2?(e.index=t.page1.index+"-"+t.page2.index,e.number=t.page1.number+"-"+t.page2.number,e.label=t.page1.label+"-"+t.page2.label):(e.index=""+t.page1.index,e.number=""+t.page1.number,e.label=""+t.page1.label),e}}}),define("utils/statistics",["jquery","utils/stats/yuduReporting","utils/stats/gaIntegration","utils/stats/adobeDtmIntegration","utils/stats/customEventIntegration"],function(t,e,i,n,r){return new function(){var t=this,s={};t.settings={},t.eventOverrides={},t.events={searched:"SEARCHED",overlay_email:"EMAIL_LINK_CLICKED",overlay_weblink:"WEB_LINK_CLICKED",overlay_pagelink:"PAGE_LINK_CLICKED",logo_clicked:"LOGO_CLICKED",video_watched:"VIDEO_WATCHED",video_resumed:"VIDEO_RESUMED",video_milestone_reached:"VIDEO_MILESTONE_REACHED",video_finished:"VIDEO_FINISHED",emailed:"EMAILED",subscribed:"SUBSCRIBED",tweeted:"TWEETED",facebooked:"FACEBOOKED"};var o=[];t.setYuduBookSettings=function(o){s.events=t.events,s.yuduBookSettings=o,o.stats&&(t.settings=o.stats),t.settings.eventSettings&&t.settings.eventSettings.globalOverrides&&(t.eventOverrides=t.settings.eventSettings.globalOverrides),a(e),"true"==localStorage.getItem("gaConsent-"+o.id)&&a(i),a(n),a(r)};var a=function(t){t.init(s)&&o.push(t)};t.newVisit=function(){for(var t=0,e=o.length;t<e;t++)o[t].newVisit.apply(this,Array.prototype.slice.call(arguments))},t.pageView=function(){for(var t=0,e=o.length;t<e;t++)o[t].pageView.apply(this,Array.prototype.slice.call(arguments))},t.action=function(t){if(h(t))for(var e=0,i=o.length;e<i;e++)o[e].action.apply(this,Array.prototype.slice.call(arguments))};var h=function(e){return!t.eventOverrides[e.actionType]};t.search=function(){if(!t.eventOverrides[t.events.searched])for(var e=0,i=o.length;e<i;e++)o[e].search.apply(this,Array.prototype.slice.call(arguments))},t.enableGoogleAnalytics=function(){a(i),i.newVisit.apply(this)}}}),define("utils/urlUtils",["config"],function(t){var e=function(t){if(!t)return t;for(var e="",n=0,r=0,s="",o=0;o<t.length;o++)0==n?"<"==t.charAt(o)&&(e+=t.substring(r,o),n=1,r=o+1):1==n?"|"==t.charAt(o)?(s=t.substring(r,o),n=2,r=o+1):">"==t.charAt(o)&&(e+=i(t.substring(r,o),!1),n=0,r=o+1):">"==t.charAt(o)&&(e+=i(s,t.substring(r,o)),n=0,r=o+1);return r<t.length&&(e+=t.substring(r,t.length)),e},i=function(e,i){var n=t.getFromQuery(e);return n||""===n?n:i||""};return{parseParameterisedUrl:e}}),define("utils/appWrapHook",["jquery","utils/tools","shared/tools","config","resources","events","shared/utils/appUtils"],function(t,e,i,n,r,s,o){var a=function(t){e.isThisAnApp()&&b.setStatus.initialised(),o.designateOrigin(o.targets.htmlReader),window.wrapperAction=y,t&&b.ready()&&c(),h()},h=function(){var t=n.getFromQuery("username"),e=n.getFromQuery("password"),r=n.getFromQuery("subscriberId");t&&e&&s.emit("appWrapHook",s.CHANGE_FOR_LOGIN_DETAILS,this,{superLoginSuccess:!0,tokenKey:!1,tokenId:!1,subscriberEmail:!1,subscriberId:r||!1,deviceId:i.getUniqueUserId(),username:t,password:e})},c=function(){if(!_.queryContainsKey())return p("gimmeKey:"+r.yuduBook.settings.id+":"+r.yuduBook.settings.pubId,!0)},l=function(){return!!b.initialised()&&p("superLogin",!0)},u=function(){return!(!b.ready()||b.superFailed())&&p("readerNeedsCredentials",!1)},d=function(t){return!!b.initialised()&&p("openExternalUrl:"+t,!1)},f=function(t){return!!b.ready()&&p("getLiveUrl:"+t,!0)},g=function(t){p(t,!1)},p=function(t,e){return e&&b.setStatus.aboutToSend(),_.sendMessage(t)},m=function(t,e){v(t,e)},v=function(t,e){var i=e||{};o.sendMessage(t,o.targets._app,i)},y={decryptKey:function(t){n.decryptionKey=t,b.setStatus.messageDecrypted(),s.emit("appWrapHook",s.LOGIN_SUCCESS,this,{key:t,success:!0})},debug:function(){},superLogin:function(t,e,i,n,r,o,a){b.setStatus.receivedSuperLogin(),s.emit("appWrapHook",s.CHANGE_FOR_LOGIN_DETAILS,this,{superLoginSuccess:!0,tokenKey:y.nullValueFilter(t),tokenId:y.nullValueFilter(e),subscriberEmail:y.nullValueFilter(i),subscriberId:y.nullValueFilter(n),deviceId:y.nullValueFilter(r),username:y.nullValueFilter(o),password:y.nullValueFilter(a)})},nullValueFilter:function(t){return"false"!=t&&(""!=t&&t)},superLoginFailed:function(){b.setStatus.noSuper(),s.emit("appWrapHook",s.SHOW_LOGIN,this,{noSuper:!0})},storeLiveUrl:function(t){if(""!==t){var e=document.createElement("a");e.href=t;var i=e.host;i.indexOf(":80")>-1?i=i.replace(":80",""):i.indexOf(":443")>-1&&(i=i.replace(":443",""));var r=e.pathname;r="/"==r.charAt(0)?r:"/"+r,n.liveUrl=e.protocol+"//"+i+r}else n.liveUrl=t;s.emit("appWrapHook",s.LIVE_URL_RECEIVED,this,{})},closedInAppBrowser:function(){r.yuduBook.settings.closeLightboxOnInAppReturn&&s.emit("appWrapHook",s.CLOSE_LIGHTBOX)},handleMessage:o.api.handleMessage},b=function(){var t=!1,e=!1,i=!1,n=!1,r={initialised:function(){t=!0},messageDecrypted:function(){n=!0},receivedSuperLogin:function(){n=!0,e=!1},noSuper:function(){e=!0,n=!0},aboutToSend:function(){i=!0}},s=function(){return t};return{initialised:s,ready:function(){return s()&&(!i||n)},superFailed:function(){return e},setStatus:r}}(),_={queryContainsKey:function(){var t=n.getFromQuery("key");return!!t&&(y.decryptKey(t),!0)},sendMessage:function(t){if(e.deviceType.isMetro()){if(t="ms-appx-web:///yudu:"+t,t.length<=2e3)window.location.href=t;else{var i=w(100,999);t=encodeURIComponent(t);for(var n=Math.ceil(t.length/2e3),r=0;r<n;r++){var s="ms-appx-web:///yudu:multipart:";s+=i+":",s+=r+":",s+=n+":",s+=t.substring(2e3*r,Math.min(2e3*(r+1),t.length)),window.location.href=s}}return!0}return!!e.deviceType.isAndroid()&&(window.location.href="yudu:"+t,!0)}},w=function(t,e){var i=Math.floor(Math.random()*(e-t+1))+t;return Date.now().toString(36).toUpperCase()+"-"+i};return{init:a,trySuperLogin:l,tryGettingSuperCredentials:u,tryOpeningExternalUrl:d,tryGettingLiveUrl:f,sendMessage:g,sendMessageWithParameters:m,registerHandlerForMessageWithParameters:o.registerMessageResponder}}),
define("model/webLinkOverlay",["events","config","shared/utils/stringUtils","model/overlay","utils/statistics","utils/tools","utils/urlUtils","utils/appWrapHook"],function(t,e,i,n,r,s,o,a){var h={htmlArticle:"htmlArticle:"},c=function(c,l,u,d,f,g,p,m){n.Overlay.call(this,c,l,u,d,f,g,p,m),this.link=g["@t"],this.tip=g["@tip"],this.isMagic=!1,this.magicSchema=!1,this.rectColour=e.webLinkOverlayColour,this.init=function(){return this.createRectAndHitArea(),this.checkForMagicLink(),this.rect},this.clicked=function(){var t=o.parseParameterisedUrl(this.link);if(!this.isMagic||!this.magicClicked(t)){if(r.action({actionType:r.events.overlay_weblink,pageNumber:this.pageNumber,extraInfo:t}),s.isThisAnApp()){var i=document.createElement("a");if(i.setAttribute("href",t),"http:"!==i.protocol&&"https"!==i.protocol){var n=t.indexOf("//pageLink/");if(-1!=n){var h=t.substring(n+"//pageLink/".length).split("/");if(h.length>=4&&"editionId"==h[0]&&"pageNumber"==h[2])return void a.sendMessage("goEdition:"+h[1]+":"+h[3])}}}t!=this.link&&s.isThisAnApp()&&s.deviceType.isAndroid()?a.tryOpeningExternalUrl(encodeURIComponent(this.link)):s.openURL(t,e.tryToOpenWebOverlaysInNewWindow)}},this.checkForMagicLink=function(){var t=o.parseParameterisedUrl(this.link);for(var e in h)if(h.hasOwnProperty(e)&&i.startsWith(t,h[e]))return this.isMagic=!0,void(this.magicSchema=h[e])},this.magicClicked=function(e){switch(this.magicSchema){case h.htmlArticle:var i=e.substr(h.htmlArticle.length);return t.emit("webOverlay",t.OPEN_ARTICLE,this,{article:i}),!0}return!1}};return c.prototype=n.Overlay.prototype,{WebLinkOverlay:c}}),define("views/overlayView",["easel"],function(t){return{OverlayView:function(){this.container=new t.Container,this.addOverlay=function(t){this.container.addChild(t)},this.getOverlayIndex=function(t){return this.container.getChildIndex(t)},this.replaceOverlay=function(t,e){this.container.removeChildAt(e),this.container.addChildAt(t,e)},this.hide=function(){this.container.visible=!1},this.show=function(){this.container.visible=!0}}}}),define("model/emailLinkOverlay",["events","config","model/overlay","utils/statistics","utils/tools"],function(t,e,i,n,r){var s=function(t,s,o,a,h,c,l,u){i.Overlay.call(this,t,s,o,a,h,c,l,u),this.email=c["@t"],this.tip=c["@tip"],this.rectColour=e.emailLinkOverlayColour,this.init=function(){return this.createRectAndHitArea(),this.rect},this.clicked=function(){n.action({actionType:n.events.overlay_email,pageNumber:this.pageNumber,extraInfo:this.email}),r.openURL("mailto:"+this.email,!1)}};return s.prototype=i.Overlay.prototype,{EmailLinkOverlay:s}}),define("model/pageLinkOverlay",["events","config","model/overlay","utils/statistics"],function(t,e,i,n){var r=function(r,s,o,a,h,c,l,u){i.Overlay.call(this,r,s,o,a,h,c,l,u),this.targetPage=c["@t"],this.tip=c["@tip"],this.rectColour=e.pageLinkOverlayColour,this.init=function(){return this.createRectAndHitArea(),t.register("pageLinkOverlay"),this.rect},this.clicked=function(){n.action({actionType:n.events.overlay_pagelink,pageNumber:this.pageNumber,extraInfo:this.targetPage}),t.emit("pageLinkOverlay",t.GOTO_PAGE,this,{pageNumber:this.targetPage})}};return r.prototype=i.Overlay.prototype,{PageLinkOverlay:r,EMITTER_NAME:"pageLinkOverlay"}}),define("shared/utils/utils",[],function(){return new function(){var t=this;t.getLeafOrUndefined=function(t){if(arguments.length<1)throw"Exception: Invalid number of arguments.";if(void 0===t)return t;for(var e=t,i=1,n=arguments.length;i<n;i++){try{e=e[arguments[i]]}catch(t){return}if(void 0===e)return}return e},t.combinePaths=function(){for(var t="",e=0,i=arguments.length;e<i;e++){var n=arguments[e];if(void 0!==n){if(0!==e){var r="/"===t[t.length-1],s="/"===n[0];r||s?r&&s&&(n=n.substr(1,n.length)):t+="/"}t+=n}}return t},t.debounce=function(t,e,i,n){var r,s=function(){var s=this,o=arguments,a=function(){r=null,i||t.apply(s,o)},h=i&&!r;return clearTimeout(r),r=setTimeout(a,e),h?t.apply(s,o):n};return s.clearTimeout=function(){r&&(clearTimeout(r),r=null)},s.isActive=function(){return!!r},s},t.performanceCriticalDebounce=function(t,e){var i,n,r=null,s=null,o=function(){r=null,i=void 0,n=void 0,s=null},a=function(){if(i=this,n=arguments,null!==s)return void(r=Date.now());s=setTimeout(c,e)},h=function(){if(null!==r){var a=e-(Date.now()-r);return a=a<30?30:a,s=setTimeout(c,a),void(r=null)}i?t.apply(i,n):t(),o()},c=function(){requestAnimationFrame(h)};return a.clearTimeout=function(){s&&(clearTimeout(s),o())},a.isActive=function(){return!!s},a},t.throttle=function(t,e){var i=!1;return function(){var n;return i||(n=t.call(),i=!0,setTimeout(function(){i=!1},e)),n}}}}),define("hammer2",[],function(){return function(t,e,i,n){"use strict";function r(t,e,i){return setTimeout(c(t,i),e)}function s(t,e,i){return!!Array.isArray(t)&&(o(t,i[e],i),!0)}function o(t,e,i){var r;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==n)for(r=0;r<t.length;)e.call(i,t[r],r,t),r++;else for(r in t)t.hasOwnProperty(r)&&e.call(i,t[r],r,t)}function a(e,i,n){var r="DEPRECATED METHOD: "+i+"\n"+n+" AT \n";return function(){var i=new Error("get-stack-trace"),n=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=t.console&&(t.console.warn||t.console.log);return s&&s.call(t.console,r,n),e.apply(this,arguments)}}function h(t,e,i){var n,r=e.prototype;n=t.prototype=Object.create(r),n.constructor=t,n._super=r,i&&lt(n,i)}function c(t,e){return function(){return t.apply(e,arguments)}}function l(t,e){return typeof t==ft?t.apply(e?e[0]||n:n,e):t}function u(t,e){return t===n?e:t}function d(t,e,i){o(m(e),function(e){t.addEventListener(e,i,!1)})}function f(t,e,i){o(m(e),function(e){t.removeEventListener(e,i,!1)})}function g(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function p(t,e){return t.indexOf(e)>-1}function m(t){return t.trim().split(/\s+/g)}function v(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function y(t){return Array.prototype.slice.call(t,0)}function b(t,e,i){for(var n=[],r=[],s=0;s<t.length;){var o=e?t[s][e]:t[s];v(r,o)<0&&n.push(t[s]),r[s]=o,s++}return i&&(n=e?n.sort(function(t,i){return t[e]>i[e]}):n.sort()),n}function _(t,e){for(var i,r,s=e[0].toUpperCase()+e.slice(1),o=0;o<ut.length;){if(i=ut[o],(r=i?i+s:e)in t)return r;o++}return n}function w(){return bt++}function T(e){var i=e.ownerDocument||e;return i.defaultView||i.parentWindow||t}function x(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){l(t.options.enable,[t])&&i.handler(e)},this.init()}function S(t){var e=t.options.inputClass;return new(e||(Tt?F:xt?U:wt?G:N))(t,C)}function C(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,s=e&Ct&&n-r==0,o=e&(Ot|At)&&n-r==0;i.isFirst=!!s,i.isFinal=!!o,s&&(t.session={}),i.eventType=e,E(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function E(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=P(e)),r>1&&!i.firstMultiple?i.firstMultiple=P(e):1===r&&(i.firstMultiple=!1);var s=i.firstInput,o=i.firstMultiple,a=o?o.center:s.center,h=e.center=k(n);e.timeStamp=mt(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=M(a,h),e.distance=D(a,h),O(i,e),e.offsetDirection=I(e.deltaX,e.deltaY);var c=L(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=c.x,e.overallVelocityY=c.y,e.overallVelocity=pt(c.x)>pt(c.y)?c.x:c.y,e.scale=o?R(o.pointers,n):1,e.rotation=o?j(o.pointers,n):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,A(i,e);var l=t.element;g(e.srcEvent.target,l)&&(l=e.srcEvent.target),e.target=l}function O(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},s=t.prevInput||{};e.eventType!==Ct&&s.eventType!==Ot||(r=t.prevDelta={x:s.deltaX||0,y:s.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}function A(t,e){var i,r,s,o,a=t.lastInterval||e,h=e.timeStamp-a.timeStamp;if(e.eventType!=At&&(h>St||a.velocity===n)){var c=e.deltaX-a.deltaX,l=e.deltaY-a.deltaY,u=L(h,c,l);r=u.x,s=u.y,i=pt(u.x)>pt(u.y)?u.x:u.y,o=I(c,l),t.lastInterval=e}else i=a.velocity,r=a.velocityX,s=a.velocityY,o=a.direction;e.velocity=i,e.velocityX=r,e.velocityY=s,e.direction=o}function P(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:gt(t.pointers[i].clientX),clientY:gt(t.pointers[i].clientY)},i++;return{timeStamp:mt(),pointers:e,center:k(e),deltaX:t.deltaX,deltaY:t.deltaY}}function k(t){var e=t.length;if(1===e)return{x:gt(t[0].clientX),y:gt(t[0].clientY)};for(var i=0,n=0,r=0;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:gt(i/e),y:gt(n/e)}}function L(t,e,i){return{x:e/t||0,y:i/t||0}}function I(t,e){return t===e?Pt:pt(t)>=pt(e)?t<0?kt:Lt:e<0?It:Dt}function D(t,e,i){i||(i=Nt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function M(t,e,i){i||(i=Nt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}function j(t,e){return M(e[1],e[0],Ft)+M(t[1],t[0],Ft)}function R(t,e){return D(e[0],e[1],Ft)/D(t[0],t[1],Ft)}function N(){this.evEl=Ht,this.evWin=Ut,this.pressed=!1,x.apply(this,arguments)}function F(){this.evEl=Wt,this.evWin=qt,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function B(){this.evTarget=Xt,this.evWin=Yt,this.started=!1,x.apply(this,arguments)}function H(t,e){var i=y(t.touches),n=y(t.changedTouches);return e&(Ot|At)&&(i=b(i.concat(n),"identifier",!0)),[i,n]}function U(){this.evTarget=Qt,this.targetIds={},x.apply(this,arguments)}function z(t,e){var i=y(t.touches),n=this.targetIds;if(e&(Ct|Et)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,s,o=y(t.changedTouches),a=[],h=this.target;if(s=i.filter(function(t){return g(t.target,h)}),e===Ct)for(r=0;r<s.length;)n[s[r].identifier]=!0,r++;for(r=0;r<o.length;)n[o[r].identifier]&&a.push(o[r]),e&(Ot|At)&&delete n[o[r].identifier],r++;return a.length?[b(s.concat(a),"identifier",!0),a]:void 0}function G(){x.apply(this,arguments);var t=c(this.handler,this);this.touch=new U(this.manager,t),this.mouse=new N(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function W(t,e){t&Ct?(this.primaryTouch=e.changedPointers[0].identifier,q.call(this,e)):t&(Ot|At)&&q.call(this,e)}function q(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var n=this.lastTouches,r=function(){var t=n.indexOf(i);t>-1&&n.splice(t,1)};setTimeout(r,Kt)}}function V(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var r=this.lastTouches[n],s=Math.abs(e-r.x),o=Math.abs(i-r.y);if(s<=Jt&&o<=Jt)return!0}return!1}function X(t,e){this.manager=t,this.set(e)}function Y(t){if(p(t,ne))return ne;var e=p(t,re),i=p(t,se);return e&&i?ne:e||i?e?re:se:p(t,ie)?ie:ee}function Z(t){this.options=lt({},this.defaults,t||{}),this.id=w(),this.manager=null,this.options.enable=u(this.options.enable,!0),this.state=ae,this.simultaneous={},this.requireFail=[]}function Q(t){return t&de?"cancel":t&le?"end":t&ce?"move":t&he?"start":""}function K(t){return t==Dt?"down":t==It?"up":t==kt?"left":t==Lt?"right":""}function J(t,e){var i=e.manager;return i?i.get(t):t}function $(){Z.apply(this,arguments)}function tt(){$.apply(this,arguments),this.pX=null,this.pY=null}function et(){$.apply(this,arguments)}function it(){Z.apply(this,arguments),this._timer=null,this._input=null}function nt(){$.apply(this,arguments)}function rt(){$.apply(this,arguments)}function st(){Z.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ot(t,e){return e=e||{},e.recognizers=u(e.recognizers,ot.defaults.preset),new at(t,e)}function at(t,e){this.options=lt({},ot.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=S(this),this.touchAction=new X(this,this.options.touchAction),ht(this,!0),o(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function ht(t,e){var i=t.element;if(i.style){var n;o(t.options.cssProps,function(r,s){n=_(i.style,s),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""}),e||(t.oldCssProps={})}}function ct(t,i){var n=e.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=i,i.target.dispatchEvent(n)}var lt,ut=["","webkit","Moz","MS","ms","o"],dt=e.createElement("div"),ft="function",gt=Math.round,pt=Math.abs,mt=Date.now;lt="function"!=typeof Object.assign?function(t){if(t===n||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(r!==n&&null!==r)for(var s in r)r.hasOwnProperty(s)&&(e[s]=r[s])}return e}:Object.assign;var vt=a(function(t,e,i){for(var r=Object.keys(e),s=0;s<r.length;)(!i||i&&t[r[s]]===n)&&(t[r[s]]=e[r[s]]),s++;return t},"extend","Use `assign`."),yt=a(function(t,e){return vt(t,e,!0)},"merge","Use `assign`."),bt=1,_t=/mobile|tablet|ip(ad|hone|od)|android/i,wt="ontouchstart"in t,Tt=_(t,"PointerEvent")!==n,xt=wt&&_t.test(navigator.userAgent),St=25,Ct=1,Et=2,Ot=4,At=8,Pt=1,kt=2,Lt=4,It=8,Dt=16,Mt=kt|Lt,jt=It|Dt,Rt=Mt|jt,Nt=["x","y"],Ft=["clientX","clientY"];x.prototype={handler:function(){},init:function(){this.evEl&&d(this.element,this.evEl,this.domHandler),this.evTarget&&d(this.target,this.evTarget,this.domHandler),this.evWin&&d(T(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&f(this.element,this.evEl,this.domHandler),this.evTarget&&f(this.target,this.evTarget,this.domHandler),this.evWin&&f(T(this.element),this.evWin,this.domHandler)}};var Bt={mousedown:Ct,mousemove:Et,mouseup:Ot},Ht="mousedown",Ut="mousemove mouseup";h(N,x,{handler:function(t){var e=Bt[t.type];e&Ct&&0===t.button&&(this.pressed=!0),e&Et&&1!==t.which&&(e=Ot),this.pressed&&(e&Ot&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var zt={pointerdown:Ct,pointermove:Et,pointerup:Ot,pointercancel:At,pointerout:At},Gt={2:"touch",3:"pen",4:"mouse",5:"kinect"},Wt="pointerdown",qt="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Wt="MSPointerDown",qt="MSPointerMove MSPointerUp MSPointerCancel"),h(F,x,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=zt[n],s=Gt[t.pointerType]||t.pointerType,o="touch"==s,a=v(e,t.pointerId,"pointerId");r&Ct&&(0===t.button||o)?a<0&&(e.push(t),a=e.length-1):r&(Ot|At)&&(i=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),i&&e.splice(a,1))}});var Vt={touchstart:Ct,touchmove:Et,touchend:Ot,touchcancel:At},Xt="touchstart",Yt="touchstart touchmove touchend touchcancel";h(B,x,{handler:function(t){var e=Vt[t.type];if(e===Ct&&(this.started=!0),this.started){var i=H.call(this,t,e);e&(Ot|At)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}});var Zt={touchstart:Ct,touchmove:Et,touchend:Ot,touchcancel:At},Qt="touchstart touchmove touchend touchcancel";h(U,x,{handler:function(t){var e=Zt[t.type],i=z.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}});var Kt=2500,Jt=25;h(G,x,{handler:function(t,e,i){var n="touch"==i.pointerType,r="mouse"==i.pointerType;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)W.call(this,e,i);else if(r&&V.call(this,i))return;this.callback(t,e,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var $t=_(dt.style,"touchAction"),te=$t!==n,ee="auto",ie="manipulation",ne="none",re="pan-x",se="pan-y",oe=function(){if(!te)return!1;var e={},i=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){e[n]=!i||t.CSS.supports("touch-action",n)}),e}();X.prototype={set:function(t){"compute"==t&&(t=this.compute()),te&&this.manager.element.style&&oe[t]&&(this.manager.element.style[$t]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return o(this.manager.recognizers,function(e){l(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),Y(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var n=this.actions,r=p(n,ne)&&!oe[ne],s=p(n,se)&&!oe[se],o=p(n,re)&&!oe[re];if(r){var a=1===t.pointers.length,h=t.distance<2,c=t.deltaTime<250;if(a&&h&&c)return}return o&&s?void 0:r||s&&i&Mt||o&&i&jt?this.preventSrc(e):void 0},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var ae=1,he=2,ce=4,le=8,ue=le,de=16;Z.prototype={defaults:{},set:function(t){return lt(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(s(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=J(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return s(t,"dropRecognizeWith",this)?this:(t=J(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(s(t,"requireFailure",this))return this;var e=this.requireFail;return t=J(t,this),-1===v(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(s(t,"dropRequireFailure",this))return this;t=J(t,this);var e=v(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){i.manager.emit(e,t)}var i=this,n=this.state;n<le&&e(i.options.event+Q(n)),e(i.options.event),t.additionalEvent&&e(t.additionalEvent),n>=le&&e(i.options.event+Q(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|ae)))return!1;t++}return!0},recognize:function(t){var e=lt({},t);if(!l(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(ue|de|32)&&(this.state=ae),this.state=this.process(e),this.state&(he|ce|le|de)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},h($,Z,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(he|ce),r=this.attrTest(t);return n&&(i&At||!r)?e|de:n||r?i&Ot?e|le:e&he?e|ce:he:32}}),h(tt,$,{defaults:{event:"pan",threshold:10,pointers:1,direction:Rt},getTouchAction:function(){var t=this.options.direction,e=[];return t&Mt&&e.push(se),t&jt&&e.push(re),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,s=t.deltaX,o=t.deltaY;return r&e.direction||(e.direction&Mt?(r=0===s?Pt:s<0?kt:Lt,i=s!=this.pX,n=Math.abs(t.deltaX)):(r=0===o?Pt:o<0?It:Dt,i=o!=this.pY,n=Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return $.prototype.attrTest.call(this,t)&&(this.state&he||!(this.state&he)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=K(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),h(et,$,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ne]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&he)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),h(it,Z,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ee]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,s=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(Ot|At)&&!s)this.reset();else if(t.eventType&Ct)this.reset(),this._timer=r(function(){this.state=ue,this.tryEmit()},e.time,this);else if(t.eventType&Ot)return ue;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===ue&&(t&&t.eventType&Ot?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=mt(),this.manager.emit(this.options.event,this._input)))}}),h(nt,$,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ne]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&he)}}),h(rt,$,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Mt|jt,pointers:1},getTouchAction:function(){return tt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(Mt|jt)?e=t.overallVelocity:i&Mt?e=t.overallVelocityX:i&jt&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&pt(e)>this.options.velocity&&t.eventType&Ot},emit:function(t){var e=K(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),h(st,Z,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ie]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,s=t.deltaTime<e.time;if(this.reset(),t.eventType&Ct&&0===this.count)return this.failTimeout();if(n&&s&&i){if(t.eventType!=Ot)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||D(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t;if(0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=r(function(){this.state=ue,this.tryEmit()},e.interval,this),he):ue}return 32},failTimeout:function(){return this._timer=r(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ue&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ot.VERSION="2.0.7",ot.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[nt,{enable:!1}],[et,{enable:!1},["rotate"]],[rt,{direction:Mt}],[tt,{direction:Mt},["swipe"]],[st],[st,{event:"doubletap",taps:2},["tap"]],[it]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};return at.prototype={set:function(t){return lt(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&ue)&&(r=e.curRecognizer=null);for(var s=0;s<n.length;)i=n[s],2===e.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(he|ce|le)&&(r=e.curRecognizer=i),s++}},get:function(t){if(t instanceof Z)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(s(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(s(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,i=v(e,t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==n&&e!==n){var i=this.handlers;return o(m(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this}},off:function(t,e){if(t!==n){var i=this.handlers;return o(m(t),function(t){e?i[t]&&i[t].splice(v(i[t],e),1):delete i[t]}),this}},emit:function(t,e){this.options.domEvents&&ct(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](e),n++}},destroy:function(){this.element&&ht(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},lt(ot,{INPUT_START:Ct,INPUT_MOVE:Et,INPUT_END:Ot,INPUT_CANCEL:At,STATE_POSSIBLE:ae,STATE_BEGAN:he,STATE_CHANGED:ce,STATE_ENDED:le,STATE_RECOGNIZED:ue,STATE_CANCELLED:de,STATE_FAILED:32,DIRECTION_NONE:Pt,DIRECTION_LEFT:kt,DIRECTION_RIGHT:Lt,DIRECTION_UP:It,DIRECTION_DOWN:Dt,DIRECTION_HORIZONTAL:Mt,DIRECTION_VERTICAL:jt,DIRECTION_ALL:Rt,Manager:at,Input:x,TouchAction:X,TouchInput:U,MouseInput:N,PointerEventInput:F,TouchMouseInput:G,SingleTouchInput:B,Recognizer:Z,AttrRecognizer:$,Tap:st,Pan:tt,Swipe:rt,Pinch:et,Rotate:nt,Press:it,on:d,off:f,each:o,merge:yt,extend:vt,assign:lt,inherit:h,bindFn:c,prefixed:_}),ot}(window,document)}),function(t){"function"==typeof define&&define.amd?define("jquery.mousewheel",["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){function e(e){var r,s=e||window.event,o=[].slice.call(arguments,1),a=0,h=0,c=0,l=0,u=0;return e=t.event.fix(s),e.type="mousewheel",s.wheelDelta&&(a=s.wheelDelta),s.detail&&(a=-1*s.detail),c=a,void 0!==s.axis&&s.axis===s.HORIZONTAL_AXIS&&(c=0,h=-1*a),s.deltaY&&(c=-1*s.deltaY,a=c),s.deltaX&&(h=s.deltaX,a=-1*h),void 0!==s.wheelDeltaY&&(c=s.wheelDeltaY),void 0!==s.wheelDeltaX&&(h=-1*s.wheelDeltaX),l=Math.abs(a),(!i||l<i)&&(i=l),u=Math.max(Math.abs(c),Math.abs(h)),(!n||u<n)&&(n=u),r=a>0?"floor":"ceil",a=Math[r](a/i),h=Math[r](h/n),c=Math[r](c/n),o.unshift(e,a,h,c),(t.event.dispatch||t.event.handle).apply(this,o)}var i,n,r=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],s="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(t.event.fixHooks)for(var o=r.length;o;)t.event.fixHooks[r[--o]]=t.event.mouseHooks;t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=s.length;t;)this.addEventListener(s[--t],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var t=s.length;t;)this.removeEventListener(s[--t],e,!1);else this.onmousewheel=null}},t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),function(t,e){"use strict";function i(){if(!n.READY){n.event.determineEventTypes();for(var t in n.gestures)n.gestures.hasOwnProperty(t)&&n.detection.register(n.gestures[t]);n.event.onTouch(n.DOCUMENT,n.EVENT_MOVE,n.detection.detect),n.event.onTouch(n.DOCUMENT,n.EVENT_END,n.detection.detect),n.READY=!0}}var n=function(t,e){return new n.Instance(t,e||{})};n.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},n.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,n.HAS_TOUCHEVENTS="ontouchstart"in t,n.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&navigator.userAgent.match(n.MOBILE_REGEX),n.EVENT_TYPES={},n.DIRECTION_DOWN="down",n.DIRECTION_LEFT="left",n.DIRECTION_UP="up",n.DIRECTION_RIGHT="right",n.POINTER_MOUSE="mouse",n.POINTER_TOUCH="touch",n.POINTER_PEN="pen",n.EVENT_START="start",n.EVENT_MOVE="move",n.EVENT_END="end",n.DOCUMENT=document,n.plugins={},n.READY=!1,n.Instance=function(t,e){var r=this;return i(),this.element=t,this.enabled=!0,this.options=n.utils.extend(n.utils.extend({},n.defaults),e||{}),this.options.stop_browser_behavior&&n.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),n.event.onTouch(t,n.EVENT_START,function(t){r.enabled&&n.detection.startDetect(r,t)}),this},n.Instance.prototype={on:function(t,e){for(var i=t.split(" "),n=0;i.length>n;n++)this.element.addEventListener(i[n],e,!1);return this},off:function(t,e){for(var i=t.split(" "),n=0;i.length>n;n++)this.element.removeEventListener(i[n],e,!1);return this},trigger:function(t,e){var i=n.DOCUMENT.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e;var r=this.element;return n.utils.hasParent(e.target,r)&&(r=e.target),r.dispatchEvent(i),this},enable:function(t){return this.enabled=t,this}};var r=null,s=!1,o=!1;n.event={bindDom:function(t,e,i){for(var n=e.split(" "),r=0;n.length>r;r++)t.addEventListener(n[r],i,!1)},onTouch:function(t,e,i){var a=this;this.bindDom(t,n.EVENT_TYPES[e],function(h){var c=h.type.toLowerCase();if(!c.match(/mouse/)||!o){(c.match(/touch/)||c.match(/pointerdown/)||c.match(/mouse/)&&1===h.which)&&(s=!0),c.match(/touch|pointer/)&&(o=!0);var l=0;s&&(n.HAS_POINTEREVENTS&&e!=n.EVENT_END?l=n.PointerEvent.updatePointer(e,h):c.match(/touch/)?l=h.touches.length:o||(l=c.match(/up/)?0:1),l>0&&e==n.EVENT_END?e=n.EVENT_MOVE:l||(e=n.EVENT_END),l||null===r?r=h:h=r,i.call(n.detection,a.collectEventData(t,e,h)),n.HAS_POINTEREVENTS&&e==n.EVENT_END&&(l=n.PointerEvent.updatePointer(e,h))),l||(r=null,s=!1,o=!1,n.PointerEvent.reset())}})},determineEventTypes:function(){var t;t=n.HAS_POINTEREVENTS?n.PointerEvent.getEvents():n.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n.EVENT_TYPES[n.EVENT_START]=t[0],n.EVENT_TYPES[n.EVENT_MOVE]=t[1],n.EVENT_TYPES[n.EVENT_END]=t[2]},getTouchList:function(t){return n.HAS_POINTEREVENTS?n.PointerEvent.getTouchList():t.touches?t.touches:[{identifier:1,pageX:t.pageX,pageY:t.pageY,target:t.target}]},collectEventData:function(t,e,i){var r=this.getTouchList(i,e),s=n.POINTER_TOUCH;return(i.type.match(/mouse/)||n.PointerEvent.matchType(n.POINTER_MOUSE,i))&&(s=n.POINTER_MOUSE),{center:n.utils.getCenter(r),timeStamp:(new Date).getTime(),target:i.target,touches:r,eventType:e,pointerType:s,srcEvent:i,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return n.detection.stopDetect()}}}},n.PointerEvent={pointers:{},getTouchList:function(){var t=this,e=[];return Object.keys(t.pointers).sort().forEach(function(i){e.push(t.pointers[i])}),e},updatePointer:function(t,e){return t==n.EVENT_END?this.pointers={}:(e.identifier=e.pointerId,this.pointers[e.pointerId]=e),Object.keys(this.pointers).length},matchType:function(t,e){if(!e.pointerType)return!1;var i={};return i[n.POINTER_MOUSE]=e.pointerType==e.MSPOINTER_TYPE_MOUSE||e.pointerType==n.POINTER_MOUSE,i[n.POINTER_TOUCH]=e.pointerType==e.MSPOINTER_TYPE_TOUCH||e.pointerType==n.POINTER_TOUCH,i[n.POINTER_PEN]=e.pointerType==e.MSPOINTER_TYPE_PEN||e.pointerType==n.POINTER_PEN,i[t]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},n.utils={extend:function(t,i,n){for(var r in i)t[r]!==e&&n||(t[r]=i[r]);return t},hasParent:function(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1},getCenter:function(t){for(var e=[],i=[],n=0,r=t.length;r>n;n++)e.push(t[n].pageX),i.push(t[n].pageY);return{pageX:(Math.min.apply(Math,e)+Math.max.apply(Math,e))/2,pageY:(Math.min.apply(Math,i)+Math.max.apply(Math,i))/2}},getVelocity:function(t,e,i){return{x:Math.abs(e/t)||0,y:Math.abs(i/t)||0}},getAngle:function(t,e){var i=e.pageY-t.pageY,n=e.pageX-t.pageX;return 180*Math.atan2(i,n)/Math.PI},getDirection:function(t,e){return Math.abs(t.pageX-e.pageX)>=Math.abs(t.pageY-e.pageY)?t.pageX-e.pageX>0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT:t.pageY-e.pageY>0?n.DIRECTION_UP:n.DIRECTION_DOWN},getDistance:function(t,e){var i=e.pageX-t.pageX,n=e.pageY-t.pageY;return Math.sqrt(i*i+n*n)},getScale:function(t,e){return t.length>=2&&e.length>=2?this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,e){
return t.length>=2&&e.length>=2?this.getAngle(e[1],e[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==n.DIRECTION_UP||t==n.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t,e){var i,n=["webkit","khtml","moz","ms","o",""];if(e&&t.style){for(var r=0;n.length>r;r++)for(var s in e)e.hasOwnProperty(s)&&(i=s,n[r]&&(i=n[r]+i.substring(0,1).toUpperCase()+i.substring(1)),t.style[i]=e[s]);"none"==e.userSelect&&(t.onselectstart=function(){return!1})}}},n.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,e){this.current||(this.stopped=!1,this.current={inst:t,startEvent:n.utils.extend({},e),lastEvent:!1,name:""},this.detect(e))},detect:function(t){if(this.current&&!this.stopped){t=this.extendEventData(t);for(var e=this.current.inst.options,i=0,r=this.gestures.length;r>i;i++){var s=this.gestures[i];if(!this.stopped&&!1!==e[s.name]&&!1===s.handler.call(s,t,this.current.inst)){this.stopDetect();break}}return this.current&&(this.current.lastEvent=t),t.eventType==n.EVENT_END&&!t.touches.length-1&&this.stopDetect(),t}},stopDetect:function(){this.previous=n.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(t){var e=this.current.startEvent;if(e&&(t.touches.length!=e.touches.length||t.touches===e.touches)){e.touches=[];for(var i=0,r=t.touches.length;r>i;i++)e.touches.push(n.utils.extend({},t.touches[i]))}var s=t.timeStamp-e.timeStamp,o=t.center.pageX-e.center.pageX,a=t.center.pageY-e.center.pageY,h=n.utils.getVelocity(s,o,a);return n.utils.extend(t,{deltaTime:s,deltaX:o,deltaY:a,velocityX:h.x,velocityY:h.y,distance:n.utils.getDistance(e.center,t.center),angle:n.utils.getAngle(e.center,t.center),direction:n.utils.getDirection(e.center,t.center),scale:n.utils.getScale(e.touches,t.touches),rotation:n.utils.getRotation(e.touches,t.touches),startEvent:e}),t},register:function(t){var i=t.defaults||{};return i[t.name]===e&&(i[t.name]=!0),n.utils.extend(n.defaults,i,!0),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort(function(t,e){return t.index<e.index?-1:t.index>e.index?1:0}),this.gestures}},n.gestures=n.gestures||{},n.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(t,e){switch(t.eventType){case n.EVENT_START:clearTimeout(this.timer),n.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==n.detection.current.name&&e.trigger("hold",t)},e.options.hold_timeout);break;case n.EVENT_MOVE:t.distance>e.options.hold_threshold&&clearTimeout(this.timer);break;case n.EVENT_END:clearTimeout(this.timer)}}},n.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(t,e){if(t.eventType==n.EVENT_END){var i=n.detection.previous,r=!1;if(t.deltaTime>e.options.tap_max_touchtime||t.distance>e.options.tap_max_distance)return;i&&"tap"==i.name&&t.timeStamp-i.lastEvent.timeStamp<e.options.doubletap_interval&&t.distance<e.options.doubletap_distance&&(e.trigger("doubletap",t),r=!0),(!r||e.options.tap_always)&&(n.detection.current.name="tap",e.trigger(n.detection.current.name,t))}}},n.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(t,e){if(t.eventType==n.EVENT_END){if(e.options.swipe_max_touches>0&&t.touches.length>e.options.swipe_max_touches)return;(t.velocityX>e.options.swipe_velocity||t.velocityY>e.options.swipe_velocity)&&(e.trigger(this.name,t),e.trigger(this.name+t.direction,t))}}},n.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(t,i){if(n.detection.current.name!=this.name&&this.triggered)return i.trigger(this.name+"end",t),this.triggered=!1,e;if(!(i.options.drag_max_touches>0&&t.touches.length>i.options.drag_max_touches))switch(t.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:if(t.distance<i.options.drag_min_distance&&n.detection.current.name!=this.name)return;n.detection.current.name=this.name,(n.detection.current.lastEvent.drag_locked_to_axis||i.options.drag_lock_to_axis&&i.options.drag_lock_min_distance<=t.distance)&&(t.drag_locked_to_axis=!0);var r=n.detection.current.lastEvent.direction;t.drag_locked_to_axis&&r!==t.direction&&(t.direction=n.utils.isVertical(r)?0>t.deltaY?n.DIRECTION_UP:n.DIRECTION_DOWN:0>t.deltaX?n.DIRECTION_LEFT:n.DIRECTION_RIGHT),this.triggered||(i.trigger(this.name+"start",t),this.triggered=!0),i.trigger(this.name,t),i.trigger(this.name+t.direction,t),(i.options.drag_block_vertical&&n.utils.isVertical(t.direction)||i.options.drag_block_horizontal&&!n.utils.isVertical(t.direction))&&t.preventDefault();break;case n.EVENT_END:this.triggered&&i.trigger(this.name+"end",t),this.triggered=!1}}},n.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(t,i){if(n.detection.current.name!=this.name&&this.triggered)return i.trigger(this.name+"end",t),this.triggered=!1,e;if(!(2>t.touches.length))switch(i.options.transform_always_block&&t.preventDefault(),t.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:var r=Math.abs(1-t.scale),s=Math.abs(t.rotation);if(i.options.transform_min_scale>r&&i.options.transform_min_rotation>s)return;n.detection.current.name=this.name,this.triggered||(i.trigger(this.name+"start",t),this.triggered=!0),i.trigger(this.name,t),s>i.options.transform_min_rotation&&i.trigger("rotate",t),r>i.options.transform_min_scale&&(i.trigger("pinch",t),i.trigger("pinch"+(1>t.scale?"in":"out"),t));break;case n.EVENT_END:this.triggered&&i.trigger(this.name+"end",t),this.triggered=!1}}},n.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(t,i){return i.options.prevent_mouseevents&&t.pointerType==n.POINTER_MOUSE?(t.stopDetect(),e):(i.options.prevent_default&&t.preventDefault(),t.eventType==n.EVENT_START&&i.trigger(this.name,t),e)}},n.gestures.Release={name:"release",index:1/0,handler:function(t,e){t.eventType==n.EVENT_END&&e.trigger(this.name,t)}},"object"==typeof module&&"object"==typeof module.exports?module.exports=n:(t.Hammer=n,"function"==typeof t.define&&t.define.amd&&t.define("hammer",[],function(){return n}))}(this),function(t,e){"use strict";t!==e&&(Hammer.event.bindDom=function(i,n,r){t(i).on(n,function(t){var i=t.originalEvent||t;i.pageX===e&&(i.pageX=t.pageX,i.pageY=t.pageY),i.target||(i.target=t.target),i.which===e&&(i.which=i.button),i.preventDefault||(i.preventDefault=t.preventDefault),i.stopPropagation||(i.stopPropagation=t.stopPropagation),r.call(this,i)})},Hammer.Instance.prototype.on=function(e,i){return t(this.element).on(e,i)},Hammer.Instance.prototype.off=function(e,i){return t(this.element).off(e,i)},Hammer.Instance.prototype.trigger=function(e,i){var n=t(this.element);return n.has(i.target).length&&(n=t(i.target)),n.trigger({type:e,gesture:i})},t.fn.hammer=function(e){return this.each(function(){var i=t(this),n=i.data("hammer");n?n&&e&&Hammer.utils.extend(n.options,e):i.data("hammer",new Hammer(this,e||{}))})})}(window.jQuery||window.Zepto),define("jquery.hammer",["jquery"],function(){}),define("interactions",["config","events","shared/hammerManager","shared/utils/utils","hammer2","jquery","jquery.mousewheel","jquery.hammer"],function(t,e,i,n,r,s){var o,a,h,c=!0,l=!0,u=!1,d=function(t){return!u&&(!(t.nativeEvent.touches&&t.nativeEvent.touches.length>1)&&!(t.nativeEvent.pointerId&&!t.nativeEvent.isPrimary))},f=function(i){e.emit("interaction",e.ZOOM,this,{direction:1,x:i.gesture.center.pageX*t.pixelDensity,y:i.gesture.center.pageY*t.pixelDensity})},g=function(i){l&&(u=!0,e.emit("interaction",e.ZOOM_SCALE,this,{scale:i.gesture.scale,x:i.gesture.center.pageX*t.pixelDensity,y:i.gesture.center.pageY*t.pixelDensity}))},p=function(i){u&&e.emit("interaction",e.ZOOM_SCALE,this,{end:!0,x:i.gesture.center.pageX*t.pixelDensity,y:i.gesture.center.pageY*t.pixelDensity}),u=!1,y(i)},m=function(t){t.gesture.preventDefault(),a.css("z-index","50000"),a.off("mousemove"),e.emit("interaction",e.DRAG_START,this,t.gesture)},v=function(t){t.gesture.preventDefault(),e.emit("interaction",e.DRAG,this,t.gesture)},y=function(t){t.gesture.preventDefault(),a.css("z-index",""),o.mouseOverEnabled&&e.yuduOn(a,"mousemove",e.callback(o,o.fadeInOrOutOverlayIfNecessary)),e.emit("interaction",e.DRAG_END,this,t.gesture)},b=function(t){e.emit("interaction",e.TAP,this,t.gesture)},_=function(t){e.emit("interaction",e.TOUCH,this,t.gesture)},w=function(i,n){e.emit("interaction",e.ZOOM,this,{direction:n,x:i.pageX*t.pixelDensity,y:i.pageY*t.pixelDensity})},T=function(i){if(27==i.which&&e.emit("interaction",e.CLOSE_ACTIVE,this,{}),c)switch(i.which){case 37:e.emit("interaction",e.GOTO_PREVIOUS_PAGE,this,{},!1);break;case 39:e.emit("interaction",e.GOTO_NEXT_PAGE,this,{},!1);break;case 38:e.emit("interaction",e.ZOOM,this,{direction:1,x:t.width/2,y:t.height/2});break;case 40:e.emit("interaction",e.ZOOM,this,{direction:-1,x:t.width/2,y:t.height/2})}},x=function(t){o=t,e.register("interaction"),e.subscribe(e.ALL,e.TOGGLE_KEY_NAVIGATION,S),a=s("#yudu_interactionDiv"),h=a.hammer({transform_always_block:l}),e.yuduOn(h,"pinch",g),e.yuduOn(h,"doubletap",f),e.yuduOn(h,"release",p),e.yuduOn(h,"drag",v),e.yuduOn(h,"dragend",y),e.yuduOn(h,"dragstart",m),e.yuduOn(h,"tap",b),e.yuduOn(h,"touch",_),a.bind("mousewheel",w),e.yuduOn(a,"mousemove",e.callback(o,o.fadeInOrOutOverlayIfNecessary)),window.onkeydown=T;var i=e.callback(this,function(){o.updateReaderSize()});i=n.debounce(i,300),window.addEventListener("resize",i),createjs.Touch.enable(o.stage),window.onpopstate=function(t){if(t&&t.state&&void 0!==t.state.page&&null!=t.state.page){var i=t.state.page;e.emit("interaction",e.HISTORY_CHANGE,this,{page:i})}},e.yuduOn(s("html"),"touchmove",function(){e.emit("interaction",e.MOUSE_MOVE_STOP,this,{}),s("html").off("touchmove")})},S=function(t){A(void 0!==t.data.isAllowed?t.data.isAllowed:!c)},C=function(){l&&(h&&(h.data("hammer").options.transform_always_block=!1),l=!1)},E=function(){l||(h&&(h.data("hammer").options.transform_always_block=!0),l=!0)},O=function(t){t.data.isZoomedIn?C():E()},A=function(t){c=t};return function(){i.setupLibraries(r),e.subscribe(e.ALL,e.BROWSER_ZOOM_LEVEL_CHANGED,O,!0)}(),{init:x,setAllowKeyNavigation:A,canDragPage:d,EMITTER_NAME:"interaction"}}),define("ui/orderForm",["constants","events","config","resources","interactions","shared/ui/messageBox","shared/localisation","utils/tools","utils/urlUtils","shared/storage","jquery"],function(t,e,i,n,r,s,o,a,h,c,l){var u,d,f,g,p,m,v=l("#yudu_orderFormBackground"),y=l("#yudu_orderForm"),b=l("#yudu_orderFormTitle"),_=l("#yudu_orderFormTableWrapper"),w=l("#yudu_orderFormTable"),T=l("#yudu_orderFormTableHeading"),x=l("#yudu_deliveryDetailsTable"),S=l("#yudu_totalPriceRow"),C=l("#yudu_totalPrice"),E=l("#yudu_emptyOrderForm"),O=l("#yudu_orderFormButtons"),A=l("#yudu_dismissOrderForm"),P=l("#yudu_nextViewOrderForm"),k=l("#yudu_previousViewOrderForm"),L=l("#yudu_sendOrderForm"),I=l("#yudu_emptyFormInfo"),D=null,M={name:l("#yudu_deliveryDetailsName"),accountNumber:l("#yudu_deliveryDetailsAccountNumber"),phone:l("#yudu_deliveryDetailsPhone"),poNumber:l("#yudu_deliveryDetailsPONumber"),email:l("#yudu_deliveryDetailsEmail"),companyName:l("#yudu_deliveryDetailsCompanyName"),customUserFieldRow:l("#yudu_customUserFieldRow"),customUserFieldName:l("#yudu_deliveryDetailsCustomUserFieldName"),customUserField:l("#yudu_deliveryDetailsCustomUserField"),billingAddress1:l("#yudu_deliveryDetailsBillingAddress1"),billingAddress2:l("#yudu_deliveryDetailsBillingAddress2"),billingCity:l("#yudu_deliveryDetailsBillingCity"),billingState:l("#yudu_deliveryDetailsBillingState"),billingPostCode:l("#yudu_deliveryDetailsBillingPostCode"),billingCountry:l("#yudu_deliveryDetailsBillingCountry"),deliveryAddress1:l("#yudu_deliveryDetailsDeliveryAddress1"),deliveryAddress2:l("#yudu_deliveryDetailsDeliveryAddress2"),deliveryCity:l("#yudu_deliveryDetailsDeliveryCity"),deliveryState:l("#yudu_deliveryDetailsDeliveryState"),deliveryPostCode:l("#yudu_deliveryDetailsDeliveryPostCode"),deliveryCountry:l("#yudu_deliveryDetailsDeliveryCountry"),deliveryNotes:l("#yudu_deliveryDetailsAdditionalInformation"),deliveryDetailsSameAsBillingCheckbox:l("#yudu_deliveryDetailsDeliveryAddressSameAsBillingAddress")},j={},R=0,N=0,F=function(){if(e.yuduOn(v,i.clickAction,V),e.yuduOn(y,i.clickAction,function(){clearTimeout(p)}),e.yuduOn(E,i.clickAction,nt),e.yuduOn(A,i.clickAction,V),e.yuduOn(P,i.clickAction,rt),e.yuduOn(k,i.clickAction,rt),e.yuduOn(L,i.clickAction,st),e.subscribe(e.All,e.RESIZE,Y),S.toggle(),x.toggle(),g=n.yuduBook.orderForm,g.submitToCustomUrl?(P.hide(),L.show()):(M.deliveryDetailsSameAsBillingCheckbox.change(function(t){M.deliveryDetailsSameAsBillingCheckbox.prop("checked")?(M.deliveryAddress1.val(M.billingAddress1.val()),M.deliveryAddress2.val(M.billingAddress2.val()),M.deliveryCity.val(M.billingCity.val()),M.deliveryState.val(M.billingState.val()),M.deliveryPostCode.val(M.billingPostCode.val()),M.deliveryCountry.val(M.billingCountry.val()),B()):H()}),d=l("#yudu_orderFormResponse"),g.userField1&&(M.customUserFieldName.text(g.userField1),M.customUserFieldRow.css("display","table-row"))),g.downloadCartToCsvEnabled&&(z(),e.yuduOn(D,i.clickAction,lt),D.show()),u="orderItem-"+n.yuduBook.settings.id,g.formHeaderLabel&&(b.html(g.formHeaderLabel),b.removeClass("yudu_localisable")),g.sendOrderLabel&&(L.html(g.sendOrderLabel),L.removeClass("yudu_localisable")),g.showProduct||l(".yudu_product_code").remove(),g.showPrice){var t=l("#yudu_itemPriceHeading");t.html(t.html()+" ("+g.currency+")");var r=l("#yudu_priceHeading");r.html(r.html()+" ("+g.currency+")");var s=l("#yudu_totalPriceText");s.html(s.html()+" ("+g.currency+")")}else l("#yudu_itemPriceHeading").remove(),l("#yudu_priceHeading").remove(),l("#yudu_totalPriceRow").remove();if(g.showQuantity||l(".yudu_quantity").remove(),g.field1){tt().html(g.field1).insertBefore(t);tt().insertBefore(s)}if(g.field2){tt().html(g.field2).insertBefore(t);tt().insertBefore(s)}if(g.postageText&&l(".yudu_removeButton",S).html(g.postageText),g.postageLinkText&&(f=l(document.createElement("div")).attr("id","yudu_postageInfo"),g.postageLinkUrl?f.append(l(document.createElement("a")).attr("href",g.postageLinkUrl).attr("target","_blank").html(g.postageLinkText)):f.html(g.postageLinkText),f.insertAfter(I)),c.getItem(u)&&(j=JSON.parse(c.getItem(u))),!l.isEmptyObject(j)){Q();for(var o in j)if(j.hasOwnProperty(o)){var a=j[o].quantity?Number(j[o].quantity):1,h=Number(j[o].itemPrice);$(o,j[o].description,h,a,j[o][g.field1],j[o][g.field2]),R+=a*h,N+=a}C.html(R.toFixed(2)),ht({numberOfProducts:N})}e.yuduOn(y,"touchmove",function(t){t.preventDefault()}),e.yuduOn(_,"touchmove",function(t){(_[0].offsetHeight<_[0].scrollHeight||_[0].offsetWidth<_[0].scrollWidth)&&t.stopPropagation()})},B=function(){e.yuduOn(M.billingAddress1,"input",U(M.billingAddress1,M.deliveryAddress1)),e.yuduOn(M.billingAddress2,"input",U(M.billingAddress2,M.deliveryAddress2)),e.yuduOn(M.billingCity,"input",U(M.billingCity,M.deliveryCity)),e.yuduOn(M.billingState,"input",U(M.billingState,M.deliveryState)),e.yuduOn(M.billingPostCode,"input",U(M.billingPostCode,M.deliveryPostCode)),e.yuduOn(M.billingCountry,"input",U(M.billingCountry,M.deliveryCountry))},H=function(){M.billingAddress1.off("input"),M.billingAddress2.off("input"),M.billingCity.off("input"),M.billingState.off("input"),M.billingPostCode.off("input"),M.billingCountry.off("input")},U=function(t,e){return function(){e.val(t.val())}},z=function(){var t=document.createElement("form");t.setAttribute("method","POST");var e="?filename="+G();t.setAttribute("action",g.downloadCartToCsvUrl+e),t.setAttribute("id","downloadCartForm");var i=document.createElement("input");i.setAttribute("id","csvData"),i.setAttribute("name","csvData"),i.setAttribute("type","hidden");var n=document.createElement("button");n.setAttribute("id","yudu_downloadCartToCsv"),n.setAttribute("class","yudu_orderFormButton yudu_localisable"),n.setAttribute("type","button");var r=parseInt(L.attr("tabindex"))+1;n.setAttribute("tabindex",r),n.disabled=!0,n.textContent="orderForm.download",t.appendChild(i),t.appendChild(n),O.append(t),D=l(n),o.localiseHtml(t)},G=function(){var t=n.yuduBook.settings.shortName,e=new Date,i=e.getMonth();return i++,"cart-"+t+"-"+(e.getFullYear()+("0"+i).slice(-2)+e.getDate())+".csv"},W=function(t){r.setAllowKeyNavigation(!1),v.show(),e.emit("orderForm",e.SHOWHIDE_TOOLBAR,this,{show:!1}),y.slideDown(function(){_.scrollTop(0),Y(),e.subscribe(e.ALL,e.CLOSE_ACTIVE,V),t&&(p=setTimeout(q,t))})},q=function(){X(!0)},V=function(){X(!1)},X=function(t){clearTimeout(p),e.unsubscribe(e.ALL,e.CLOSE_ACTIVE,V),v.hide(),t?y.slideUp(function(){r.setAllowKeyNavigation(!0)}):(y.hide(),r.setAllowKeyNavigation(!0))},Y=function(){var t=b.height()+parseInt(b.css("margin-top"))+parseInt(b.css("margin-bottom")),e=l(".yudu_orderFormButton").height()+parseInt(O.css("margin-top"))+parseInt(O.css("margin-bottom")),n=0;f&&(n=f.height()+parseInt(f.css("margin-top"))+parseInt(f.css("margin-bottom")));var r=parseInt(y.css("padding-top"))+parseInt(y.css("padding-bottom"));_.css("max-height",i.canvasResizeHeight-t-e-n-r-(i.isDesktop?0:20)+"px"),Z()},Z=function(){var t=a.clamp(60,.1*l("body").width(),90);w.css("font-size",t+"%"),l(".inputField").css("font-size",t+10+"%"),l(".yudu_removeItem").css("font-size",t+10+"%")},Q=function(){I.toggle(),S.toggle(),E.toggle(),f&&f.toggle(),L.toggleClass("enabled"),P.toggleClass("enabled"),L[0].disabled=!L[0].disabled,P[0].disabled=!P[0].disabled,g.downloadCartToCsvEnabled&&(D.toggleClass("enabled"),D[0].disabled=!D[0].disabled),ht({toggleIcon:!0})},K=function(t){var e=et(t);l.isEmptyObject(j)&&Q();var i=!0;if(j[t]){if(i=!1,g.showQuantity){var r=Number(j[t].quantity)+1;j[t].quantity=r,document.getElementById(e+"Quantity").value=r,l(document.getElementById(e+"Price")).html((r*Number(j[t].itemPrice)).toFixed(2))}}else{var s=n.priceList[e].desc,o=Number(n.priceList[e].price);j[t]={description:s,itemPrice:o},g.showQuantity&&(j[t].quantity=1);var a,h;g.field1&&(a="",j[t][g.field1]=a),g.field2&&(h="",j[t][g.field2]=h),$(t,s,o,j[t].quantity,a,h)}(i||g.showQuantity)&&(R+=Number(j[t].itemPrice),C.html(R.toFixed(2)),N++,ht({numberOfProducts:N})),J(),W(3e3)},J=function(){c.setItem(u,JSON.stringify(j))},$=function(t,n,r,s,a,h){var c=et(t),u=l(document.createElement("div")).addClass("yudu_orderFormTableRow").attr("id",c);if(g.showProduct&&u.append(tt().html(t)),u.append(tt().addClass("yudu_description").html(n)),g.showQuantity){var d=l(document.createElement("input")).attr("value",s).addClass("inputField").attr("id",c+"Quantity");e.yuduOn(d,"focus",function(){m=j[t].quantity.toString()}),e.yuduOn(d,"input",function(){if(this.value.length>m.length){var i=this.value.slice(m.length,this.value.length);isNaN(i)?this.value=this.value.slice(0,m.length):this.value.length>9&&(this.value=this.value.slice(0,9))}m=this.value,e.yuduOn(l(this),"focusout",function(){l(this).off("focusout"),0==this.value.length&&(this.value=1),R-=Number(j[t].quantity)*Number(j[t].itemPrice),N-=Number(j[t].quantity),j[t].quantity=this.value,J();var e=Number(this.value)*Number(j[t].itemPrice);l(document.getElementById(c+"Price")).html(e.toFixed(2)),R+=e,C.html(R.toFixed(2)),N+=Number(this.value),ht({numberOfProducts:N})})}),d.keypress(function(t){13==t.which&&l(this).focusout()}),u.append(tt().html(d))}if(null!=a){var f=l(document.createElement("input")).attr("value",a).addClass("inputField");e.yuduOn(f,"focusout",function(){j[t][g.field1]=this.value,J()}),f.keypress(function(t){13==t.which&&l(this).focusout()}),u.append(tt().html(f))}if(null!=h){var p=l(document.createElement("input")).attr("value",h).addClass("inputField");e.yuduOn(p,"focusout",function(){j[t][g.field2]=this.value,J()}),p.keypress(function(t){13==t.which&&l(this).focusout()}),u.append(tt().html(p))}g.showPrice&&(u.append(tt().html(r.toFixed(2))),u.append(tt().attr("id",c+"Price").html((s*r).toFixed(2))));var v=l(document.createElement("button")).attr("type","button").addClass("yudu_removeItem").html(o.get("orderForm.removeItem"));e.yuduOn(v,i.clickAction,function(){it(t)}),u.append(tt().addClass("yudu_removeButton").html(v)),u.insertAfter(T)},tt=function(){return l(document.createElement("div")).addClass("yudu_orderFormTableCell")},et=function(t){return t.trim().replace(/ /g,"_").replace(/\./g,"_").toLowerCase()},it=function(t){var e=j[t].quantity?Number(j[t].quantity):1;R-=e*Number(j[t].itemPrice),C.html(R.toFixed(2)),N-=e,ht({numberOfProducts:N}),delete j[t],J();var i=et(t);l(document.getElementById(i)).remove(),l.isEmptyObject(j)&&Q()},nt=function(){j={},J(),R=0,N=0,w.empty(),w.append(T),w.append(S),e.yuduOn(E,i.clickAction,nt),Q()},rt=function(){w.toggle(),x.toggle(),P.toggle(),k.toggle(),L.toggle(),f&&f.toggle()},st=function(){d&&d.hide();var t={bookId:n.yuduBook.settings.id,currency:g.currency,customField1Name:g.field1,customField2Name:g.field2,totalPrice:R.toFixed(2),postage:g.postageText},e=i.getFromQuery("distributorId");e&&(t.distributorId=e);var r=[];for(var s in j){var o={productCode:s,description:j[s].description,price:Number(j[s].itemPrice).toFixed(2)};g.field1&&(o.customField1=j[s][g.field1]),g.field2&&(o.customField2=j[s][g.field2]),g.showQuantity?(o.quantity=j[s].quantity,o.quantityPrice=(Number(o.quantity)*Number(o.price)).toFixed(2)):o.quantityPrice=Number(o.price).toFixed(2),r.push(o)}t.orderItems=r,g.submitToCustomUrl||(t.name=M.name.val(),t.accountNumber=M.accountNumber.val(),t.phone=M.phone.val(),t.poNumber=M.poNumber.val(),t.email=M.email.val(),t.companyName=M.companyName.val(),t.customUserField1Name=M.customUserFieldName.text(),t.customUserField1=M.customUserField.val(),t.billingAddress1=M.billingAddress1.val(),t.billingAddress2=M.billingAddress2.val(),t.billingCity=M.billingCity.val(),t.billingState=M.billingState.val(),t.billingPostCode=M.billingPostCode.val(),t.billingCountry=M.billingCountry.val(),t.deliveryAddress1=M.deliveryAddress1.val(),t.deliveryAddress2=M.deliveryAddress2.val(),t.deliveryCity=M.deliveryCity.val(),t.deliveryState=M.deliveryState.val(),t.deliveryPostCode=M.deliveryPostCode.val(),t.deliveryCountry=M.deliveryCountry.val(),t.notes=M.deliveryNotes.val());var a=g.submitToCustomUrl?h.parseParameterisedUrl(g.customUrl):g.sendOrderFormUrl;l.ajax({url:a,type:"POST",dataType:"json",data:"json="+encodeURIComponent(JSON.stringify(t)),success:ot,error:at})},ot=function(t){switch(t.result){case"SUCCESS":if(V(),nt(),g.submitToCustomUrl){if(g.redirectUrl){var e=h.parseParameterisedUrl(g.redirectUrl);t.token&&(e+=-1==e.indexOf("?")?"?":"&",e+="token="+t.token),a.openURL(e,"_blank")}}else rt(),s.displayByCode("orderForm.success");return;case"EMAILADDRESSFAILURE":case"MISSINGDETAILSFAILURE":return void(d&&(d.text(o.get(t.error)),d.show()));default:return void s.displayByCode("orderForm.error")}},at=function(){V(),s.displayByCode("orderForm.genericError")},ht=function(t){window.yudu_commonSettings.toolbarLoaded?ct(t):e.subscribe(e.ALL,yudu_events.TOOLBAR.LOADED,function(){ct(t)})},ct=function(t){e.emit("orderForm",yudu_events.TOOLBAR.UPDATE_SHOPPING_CART_BUTTON,this,t)},lt=function(){var t=[];T.find(".yudu_orderFormTableCell:not(.yudu_removeButton)").each(function(){t.push(l(this).text())});var e=[t.join()];y.find(".yudu_orderFormTableRow").each(function(){var t=[];l(this).find(".yudu_orderFormTableCell:not(.yudu_removeButton)").each(function(){t.push(l(this).text()||l(this).find("input").val())}),e.push(t.join())}),l("#csvData").val(window.btoa(e.join("\n"))),l("#downloadCartForm").submit()};return{init:F,showForDuration:W,addItem:K}}),define("ui/rollover",["events","jquery","config","constants","resources","utils/tools","ui/orderForm"],function(t,e,i,n,r,s,o){var a=null,h=null,c=null,l=null,u=null,d=null,f=.75,g=1.15,p={left:"left",top:"top",right:"right",bottom:"bottom",centre:"centre"},m=function(t,e){var n,r;if(e==p.centre||e==p.top||e==p.bottom){var o=Math.max(0,t.x),a=Math.min(i.canvasResizeWidth,t.x+t.w);n=s.clamp(10,(a+o-30)/2,i.canvasResizeWidth-10)}else n=e==p.left?t.x-15:t.x+t.w-15;if(e==p.centre||e==p.left||e==p.right){var h=Math.max(0,t.y),c=Math.min(i.canvasResizeHeight,t.y+t.h);r=s.clamp(10,(c+h-30)/2,i.canvasResizeHeight-10)}else r=e==p.top?t.y-15:t.y+t.h-15;return{x:Math.round(n),y:Math.round(r)}},v=function(t,e){var n,r;if(t==p.left||t==p.right){var o=s.clamp(e.y-350+30+10,(i.canvasResizeHeight-350-30)/2,e.y-30-10);r=s.clamp(0,o,i.canvasResizeHeight-350),n=t==p.left?e.x-300-1:e.x+15+15}else{var a=s.clamp(e.x-300+30+10,(i.canvasResizeWidth-300-30)/2,e.x-10);n=s.clamp(0,a,i.canvasResizeWidth-300),r=t==p.top?e.y-350-1:e.y+15+15}return{x:Math.round(n),y:Math.round(r)}},y=function(t){function n(){return r=i.canvasResizeWidth-2*o,s=i.canvasResizeHeight-2*o,r/s<f?s=r/f:r/s>g&&(r=s*g),{box:{x:(i.canvasResizeWidth-r)/2,y:(i.canvasResizeHeight-s)/2,width:r,height:s},point:!1,fullScreen:!0}}var r=300,s=350,o=10;if(300>.75*i.canvasResizeWidth||350>.75*i.canvasResizeHeight||105e3>i.canvasResizeWidth*i.canvasResizeHeight*.3)return n();var a=t.getScreenDimensions(),h=T(a);if(!h)return n();var c=m(a,h.point),l=v(h.direction,c);return{point:c,box:e.extend(l,{width:r,height:s}),direction:h.direction}},b=function(t){var e=y(t);if(e.fullScreen)return void O();a.style.left=e.box.x+"px",a.style.top=e.box.y+"px",a.style.width=e.box.width+"px",a.style.height=e.box.height+"px",e.point&&S(e.direction,e.point.x,e.point.y)},_=function(t,i){if(l=t,null!=h){if(h==t.productCode)return void b(t);O()}h=t.productCode;var r=y(t);a=document.createElement("div"),a.className="yudu_rollover",a.style.borderRadius="10px",a.style.left=r.box.x+"px",a.style.top=r.box.y+"px",a.style.width=r.box.width+"px",a.style.height=r.box.height+"px";var s=document.createElement("iframe");s.id="yudu_rollover",s.src=n.rolloverTemplate,s.style.width=r.box.width+"px",s.style.height=r.box.height+"px",c=i,e(a).append(s),e("#yudu_reader").append(a),r.point&&S(r.direction,r.point.x,r.point.y),e(s).on("load",function(){C()})},w=function(t,e,n,r,s){for(var o=[{point:p.left,score:t-300,outOf:i.canvasResizeWidth},{point:p.right,score:i.canvasResizeWidth-(t+n)-300,outOf:i.canvasResizeWidth},{point:p.top,score:e-350,outOf:i.canvasResizeHeight},{point:p.bottom,score:i.canvasResizeHeight-(e+r)-350,outOf:i.canvasResizeHeight}],a=null,h=0,c=0,l=o.length;c<l;c++){var u=o[c].score/o[c].outOf;u>h&&(a=o[c].point,h=u)}return a?{direction:a,point:s||a}:null},T=function(t){if(t.x>i.canvasResizeWidth||t.y>i.canvasResizeHeight||t.x<-t.w||t.y<-t.h)return null;var e=w(t.x,t.y,t.w,t.h);return e||w(t.x+t.w/2,t.y+t.h/2,0,0,p.centre)},x=function(t,i,n,r){r=r||"#000";var s=document.createElement("div");switch(s.className="yudu_arrow",e(s).css({left:t+"px",top:i+"px","border-width":"15px"}),n){case p.bottom:s.style.borderBottomColor=r;break;case p.top:s.style.borderTopColor=r;break;case p.left:s.style.borderLeftColor=r;break;case p.right:s.style.borderRightColor=r}return s},S=function(t,i,n){u&&e(u).remove(),d&&e(d).remove();var r=i,s=i,o=n,h=n,c=e(a).css("background-color");switch(t){case p.right:r+=1,s+=2;break;case p.left:s-=1;break;case p.bottom:o+=1,h+=2;break;case p.top:o+=1}u=x(r,o,t),d=x(s,h,t,c),e("#yudu_reader").append(u),e("#yudu_reader").append(d)},C=function(){var t=e("#yudu_rollover").contents();if(c.name&&t.find("#productName").text(c.name),c.price){var i,n=Number(c.price);i=isNaN(n)?c.price:String(n.toFixed(2)),r.yuduBook.orderForm&&r.yuduBook.orderForm.currency&&(i=r.yuduBook.orderForm.currency+""+i),t.find("#productPrice").text(i)}if(c.desc&&t.find("#productDescription").text(c.desc),c.image){var s=t.find("#productImage"),o=new Image;o.src=c.image,s.append(o)}t.find("#cancelButton").bind("click touch",O),t.find("#purchaseButton").bind("click touch",E),document.getElementById("yudu_rollover").contentWindow.instantiated&&document.getElementById("yudu_rollover").contentWindow.instantiated()},E=function(){c&&(c.url?s.openURL(c.url,!0):i.orderFormEnabled&&o.addItem(h))},O=function(){a&&e(a).remove(),u&&e(u).remove(),d&&e(d).remove(),a=u=d=h=c=l=null},A=function(){l?b(l):O()};return t.subscribe(t.ALL,t.DRAG,O,!1),t.subscribe(t.ALL,t.TAP,O,!1),t.subscribe(t.ALL,t.RESIZE,O,!1),t.subscribe(t.ALL,t.PAGE_CHANGED,O,!1),t.subscribe(t.ALL,t.ZOOM,O,!1),t.subscribe(t.ALL,t.TWO_UP_CHANGED,O,!1),t.subscribe(t.ALL,t.FIT_CHANGED,O,!1),t.subscribe(t.ALL,t.SHIFTER_SPRINGING,A,!1),{activateRollover:_,killRollover:O,_private:{ArrowPoint:p,workoutRolloverPlacement:T,getScreenSpaceArrowOptions:w}}}),define("model/productOverlay",["events","config","resources","model/overlay","ui/rollover","utils/tools","ui/orderForm"],function(t,e,i,n,r,s,o){var a=function(t,a,h,c,l,u,d,f){n.Overlay.call(this,t,a,h,c,l,u,d,f),this.productCode=u["@t"],this.safeProductCode=this.productCode.trim().replace(/ /g,"_").replace(/\./g,"_").toLowerCase(),this.rectColour=e.productOverlayColour,this.defaultAlpha=e.transparentProductOverlays?0:e.overlayAlpha,this.isRollover=i.rollovers&&!!i.rollovers[this.safeProductCode],this.isProductLink=!this.isRollover&&i.priceList&&i.priceList[this.safeProductCode]&&!!i.priceList[this.safeProductCode].url,this.isProductOrderForm=!this.isRollover&&i.priceList&&i.priceList[this.safeProductCode]&&!!i.priceList[this.safeProductCode].price&&e.orderFormEnabled,this.isValid=this.isRollover||this.isProductLink||this.isProductOrderForm,this.init=function(){return this.createRectAndHitArea(),this.rect},this.mouseIn=function(){this.isMouseIn=!0,this.fadeIn(),this.isRollover&&!i.yuduBook.settings.rolloversAppearOnClick&&r.activateRollover(this,i.rollovers[this.safeProductCode])},this.clicked=function(){return this.isProductLink?void s.openURL(i.priceList[this.safeProductCode].url,!0):this.isProductOrderForm?void o.addItem(this.productCode):void(this.isRollover&&r.activateRollover(this,i.rollovers[this.safeProductCode]))}};return a.prototype=n.Overlay.prototype,{ProductOverlay:a,EMITTER_NAME:"productOverlay"}}),define("model/contentOverlay",["events","constants","config","model/overlay","utils/tools","utils/encryptedResourceFetchingUtils"],function(t,e,i,n,r,s){return{ContentOverlay:function(e,o,a,h,c,l,u,d){n.Overlay.call(this,e,o,a,h,c,l,u,d),this.triggerableId=l["@id"],this.triggerTargetId=l["@toId"],this.triggerAlternateContentSrc=l["@trAltCntnt"],this.transparent=1==l["@transparent"],this.showAlternateContent=!1,this.rectColour=i.contentOverlayColour,this.init=function(){return this.createRectAndHitArea(),this.transparent&&(this.rect.alpha=0,this.flash=this.fadeIn=this.fadeOut=function(){}),this.rect},this.clicked=function(){this.triggerTargetId&&this.rect.visible&&(this.triggerAlternateContentSrc&&this.toggleContent(),t.emit("contentOverlay",t.TRIGGER,this,{pageNumber:this.pageNumber,triggerTargetId:this.triggerTargetId}))},this.toggleContent=function(){this.showAlternateContent=!this.showAlternateContent,this.showAlternateContent?(this.createImageContainer(this.triggerAlternateContentSrc),this.flash=this.fadeIn=this.fadeOut=function(){}):(this.createRectAndHitArea(),this.transparent?(this.rect.alpha=0,this.flash=this.fadeIn=this.fadeOut=function(){}):(this.flash=n.Overlay.prototype.flash,this.fadeIn=n.Overlay.prototype.fadeIn,this.fadeOut=n.Overlay.prototype.fadeOut))},this.createImageContainer=function(e){this.rect=new createjs.Container;var i=t.callback(this,function(e){this.image=new createjs.Bitmap(e),this.image.image.onload=t.callback(this,this.rescaleImage)});s.useResourceAsCallbackArgument(e,i)},this.rescaleImage=function(){this.image.scaleX=this.width/this.image.image.width,this.image.scaleY=this.height/this.image.image.height,this.image.set({x:this.x,y:this.y}),this.rect.addChild(this.image)},this.handleTap=function(t){return!!this.rect.visible&&n.Overlay.prototype.handleTap.call(this,t)},
this.triggerToggle=function(){this.rect.visible=!this.rect.visible,this.triggerAutoPlay()},this.triggerOff=function(){this.rect.visible=!1},this.checkIfEventShouldDisableMedia=function(e,i){return!(this.showingPlaceHolder||r.isElementFullScreen(i)||e.type==t.TRIGGER&&this.rect.visible&&this.triggerableId==e.data.triggerTargetId)}},EMITTER_NAME:"contentOverlay"}}),define("ui/customControls",["events","config"],function(t,e){return{CustomControls:function(i,n,r){this.init=function(){this.rawControlsHeight=25,this.rawFontSize=10,this.rawFontMarginTop=7,this.rawProgressMarginTop=.5,this.rawCharacterWidth=5,this.parent=n,this.mediaElement=i,this.mediaElement.controls=!1,this.overlayWidth=r,this.createDOM(),this.resizeControls(),this.addCallbacks()},this.createDOM=function(){this.mediaDiv=document.createElement("div"),this.mediaDiv.className="media-wrapper",this.mediaDiv.appendChild(this.mediaElement),this.controlsDiv=document.createElement("div"),this.controlsDiv.className="custom-controls",this.playpause=document.createElement("button"),this.playpause.className="play-button",this.playpause.setAttribute("data-state","playing"),this.controlsDiv.appendChild(this.playpause),this.currentTime=document.createElement("div"),this.currentTime.className="time",this.controlsDiv.appendChild(this.currentTime),this.maxTime=document.createElement("div"),this.maxTime.className="time",this.controlsDiv.appendChild(this.maxTime),this.progressDiv=document.createElement("div"),this.progressDiv.className="progress",this.progress=document.createElement("progress"),this.progressDiv.appendChild(this.progress),this.progress.className="progress-bar",this.progress.setAttribute("value","0"),this.progress.setAttribute("min","0"),this.controlsDiv.appendChild(this.progressDiv),this.mute=document.createElement("button"),this.mute.className="mute-button",this.mute.setAttribute("data-state","notMuted"),this.controlsDiv.appendChild(this.mute),this.parent.appendChild(this.mediaDiv),this.parent.appendChild(this.controlsDiv)},this.resizeControls=function(){var t=this.densityConvertedPixels(this.rawControlsHeight),e=this.densityConvertedPixels(this.rawFontSize),i=this.densityConvertedPixels(this.rawFontMarginTop),n=this.densityConvertedPixels(this.rawProgressMarginTop);this.mediaDiv.style.height="calc(100% - "+t+")",this.controlsDiv.style.height=t,this.playpause.style.height=t,this.playpause.style.width=t,this.mute.style.height=t,this.mute.style.width=t,this.currentTime.style.height=t,this.currentTime.style.fontSize=e,this.currentTime.style.marginTop=i,this.maxTime.style.height=t,this.maxTime.style.fontSize=e,this.maxTime.style.marginTop=i,this.progressDiv.style.height=t,this.progressDiv.style.marginTop=n,this.resizeVariableControls()},this.resizeVariableControls=function(){var t=(this.maxTime.innerHTML.length>5?this.maxTime.innerHTML.length:5)*this.rawCharacterWidth;this.currentTime.style.width=this.densityConvertedPixels(t),this.maxTime.style.width=this.densityConvertedPixels(t),this.overlayWidth-2*this.rawControlsHeight-2*t<2*this.rawControlsHeight?this.progressDiv.style.width="0px":this.progressDiv.style.width="calc(99% - "+this.densityConvertedPixels(2*this.rawControlsHeight+2*t)+")"},this.densityConvertedPixels=function(t){return t*e.pixelDensity+"px"},this.addCallbacks=function(){t.yuduAddEventListener(this.playpause,"click",t.callback(this,this.onPlayPause)),t.yuduAddEventListener(this.mute,"click",t.callback(this,this.onMute)),t.yuduAddEventListener(this.progress,"click",t.callback(this,this.setProgress)),t.yuduAddEventListener(this.mediaElement,"loadedmetadata",t.callback(this,this.setProgressMax)),t.yuduAddEventListener(this.mediaElement,"timeupdate",t.callback(this,this.updateProgress)),t.yuduAddEventListener(this.mediaElement,"play",t.callback(this,this.changePlayPauseButtonState)),t.yuduAddEventListener(this.mediaElement,"pause",t.callback(this,this.changePlayPauseButtonState))},this.onPlayPause=function(){this.mediaElement.paused||this.mediaElement.stopped?this.mediaElement.play():this.mediaElement.pause()},this.onMute=function(){this.mediaElement.muted=!this.mediaElement.muted,this.mediaElement.muted?this.mute.setAttribute("data-state","muted"):this.mute.setAttribute("data-state","notMuted")},this.setProgressMax=function(){this.progress.setAttribute("max",this.mediaElement.duration),this.maxTime.innerHTML=" "+this.parseTime(this.mediaElement.duration),this.resizeVariableControls()},this.updateProgress=function(){this.progress.getAttribute("max")||this.setProgressMax(),this.progress.setAttribute("value",this.mediaElement.currentTime),this.currentTime.innerHTML=this.parseTime(this.mediaElement.currentTime)+"/"},this.setProgress=function(t){var e=t.offsetX/this.progress.offsetWidth;this.mediaElement.currentTime=e*this.mediaElement.duration},this.changePlayPauseButtonState=function(){this.mediaElement.paused||this.mediaElement.ended?this.playpause.setAttribute("data-state","notPlaying"):this.playpause.setAttribute("data-state","playing")},this.parseTime=function(t){var e=parseInt(t/3600,10)||0,i=parseInt(t/60%60,10)||0,n=parseInt(t%60,10)||0;return n=(n<10?"0":"")+n.toString(),i=(e>0&&i<10?"0":"")+i.toString()+":",(e=e>0?e.toString()+":":"")+i+n},this.init()}}}),define("model/audioOverlay",["events","constants","config","model/contentOverlay","utils/tools","ui/customControls"],function(t,e,i,n,r,s){return{AudioOverlay:function(o,a,h,c,l,u,d,f){n.ContentOverlay.call(this,o,a,h,c,l,u,d,f),this.src=u["@t"],this.autoPlay="1"==u["@ap"],this.beenPlayed=!1,this.showingPlaceHolder=!0,this.init=function(){return this.subscribeToInteractionEvents(t.callback(this,this.disableMedia)),this.setMinWidth(e.minAudioVideoWidth),this.createMediaPlaceHolder(),t.subscribe(t.ALL,t.RESIZE,t.callback(this,this.reposition),!1),this.triggerableId&&(this.rect.visible=!1),this.rect},this.onPlay=function(){this.beenPlayed=!0},this.triggerAutoPlay=function(){this.autoPlay&&this.rect.visible&&this.enableMedia()},this.flash=this.fadeIn=this.fadeOut=this.toggleContent=function(){},this.clicked=function(){this.rect.visible&&this.enableMedia()},this.enableMedia=function(){this.showingPlaceHolder&&(this.background.visible=!1,this.button.visible=!1,this.domElement||(this.domElement=document.createElement("div"),this.audioElement=this.createDOMMediaElement("audio",this.src),$(this.audioElement).css({width:"100%",height:"100%"}),this.interactiveOverlayContainer.appendChild(this.domElement),r.deviceType.isAndroid()?new s.CustomControls(this.audioElement,this.domElement,this.getScreenDimensions().w):this.domElement.appendChild(this.audioElement)),$(this.domElement).show(),this.showingPlaceHolder=!1,this.reposition(),this.audioElement.readyState<=2&&this.audioElement.load(),this.audioElement.play())},this.disableMedia=function(e){this.showingPlaceHolder||e.type==t.TRIGGER&&this.triggerableId==e.data.triggerTargetId&&this.rect.visible||(this.background.visible=!0,this.button.visible=!0,this.audioElement.pause(),$(this.domElement).hide(),this.showingPlaceHolder=!0)},this.reposition=function(){if(!this.showingPlaceHolder){var t=this.getScreenDimensions();$(this.domElement).css({position:"absolute",left:t.x*i.pixelDensity+"px",top:t.y*i.pixelDensity+"px",width:t.w*i.pixelDensity+"px",height:t.h*i.pixelDensity+"px"})}},this.triggerToggle=function(){this.rect.visible=!this.rect.visible,this.triggerAutoPlay()},this.triggerOff=function(){this.rect.visible=!1}}}}),define("model/videoOverlay",["events","constants","config","resources","model/contentOverlay","utils/tools","utils/statistics","ui/customControls"],function(t,e,i,n,r,s,o,a){var h=!1,c={absolute:0,percentage:0,finish:!1},l=!0,u=function(){var t;if(o.settings.eventSettings&&o.settings.eventSettings[o.events.video_milestone_reached]&&(t=o.settings.eventSettings[o.events.video_milestone_reached]),o.eventOverrides[o.events.video_milestone_reached]&&(l=!1),l&&t){if(t.absolute){var e=parseInt(t.absolute);!isNaN(e)&&e>0&&(c.absolute=e)}if(t.percentage){var i=parseInt(t.percentage);!isNaN(i)&&i>0&&(c.percentInt=i,c.percentage=i/100,c.finish=100%i==0)}}h=!0};return{VideoOverlay:function(n,l,d,f,g,p,m,v){r.ContentOverlay.call(this,n,l,d,f,g,p,m,v),h||u(),this.src=p["@t"],this.filename=p["@n"],this.altSrc=p["@altt"],this.altFilename=p["@altn"],this.autoPlay="1"==p["@ap"],this.beenPlayed=!1,this.duration=0,this.lastProgress=0,this.lastProgressWasPaused=!0,this.milestonePercentConverted=-1,this.domElement=!1,this.showingPlaceHolder=!0,this.init=function(){return this.setMinWidth(e.minAudioVideoWidth),this.createMediaPlaceHolder(),t.subscribe(t.ALL,t.RESIZE,t.callback(this,this.reposition),!1),this.triggerableId&&(this.rect.visible=!1),this.rect},this.onPlay=function(){this.beenPlayed?this.trackEvent({actionType:o.events.video_resumed}):(this.trackEvent({actionType:o.events.video_watched}),this.beenPlayed=!0)},this.triggerAutoPlay=function(){this.autoPlay&&this.rect.visible&&this.enableMedia()},this.flash=this.fadeIn=this.fadeOut=this.toggleContent=function(){},this.clicked=function(){this.rect.visible&&this.enableMedia()},this.enableMedia=function(){if(this.showingPlaceHolder){if(this.background.visible=!1,this.button.visible=!1,!this.domElement){if(this.videoElement=this.createDOMMediaElement("video",this.src,this.altSrc),t.yuduAddEventListener(this.videoElement,"timeupdate",t.callback(this,this.checkMilestoneProgress)),s.deviceType.isMetro()){var e=function(){this.videoElement.load()};t.yuduAddEventListener(this.videoElement,"ended",t.callback(this,e),!1)}s.deviceType.isAndroid()?(this.domElement=document.createElement("div"),new a.CustomControls(this.videoElement,this.domElement,this.getScreenDimensions().w)):this.domElement=this.videoElement,this.interactiveOverlayContainer.appendChild(this.domElement),this.subscribeToInteractionEvents(t.callback(this,function(t){this.checkIfEventShouldDisableMedia(t,this.videoElement)&&this.disableMedia()}))}$(this.domElement).show(),this.showingPlaceHolder=!1,this.reposition(),this.videoElement.readyState<=2&&this.videoElement.load(),this.videoElement.play()}},this.disableMedia=function(){this.background.visible=!0,this.button.visible=!0,this.videoElement.pause(),$(this.domElement).hide(),this.showingPlaceHolder=!0},this.checkMilestoneProgress=function(t){var e=this.videoElement.currentTime;return this.duration!=this.domElement.duration&&this.updateVideoMetadataCache(),this.videoElement.paused?(!this.lastProgressWasPaused&&this.lastProgress<this.duration&&e==this.duration&&(c.finish&&this.trackEvent({actionType:o.events.video_milestone_reached,extraInfo:"100%"}),this.trackEvent({actionType:o.events.video_finished})),this.lastProgress=e,void(this.lastProgressWasPaused=!0)):(this.lastProgressWasPaused=!1,e<=this.lastProgress?void(this.lastProgress=e):(c.absolute>0&&this.checkIfTimestampHasCrossedMultipleOfBoundary(this.lastProgress,e,c.absolute,!0),c.percentage>0&&this.milestonePercentConverted>0&&this.checkIfTimestampHasCrossedMultipleOfBoundary(this.lastProgress,e,this.milestonePercentConverted,!1),void(this.lastProgress=e)))},this.checkIfTimestampHasCrossedMultipleOfBoundary=function(t,e,i,n){if(t<=0||e<=0||i<=0)return!1;if(e%i<t%i){var r,s=Math.floor(e/i);return r=n?s*c.absolute+"s":s*c.percentInt+"%",this.trackEvent({actionType:o.events.video_milestone_reached,extraInfo:r}),!0}return!1},this.updateVideoMetadataCache=function(){this.duration=this.videoElement.duration,c.percentage>0&&(this.milestonePercentConverted=c.percentage*this.duration)},this.reposition=function(){if(!this.showingPlaceHolder){var t=this.getScreenDimensions();this.videoElement.width=t.w*i.pixelDensity,this.videoElement.height=t.h*i.pixelDensity,$(this.domElement).css({position:"absolute",left:t.x*i.pixelDensity+"px",top:t.y*i.pixelDensity+"px"})}},this.trackEvent=function(t){t.extraInfo?t.src=this.src:t.extraInfo=this.src,t.pageNumber=this.pageNumber,t.videoName=this.filename,o.action(t)},this.triggerToggle=function(){this.rect.visible=!this.rect.visible,this.triggerAutoPlay()},this.triggerOff=function(){this.rect.visible=!1}}}}),define("model/imageOverlay",["events","constants","config","model/contentOverlay","model/overlay"],function(t,e,i,n,r){return{ImageOverlay:function(t,e,i,s,o,a,h,c){n.ContentOverlay.call(this,t,e,i,s,o,a,h,c),this.src=a["@t"],this.image=null,this.init=function(){return this.createImageContainer(this.src),this.triggerableId&&(this.rect.visible=!1),this.rect},this.flash=this.fadeIn=this.fadeOut=function(){},this.handleTap=function(t){return!(!this.triggerTargetId||!this.rect.visible)&&r.Overlay.prototype.handleTap.call(this,t)},this.toggleContent=function(){this.showAlternateContent=!this.showAlternateContent,this.showAlternateContent?this.createImageContainer(this.triggerAlternateContentSrc):this.createImageContainer(this.src)},this.triggerToggle=function(){this.rect.visible=!this.rect.visible,this.triggerAutoPlay()},this.triggerOff=function(){this.rect.visible=!1}}}}),define("ui/uiTools",["jquery","config","constants","events","shared/utils/appUtils","shared/utils/stringUtils","utils/tools"],function(t,e,i,n,r,s,o){var a,h=0,c=r.nativeWrapperPrefixPrototcol,l=r.nativeWindowsAdditionalPrefixPrototcol,u=null,d=null,f=function(){null!=d&&"function"==typeof d&&d()};n.subscribe(n.ALL,n.CLOSE_LIGHTBOX,f,!0);var g=null,p=function(){var t=document.createElement("div");t.style.visibility="hidden",t.style.width="100px",t.style.msOverflowStyle="scrollbar",document.body.appendChild(t);var e=t.offsetWidth;t.style.overflow="scroll";var i=document.createElement("div");i.style.width="100%",t.appendChild(i);var n=i.offsetWidth;return t.parentNode.removeChild(t),e-n},m=function(){g=p()},v=function(t,e,i){var r=document.createElement("div");(t.indexOf("%")>0||e.indexOf("%")>=0)&&i?(n.subscribe(n.ALL,n.RESIZE,function(){y(r,t,e,i)},!0),y(r,t,e,i)):(r.style.width=t,r.style.height=e);var s=document.createElement("div");s.className="yudu_throbberWrapper",r.appendChild(s);for(var o=document.createElement("ul"),a=0;a<8;a++)o.appendChild(document.createElement("li"));return o.className="yudu_throbber",s.appendChild(o),r},y=function(i,n,r,s){n.indexOf("%")>0&&t(i).width(Math.floor(parseInt(n)*(e.isDesktop?s.width():e.canvasResizeWidth)/100)+"px"),r.indexOf("%")>0&&t(i).height(Math.floor(parseInt(r)*(e.isDesktop?s.height():e.canvasResizeHeight)/100)+"px"),u&&u(),S(i)},b=function(t,e){t.contentWindow.location.assign(e)},_=function(t,e,i){o.deviceType.isAndroid()&&top.location.assign(t),b(e,i)},w=function(i){var r,s=void 0!==i.width?i.width:"100%",a=void 0!==i.height?i.height:"100%",h=document.createElement("iframe");void 0!==i.callback&&(r=function(){i.callback()});var c=function(){r&&r(),o.isThisAnApp()&&n.yuduOn(t(h).contents().find("body"),e.clickAction,n.callback(this,l))};t(h).on("load",c);var l=function(){var t=this.contentWindow.location,e=t.href,i=this,n=0,r=setInterval(function(){n+=1;var t=i.contentWindow,s=t?t.location:null,o=s?s.href:null;o&&e!==o&&-1!==s.search.indexOf("yuduBrowser=inapp")?(clearInterval(r),_(o,i,e)):n>100&&clearInterval(r)}.bind(i,e),10)};h.src=void 0!==i.src?i.src:"about:blank",void 0!==i.bgColour&&(h.style.backgroundColor="#"+i.bgColour);var u=void 0!==i.interactionEnabled&&i.interactionEnabled,d=void 0===i.supportIosScrolling||i.supportIosScrolling,f=navigator.userAgent;if(f.match(/(iPad|iPhone|iPod)/g)){h.style.width="100%",h.style.height="100%";var g=document.createElement("div");g.style.height="100%",g.style.overflowY="auto",g.appendChild(h);var p=document.createElement("div");p.style.width=s,p.style.height=a,p.style.overflow=u?"auto":"hidden",d&&(p.style.WebkitOverflowScrolling="touch"),p.appendChild(g);return parseInt(/OS (\d+)/.exec(f)[1])>6&&x(p,null),p}return h.style.width=s,h.style.height=a,x(h,null),h},T=function(t){t.style.overflow="hidden",t.scrolling="no",t.frameBorder="0"},x=function(e,i){""==e.id&&(e.id="iframeElem"+h++);var n=i;i||(n="[scaleIframe]"+e.id+":"+(g+2));var r="iframe"==e.tagName.toLowerCase()?e:t("iframe",t(e))[0];try{r.contentWindow.postMessage(n,"*")}catch(e){t(r).on("load",function(){r.contentWindow.postMessage(n,"*")})}},S=function(e){var i,n=t(e);1>n.children().length||(i=n.children(".yudu_lightboxContent"),1==i.length&&x(i[0],"[passOnResize]"))},C=function(){return e.pixelDensity>=1.5},E=function(i){var r=t.isNumeric(i.w)?i.w:80,s=t.isNumeric(i.h)?i.h:80,o="function"!=typeof i.closeCallback?function(){}:i.closeCallback;a||(a=document.getElementById("yudu_lightboxBackground"),n.yuduOn(t(a),e.clickAction,function(t){A(i.animated,t)}));var h=v(r+"%",s+"%",t(a));h.className="yudu_lightboxContentContainer",i.animated?(h.style.backgroundColor="transparent",n.yuduOn(t(h),e.clickAction,function(t){A(!1,t)})):n.yuduOn(t(h),e.clickAction,function(t){t.stopPropagation()});var c={src:i.src,interactionEnabled:i.interactionEnabled,bgColour:i.bgColour,supportIosScrolling:i.supportIosScrolling};"function"==typeof i.callback&&(c.callback=i.callback);var l=w(c);if(l.className="yudu_lightboxContent",h.appendChild(l),a.appendChild(h),d=function(t){A(i.animated,t),o()},i.addCloseButton){var f=(r+100)/2,g=(s+100)/2,p=O(f,g,d);t(a).append(p)}return u=function(){h.style.left=((e.isDesktop?t(a).width():e.canvasResizeWidth)-t(h).width())/2+"px",h.style.top=((e.isDesktop?t(a).height():e.canvasResizeHeight)-t(h).height())/2+"px"},u(),a},O=function(r,s,o){var a=t('<button type="button" class="closeControl" tabindex="-1" id="close"></button>');e.isDesktop||a.addClass("touchControl");var h=i.toolbarIconBasePath+(C()?i.toolbarIconHighResPrefix:"")+"close"+i.toolbarIconFileExtension;return a.css({"background-image":"url("+h+")",width:"24px",height:"24px",left:r+"%",bottom:s+"%"}),n.yuduOn(a,e.clickAction,o),a},A=function(e,i){i&&(i.stopPropagation(),i.preventDefault()),u=null,d=null,e?t(a).fadeOut(500,function(){a.innerHTML=""}):(t(a).hide(),a.innerHTML="")},P=function(i){if("string"==typeof i.data){var o="[scaleLightboxIframe]"==i.data.substr(0,"[scaleLightboxIframe]".length);if("hideLightbox"==i.data)A(!1);else if("hideLightboxAnimated"==i.data)A(!0);else if("finishedLoadingEditionList"==i.data)t(".yudu_lightboxContent",t(a)).hide(),t(".yudu_lightboxContent",t(a)).css("visibility","visible"),t(".yudu_throbberWrapper",t(a)).hide(),t(".yudu_lightboxContent",t(a)).fadeIn(500),n.yuduOn(t(".yudu_lightboxContentContainer",t(a)),e.clickAction,function(t){t.stopPropagation()});else if(s.startsWith(i.data,"[scaleIframe]")||o){var h=k(i.data);if(0!=h.width){var u,d,f=t(h.iframe);if(o){var p=f.parents(".yudu_lightboxContentContainer");u=p.width(),d=p.height()}else u=f.width(),d=f.height();var m="iframe"==f[0].tagName.toLowerCase()?f:t("iframe",f),v=h.width,y=u/v,b=d/y,_=h.height-b;_>=0&&_<=g?(y=d/h.height,v=u/y,b=h.height):_>g&&"no"!=m[0].scrolling&&(y=u/(h.width+g),v=h.width+g,b=d/y),f.width(v),f.height(b),function(t,e){var i="scale("+e+")";t.css("-webkit-transform",i),t.css("-moz-transform",i),t.css("-ms-transform",i),t.css("-transform",i);t.css("-webkit-transform-origin","0 0 0"),t.css("-moz-transform-origin","0 0 0"),t.css("-ms-transform-origin","0 0 0"),t.css("-transform-origin","0 0 0")}(f,y)}}else if(s.startsWith(i.data,"[clickOccur]")){var h=L(i.data);if(!h.iframe)return;var w=t(h.iframe),T=h.iframe.getBoundingClientRect(),x=T.left+T.width*h.x/w.width(),S=T.top+T.height*h.y/w.height();n.emit("uiTools",n.TAP,this,{center:{pageX:x,pageY:S},stopDetect:function(){}})}else if(s.startsWith(i.data,c)||s.startsWith(i.data,l+c)){var C=r.parseMessage(i.data);"yudu"===C.prefix&&(C.origin===r.targets.articleView?n.emit("uiTools",n.MESSAGE_RECEIVED_FROM_ARTICLE_VIEW,this,C):n.emit("uiTools",n.YUDU_PREFIXED_MESSAGE_RECEIVED,this,C))}}},k=function(t){var e=t.split("]")[1],i=e.split(":");return{iframe:document.getElementById(i[0]),id:i[0],width:parseInt(i[1]),height:parseInt(i[2])}},L=function(t){var e=t.substr("[clickOccur]".length).split(":");return{iframe:document.getElementById(e[0]),id:e[0],x:parseInt(e[1]),y:parseInt(e[2])}};return n.yuduAddEventListener(window,"message",P),{createThrobber:v,createIframe:w,shouldUseHighRes:C,hideIframeScrollBars:T,createIframeLightbox:E,hideLightbox:A,setScrollbarWidth:m,enableScrollingWithoutDocumentBouncing:function(e){var i;e=t(e),n.yuduOn(e,"touchstart",function(t){i=t.originalEvent.touches[0].clientY}),n.yuduOn(e,"touchmove",function(t){var n=parseInt(e.css("padding-top")),r=parseInt(e.css("padding-bottom")),s=t.originalEvent.touches[0].clientY;e.scrollTop()+e.height()+n+r==e[0].scrollHeight&&s<i||0==e.scrollTop()&&s>i||t.stopPropagation(),i=s}),n.yuduOn(e,"touchend",function(){i=void 0})}}}),define("model/htmlOverlay",["resources","model/overlay","events","ui/uiTools","utils/tools","jquery"],function(t,e,i,n,r,s){var o=!1,a=function(h,c,l,u,d,f,g,p){e.Overlay.call(this,h,c,l,u,d,f,g,p),this.url=f["@url"],this.src=f["@src"],this.interactionEnabled="true"===f["@interactionEnabled"],this.requiresUserCredentials="true"===f["@requiresUserCredentials"],this.triggerableId=f["@id"],this.iframe=null,this.iframeAttached=!1,this.lastMessage=null,this.extraQueryString=f.extraQueryString,this.extraQueryString&&(this.url=this.url?r.addQueryStringToURL(this.url,this.extraQueryString):this.url,this.src=this.src?r.addQueryStringToURL(this.src,this.extraQueryString):this.src),this.isInDom=!1,this.isActive=!1,this.init=function(){return i.subscribe(i.ALL,i.PAGE_CHANGED,i.callback(this,this.pageChanged),!1),this.rect=new createjs.Container,this.rect.x=this.x,this.rect.y=this.y,this.isActive=!1,this.isInDom=!1,this.triggerableId||this.createHtmlContainer(),this.rect},this.removeHtmlContent=function(){this.domElement&&(s(this.domElement).remove(),this.domElement=null),this.rect&&this.rect.removeAllChildren(),this.isActive=!1,this.isInDom=!1,this.iframe=null,this.iframeAttached=!1,this.lastMessage=null,this.unsubscribeFromSendCredentialsCallback()},this.receiveMessage=function(t){t.source===this.iframe.contentWindow&&"overlayAttached"==t.data&&(this.lastMessage&&(this.iframe.contentWindow.postMessage(this.lastMessage,"*"),this.lastMessage=null),this.iframeAttached=!0)},this.sendCredentials=function(){if(this.requiresUserCredentials&&this.iframe.contentWindow){var e=window.yudu_readerApi.getCredentials(),i=t.yuduBook.settings.introPage?0:1,n={editionTitle:t.yuduBook.settings.name,editionId:t.yuduBook.settings.id,editionCurrentPage:g+i};e.username&&e.password?this.iframe.contentWindow.postMessage({messageName:"userCredentialsAvailable",username:e.username,password:e.password,context:n},"*"):this.iframe.contentWindow.postMessage({messageName:"userCredentialsNotAvailable"},"*")}},this.sendCredentialsCallback=i.callback(this,this.sendCredentials),this.unsubscribeFromSendCredentialsCallback=i.callback(this,function(){i.unsubscribe(i.ALL,i.PUBLIC_API_LOGIN_STATE_CHANGED,this.sendCredentialsCallback)}),this.createHtmlContainer=function(){this.isActive=!0,this.isInDom=!1,i.yuduAddEventListener(window,"message",i.callback(this,this.receiveMessage),!1),this.domElement=n.createThrobber(this.width+"px",this.height+"px"),this.htmlContent=n.createIframe({width:this.width+"px",height:this.height+"px",callback:i.callback(this,function(){setTimeout(i.callback(this,function(){s(".yudu_throbberWrapper",s(this.domElement)).hide(),s(this.htmlContent).css("visibility","visible")}),100),this.sendCredentials(),i.subscribe(i.ALL,i.PUBLIC_API_LOGIN_STATE_CHANGED,this.sendCredentialsCallback)}),src:this.url?this.url:this.src,interactionEnabled:this.interactionEnabled}),s(this.htmlContent).css("visibility","hidden"),this.iframe="iframe"==this.htmlContent.tagName.toLowerCase()?this.htmlContent:s("iframe",s(this.htmlContent))[0],this.domElement.appendChild(this.htmlContent),this.interactionEnabled||n.hideIframeScrollBars(s("iframe",this.domElement)[0]),this.rect.addChildAt(new createjs.DOMElement(this.domElement)),this.toggleVisibility()},this.pageChanged=function(){this.isActive&&this.toggleVisibility()},this.sendMessage=function(t){this.iframeAttached?this.iframe.contentWindow.postMessage(t,"*"):this.lastMessage=t},this.toggleVisibility=function(){o.isPageShowing(g)?(this.addToDom(!0),s(this.domElement).show(),this.sendMessage("overlayVisible")):(this.addToDom(!1),this.isInDom&&s(this.domElement).hide(),this.sendMessage("overlayNotVisible"))},this.addToDom=function(t){this.isInDom||!t&&!o.isPageInTray(g)||(this.isInDom=!0,this.interactionEnabled?this.interactiveOverlayContainer.appendChild(this.domElement):this.overlayContainer.appendChild(this.domElement))},this.flash=this.fadeIn=this.fadeOut=function(){},this.handleTap=function(t){return!(this instanceof a)&&e.Overlay.prototype.handleTap.call(this,t)},this.hide=function(){this.rect&&this.isActive&&this.isInDom&&(this.domElement.style.WebkitTransform="translate(0px, -9999px)",this.domElement.style.transform="translate(0px, -9999px)")},this.triggerToggle=function(){this.rect&&(this.isActive?this.isInDom&&this.removeHtmlContent():this.createHtmlContainer())},this.triggerOff=function(){this.removeHtmlContent()}};return{HtmlOverlay:a,setShifter:i.callback(this,function(t){o=t})}}),define("model/launchableHtmlOverlay",["events","config","model/overlay","model/htmlOverlay","ui/uiTools","utils/encryptedResourceFetchingUtils"],function(t,e,i,n,r,s){return{LaunchableHtmlOverlay:function(o,a,h,c,l,u,d,f){n.HtmlOverlay.call(this,o,a,h,c,l,u,d,f),this.imageSrc=u["@imageSrc"],this.hoverImageSrc=u["@hoverImageSrc"],this.rectColour=e.launchableHtmlOverlayColour,this.init=function(){return this.imageSrc?(this.createImageContainer(),this.hoverImageSrc&&this.createHoverImageContainer()):this.createRectAndHitArea(),this.rect},this.createImageContainer=function(){this.checkForContainer();var e=t.callback(this,function(e){this.image=new createjs.Bitmap(e),this.image.image.onload=t.callback(this,this.rescaleImage,this.image,!0)});s.useResourceAsCallbackArgument(this.imageSrc,e)},this.createHoverImageContainer=function(){this.checkForContainer();var e=t.callback(this,function(e){this.hoverImage=new createjs.Bitmap(e),this.hoverImage.image.onload=t.callback(this,this.rescaleImage,this.hoverImage,!1)});s.useResourceAsCallbackArgument(this.hoverImageSrc,e)},this.rescaleImage=function(t,e){t.scaleX=this.width/t.image.width,t.scaleY=this.height/t.image.height,t.set({x:this.x,y:this.y}),this.rect.addChild(t),e||(t.alpha=0)},this.checkForContainer=function(){this.rect||(this.rect=new createjs.Container)},this.clicked=function(){this.showContent()},this.showContent=function(){this.createContent(),$(this.domElement).show()},this.createContent=function(){var e={w:80,h:80,callback:t.callback(this,function(){$(".yudu_throbberWrapper",$(this.domElement)).hide(),$(".yudu_lightboxContent",$(this.domElement)).css("visibility","visible"),this.iframe=$(this.domElement).find("iframe")[0],this.sendCredentials(),t.subscribe(t.ALL,t.PUBLIC_API_LOGIN_STATE_CHANGED,this.sendCredentialsCallback)}),src:this.url?this.url:this.src,interactionEnabled:this.interactionEnabled,addCloseButton:!0,animated:!1,closeCallback:this.unsubscribeFromSendCredentialsCallback};this.domElement=r.createIframeLightbox(e),this.interactionEnabled||(this.disableUserInteractionWithIframe("80%","80%"),t.yuduOn($(this.cover),"click touchstart",t.callback(this,this.stopPropagation)),this.cover.style.position="fixed",this.cover.style.top="10%",this.cover.style.right="10%"),this.cover&&this.domElement.appendChild(this.cover)},this.disableUserInteractionWithIframe=function(t,e){r.hideIframeScrollBars($("iframe",this.domElement)[0]),this.cover=document.createElement("div"),this.cover.style.width=t,this.cover.style.height=e,this.cover.style.opacity="0",this.cover.style.backgroundColor="black"},this.flash=function(){this.imageSrc||i.Overlay.prototype.flash.call(this)},this.fadeIn=function(){this.imageSrc?this.hoverImageSrc&&(this.hoverImage.alpha=1,this.image.alpha=0):i.Overlay.prototype.fadeIn.call(this)},this.fadeOut=function(){this.imageSrc?this.hoverImageSrc&&(this.hoverImage.alpha=0,this.image.alpha=1):i.Overlay.prototype.fadeOut.call(this)},this.stopPropagation=function(t){t.stopPropagation(),t.preventDefault()}}}}),define("model/urlContentOverlay",["events","constants","config","model/contentOverlay","ui/uiTools","utils/tools","jquery"],function(t,e,i,n,r,s,o){var a=0,h=document.createElement("script");return h.src="https://www.youtube.com/iframe_api",o("head").append(h),{UrlContentOverlay:function(h,c,l,u,d,f,g,p){n.ContentOverlay.call(this,h,c,l,u,d,f,g,p),this.src="https://www.youtube.com/embed/"+s.getYouTubeUrlPattern().exec(f["@t"])[1]+"?enablejsapi=1",this.autoPlay="1"==f["@ap"],this.domElement=!1,this.showingPlaceHolder=!0,this.beenPlayed=!1,this.loaded=!1,this.init=function(){return this.subscribeToInteractionEvents(t.callback(this,function(t){this.checkIfEventShouldDisableMedia(t)&&this.disableMedia()})),this.setMinWidth(e.minAudioVideoWidth),this.createMediaPlaceHolder(),t.subscribe(t.ALL,t.RESIZE,t.callback(this,this.reposition),!1),this.triggerableId&&(this.rect.visible=!1),this.rect},this.flash=this.fadeIn=this.fadeOut=this.toggleContent=function(){},this.clicked=function(){this.rect.visible&&this.enableMedia()},this.enableMedia=function(){this.showingPlaceHolder&&(this.background.visible=!1,this.button.visible=!1,this.domElement||this.createHtmlContainer(),this.domElement.parentNode!=this.interactiveOverlayContainer?(this.interactiveOverlayContainer.appendChild(this.domElement),i.isDesktop&&(this.player=new YT.Player(this.iframeId,{events:{onReady:t.callback(this,this.onPlayerReady)}}))):o(this.domElement).show(),this.showingPlaceHolder=!1,this.loaded&&i.isDesktop&&this.player.playVideo(),this.reposition())},this.createHtmlContainer=function(){this.domElement=r.createThrobber(this.width+"px",this.height+"px"),this.htmlContent=r.createIframe({callback:t.callback(this,function(){o(".yudu_throbberWrapper",o(this.domElement)).hide(),o(this.htmlContent).show()}),src:this.src,interactionEnabled:!0,bgColour:"FFFFFF"}),this.htmlContent.style.display="none",this.domElement.appendChild(this.htmlContent),this.iframeId="YTvideo"+a++,o("iframe",this.domElement).attr("id",this.iframeId)},this.onPlayerReady=function(){this.beenPlayed=!0,this.loaded=!0,i.isDesktop&&this.player.playVideo()},this.disableMedia=function(){this.background.visible=!0,this.button.visible=!0,this.loaded&&i.isDesktop&&this.player.pauseVideo(),i.isDesktop?o(this.domElement).hide():this.interactiveOverlayContainer.removeChild(this.domElement),this.showingPlaceHolder=!0},this.reposition=function(){if(!this.showingPlaceHolder){var t=this.getScreenDimensions();this.domElement.style.width=t.w*i.pixelDensity+"px",this.domElement.style.height=t.h*i.pixelDensity+"px",o(this.domElement).css({position:"absolute",left:t.x*i.pixelDensity+"px",top:t.y*i.pixelDensity+"px"})}},this.triggerAutoPlay=function(){this.autoPlay&&this.rect.visible&&this.enableMedia()},this.triggerToggle=function(){this.rect.visible=!this.rect.visible,this.triggerAutoPlay()},this.triggerOff=function(){this.rect.visible=!1}}}}),define("controllers/tray",["config","constants","easel","events","utils/tools","fetching/fetchHandler"],function(t,e,i,n,r,s){var o={default:"default",pinching:"pinch",interstitial:"inters",zooming:"zoom"};return{Tray:function(){var r=this;this.pages=[],this.fakePages=[],this.container=new i.Container,this.length=0,this.currentZoomStateIndex=0,this.zoomStates=null,this.basePage=null,this.state=o.default,this.isCentre=!1,this.touchState=null,this.setPages=function(t,e){if(!t)return void this.empty();if(!this.matchPages(t,e)){this.mapOverPages(function(t){t.overlayLevel.hide()}),this.basePage=t.getPageNumber(),this.currentZoomStateIndex=0,this.pages=[t],this.container.removeAllChildren(),e?(this.length=2,this.pages.push(e),this.container.addChild(e.getContainer()),t.resetAlignments(i.Alignment.RIGHT),t.overlayLevel.getContainer().mask=null,t.overlayLevel.setOverlaysHitArea(t.page.width,t.page.height),e.resetAlignments(i.Alignment.LEFT)):(this.length=1,t.resetAlignments(i.Alignment.CENTRE)),this.container.addChild(t.getContainer()),this.updateZoomStates()
;var n=this.zoomStates[this.currentZoomStateIndex];this.mapOverPages(function(t){t.prepareZoomLevel(n.z)}),this.resnapSize(),this.loadAllUnfetched(),this.defaultState()}},this.load=function(){if(!this.isEmpty()){s.newRequests();var t=this.zoomStates[this.currentZoomStateIndex];this.mapOverPages(function(e){e.zoomLevels[t.z].load()})}},this.setIsCentre=function(t){this.isCentre=t},this.loadAllUnfetched=function(){if(!this.isEmpty()&&this.isCentre){var t=this.zoomStates[this.currentZoomStateIndex];s.newRequests(),this.mapOverPages(function(e){s.loadTiles(e.zoomLevels[t.z],!1,!0)})}},this.isStateChangeAllowed=function(t,e){return t==o.default||e==o.default||(e==o.zooming||e==o.pinching&&t==o.interstitial)},this.defaultState=function(){this.state=o.default,this.touchState=null},this.tryChangeState=function(t){return this.state==t||!!this.isStateChangeAllowed(this.state,t)&&(this.state=t,!0)},this.getLowestZoomStateZ=function(){return this.zoomStates?this.zoomStates[0].z:0},this.getBasePage=function(){return this.basePage},this.generateRawStates=function(){for(var t=this.pages[0].zoomLevelCount,e=[],i=0,n=t;i<n;i++){var r=this.getRawContentSizeAtZoomLevel(i);e.push({z:i,scale:1,width:r.width,height:r.height})}return e},this.findLowestFittingZoomLevel=function(e){var i=0;if(t.fitOnlyWidth)for(;e[i].width<t.width&&i<e.length-1;)i++;else for(;e[i].height<t.height&&e[i].width<t.width&&i<e.length-1;)i++;return i},this.applyMinMaxZoomLevels=function(t,e,i){for(var n=0,r=t.length;n<r;n++)t[n].minScale=e/t[n].width,t[n].maxScale=i/t[n].width;return t},this.generateZoomStates=function(){if(!this.pages.length||!this.pages[0])return null;var e=[],i=this.generateRawStates(),n=this.findLowestFittingZoomLevel(i),r=i[n],s=t.width/r.width;t.fitOnlyWidth||(s=Math.min(s,t.height/r.height));var o=r.width*s/2;e.push({z:n,scale:s,width:r.width,height:r.height}),s>=.9&&(n+=1);for(var a=n,h=i.length;a<h;a++)r=i[a],e.push(r);t.disableExtraZoom||e.push({z:r.z,scale:2,width:r.width,height:r.height});var c=2*r.width*2;return this.applyMinMaxZoomLevels(e,o,c)},this.getRawContentSizeAtZoomLevel=function(t){var e=0,i=0;return this.mapOverPages(function(n){var r=n.zoomLevels[t].zoomLevel;e=Math.max(e,r.height),i+=r.width}),{width:i,height:e}},this.reposition=function(t){this.container.x=t},this.empty=function(){this.length=0,this.basePage=null,this.zoomStates=null,this.mapOverPages(function(t){t.overlayLevel.hide()}),this.pages=[],this.container.removeAllChildren()},this.show=function(){this.container.visible=!0},this.hide=function(){this.container.visible=!1},this.updateZoomStates=function(){this.zoomStates=this.generateZoomStates()},this.zoom=function(t,e,i,n){var r=Math.max(0,Math.min(this.currentZoomStateIndex+t,this.zoomStates.length-1));if(r!=this.currentZoomStateIndex)return void this.zoomTo(r,e,i,void 0,n);n()},this.zoomScale=function(e,i,n){if(this.tryChangeState(o.pinching)){var r=(i-t.width/2-this.container.x)/this.container.scaleX,s=(n-t.height/2-this.container.y)/this.container.scaleY,a=this.zoomStates[this.currentZoomStateIndex];this.container.scaleX=this.container.scaleY=Math.max(a.minScale,Math.min(e,a.maxScale));var h=this.container.localToGlobal(r,s),c=this.container.x+(i-h.x),l=this.container.y+(n-h.y);t.width,a.width,this.container.scaleX,t.height,a.height,this.container.scaleY;this.container.x=c,this.container.y=l}},this.zoomResolve=function(t,e){var i=this.zoomStates[this.currentZoomStateIndex].width*this.container.scaleX;if(this.currentZoomStateIndex>=this.zoomStates.length-2&&i>=this.zoomStates[this.currentZoomStateIndex].width&&this.container.scaleX<=2)return void this.tryChangeState(o.interstitial);for(var n=0,r=-100,s=0,a=this.zoomStates.length;s<a;s++){var h=this.zoomStates[s],c=h.width*h.scale,l=Math.abs(c-i);if((r<0||r>l)&&(r=l,n=s),c>i)break}this.zoomTo(n,t,e,!0)},this.areAnyPagesAnimating=function(){this.checkOverPages(function(t){return i.Tween.hasActiveTweens(t.getContainer())})},this.stopTweens=function(){i.Tween.removeTweens(this.container)},this.zoomTo=function(n,r,s,a,h){if(this.zoomStates&&(this.state!=o.zooming||a)&&this.tryChangeState(o.zooming)){var c=this.zoomStates[this.currentZoomStateIndex],l=this.zoomStates[n],u=l.width*l.scale/c.width,d=l.z!=c.z,f=u!=this.container.scale;if(!d&&!f)return!1;var g=(r-t.width/2-this.container.x)/this.container.scaleX,p=(s-t.height/2-this.container.y)/this.container.scaleY,m=this.container.x-g*(u-this.container.scaleX),v=this.container.y-p*(u-this.container.scaleY),y=this.boundPosition(m,v,l);d&&this.anticipatoryLoad(this.zoomStates[n],y.x-this.container.x,y.y-this.container.y),i.Tween.get(this.container).to({scaleX:u,scaleY:u,x:y.x,y:y.y},e.swapTweenTime,i.Ease.cubicInOut).call(function(t){this.defaultState(),this.currentZoomStateIndex=t,this.resnapSize(),this.load(),h()},[n],this)}},this.anticipatoryLoad=function(t,e,i){s.newRequests(),this.mapOverPages(function(n){n.prepareZoomLevel(t.z),n.zoomLevels[t.z].load(e,i)})},this.cancelTweens=function(){this.defaultState(),i.Tween.removeTweens(this.container)},this.canDrag=function(){return this.state!=o.zooming&&this.state!=o.pinching},this.resnapSize=function(){if(this.zoomStates){var t=this.zoomStates[this.currentZoomStateIndex];this.mapOverPages(function(e){e.endZoomOn(t.z)}),this.setScale(t.scale)}},this.setScale=function(t){this.defaultState(),this.container.scaleX=this.container.scaleY=t},this.handleMove=function(e,i){if(this.touchState?(this.touchState.dx+=e,this.touchState.dy+=i):this.touchState={dx:e,dy:i,canPassX:!1,canMove:!1},this.touchState.canMove){var n=this.container.x+e,r=this.boundPosition(n,this.container.y+i);return r.x==this.container.x&&r.y==this.container.y||this.load(),this.container.x=r.x,this.container.y=r.y,this.touchState.canPassX||!t.fitOnlyWidth?n-this.container.x:0}return this.touchState.dx*this.touchState.dx+this.touchState.dy*this.touchState.dy>20&&(this.touchState.canMove=!0,this.touchState.canPassX=Math.abs(this.touchState.dx)>Math.abs(this.touchState.dy)),0},this.moveEnd=function(){this.touchState=null},this.setToTop=function(){var t=this.getZoomBounds(),e=this.boundPosition(0,t.height);this.container.y=e.y},this.boundPosition=function(e,i,n){var r,s;if(n)r=n.width*n.scale/2,s=n.height*n.scale/2;else{var o=this.getZoomBounds();r=o.width/2,s=o.height/2}var a=r-Math.min(r,t.width/2),h=s-Math.min(s,t.height/2);return{x:Math.max(-a,Math.min(e,a)),y:Math.max(-h,Math.min(i,h))}},this.getZoomBounds=function(){var t=this.zoomStates[this.currentZoomStateIndex],e=this.state==o.interstitial?this.container.scaleX:t.scale;return{width:t.width*e,height:t.height*e}},this.resetZoom=function(){if(!this.isEmpty()&&this.zoomStates){this.cancelTweens();var t=this.zoomStates[0];this.mapOverPages(function(e){e.endZoomOn(t.z)}),this.setScale(t.scale)}},this.isEmpty=function(){return 0==this.length},this.findPage=function(t){for(var e=0,i=this.pages.length;e<i;e++)if(this.pages[e].getPageNumber()==t)return this.pages[e];return null},this.hasPage=function(t){return!!this.findPage(t)},this.matchPages=function(t,e){return t?e?this.hasPage(t)&&this.hasPage(e):this.hasPage(t):this.isEmpty()},this.triggerShow=function(){this.mapOverPages(function(t){t.triggerShow()})},this.handleTap=function(t){return this.checkOverPages(function(e){return e.handleTap(t)})},this.getScale=function(){return this.container.scaleX},this.generateRandomGreyishColour=function(){var t=Math.floor(31*Math.random()+219).toString(16);return"#"+t+t+t},this.addFakePages=function(e){if(!e||e<0)return 0;e=Math.min(40,e),this.currentZoomStateIndex=0,this.resnapSize();for(var n=this.zoomStates[this.currentZoomStateIndex],r=[],s=n.width/Math.max(1,Math.log(e)),o=.1*s,a=.2*s,h=a+t.width/2/n.scale,c=e*(s+o)+2*a,l=n.height,u=-l/2,d=0;d<e;d++){var f=new i.Shape,g=h+d*(s+o);f.graphics.beginFill(this.generateRandomGreyishColour()).drawRect(g,u,s,l),r.push(f),this.container.addChild(f)}return this.fakePages=r,c*n.scale},this.anim_fakePairToSingle=function(t,s){if(1!=this.pages.length)return!1;var o=this.zoomStates[this.currentZoomStateIndex];if(!o)return!1;var a=this.pages[0].getContainer();a.x=t?-o.width/2:o.width/2,i.Tween.get(a,{override:!0}).to({x:0},e.pageNumTransTime,i.Ease.cubicInOut).call(function(){n.callback(r,r.applyMaskToOverlayContainer)(),s()})},this.anim_fakeSingleToPair=function(t,n){if(2!=this.pages.length)return!1;var r=this.zoomStates[this.currentZoomStateIndex];if(!r)return!1;var s=t?0:1,o=this.pages[s].getContainer();o.x=t?r.width/4:-r.width/4,i.Tween.get(o,{override:!0}).to({x:0},e.pageNumTransTime,i.Ease.cubicInOut).call(n)},this.anim_fakeMoveToAdjacentTray=function(s,o){if(1!=this.pages.length)return!1;var a=this.zoomStates[this.currentZoomStateIndex];if(!a)return!1;var h=this.pages[0].getContainer(),c=t.width/a.scale-a.width/2;h.x=s?c:-c,i.Tween.get(h,{override:!0}).to({x:0},e.pageNumTransTime,i.Ease.cubicInOut).call(function(){n.callback(r,function(){r.pages[0].overlayLevel.hideAllTriggeredOverlaysAndRestoreTriggerMainContent(),r.applyMaskToOverlayContainer()})(),o()})},this.anim_fakeMoveFromAdjacentTray=function(n,r){if(2!=this.pages.length)return!1;var s=this.zoomStates[this.currentZoomStateIndex];if(!s)return!1;var o=n?0:1,a=this.pages[o].getContainer(),h=t.width/s.scale-s.width/2;a.x=n?-h:h,i.Tween.get(a,{override:!0}).to({x:0},e.pageNumTransTime,i.Ease.cubicInOut).call(r)},this.applyMaskToOverlayContainer=function(){this.pages.length>0&&(this.pages[0].overlayLevel.getContainer().mask=this.pages[0].mask,this.pages[0].overlayLevel.setOverlaysHitArea(this.pages[0].page.width,this.pages[0].page.height))},this.applyMaskToOverlayContainerIfNecessary=function(){1!=this.pages.length||this.pages[0].overlayLevel.getContainer().mask||this.applyMaskToOverlayContainer()},this.stopFakeAnimations=function(){this.mapOverPages(function(t){i.Tween.removeTweens(t.getContainer())}),1==this.pages.length&&this.applyMaskToOverlayContainer()},this.anim_wobble=function(t){var n=this.zoomStates[this.currentZoomStateIndex];if(!n)return!1;var r=e.pageNumTransTime/5,s=n.width/10;this.mapOverPages(function(e){var n=e.getContainer();i.Tween.get(n,{override:!0}).to({x:s},r,i.Ease.cubicInOut).to({x:-s/2},r,i.Ease.cubicInOut).to({x:s/5},r,i.Ease.cubicInOut).to({x:-s/10},r,i.Ease.cubicInOut).to({x:0},r,i.Ease.cubicInOut).call(t)})},this.anim_falseZoomIn=function(t){var n=e.pageNumTransTime/3,r=this.container.scaleX,s=.9*r;i.Tween.get(this.container).to({scaleX:s,scaleY:s},n,i.Ease.cubicInOut).to({scaleX:r,scaleY:r},n,i.Ease.cubicInOut).call(t)},this.removeFakePages=function(){for(var t=0,e=this.fakePages.length;t<e;t++)this.container.removeChild(this.fakePages.pop())},this.containsEncryptedPage=function(){return this.checkOverPages(function(t){return t.encrypted})},this.flashSearchOverlays=function(){this.mapOverPages(function(t){t.flashSearchOverlays()})},this.mapOverPages=function(t){for(var e=0,i=this.pages.length;e<i;e++)t(this.pages[e])},this.checkOverPages=function(t){for(var e=0,i=this.pages.length;e<i;e++)if(t(this.pages[e]))return!0;return!1}},EMITTER_NAME:"tray"}}),this.createjs=this.createjs||{},function(){var t=createjs.SoundJS=createjs.SoundJS||{};t.version="1.0.0",t.buildDate="Thu, 12 Oct 2017 16:34:05 GMT"}(),this.createjs=this.createjs||{},createjs.extend=function(t,e){"use strict";function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i},this.createjs=this.createjs||{},createjs.promote=function(t,e){"use strict";var i=t.prototype,n=Object.getPrototypeOf&&Object.getPrototypeOf(i)||i.__proto__;if(n){i[(e+="_")+"constructor"]=n.constructor;for(var r in n)i.hasOwnProperty(r)&&"function"==typeof n[r]&&(i[e+r]=n[r])}return t},this.createjs=this.createjs||{},createjs.deprecate=function(t,e){"use strict";return function(){var i="Deprecated property or method '"+e+"'. See docs for info.";return console&&(console.warn?console.warn(i):console.log(i)),t&&t.apply(this,arguments)}},this.createjs=this.createjs||{},createjs.indexOf=function(t,e){"use strict";for(var i=0,n=t.length;n>i;i++)if(e===t[i])return i;return-1},this.createjs=this.createjs||{},function(){"use strict";createjs.proxy=function(t,e){var i=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,Array.prototype.slice.call(arguments,0).concat(i))}}}(),this.createjs=this.createjs||{},function(){"use strict";function t(){throw"BrowserDetect cannot be instantiated"}var e=t.agent=window.navigator.userAgent;t.isWindowPhone=e.indexOf("IEMobile")>-1||e.indexOf("Windows Phone")>-1,t.isFirefox=e.indexOf("Firefox")>-1,t.isOpera=null!=window.opera,t.isChrome=e.indexOf("Chrome")>-1,t.isIOS=(e.indexOf("iPod")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1)&&!t.isWindowPhone,t.isAndroid=e.indexOf("Android")>-1&&!t.isWindowPhone,t.isBlackberry=e.indexOf("Blackberry")>-1,createjs.BrowserDetect=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(){this._listeners=null,this._captureListeners=null}var e=t.prototype;t.initialize=function(t){t.addEventListener=e.addEventListener,t.on=e.on,t.removeEventListener=t.off=e.removeEventListener,t.removeAllEventListeners=e.removeAllEventListeners,t.hasEventListener=e.hasEventListener,t.dispatchEvent=e.dispatchEvent,t._dispatchEvent=e._dispatchEvent,t.willTrigger=e.willTrigger},e.addEventListener=function(t,e,i){var n;n=i?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var r=n[t];return r&&this.removeEventListener(t,e,i),r=n[t],r?r.push(e):n[t]=[e],e},e.on=function(t,e,i,n,r,s){return e.handleEvent&&(i=i||e,e=e.handleEvent),i=i||this,this.addEventListener(t,function(t){e.call(i,t,r),n&&t.remove()},s)},e.removeEventListener=function(t,e,i){var n=i?this._captureListeners:this._listeners;if(n){var r=n[t];if(r)for(var s=0,o=r.length;o>s;s++)if(r[s]==e){1==o?delete n[t]:r.splice(s,1);break}}},e.off=e.removeEventListener,e.removeAllEventListeners=function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null},e.dispatchEvent=function(t,e,i){if("string"==typeof t){var n=this._listeners;if(!(e||n&&n[t]))return!0;t=new createjs.Event(t,e,i)}else t.target&&t.clone&&(t=t.clone());try{t.target=this}catch(t){}if(t.bubbles&&this.parent){for(var r=this,s=[r];r.parent;)s.push(r=r.parent);var o,a=s.length;for(o=a-1;o>=0&&!t.propagationStopped;o--)s[o]._dispatchEvent(t,1+(0==o));for(o=1;a>o&&!t.propagationStopped;o++)s[o]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return!t.defaultPrevented},e.hasEventListener=function(t){var e=this._listeners,i=this._captureListeners;return!!(e&&e[t]||i&&i[t])},e.willTrigger=function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.parent}return!1},e.toString=function(){return"[EventDispatcher]"},e._dispatchEvent=function(t,e){var i,n,r=2>=e?this._captureListeners:this._listeners;if(t&&r&&(n=r[t.type])&&(i=n.length)){try{t.currentTarget=this}catch(t){}try{t.eventPhase=0|e}catch(t){}t.removed=!1,n=n.slice();for(var s=0;i>s&&!t.immediatePropagationStopped;s++){var o=n[s];o.handleEvent?o.handleEvent(t):o(t),t.removed&&(this.off(t.type,o,1==e),t.removed=!1)}}2===e&&this._dispatchEvent(t,2.1)},createjs.EventDispatcher=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i){this.type=t,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=!!e,this.cancelable=!!i,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}var e=t.prototype;e.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0},e.stopPropagation=function(){this.propagationStopped=!0},e.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},e.remove=function(){this.removed=!0},e.clone=function(){return new t(this.type,this.bubbles,this.cancelable)},e.set=function(t){for(var e in t)this[e]=t[e];return this},e.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i){this.Event_constructor("error"),this.title=t,this.message=e,this.data=i}createjs.extend(t,createjs.Event).clone=function(){return new createjs.ErrorEvent(this.title,this.message,this.data)},createjs.ErrorEvent=createjs.promote(t,"Event")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e){this.Event_constructor("progress"),this.loaded=t,this.total=null==e?1:e,this.progress=0==e?0:this.loaded/this.total}createjs.extend(t,createjs.Event).clone=function(){return new createjs.ProgressEvent(this.loaded,this.total)},createjs.ProgressEvent=createjs.promote(t,"Event")}(window),this.createjs=this.createjs||{},function(){"use strict";function t(){this.src=null,this.type=null,this.id=null,this.maintainOrder=!1,this.callback=null,this.data=null,this.method=createjs.Methods.GET,this.values=null,this.headers=null,this.withCredentials=!1,this.mimeType=null,this.crossOrigin=null,this.loadTimeout=i.LOAD_TIMEOUT_DEFAULT}var e=t.prototype={},i=t;i.LOAD_TIMEOUT_DEFAULT=8e3,i.create=function(e){if("string"==typeof e){var n=new t;return n.src=e,n}if(e instanceof i)return e;if(e instanceof Object&&e.src)return null==e.loadTimeout&&(e.loadTimeout=i.LOAD_TIMEOUT_DEFAULT),e;throw new Error("Type not recognized.")},e.set=function(t){for(var e in t)this[e]=t[e];return this},createjs.LoadItem=i}(),this.createjs=this.createjs||{},function(){var t={};t.POST="POST",t.GET="GET",createjs.Methods=t}(),this.createjs=this.createjs||{},function(){var t={};t.BINARY="binary",t.CSS="css",t.FONT="font",t.FONTCSS="fontcss",t.IMAGE="image",t.JAVASCRIPT="javascript",t.JSON="json",t.JSONP="jsonp",t.MANIFEST="manifest",t.SOUND="sound",t.VIDEO="video",t.SPRITESHEET="spritesheet",t.SVG="svg",t.TEXT="text",t.XML="xml",createjs.Types=t}(),function(){var t={};t.a=function(){return t.el("a")},t.svg=function(){return t.el("svg")},t.object=function(){return t.el("object")},t.image=function(){return t.el("image")},t.img=function(){return t.el("img")},t.style=function(){return t.el("style")},t.link=function(){return t.el("link")},t.script=function(){return t.el("script")},t.audio=function(){return t.el("audio")},t.video=function(){return t.el("video")},t.text=function(t){return document.createTextNode(t)},t.el=function(t){return document.createElement(t)},createjs.Elements=t}(),function(){var t={container:null};t.appendToHead=function(e){t.getHead().appendChild(e)},t.appendToBody=function(e){if(null==t.container){t.container=document.createElement("div"),t.container.id="preloadjs-container";var i=t.container.style;i.visibility="hidden",i.position="absolute",i.width=t.container.style.height="10px",i.overflow="hidden",i.transform=i.msTransform=i.webkitTransform=i.oTransform="translate(-10px, -10px)",t.getBody().appendChild(t.container)}t.container.appendChild(e)},t.getHead=function(){return document.head||document.getElementsByTagName("head")[0]},t.getBody=function(){return document.body||document.getElementsByTagName("body")[0]},t.removeChild=function(t){t.parent&&t.parent.removeChild(t)},t.isImageTag=function(t){return t instanceof HTMLImageElement},t.isAudioTag=function(t){return!!window.HTMLAudioElement&&t instanceof HTMLAudioElement},t.isVideoTag=function(t){return!!window.HTMLVideoElement&&t instanceof HTMLVideoElement},createjs.DomUtils=t}(),function(){var t={};t.isBinary=function(t){switch(t){case createjs.Types.IMAGE:case createjs.Types.BINARY:return!0;default:return!1}},t.isText=function(t){switch(t){case createjs.Types.TEXT:case createjs.Types.JSON:case createjs.Types.MANIFEST:case createjs.Types.XML:case createjs.Types.CSS:case createjs.Types.SVG:case createjs.Types.JAVASCRIPT:case createjs.Types.SPRITESHEET:return!0;default:return!1}},t.getTypeByExtension=function(t){if(null==t)return createjs.Types.TEXT;switch(t.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.Types.IMAGE;case"ogg":case"mp3":case"webm":return createjs.Types.SOUND;case"mp4":case"webm":case"ts":return createjs.Types.VIDEO;case"json":return createjs.Types.JSON;case"xml":return createjs.Types.XML;case"css":return createjs.Types.CSS;case"js":return createjs.Types.JAVASCRIPT;case"svg":return createjs.Types.SVG;default:return createjs.Types.TEXT}},createjs.RequestUtils=t}(),function(){var t={};t.ABSOLUTE_PATT=/^(?:\w+:)?\/{2}/i,t.RELATIVE_PATT=/^[.\/]*?\//i,t.EXTENSION_PATT=/\/?[^\/]+\.(\w{1,5})$/i,t.parseURI=function(e){var i={absolute:!1,relative:!1,protocol:null,hostname:null,port:null,pathname:null,search:null,hash:null,host:null};if(null==e)return i;var n=createjs.Elements.a();n.href=e;for(var r in i)r in n&&(i[r]=n[r]);var s=e.indexOf("?");s>-1&&(e=e.substr(0,s));var o;return t.ABSOLUTE_PATT.test(e)?i.absolute=!0:t.RELATIVE_PATT.test(e)&&(i.relative=!0),(o=e.match(t.EXTENSION_PATT))&&(i.extension=o[1].toLowerCase()),i},t.formatQueryString=function(t,e){if(null==t)throw new Error("You must specify data.");var i=[];for(var n in t)i.push(n+"="+escape(t[n]));return e&&(i=i.concat(e)),i.join("&")},t.buildURI=function(t,e){if(null==e)return t;var i=[],n=t.indexOf("?");if(-1!=n){var r=t.slice(n+1);i=i.concat(r.split("&"))}return-1!=n?t.slice(0,n)+"?"+this.formatQueryString(e,i):t+"?"+this.formatQueryString(e,i)},t.isCrossDomain=function(t){var e=createjs.Elements.a();e.href=t.src;var i=createjs.Elements.a();return i.href=location.href,""!=e.hostname&&(e.port!=i.port||e.protocol!=i.protocol||e.hostname!=i.hostname)},t.isLocal=function(t){var e=createjs.Elements.a();return e.href=t.src,""==e.hostname&&"file:"==e.protocol},createjs.URLUtils=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i){this.EventDispatcher_constructor(),this.loaded=!1,this.canceled=!1,this.progress=0,this.type=i,this.resultFormatter=null,this._item=t?createjs.LoadItem.create(t):null,this._preferXHR=e,this._result=null,this._rawResult=null,this._loadedItems=null,this._tagSrcAttribute=null,this._tag=null}var e=createjs.extend(t,createjs.EventDispatcher),i=t;try{Object.defineProperties(i,{POST:{get:createjs.deprecate(function(){return createjs.Methods.POST},"AbstractLoader.POST")},GET:{get:createjs.deprecate(function(){return createjs.Methods.GET},"AbstractLoader.GET")},BINARY:{get:createjs.deprecate(function(){return createjs.Types.BINARY},"AbstractLoader.BINARY")},CSS:{get:createjs.deprecate(function(){return createjs.Types.CSS},"AbstractLoader.CSS")},FONT:{get:createjs.deprecate(function(){return createjs.Types.FONT},"AbstractLoader.FONT")},FONTCSS:{get:createjs.deprecate(function(){return createjs.Types.FONTCSS},"AbstractLoader.FONTCSS")},IMAGE:{get:createjs.deprecate(function(){return createjs.Types.IMAGE},"AbstractLoader.IMAGE")},JAVASCRIPT:{get:createjs.deprecate(function(){return createjs.Types.JAVASCRIPT},"AbstractLoader.JAVASCRIPT")},JSON:{get:createjs.deprecate(function(){return createjs.Types.JSON},"AbstractLoader.JSON")},JSONP:{get:createjs.deprecate(function(){return createjs.Types.JSONP},"AbstractLoader.JSONP")},MANIFEST:{get:createjs.deprecate(function(){return createjs.Types.MANIFEST},"AbstractLoader.MANIFEST")},SOUND:{get:createjs.deprecate(function(){return createjs.Types.SOUND},"AbstractLoader.SOUND")},VIDEO:{get:createjs.deprecate(function(){return createjs.Types.VIDEO},"AbstractLoader.VIDEO")},SPRITESHEET:{get:createjs.deprecate(function(){return createjs.Types.SPRITESHEET},"AbstractLoader.SPRITESHEET")},SVG:{get:createjs.deprecate(function(){return createjs.Types.SVG},"AbstractLoader.SVG")},TEXT:{get:createjs.deprecate(function(){return createjs.Types.TEXT},"AbstractLoader.TEXT")},XML:{get:createjs.deprecate(function(){return createjs.Types.XML},"AbstractLoader.XML")}})}catch(t){}e.getItem=function(){return this._item},e.getResult=function(t){return t?this._rawResult:this._result},e.getTag=function(){return this._tag},e.setTag=function(t){this._tag=t},e.load=function(){this._createRequest(),this._request.on("complete",this,this),this._request.on("progress",this,this),this._request.on("loadStart",this,this),this._request.on("abort",this,this),this._request.on("timeout",this,this),this._request.on("error",this,this);var t=new createjs.Event("initialize");t.loader=this._request,this.dispatchEvent(t),this._request.load()},e.cancel=function(){this.canceled=!0,this.destroy()},e.destroy=function(){this._request&&(this._request.removeAllEventListeners(),this._request.destroy()),this._request=null,this._item=null,this._rawResult=null,this._result=null,this._loadItems=null,this.removeAllEventListeners()},e.getLoadedItems=function(){return this._loadedItems},e._createRequest=function(){this._request=this._preferXHR?new createjs.XHRRequest(this._item):new createjs.TagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)},e._createTag=function(){return null},e._sendLoadStart=function(){this._isCanceled()||this.dispatchEvent("loadstart")},e._sendProgress=function(t){if(!this._isCanceled()){var e=null;"number"==typeof t?(this.progress=t,e=new createjs.ProgressEvent(this.progress)):(e=t,this.progress=t.loaded/t.total,e.progress=this.progress,(isNaN(this.progress)||1/0==this.progress)&&(this.progress=0)),this.hasEventListener("progress")&&this.dispatchEvent(e)}},e._sendComplete=function(){if(!this._isCanceled()){this.loaded=!0;var t=new createjs.Event("complete");t.rawResult=this._rawResult,null!=this._result&&(t.result=this._result),this.dispatchEvent(t)}},e._sendError=function(t){!this._isCanceled()&&this.hasEventListener("error")&&(null==t&&(t=new createjs.ErrorEvent("PRELOAD_ERROR_EMPTY")),this.dispatchEvent(t))},e._isCanceled=function(){return!(null!=window.createjs&&!this.canceled)},e.resultFormatter=null,e.handleEvent=function(t){switch(t.type){case"complete":this._rawResult=t.target._response;var e=this.resultFormatter&&this.resultFormatter(this);e instanceof Function?e.call(this,createjs.proxy(this._resultFormatSuccess,this),createjs.proxy(this._resultFormatFailed,this)):(this._result=e||this._rawResult,this._sendComplete());break;case"progress":this._sendProgress(t);break;case"error":this._sendError(t);break;case"loadstart":this._sendLoadStart();break;case"abort":case"timeout":this._isCanceled()||this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_"+t.type.toUpperCase()+"_ERROR"))}},e._resultFormatSuccess=function(t){this._result=t,this._sendComplete()},e._resultFormatFailed=function(t){this._sendError(t)},e.toString=function(){return"[PreloadJS AbstractLoader]"},createjs.AbstractLoader=createjs.promote(t,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i){this.AbstractLoader_constructor(t,e,i),this.resultFormatter=this._formatResult,this._tagSrcAttribute="src",this.on("initialize",this._updateXHR,this)}var e=createjs.extend(t,createjs.AbstractLoader);e.load=function(){this._tag||(this._tag=this._createTag(this._item.src)),this._tag.preload="auto",this._tag.load(),this.AbstractLoader_load()},e._createTag=function(){},e._createRequest=function(){this._request=this._preferXHR?new createjs.XHRRequest(this._item):new createjs.MediaTagRequest(this._item,this._tag||this._createTag(),this._tagSrcAttribute)},e._updateXHR=function(t){t.loader.setResponseType&&t.loader.setResponseType("blob")},e._formatResult=function(t){if(this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler),this._tag.onstalled=null,this._preferXHR){var e=window.URL||window.webkitURL,i=t.getResult(!0);t.getTag().src=e.createObjectURL(i)}return t.getTag()},createjs.AbstractMediaLoader=createjs.promote(t,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t){this._item=t},e=createjs.extend(t,createjs.EventDispatcher);e.load=function(){},e.destroy=function(){},e.cancel=function(){},createjs.AbstractRequest=createjs.promote(t,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i){this.AbstractRequest_constructor(t),this._tag=e,this._tagSrcAttribute=i,this._loadedHandler=createjs.proxy(this._handleTagComplete,this),this._addedToDOM=!1}var e=createjs.extend(t,createjs.AbstractRequest);e.load=function(){this._tag.onload=createjs.proxy(this._handleTagComplete,this),this._tag.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this),this._tag.onerror=createjs.proxy(this._handleError,this);var t=new createjs.Event("initialize");t.loader=this._tag,this.dispatchEvent(t),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout),this._tag[this._tagSrcAttribute]=this._item.src,null==this._tag.parentNode&&(createjs.DomUtils.appendToBody(this._tag),this._addedToDOM=!0)},e.destroy=function(){this._clean(),this._tag=null,this.AbstractRequest_destroy()},e._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var t=this._tag;("loaded"==t.readyState||"complete"==t.readyState)&&this._handleTagComplete()},e._handleError=function(){this._clean(),this.dispatchEvent("error")},e._handleTagComplete=function(){this._rawResult=this._tag,this._result=this.resultFormatter&&this.resultFormatter(this)||this._rawResult,this._clean(),this.dispatchEvent("complete")},e._handleTimeout=function(){this._clean(),this.dispatchEvent(new createjs.Event("timeout"))},e._clean=function(){this._tag.onload=null,this._tag.onreadystatechange=null,this._tag.onerror=null,this._addedToDOM&&null!=this._tag.parentNode&&this._tag.parentNode.removeChild(this._tag),clearTimeout(this._loadTimeout)},e._handleStalled=function(){},createjs.TagRequest=createjs.promote(t,"AbstractRequest")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i){this.AbstractRequest_constructor(t),this._tag=e,this._tagSrcAttribute=i,this._loadedHandler=createjs.proxy(this._handleTagComplete,this)}var e=createjs.extend(t,createjs.TagRequest);e.load=function(){var t=createjs.proxy(this._handleStalled,this);this._stalledCallback=t;var e=createjs.proxy(this._handleProgress,this);this._handleProgress=e,this._tag.addEventListener("stalled",t),this._tag.addEventListener("progress",e),this._tag.addEventListener&&this._tag.addEventListener("canplaythrough",this._loadedHandler,!1),this.TagRequest_load()},e._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var t=this._tag;("loaded"==t.readyState||"complete"==t.readyState)&&this._handleTagComplete()},e._handleStalled=function(){},e._handleProgress=function(t){if(t&&!(t.loaded>0&&0==t.total)){var e=new createjs.ProgressEvent(t.loaded,t.total);this.dispatchEvent(e)}},e._clean=function(){this._tag.removeEventListener&&this._tag.removeEventListener("canplaythrough",this._loadedHandler),this._tag.removeEventListener("stalled",this._stalledCallback),this._tag.removeEventListener("progress",this._progressCallback),this.TagRequest__clean()},createjs.MediaTagRequest=createjs.promote(t,"TagRequest")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.AbstractRequest_constructor(t),this._request=null,this._loadTimeout=null,this._xhrLevel=1,this._response=null,this._rawResponse=null,this._canceled=!1,this._handleLoadStartProxy=createjs.proxy(this._handleLoadStart,this),this._handleProgressProxy=createjs.proxy(this._handleProgress,this),this._handleAbortProxy=createjs.proxy(this._handleAbort,this),this._handleErrorProxy=createjs.proxy(this._handleError,this),this._handleTimeoutProxy=createjs.proxy(this._handleTimeout,this),this._handleLoadProxy=createjs.proxy(this._handleLoad,this),this._handleReadyStateChangeProxy=createjs.proxy(this._handleReadyStateChange,this),this._createXHR(t)}var e=createjs.extend(t,createjs.AbstractRequest);t.ACTIVEX_VERSIONS=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],e.getResult=function(t){return t&&this._rawResponse?this._rawResponse:this._response},e.cancel=function(){this.canceled=!0,this._clean(),this._request.abort()},e.load=function(){if(null==this._request)return void this._handleError()
;null!=this._request.addEventListener?(this._request.addEventListener("loadstart",this._handleLoadStartProxy,!1),this._request.addEventListener("progress",this._handleProgressProxy,!1),this._request.addEventListener("abort",this._handleAbortProxy,!1),this._request.addEventListener("error",this._handleErrorProxy,!1),this._request.addEventListener("timeout",this._handleTimeoutProxy,!1),this._request.addEventListener("load",this._handleLoadProxy,!1),this._request.addEventListener("readystatechange",this._handleReadyStateChangeProxy,!1)):(this._request.onloadstart=this._handleLoadStartProxy,this._request.onprogress=this._handleProgressProxy,this._request.onabort=this._handleAbortProxy,this._request.onerror=this._handleErrorProxy,this._request.ontimeout=this._handleTimeoutProxy,this._request.onload=this._handleLoadProxy,this._request.onreadystatechange=this._handleReadyStateChangeProxy),1==this._xhrLevel&&(this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),this._item.loadTimeout));try{this._item.values?this._request.send(createjs.URLUtils.formatQueryString(this._item.values)):this._request.send()}catch(t){this.dispatchEvent(new createjs.ErrorEvent("XHR_SEND",null,t))}},e.setResponseType=function(t){"blob"===t&&(t=window.URL?"blob":"arraybuffer",this._responseType=t),this._request.responseType=t},e.getAllResponseHeaders=function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},e.getResponseHeader=function(t){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(t):null},e._handleProgress=function(t){if(t&&!(t.loaded>0&&0==t.total)){var e=new createjs.ProgressEvent(t.loaded,t.total);this.dispatchEvent(e)}},e._handleLoadStart=function(){clearTimeout(this._loadTimeout),this.dispatchEvent("loadstart")},e._handleAbort=function(t){this._clean(),this.dispatchEvent(new createjs.ErrorEvent("XHR_ABORTED",null,t))},e._handleError=function(t){this._clean(),this.dispatchEvent(new createjs.ErrorEvent(t.message))},e._handleReadyStateChange=function(){4==this._request.readyState&&this._handleLoad()},e._handleLoad=function(){if(!this.loaded){this.loaded=!0;var t=this._checkError();if(t)return void this._handleError(t);if(this._response=this._getResponse(),"arraybuffer"===this._responseType)try{this._response=new Blob([this._response])}catch(t){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"===t.name&&window.BlobBuilder){var e=new BlobBuilder;e.append(this._response),this._response=e.getBlob()}}this._clean(),this.dispatchEvent(new createjs.Event("complete"))}},e._handleTimeout=function(t){this._clean(),this.dispatchEvent(new createjs.ErrorEvent("PRELOAD_TIMEOUT",null,t))},e._checkError=function(){var t=parseInt(this._request.status);return t>=400&&599>=t?new Error(t):0==t&&/^https?:/.test(location.protocol)?new Error(0):null},e._getResponse=function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(t){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(t){}return null},e._createXHR=function(t){var e=createjs.URLUtils.isCrossDomain(t),i={},n=null;if(window.XMLHttpRequest)n=new XMLHttpRequest,e&&void 0===n.withCredentials&&window.XDomainRequest&&(n=new XDomainRequest);else{for(var r=0,o=s.ACTIVEX_VERSIONS.length;o>r;r++){var a=s.ACTIVEX_VERSIONS[r];try{n=new ActiveXObject(a);break}catch(t){}}if(null==n)return!1}null==t.mimeType&&createjs.RequestUtils.isText(t.type)&&(t.mimeType="text/plain; charset=utf-8"),t.mimeType&&n.overrideMimeType&&n.overrideMimeType(t.mimeType),this._xhrLevel="string"==typeof n.responseType?2:1;var h=null;if(h=t.method==createjs.Methods.GET?createjs.URLUtils.buildURI(t.src,t.values):t.src,n.open(t.method||createjs.Methods.GET,h,!0),e&&n instanceof XMLHttpRequest&&1==this._xhrLevel&&(i.Origin=location.origin),t.values&&t.method==createjs.Methods.POST&&(i["Content-Type"]="application/x-www-form-urlencoded"),e||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),t.headers)for(var c in t.headers)i[c]=t.headers[c];for(c in i)n.setRequestHeader(c,i[c]);return n instanceof XMLHttpRequest&&void 0!==t.withCredentials&&(n.withCredentials=t.withCredentials),this._request=n,!0},e._clean=function(){clearTimeout(this._loadTimeout),null!=this._request.removeEventListener?(this._request.removeEventListener("loadstart",this._handleLoadStartProxy),this._request.removeEventListener("progress",this._handleProgressProxy),this._request.removeEventListener("abort",this._handleAbortProxy),this._request.removeEventListener("error",this._handleErrorProxy),this._request.removeEventListener("timeout",this._handleTimeoutProxy),this._request.removeEventListener("load",this._handleLoadProxy),this._request.removeEventListener("readystatechange",this._handleReadyStateChangeProxy)):(this._request.onloadstart=null,this._request.onprogress=null,this._request.onabort=null,this._request.onerror=null,this._request.ontimeout=null,this._request.onload=null,this._request.onreadystatechange=null)},e.toString=function(){return"[PreloadJS XHRRequest]"},createjs.XHRRequest=createjs.promote(t,"AbstractRequest")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e){this.AbstractMediaLoader_constructor(t,e,createjs.Types.SOUND),createjs.DomUtils.isAudioTag(t)?this._tag=t:createjs.DomUtils.isAudioTag(t.src)?this._tag=t:createjs.DomUtils.isAudioTag(t.tag)&&(this._tag=createjs.DomUtils.isAudioTag(t)?t:t.src),null!=this._tag&&(this._preferXHR=!1)}var e=createjs.extend(t,createjs.AbstractMediaLoader);t.canLoadItem=function(t){return t.type==createjs.Types.SOUND},e._createTag=function(t){var e=createjs.Elements.audio();return e.autoplay=!1,e.preload="none",e.src=t,e},createjs.SoundLoader=createjs.promote(t,"AbstractMediaLoader")}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(){this.interrupt=null,this.delay=null,this.offset=null,this.loop=null,this.volume=null,this.pan=null,this.startTime=null,this.duration=null},e=t.prototype={},i=t;i.create=function(t){if("string"==typeof t)return console&&(console.warn||console.log)("Deprecated behaviour. Sound.play takes a configuration object instead of individual arguments. See docs for info."),(new createjs.PlayPropsConfig).set({interrupt:t});if(null==t||t instanceof i||t instanceof Object)return(new createjs.PlayPropsConfig).set(t);if(null==t)throw new Error("PlayProps configuration not recognized.")},e.set=function(t){if(null!=t)for(var e in t)this[e]=t[e];return this},e.toString=function(){return"[PlayPropsConfig]"},createjs.PlayPropsConfig=i}(),this.createjs=this.createjs||{},function(){"use strict";function t(){throw"Sound cannot be instantiated"}function e(t,e){this.init(t,e)}var i=t;i.INTERRUPT_ANY="any",i.INTERRUPT_EARLY="early",i.INTERRUPT_LATE="late",i.INTERRUPT_NONE="none",i.PLAY_INITED="playInited",i.PLAY_SUCCEEDED="playSucceeded",i.PLAY_INTERRUPTED="playInterrupted",i.PLAY_FINISHED="playFinished",i.PLAY_FAILED="playFailed",i.SUPPORTED_EXTENSIONS=["mp3","ogg","opus","mpeg","wav","m4a","mp4","aiff","wma","mid"],i.EXTENSION_MAP={m4a:"mp4"},i.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([\/.]*?(?:[^?]+)?\/)?((?:[^\/?]+)\.(\w+))(?:\?(\S+)?)?$/,i.defaultInterruptBehavior=i.INTERRUPT_NONE,i.alternateExtensions=[],i.activePlugin=null,i._masterVolume=1,i._getMasterVolume=function(){return this._masterVolume},i.getVolume=createjs.deprecate(i._getMasterVolume,"Sound.getVolume"),i._setMasterVolume=function(t){if(null!=Number(t)&&(t=Math.max(0,Math.min(1,t)),i._masterVolume=t,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(t)))for(var e=this._instances,n=0,r=e.length;r>n;n++)e[n].setMasterVolume(t)},i.setVolume=createjs.deprecate(i._setMasterVolume,"Sound.setVolume"),i._masterMute=!1,i._getMute=function(){return this._masterMute},i.getMute=createjs.deprecate(i._getMute,"Sound.getMute"),i._setMute=function(t){if(null!=t&&(this._masterMute=t,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(t)))for(var e=this._instances,i=0,n=e.length;n>i;i++)e[i].setMasterMute(t)},i.setMute=createjs.deprecate(i._setMute,"Sound.setMute"),i._getCapabilities=function(){return null==i.activePlugin?null:i.activePlugin._capabilities},i.getCapabilities=createjs.deprecate(i._getCapabilities,"Sound.getCapabilities"),Object.defineProperties(i,{volume:{get:i._getMasterVolume,set:i._setMasterVolume},muted:{get:i._getMute,set:i._setMute},capabilities:{get:i._getCapabilities}}),i._pluginsRegistered=!1,i._lastID=0,i._instances=[],i._idHash={},i._preloadHash={},i._defaultPlayPropsHash={},i.addEventListener=null,i.removeEventListener=null,i.removeAllEventListeners=null,i.dispatchEvent=null,i.hasEventListener=null,i._listeners=null,createjs.EventDispatcher.initialize(i),i.getPreloadHandlers=function(){return{callback:createjs.proxy(i.initLoad,i),types:["sound"],extensions:i.SUPPORTED_EXTENSIONS}},i._handleLoadComplete=function(t){var e=t.target.getItem().src;if(i._preloadHash[e])for(var n=0,r=i._preloadHash[e].length;r>n;n++){var s=i._preloadHash[e][n];if(i._preloadHash[e][n]=!0,i.hasEventListener("fileload")){var t=new createjs.Event("fileload");t.src=s.src,t.id=s.id,t.data=s.data,t.sprite=s.sprite,i.dispatchEvent(t)}}},i._handleLoadError=function(t){var e=t.target.getItem().src;if(i._preloadHash[e])for(var n=0,r=i._preloadHash[e].length;r>n;n++){var s=i._preloadHash[e][n];if(i._preloadHash[e][n]=!1,i.hasEventListener("fileerror")){var t=new createjs.Event("fileerror");t.src=s.src,t.id=s.id,t.data=s.data,t.sprite=s.sprite,i.dispatchEvent(t)}}},i._registerPlugin=function(t){return!!t.isSupported()&&(i.activePlugin=new t,!0)},i.registerPlugins=function(t){i._pluginsRegistered=!0;for(var e=0,n=t.length;n>e;e++)if(i._registerPlugin(t[e]))return!0;return!1},i.initializeDefaultPlugins=function(){return null!=i.activePlugin||!i._pluginsRegistered&&!!i.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])},i.isReady=function(){return null!=i.activePlugin},i.initLoad=function(t){return"video"==t.type||i._registerSound(t)},i._registerSound=function(t){if(!i.initializeDefaultPlugins())return!1;var n;if(t.src instanceof Object?(n=i._parseSrc(t.src),n.src=t.path+n.src):n=i._parsePath(t.src),null==n)return!1;t.src=n.src,t.type="sound";var r=t.data,s=null;if(null!=r&&(isNaN(r.channels)?isNaN(r)||(s=parseInt(r)):s=parseInt(r.channels),r.audioSprite))for(var o,a=r.audioSprite.length;a--;)o=r.audioSprite[a],i._idHash[o.id]={src:t.src,startTime:parseInt(o.startTime),duration:parseInt(o.duration)},o.defaultPlayProps&&(i._defaultPlayPropsHash[o.id]=createjs.PlayPropsConfig.create(o.defaultPlayProps));null!=t.id&&(i._idHash[t.id]={src:t.src});var h=i.activePlugin.register(t);return e.create(t.src,s),null!=r&&isNaN(r)?t.data.channels=s||e.maxPerChannel():t.data=s||e.maxPerChannel(),h.type&&(t.type=h.type),t.defaultPlayProps&&(i._defaultPlayPropsHash[t.src]=createjs.PlayPropsConfig.create(t.defaultPlayProps)),h},i.registerSound=function(t,e,n,r,s){var o={src:t,id:e,data:n,defaultPlayProps:s};t instanceof Object&&t.src&&(r=e,o=t),o=createjs.LoadItem.create(o),o.path=r,null==r||o.src instanceof Object||(o.src=r+o.src);var a=i._registerSound(o);if(!a)return!1;if(i._preloadHash[o.src]||(i._preloadHash[o.src]=[]),i._preloadHash[o.src].push(o),1==i._preloadHash[o.src].length)a.on("complete",this._handleLoadComplete,this),a.on("error",this._handleLoadError,this),i.activePlugin.preload(a);else if(1==i._preloadHash[o.src][0])return!0;return o},i.registerSounds=function(t,e){var i=[];t.path&&(e?e+=t.path:e=t.path,t=t.manifest);for(var n=0,r=t.length;r>n;n++)i[n]=createjs.Sound.registerSound(t[n].src,t[n].id,t[n].data,e,t[n].defaultPlayProps);return i},i.removeSound=function(t,n){if(null==i.activePlugin)return!1;t instanceof Object&&t.src&&(t=t.src);var r;if(t instanceof Object?r=i._parseSrc(t):(t=i._getSrcById(t).src,r=i._parsePath(t)),null==r)return!1;t=r.src,null!=n&&(t=n+t);for(var s in i._idHash)i._idHash[s].src==t&&delete i._idHash[s];return e.removeSrc(t),delete i._preloadHash[t],i.activePlugin.removeSound(t),!0},i.removeSounds=function(t,e){var i=[];t.path&&(e?e+=t.path:e=t.path,t=t.manifest);for(var n=0,r=t.length;r>n;n++)i[n]=createjs.Sound.removeSound(t[n].src,e);return i},i.removeAllSounds=function(){i._idHash={},i._preloadHash={},e.removeAll(),i.activePlugin&&i.activePlugin.removeAllSounds()},i.loadComplete=function(t){if(!i.isReady())return!1;var e=i._parsePath(t);return t=e?i._getSrcById(e.src).src:i._getSrcById(t).src,void 0!=i._preloadHash[t]&&1==i._preloadHash[t][0]},i._parsePath=function(t){"string"!=typeof t&&(t=t.toString());var e=t.match(i.FILE_PATTERN);if(null==e)return!1;for(var n=e[4],r=e[5],s=i.capabilities,o=0;!s[r];)if(r=i.alternateExtensions[o++],o>i.alternateExtensions.length)return null;return t=t.replace("."+e[5],"."+r),{name:n,src:t,extension:r}},i._parseSrc=function(t){var e={name:void 0,src:void 0,extension:void 0},n=i.capabilities;for(var r in t)if(t.hasOwnProperty(r)&&n[r]){e.src=t[r],e.extension=r;break}if(!e.src)return!1;var s=e.src.lastIndexOf("/");return e.name=-1!=s?e.src.slice(s+1):e.src,e},i.play=function(t,e){var n=createjs.PlayPropsConfig.create(e),r=i.createInstance(t,n.startTime,n.duration);return i._playInstance(r,n)||r._playFailed(),r},i.createInstance=function(t,n,r){if(!i.initializeDefaultPlugins())return new createjs.DefaultSoundInstance(t,n,r);var s=i._defaultPlayPropsHash[t];t=i._getSrcById(t);var o=i._parsePath(t.src),a=null;return null!=o&&null!=o.src?(e.create(o.src),null==n&&(n=t.startTime),a=i.activePlugin.create(o.src,n,r||t.duration),(s=s||i._defaultPlayPropsHash[o.src])&&a.applyPlayProps(s)):a=new createjs.DefaultSoundInstance(t,n,r),a.uniqueId=i._lastID++,a},i.stop=function(){for(var t=this._instances,e=t.length;e--;)t[e].stop()},i.setDefaultPlayProps=function(t,e){t=i._getSrcById(t),i._defaultPlayPropsHash[i._parsePath(t.src).src]=createjs.PlayPropsConfig.create(e)},i.getDefaultPlayProps=function(t){return t=i._getSrcById(t),i._defaultPlayPropsHash[i._parsePath(t.src).src]},i._playInstance=function(t,e){var n=i._defaultPlayPropsHash[t.src]||{};if(null==e.interrupt&&(e.interrupt=n.interrupt||i.defaultInterruptBehavior),null==e.delay&&(e.delay=n.delay||0),null==e.offset&&(e.offset=t.position),null==e.loop&&(e.loop=t.loop),null==e.volume&&(e.volume=t.volume),null==e.pan&&(e.pan=t.pan),0==e.delay){if(!i._beginPlaying(t,e))return!1}else{var r=setTimeout(function(){i._beginPlaying(t,e)},e.delay);t.delayTimeoutId=r}return this._instances.push(t),!0},i._beginPlaying=function(t,i){if(!e.add(t,i.interrupt))return!1;if(!t._beginPlaying(i)){var n=createjs.indexOf(this._instances,t);return n>-1&&this._instances.splice(n,1),!1}return!0},i._getSrcById=function(t){return i._idHash[t]||{src:t}},i._playFinished=function(t){e.remove(t);var i=createjs.indexOf(this._instances,t);i>-1&&this._instances.splice(i,1)},createjs.Sound=t,e.channels={},e.create=function(t,i){return null==e.get(t)&&(e.channels[t]=new e(t,i),!0)},e.removeSrc=function(t){var i=e.get(t);return null!=i&&(i._removeAll(),delete e.channels[t],!0)},e.removeAll=function(){for(var t in e.channels)e.channels[t]._removeAll();e.channels={}},e.add=function(t,i){var n=e.get(t.src);return null!=n&&n._add(t,i)},e.remove=function(t){var i=e.get(t.src);return null!=i&&(i._remove(t),!0)},e.maxPerChannel=function(){return n.maxDefault},e.get=function(t){return e.channels[t]};var n=e.prototype;n.constructor=e,n.src=null,n.max=null,n.maxDefault=100,n.length=0,n.init=function(t,e){this.src=t,this.max=e||this.maxDefault,-1==this.max&&(this.max=this.maxDefault),this._instances=[]},n._get=function(t){return this._instances[t]},n._add=function(t,e){return!!this._getSlot(e,t)&&(this._instances.push(t),this.length++,!0)},n._remove=function(t){var e=createjs.indexOf(this._instances,t);return-1!=e&&(this._instances.splice(e,1),this.length--,!0)},n._removeAll=function(){for(var t=this.length-1;t>=0;t--)this._instances[t].stop()},n._getSlot=function(e){var i,n;if(e!=t.INTERRUPT_NONE&&null==(n=this._get(0)))return!0;for(var r=0,s=this.max;s>r;r++){if(null==(i=this._get(r)))return!0;if(i.playState==t.PLAY_FINISHED||i.playState==t.PLAY_INTERRUPTED||i.playState==t.PLAY_FAILED){n=i;break}e!=t.INTERRUPT_NONE&&(e==t.INTERRUPT_EARLY&&i.position<n.position||e==t.INTERRUPT_LATE&&i.position>n.position)&&(n=i)}return null!=n&&(n._interrupt(),this._remove(n),!0)},n.toString=function(){return"[Sound SoundChannel]"}}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(t,e,i,n){this.EventDispatcher_constructor(),this.src=t,this.uniqueId=-1,this.playState=null,this.delayTimeoutId=null,this._volume=1,Object.defineProperty(this,"volume",{get:this._getVolume,set:this._setVolume}),this.getVolume=createjs.deprecate(this._getVolume,"AbstractSoundInstance.getVolume"),this.setVolume=createjs.deprecate(this._setVolume,"AbstractSoundInstance.setVolume"),this._pan=0,Object.defineProperty(this,"pan",{get:this._getPan,set:this._setPan}),this.getPan=createjs.deprecate(this._getPan,"AbstractSoundInstance.getPan"),this.setPan=createjs.deprecate(this._setPan,"AbstractSoundInstance.setPan"),this._startTime=Math.max(0,e||0),Object.defineProperty(this,"startTime",{get:this._getStartTime,set:this._setStartTime}),this.getStartTime=createjs.deprecate(this._getStartTime,"AbstractSoundInstance.getStartTime"),this.setStartTime=createjs.deprecate(this._setStartTime,"AbstractSoundInstance.setStartTime"),this._duration=Math.max(0,i||0),Object.defineProperty(this,"duration",{get:this._getDuration,set:this._setDuration}),this.getDuration=createjs.deprecate(this._getDuration,"AbstractSoundInstance.getDuration"),this.setDuration=createjs.deprecate(this._setDuration,"AbstractSoundInstance.setDuration"),this._playbackResource=null,Object.defineProperty(this,"playbackResource",{get:this._getPlaybackResource,set:this._setPlaybackResource}),!1!==n&&!0!==n&&this._setPlaybackResource(n),this.getPlaybackResource=createjs.deprecate(this._getPlaybackResource,"AbstractSoundInstance.getPlaybackResource"),this.setPlaybackResource=createjs.deprecate(this._setPlaybackResource,"AbstractSoundInstance.setPlaybackResource"),this._position=0,Object.defineProperty(this,"position",{get:this._getPosition,set:this._setPosition}),this.getPosition=createjs.deprecate(this._getPosition,"AbstractSoundInstance.getPosition"),this.setPosition=createjs.deprecate(this._setPosition,"AbstractSoundInstance.setPosition"),this._loop=0,Object.defineProperty(this,"loop",{get:this._getLoop,set:this._setLoop}),this.getLoop=createjs.deprecate(this._getLoop,"AbstractSoundInstance.getLoop"),this.setLoop=createjs.deprecate(this._setLoop,"AbstractSoundInstance.setLoop"),this._muted=!1,Object.defineProperty(this,"muted",{get:this._getMuted,set:this._setMuted}),this.getMuted=createjs.deprecate(this._getMuted,"AbstractSoundInstance.getMuted"),this.setMuted=createjs.deprecate(this._setMuted,"AbstractSoundInstance.setMuted"),this._paused=!1,Object.defineProperty(this,"paused",{get:this._getPaused,set:this._setPaused}),this.getPaused=createjs.deprecate(this._getPaused,"AbstractSoundInstance.getPaused"),this.setPaused=createjs.deprecate(this._setPaused,"AbstractSoundInstance.setPaused")},e=createjs.extend(t,createjs.EventDispatcher);e.play=function(t){var e=createjs.PlayPropsConfig.create(t);return this.playState==createjs.Sound.PLAY_SUCCEEDED?(this.applyPlayProps(e),void(this._paused&&this._setPaused(!1))):(this._cleanUp(),createjs.Sound._playInstance(this,e),this)},e.stop=function(){return this._position=0,this._paused=!1,this._handleStop(),this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this},e.destroy=function(){this._cleanUp(),this.src=null,this.playbackResource=null,this.removeAllEventListeners()},e.applyPlayProps=function(t){return null!=t.offset&&this._setPosition(t.offset),null!=t.loop&&this._setLoop(t.loop),null!=t.volume&&this._setVolume(t.volume),null!=t.pan&&this._setPan(t.pan),null!=t.startTime&&(this._setStartTime(t.startTime),this._setDuration(t.duration)),this},e.toString=function(){return"[AbstractSoundInstance]"},e._getPaused=function(){return this._paused},e._setPaused=function(t){return!0!==t&&!1!==t||this._paused==t||1==t&&this.playState!=createjs.Sound.PLAY_SUCCEEDED?void 0:(this._paused=t,t?this._pause():this._resume(),clearTimeout(this.delayTimeoutId),this)},e._setVolume=function(t){return t==this._volume?this:(this._volume=Math.max(0,Math.min(1,t)),this._muted||this._updateVolume(),this)},e._getVolume=function(){return this._volume},e._setMuted=function(t){return!0===t||!1===t?(this._muted=t,this._updateVolume(),this):void 0},e._getMuted=function(){return this._muted},e._setPan=function(t){return t==this._pan?this:(this._pan=Math.max(-1,Math.min(1,t)),this._updatePan(),this)},e._getPan=function(){return this._pan},e._getPosition=function(){return this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||(this._position=this._calculateCurrentPosition()),this._position},e._setPosition=function(t){return this._position=Math.max(0,t),this.playState==createjs.Sound.PLAY_SUCCEEDED&&this._updatePosition(),this},e._getStartTime=function(){return this._startTime},e._setStartTime=function(t){return t==this._startTime?this:(this._startTime=Math.max(0,t||0),this._updateStartTime(),this)},e._getDuration=function(){return this._duration},e._setDuration=function(t){return t==this._duration?this:(this._duration=Math.max(0,t||0),this._updateDuration(),this)},e._setPlaybackResource=function(t){return this._playbackResource=t,0==this._duration&&this._playbackResource&&this._setDurationFromSource(),this},e._getPlaybackResource=function(){return this._playbackResource},e._getLoop=function(){return this._loop},e._setLoop=function(t){null!=this._playbackResource&&(0!=this._loop&&0==t?this._removeLooping(t):0==this._loop&&0!=t&&this._addLooping(t)),this._loop=t},e._sendEvent=function(t){var e=new createjs.Event(t);this.dispatchEvent(e)},e._cleanUp=function(){clearTimeout(this.delayTimeoutId),this._handleCleanUp(),this._paused=!1,createjs.Sound._playFinished(this)},e._interrupt=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_INTERRUPTED,this._sendEvent("interrupted")},e._beginPlaying=function(t){return this._setPosition(t.offset),this._setLoop(t.loop),this._setVolume(t.volume),this._setPan(t.pan),null!=t.startTime&&(this._setStartTime(t.startTime),this._setDuration(t.duration)),null!=this._playbackResource&&this._position<this._duration?(this._paused=!1,this._handleSoundReady(),this.playState=createjs.Sound.PLAY_SUCCEEDED,this._sendEvent("succeeded"),!0):(this._playFailed(),!1)},e._playFailed=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_FAILED,this._sendEvent("failed")},e._handleSoundComplete=function(){return this._position=0,0!=this._loop?(this._loop--,this._handleLoop(),void this._sendEvent("loop")):(this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,void this._sendEvent("complete"))},e._handleSoundReady=function(){},e._updateVolume=function(){},e._updatePan=function(){},e._updateStartTime=function(){},e._updateDuration=function(){},e._setDurationFromSource=function(){},e._calculateCurrentPosition=function(){},e._updatePosition=function(){},e._removeLooping=function(){},e._addLooping=function(){},e._pause=function(){},e._resume=function(){},e._handleStop=function(){},e._handleCleanUp=function(){},e._handleLoop=function(){},createjs.AbstractSoundInstance=createjs.promote(t,"EventDispatcher"),createjs.DefaultSoundInstance=createjs.AbstractSoundInstance}(),this.createjs=this.createjs||{},function(){"use strict";var t=function(){this._capabilities=null,this._loaders={},this._audioSources={},this._soundInstances={},this._volume=1,this._loaderClass,this._soundInstanceClass},e=t.prototype;t._capabilities=null,t.isSupported=function(){return!0},e.register=function(t){var e=this._loaders[t.src];return e&&!e.canceled?this._loaders[t.src]:(this._audioSources[t.src]=!0,this._soundInstances[t.src]=[],e=new this._loaderClass(t),e.on("complete",this._handlePreloadComplete,this),this._loaders[t.src]=e,e)},e.preload=function(t){t.on("error",this._handlePreloadError,this),t.load()},e.isPreloadStarted=function(t){return null!=this._audioSources[t]},e.isPreloadComplete=function(t){return!(null==this._audioSources[t]||1==this._audioSources[t])},e.removeSound=function(t){if(this._soundInstances[t]){for(var e=this._soundInstances[t].length;e--;){this._soundInstances[t][e].destroy()}delete this._soundInstances[t],delete this._audioSources[t],this._loaders[t]&&this._loaders[t].destroy(),delete this._loaders[t]}},e.removeAllSounds=function(){for(var t in this._audioSources)this.removeSound(t)},e.create=function(t,e,i){this.isPreloadStarted(t)||this.preload(this.register(t));var n=new this._soundInstanceClass(t,e,i,this._audioSources[t]);return this._soundInstances[t]&&this._soundInstances[t].push(n),n.setMasterVolume&&n.setMasterVolume(createjs.Sound.volume),n.setMasterMute&&n.setMasterMute(createjs.Sound.muted),n},e.setVolume=function(t){return this._volume=t,this._updateVolume(),!0},e.getVolume=function(){return this._volume},e.setMute=function(){return this._updateVolume(),!0},e.toString=function(){return"[AbstractPlugin]"},e._handlePreloadComplete=function(t){var e=t.target.getItem().src;this._audioSources[e]=t.result;for(var i=0,n=this._soundInstances[e].length;n>i;i++){this._soundInstances[e][i].playbackResource=this._audioSources[e],this._soundInstances[e]=null}},e._handlePreloadError=function(){},e._updateVolume=function(){},createjs.AbstractPlugin=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.AbstractLoader_constructor(t,!0,createjs.Types.SOUND)}var e=createjs.extend(t,createjs.AbstractLoader);t.context=null,e.toString=function(){return"[WebAudioLoader]"},e._createRequest=function(){this._request=new createjs.XHRRequest(this._item,!1),this._request.setResponseType("arraybuffer")},e._sendComplete=function(){t.context.decodeAudioData(this._rawResult,createjs.proxy(this._handleAudioDecoded,this),createjs.proxy(this._sendError,this))},e._handleAudioDecoded=function(t){this._result=t,this.AbstractLoader__sendComplete()},createjs.WebAudioLoader=createjs.promote(t,"AbstractLoader")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,n,r){this.AbstractSoundInstance_constructor(t,e,n,r),this.gainNode=i.context.createGain(),this.panNode=i.context.createPanner(),this.panNode.panningModel=i._panningModel,this.panNode.connect(this.gainNode),this._updatePan(),this.sourceNode=null,this._soundCompleteTimeout=null,this._sourceNodeNext=null,this._playbackStartTime=0,this._endedHandler=createjs.proxy(this._handleSoundComplete,this)}var e=createjs.extend(t,createjs.AbstractSoundInstance),i=t;i.context=null,i._scratchBuffer=null,i.destinationNode=null,i._panningModel="equalpower",e.destroy=function(){this.AbstractSoundInstance_destroy(),this.panNode.disconnect(0),this.panNode=null,this.gainNode.disconnect(0),this.gainNode=null},e.toString=function(){return"[WebAudioSoundInstance]"},e._updatePan=function(){this.panNode.setPosition(this._pan,0,-.5)},e._removeLooping=function(){this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)},e._addLooping=function(){this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0))},e._setDurationFromSource=function(){this._duration=1e3*this.playbackResource.duration},e._handleCleanUp=function(){this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._soundCompleteTimeout),this._playbackStartTime=0},e._cleanUpAudioNode=function(t){if(t){if(t.stop(0),t.disconnect(0),createjs.BrowserDetect.isIOS)try{t.buffer=i._scratchBuffer}catch(t){}t=null}return t},e._handleSoundReady=function(){this.gainNode.connect(i.destinationNode);var t=.001*this._duration,e=Math.min(.001*Math.max(0,this._position),t);this.sourceNode=this._createAndPlayAudioNode(i.context.currentTime-t,e),this._playbackStartTime=this.sourceNode.startTime-e,this._soundCompleteTimeout=setTimeout(this._endedHandler,1e3*(t-e)),0!=this._loop&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0))},e._createAndPlayAudioNode=function(t,e){var n=i.context.createBufferSource();n.buffer=this.playbackResource,n.connect(this.panNode);var r=.001*this._duration;return n.startTime=t+r,n.start(n.startTime,e+.001*this._startTime,r-e),n},e._pause=function(){this._position=1e3*(i.context.currentTime-this._playbackStartTime),this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._soundCompleteTimeout)},e._resume=function(){this._handleSoundReady()},e._updateVolume=function(){var t=this._muted?0:this._volume;t!=this.gainNode.gain.value&&(this.gainNode.gain.value=t)},e._calculateCurrentPosition=function(){return 1e3*(i.context.currentTime-this._playbackStartTime)},e._updatePosition=function(){this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext),clearTimeout(this._soundCompleteTimeout),this._paused||this._handleSoundReady()},e._handleLoop=function(){this._cleanUpAudioNode(this.sourceNode),this.sourceNode=this._sourceNodeNext,this._playbackStartTime=this.sourceNode.startTime,this._sourceNodeNext=this._createAndPlayAudioNode(this._playbackStartTime,0),this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration)},e._updateDuration=function(){this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._pause(),this._resume())},createjs.WebAudioSoundInstance=createjs.promote(t,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){"use strict";function t(){this.AbstractPlugin_constructor(),this._panningModel=i._panningModel,this.context=i.context,this.dynamicsCompressorNode=this.context.createDynamicsCompressor(),this.dynamicsCompressorNode.connect(this.context.destination),this.gainNode=this.context.createGain(),this.gainNode.connect(this.dynamicsCompressorNode),createjs.WebAudioSoundInstance.destinationNode=this.gainNode,this._capabilities=i._capabilities,this._loaderClass=createjs.WebAudioLoader,this._soundInstanceClass=createjs.WebAudioSoundInstance,this._addPropsToClasses()}var e=createjs.extend(t,createjs.AbstractPlugin),i=t;i._capabilities=null,i._panningModel="equalpower",i.context=null,i._scratchBuffer=null,i._unlocked=!1,i.DEFAULT_SAMPLE_RATE=44100,i.isSupported=function(){var t=createjs.BrowserDetect.isIOS||createjs.BrowserDetect.isAndroid||createjs.BrowserDetect.isBlackberry;return!("file:"==location.protocol&&!t&&!this._isFileXHRSupported())&&(i._generateCapabilities(),null!=i.context)},i.playEmptySound=function(){if(null!=i.context){var t=i.context.createBufferSource();t.buffer=i._scratchBuffer,t.connect(i.context.destination),t.start(0,0,0)}},i._isFileXHRSupported=function(){var t=!0,e=new XMLHttpRequest;try{e.open("GET","WebAudioPluginTest.fail",!1)}catch(e){return t=!1}e.onerror=function(){t=!1},e.onload=function(){t=404==this.status||200==this.status||0==this.status&&""!=this.response};try{e.send()}catch(e){t=!1}return t},i._generateCapabilities=function(){if(null==i._capabilities){var t=document.createElement("audio");if(null==t.canPlayType)return null;if(null==i.context&&(i.context=i._createAudioContext(),null==i.context))return null;null==i._scratchBuffer&&(i._scratchBuffer=i.context.createBuffer(1,1,22050)),i._compatibilitySetUp(),"ontouchstart"in window&&"running"!=i.context.state&&(i._unlock(),document.addEventListener("mousedown",i._unlock,!0),
document.addEventListener("touchstart",i._unlock,!0),document.addEventListener("touchend",i._unlock,!0)),i._capabilities={panning:!0,volume:!0,tracks:-1};for(var e=createjs.Sound.SUPPORTED_EXTENSIONS,n=createjs.Sound.EXTENSION_MAP,r=0,s=e.length;s>r;r++){var o=e[r],a=n[o]||o;i._capabilities[o]="no"!=t.canPlayType("audio/"+o)&&""!=t.canPlayType("audio/"+o)||"no"!=t.canPlayType("audio/"+a)&&""!=t.canPlayType("audio/"+a)}i.context.destination.numberOfChannels<2&&(i._capabilities.panning=!1)}},i._createAudioContext=function(){var t=window.AudioContext||window.webkitAudioContext;if(null==t)return null;var e=new t;if(/(iPhone|iPad)/i.test(navigator.userAgent)&&e.sampleRate!==i.DEFAULT_SAMPLE_RATE){var n=e.createBuffer(1,1,i.DEFAULT_SAMPLE_RATE),r=e.createBufferSource();r.buffer=n,r.connect(e.destination),r.start(0),r.disconnect(),e.close(),e=new t}return e},i._compatibilitySetUp=function(){if(i._panningModel="equalpower",!i.context.createGain){i.context.createGain=i.context.createGainNode;var t=i.context.createBufferSource();t.__proto__.start=t.__proto__.noteGrainOn,t.__proto__.stop=t.__proto__.noteOff,i._panningModel=0}},i._unlock=function(){i._unlocked||(i.playEmptySound(),"running"==i.context.state&&(document.removeEventListener("mousedown",i._unlock,!0),document.removeEventListener("touchend",i._unlock,!0),document.removeEventListener("touchstart",i._unlock,!0),i._unlocked=!0))},e.toString=function(){return"[WebAudioPlugin]"},e._addPropsToClasses=function(){var t=this._soundInstanceClass;t.context=this.context,t._scratchBuffer=i._scratchBuffer,t.destinationNode=this.gainNode,t._panningModel=this._panningModel,this._loaderClass.context=this.context},e._updateVolume=function(){var t=createjs.Sound._masterMute?0:this._volume;t!=this.gainNode.gain.value&&(this.gainNode.gain.value=t)},createjs.WebAudioPlugin=createjs.promote(t,"AbstractPlugin")}(),this.createjs=this.createjs||{},function(){"use strict";function t(){throw"HTMLAudioTagPool cannot be instantiated"}function e(){this._tags=[]}var i=t;i._tags={},i._tagPool=new e,i._tagUsed={},i.get=function(t){var e=i._tags[t];return null==e?(e=i._tags[t]=i._tagPool.get(),e.src=t):i._tagUsed[t]?(e=i._tagPool.get(),e.src=t):i._tagUsed[t]=!0,e},i.set=function(t,e){e==i._tags[t]?i._tagUsed[t]=!1:i._tagPool.set(e)},i.remove=function(t){var e=i._tags[t];return null!=e&&(i._tagPool.set(e),delete i._tags[t],delete i._tagUsed[t],!0)},i.getDuration=function(t){var e=i._tags[t];return null!=e&&e.duration?1e3*e.duration:0},createjs.HTMLAudioTagPool=t;var n=e.prototype;n.constructor=e,n.get=function(){var t;return t=0==this._tags.length?this._createTag():this._tags.pop(),null==t.parentNode&&document.body.appendChild(t),t},n.set=function(t){-1==createjs.indexOf(this._tags,t)&&(this._tags.src=null,this._tags.push(t))},n.toString=function(){return"[TagPool]"},n._createTag=function(){var t=document.createElement("audio");return t.autoplay=!1,t.preload="none",t}}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,n){this.AbstractSoundInstance_constructor(t,e,i,n),this._audioSpriteStopTime=null,this._delayTimeoutId=null,this._endedHandler=createjs.proxy(this._handleSoundComplete,this),this._readyHandler=createjs.proxy(this._handleTagReady,this),this._stalledHandler=createjs.proxy(this._playFailed,this),this._audioSpriteEndHandler=createjs.proxy(this._handleAudioSpriteLoop,this),this._loopHandler=createjs.proxy(this._handleSoundComplete,this),i?this._audioSpriteStopTime=.001*(e+i):this._duration=createjs.HTMLAudioTagPool.getDuration(this.src)}var e=createjs.extend(t,createjs.AbstractSoundInstance);e.setMasterVolume=function(){this._updateVolume()},e.setMasterMute=function(){this._updateVolume()},e.toString=function(){return"[HTMLAudioSoundInstance]"},e._removeLooping=function(){null!=this._playbackResource&&(this._playbackResource.loop=!1,this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},e._addLooping=function(){null==this._playbackResource||this._audioSpriteStopTime||(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.loop=!0)},e._handleCleanUp=function(){var t=this._playbackResource;if(null!=t){t.pause(),t.loop=!1,t.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),t.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),t.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),t.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),t.removeEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1);try{t.currentTime=this._startTime}catch(t){}createjs.HTMLAudioTagPool.set(this.src,t),this._playbackResource=null}},e._beginPlaying=function(t){return this._playbackResource=createjs.HTMLAudioTagPool.get(this.src),this.AbstractSoundInstance__beginPlaying(t)},e._handleSoundReady=function(){if(4!==this._playbackResource.readyState){var t=this._playbackResource;return t.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),t.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),t.preload="auto",void t.load()}this._updateVolume(),this._playbackResource.currentTime=.001*(this._startTime+this._position),this._audioSpriteStopTime?this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1):(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),0!=this._loop&&(this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.loop=!0)),this._playbackResource.play()},e._handleTagReady=function(){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),this._handleSoundReady()},e._pause=function(){this._playbackResource.pause()},e._resume=function(){this._playbackResource.play()},e._updateVolume=function(){if(null!=this._playbackResource){var t=this._muted||createjs.Sound._masterMute?0:this._volume*createjs.Sound._masterVolume;t!=this._playbackResource.volume&&(this._playbackResource.volume=t)}},e._calculateCurrentPosition=function(){return 1e3*this._playbackResource.currentTime-this._startTime},e._updatePosition=function(){this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,!1);try{this._playbackResource.currentTime=.001*(this._position+this._startTime)}catch(t){this._handleSetPositionSeek(null)}},e._handleSetPositionSeek=function(){null!=this._playbackResource&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._handleSetPositionSeek,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},e._handleAudioSpriteLoop=function(){this._playbackResource.currentTime<=this._audioSpriteStopTime||(this._playbackResource.pause(),0==this._loop?this._handleSoundComplete(null):(this._position=0,this._loop--,this._playbackResource.currentTime=.001*this._startTime,this._paused||this._playbackResource.play(),this._sendEvent("loop")))},e._handleLoop=function(){0==this._loop&&(this._playbackResource.loop=!1,this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this._loopHandler,!1))},e._updateStartTime=function(){this._audioSpriteStopTime=.001*(this._startTime+this._duration),this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1))},e._updateDuration=function(){this._audioSpriteStopTime=.001*(this._startTime+this._duration),this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._playbackResource.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._playbackResource.addEventListener(createjs.HTMLAudioPlugin._TIME_UPDATE,this._audioSpriteEndHandler,!1))},e._setDurationFromSource=function(){this._duration=createjs.HTMLAudioTagPool.getDuration(this.src),this._playbackResource=null},createjs.HTMLAudioSoundInstance=createjs.promote(t,"AbstractSoundInstance")}(),this.createjs=this.createjs||{},function(){"use strict";function t(){this.AbstractPlugin_constructor(),this._capabilities=i._capabilities,this._loaderClass=createjs.SoundLoader,this._soundInstanceClass=createjs.HTMLAudioSoundInstance}var e=createjs.extend(t,createjs.AbstractPlugin),i=t;i.MAX_INSTANCES=30,i._AUDIO_READY="canplaythrough",i._AUDIO_ENDED="ended",i._AUDIO_SEEKED="seeked",i._AUDIO_STALLED="stalled",i._TIME_UPDATE="timeupdate",i._capabilities=null,i.isSupported=function(){return i._generateCapabilities(),null!=i._capabilities},i._generateCapabilities=function(){if(null==i._capabilities){var t=document.createElement("audio");if(null==t.canPlayType)return null;i._capabilities={panning:!1,volume:!0,tracks:-1};for(var e=createjs.Sound.SUPPORTED_EXTENSIONS,n=createjs.Sound.EXTENSION_MAP,r=0,s=e.length;s>r;r++){var o=e[r],a=n[o]||o;i._capabilities[o]="no"!=t.canPlayType("audio/"+o)&&""!=t.canPlayType("audio/"+o)||"no"!=t.canPlayType("audio/"+a)&&""!=t.canPlayType("audio/"+a)}}},e.register=function(t){var e=createjs.HTMLAudioTagPool.get(t.src),i=this.AbstractPlugin_register(t);return i.setTag(e),i},e.removeSound=function(t){this.AbstractPlugin_removeSound(t),createjs.HTMLAudioTagPool.remove(t)},e.create=function(t,e,i){var n=this.AbstractPlugin_create(t,e,i);return n.playbackResource=null,n},e.toString=function(){return"[HTMLAudioPlugin]"},e.setVolume=e.getVolume=e.setMute=null,createjs.HTMLAudioPlugin=createjs.promote(t,"AbstractPlugin")}(),define("sound",["easel"],function(t){return function(){return t.createjs.Sound}}(this)),define("controllers/pageTurner",["constants","config","easel","sound"],function(t,e,i,n){var r={PREVIOUS:"previous",NEXT:"next"},s={LEFT:"left",RIGHT:"right",MIDDLE:"middle",BLANK:"blank"},o={TOP_LEFT:0,TOP_RIGHT:1,BOTTOM_LEFT:2,BOTTOM_RIGHT:3},a={RIGHT:1,BOTTOM:2},h=function(t,e,i,n){var r=new l;return r.setUpAnimation(t,e,i,n),r},c={PageFlip:{src:"pageFlip.mp3",loaded:!1}},l=function(){function n(t){d&&h()}function h(){var t={width:u.current.page.image.width,height:u.current.page.image.height/2},e={x:0,y:u.next.page.image.height/4},n=f?1:-1,r=g?-1:1,s=u.current.page.image.height/4+r*u.overleaf.page.y,o={x:t.width-n*u.overleaf.page.x,y:s},a=l.getGeometries(o);u.overleaf.page.rotation=n*r*-a.pageRotationAngle.degrees;var h={x:f?0:t.width,y:g?t.height:0},c={x:h.x,y:h.y+r*a.maskDimensions.height},d={x:h.x+n*a.maskDimensions.width,y:h.y},p=a.maskDimensions.width/t.width,m=15*(1-p);u.overleaf.underShadow.graphics.clear(),u.overleaf.underShadow.graphics.beginFill("rgb(0,0,0,0.3)").moveTo(u.overleaf.page.x-n*m,u.overleaf.page.y).lineTo((f?t.width:0)-d.x-n*m,d.y/2).lineTo((f?t.width:-2*t.width)+c.x-n*m,c.y-t.height/2).lineTo(u.overleaf.page.x-n*m,u.overleaf.page.y).endStroke();var v=0==p?a.maskDimensions.width:a.maskDimensions.width*(1-p),y=C(d,(new x).withDegrees(90+n*a.primaryAngle.degrees),n*-v),b=.6*(1-p),_="rgba(30,15,5,"+b+")";u.overleaf.overShadow.rotation=u.overleaf.page.rotation,u.overleaf.overShadow.x=u.overleaf.page.x,u.overleaf.overShadow.y=u.overleaf.page.y,u.overleaf.overShadow.graphics.clear(),u.overleaf.overShadow.graphics.beginLinearGradientFill(["rgba(30,15,5,0)",_,"rgba(30,15,5,0)"],[0,.2,1],d.x,d.y,y.x,y.y).drawRect(0,0,t.width,t.height);var w=new i.Shape;w.graphics.beginStroke("Red").moveTo(u.overleaf.page.x,u.overleaf.page.y).lineTo(u.overleaf.page.x+n*a.maskOffset.x,r*-e.y).lineTo(n*t.width,r*(a.maskDimensions.height-e.y)).lineTo(u.overleaf.page.x,u.overleaf.page.y).endStroke();var T=new i.Shape;T.graphics.beginStroke("Green").moveTo(0,r*-e.y).lineTo(u.overleaf.page.x+n*a.maskOffset.x,r*-e.y).lineTo(u.overleaf.page.x,u.overleaf.page.y).lineTo(n*t.width,r*(a.maskDimensions.height-e.y)).lineTo(n*t.width,r*e.y).lineTo(0,r*e.y).lineTo(0,r*-e.y).endStroke();var S=new i.Shape;S.graphics.beginStroke("Blue").moveTo(n*u.next.page.image.width,r*-e.y).lineTo(u.overleaf.page.x+n*a.maskOffset.x,r*-e.y).lineTo(n*u.next.page.image.width,r*(a.maskDimensions.height-e.y)).lineTo(n*u.next.page.image.width,r*-e.y).endStroke(),u.overleaf.page.mask=w,u.current.page.mask=T,u.next.page.mask=S}var l=this,u={},d=!1,f=!1,g=!1,p=0,m=null,v=!1;l.animationLayer=new i.Container;var y={before:0,during:0};l.setUpAnimation=function(t,e,i,n){t.pages.length>1?n==r.PREVIOUS?(u.current=b(t.pages[0],s.LEFT),u.passive=b(t.pages[1],s.RIGHT)):(0==i&&t.pages[0].width!=t.pages[1].width&&(v=!0),u.passive=b(t.pages[0],s.LEFT,{introPageFadeOut:v}),u.current=b(t.pages[1],s.RIGHT)):(u.current=b(t.pages[0],s.MIDDLE),y.before=n==r.NEXT?-1:1,y.during=-y.before),n==r.PREVIOUS?(p=o.BOTTOM_LEFT,e.pages.length>1?(u.overleaf=b(e.pages[1],s.RIGHT,{useShadow:!0}),u.next=b(e.pages[0],s.LEFT)):(u.overleaf=b(e.pages[0],s.MIDDLE,{useShadow:!0}),u.next=b(e.pages[0],s.BLANK),y.during=-1)):(p=o.BOTTOM_RIGHT,e.pages.length>1?(u.overleaf=b(e.pages[0],s.LEFT,{useShadow:!0}),u.next=b(e.pages[1],s.RIGHT)):(u.overleaf=b(e.pages[0],s.MIDDLE,{useShadow:!0}),u.next=b(e.pages[0],s.BLANK),y.during=1)),1==t.pages.length&&1==e.pages.length&&(y.during*=2),u.passive&&l.animationLayer.addChild(u.passive.container),l.animationLayer.addChild(u.current.container),l.animationLayer.addChild(u.next.container),l.animationLayer.addChild(u.overleaf.container)};var b=function(t,e,n){if(!t.zoomLevels||0==t.zoomLevels.length)return null;var r=t.zoomLevels[t.z].zoomLevelView,o=r.container.parent,a=r.width,h=2*r.height,c={x:0,y:-r.height/2};e==s.LEFT?c.x-=a:e==s.MIDDLE?c.x-=.5*a:e==s.BLANK&&(c.x-=20*a),o.cache(c.x,c.y,a,h);var l=new i.Bitmap(o.cacheCanvas);l.x=0,l.y=-r.height/2,o.uncache();var u=new i.Container,d=new i.Shape,f=new i.Shape;return n&&n.useShadow&&u.addChild(f),u.addChild(l),n&&n.useShadow&&u.addChild(d),{page:l,container:u,overShadow:d,underShadow:f,fadeOut:n&&n.introPageFadeOut}};this.start=function(t){f=(p&a.RIGHT)==a.RIGHT,g=(p&a.BOTTOM)==a.BOTTOM;var i=u.current.page.image.width/2;f?(u.passive&&(u.passive.page.x=-u.passive.page.image.width),u.overleaf.page.x=u.overleaf.page.image.width,u.overleaf.overShadow.x=u.overleaf.page.image.width):(u.overleaf.page.regX=u.overleaf.page.image.width,u.overleaf.overShadow.regX=u.overleaf.page.image.width,u.overleaf.page.x=-u.overleaf.page.image.width,u.overleaf.overShadow.x=-u.overleaf.page.image.width,u.current.page.x=-u.current.page.image.width,u.next.page.x=-u.next.page.image.width),g&&(u.overleaf.page.regY=u.overleaf.page.image.height/2,u.overleaf.overShadow.regY=u.overleaf.page.image.height/2,u.overleaf.page.y=u.overleaf.page.image.height/4,u.overleaf.overShadow.y=u.overleaf.page.image.height/4),y.before&&(u.current.container.parent.x+=y.before*i),h();var n={totalTime:e.pageTurnDurationMs||400,sidewaysTranslation:y};u.passive&&u.passive.page.image.width-u.current.page.image.width>10&&(n.fadeOut=!0),u.next&&u.next.page.image.width!=u.current.page.image.width&&(n.fadeIn=!0);var r=_(n.totalTime);T(r,n,t),e.pageTurnAudioEnabled&&l.ifAudioAvailableThenPlay("PageFlip")};var _=function(t){for(var e=[],i=0;i<1;i+=.1){var n=1-i,r=n*(n*i*.3+i*n*.3)+i*(n*n*.3);e.push({x:i,y:r,time:1})}var s=e.reduce(function(t,e){return t+e.time},0);return e.map(function(e){return{x:2*e.x*u.current.page.image.width,y:e.y*u.current.page.image.height,time:e.time/s*t}})},w=function(t){return(g?u.current.page.image.height/2-t:t)-u.current.page.image.height/4},T=function(t,e,r){i.Ticker.addEventListener("tick",n),d=!0;var s=i.Tween.get(u.overleaf.page),o=f?1:-1,a=Math.min(200,e.totalTime);if(e.fadeOut){i.Tween.get(u.passive.container).to({alpha:0},a,i.Ease.linear)}if(e.fadeIn){u.next.container.alpha=0;i.Tween.get(u.next.container).wait(e.totalTime-a).to({alpha:1},a,i.Ease.linear)}if(e.sidewaysTranslation.during){i.Tween.get(u.current.container.parent).to({x:u.current.container.parent.x+e.sidewaysTranslation.during*(u.current.page.image.width/2)},e.totalTime,i.Ease.quartIn)}for(var c=0;c<t.length;++c){var l=t[c],g=o*(u.current.page.image.width-l.x),p=w(l.y);s.to({x:g,y:p},l.time,i.Ease.linear)}s.call(function(){h(),d=!1,r()})};l.ifAudioAvailableThenPlay=function(e){if(null==m&&(m=i.Sound.initializeDefaultPlugins()),m&&c[e]){var n=c[e];n.loaded?i.Sound.play(e):(i.Sound.addEventListener("fileload",function(){n.loaded=!0,i.Sound.play(e)}),i.Sound.registerSounds([{id:e,src:n.src}],t.audioResourcesFolder))}};var x=function(){var t=this;return t.degrees=0,t.radians=0,t.withDegrees=function(e){return t.degrees=e,t.radians=e/(180/Math.PI),t},t.withRadians=function(e){return t.radians=e,t.degrees=e*(180/Math.PI),t},t.addDegrees=function(e){return(new x).withDegrees(t.degrees+e)},t};l.getGeometries=function(t){var e={};if(0==t.x?e.primaryAngle=(new x).withDegrees(0):e.primaryAngle=(new x).withRadians(Math.abs(Math.atan(-t.y/t.x))),e.maskRotationAngle=(new x).withDegrees(90-e.primaryAngle.degrees),e.pageRotationAngle=(new x).withDegrees(180-2*e.maskRotationAngle.degrees),0==e.pageRotationAngle.radians)e.maskOffset={x:0,y:0};else{var i=t.y/Math.tan(e.pageRotationAngle.radians),n=(t.x-i)/Math.tan(e.primaryAngle.radians)-t.y;e.maskOffset={x:i,y:isNaN(n)?0:n}}var r=0==Math.tan(e.primaryAngle.radians)?0:(t.x-i)/Math.tan(e.primaryAngle.radians);return e.maskDimensions={width:S(e.maskOffset.x,t.y),height:r},e};var S=function(t,e){return Math.sqrt(t*t+e*e)},C=function(t,e,i){var n=Math.sin(e.radians)*i,r=Math.cos(e.radians)*i;return{x:t.x+n,y:t.y+r}}};return{createAnimation:h,DIRECTION:r}}),define("config/pageMode",["constants","config","events"],function(t,e,i){var n={SINGLE_PAGE:"SINGLE_PAGE",DOUBLE_PAGE:"DOUBLE_PAGE"};return new function r(){if(!(this instanceof r))return new r;var s=this;s.configureFromYuduBook=function(t){var i=t.settings.pageMode;e.twoPageMode=!(i&&i==n.SINGLE_PAGE),e.pageModeStopToggle=t.settings.pageModeStopToggle},s.autoSetTwoPageMode=function(){if(!e.pageModeStopToggle){var i=!1;e.width>t.maxPhoneWidth&&(i=e.width>e.height),s.setTwoPageMode(i)}},s.setTwoPageMode=function(t){if(!e.pageModeStopToggle){var n=e.twoPageMode!=t;e.twoPageMode=t,n&&i.emit("config/pageMode",i.TWO_UP_CHANGED,this,{})}},s.togglePageMode=function(){s.setTwoPageMode(!e.twoPageMode)}}}),define("controllers/shifter",["easel","config","constants","controllers/tray","controllers/pageTurner","events","fetching/fetchHandler","config/pageMode"],function(t,e,i,n,r,s,o,a){var h={default:"default",changingTwoPageMode:"changeTwoPageMode",fittingWidth:"fitWidth",resizing:"resize",springing:"spring",skipping:"skip",dragging:"drag",zooming:"zoom",turning:"turn",syncingUgc:"syncUgc"};return{Shifter:function(o){function a(){c.tryChangeState(h.default)}var c=this;this.pages=o,this.pageIndexOffset=e.hasIntroPage?0:1,this.container=new t.Container;var l=[],u=$("#yudu_overlays"),d=$("#yudu_interactiveOverlays"),f=[];this.fadingTileIds=[],this.pagesAndZooms={},this.fadingOverlayIds=[],this.fadingOutOverlayIds=[],this.flashingOverlayIds=[],this.trays=[];for(var g=0;g<3;g++){var p=new n.Tray;this.container.addChildAt(p.container,0),this.trays.push(p)}this.velocityMax=1e4,this.velocityScale=300,this.springCoefficient=-250,this.dampingCoefficient=-60,this.mass=5,this.velocity=0,this.displacement=0,this.displacementScreen=1e3,this.displacementRatio=e.width/this.displacementScreen,this.triggerMarker=.05*this.displacementScreen,this.bounceVelocity=1e3,this.shouldFireUpdateEvent=!1,this.currentPage=0,this.initialPage=0,this.lastDragData=null,this.lastZoomData=null,this.prevState=null,this.state=h.default,this.initialised=!1,this.init=function(t){this.initialised=!0,this.currentPage=t,this.initialPage=t,this.recentre(),this.updateTrayLocation(),this.repageAll(),this.setLowestZoomLevel(),this.updatePosition(),this.tryChangeState(h.default),s.subscribe(s.ALL,s.TILE_FADE_START,this.handleTileFadeStart),s.subscribe(s.ALL,s.TILE_FADE_END,this.handleTileFadeEnd),s.subscribe(s.ALL,s.OVERLAY_FADE_START,this.handleOverlayFadeStart),s.subscribe(s.ALL,s.OVERLAY_FADE_END,this.handleOverlayFadeEnd),s.subscribe(s.ALL,s.OVERLAY_FADE_OUT_START,this.handleOverlayFadeOutStart),s.subscribe(s.ALL,s.OVERLAY_FADE_OUT_END,this.handleOverlayFadeOutEnd),s.subscribe(s.ALL,s.OVERLAY_FLASH_START,this.handleOverlayFlashStart),s.subscribe(s.ALL,s.OVERLAY_FLASH_END,this.handleOverlayFlashEnd),s.subscribe(s.ALL,s.OVERLAY_TWEENS_REMOVED,this.handleOverlayTweensRemoved),s.subscribe(s.ALL,s.ZOOMLEVEL_TILESLOADED,this.handleTilesLoaded),s.subscribe(s.ALL,s.UGC_CHANGED,this.handleUgcChanged)},this.handleTilesLoaded=function(t){const e=t.data.pageNumber,i=t.data.z;c.pagesAndZooms[e]||(c.pagesAndZooms[e]=[]),c.pagesAndZooms[e].push(i)},this.handleTileFadeStart=function(t){c.fadingTileIds.push(t.data.id)},this.handleTileFadeEnd=function(t){c.fadingTileIds=c.fadingTileIds.filter(function(e){return e!==t.data.id})},this.handleOverlayFadeStart=function(t){c.fadingOverlayIds.includes(t.data.id)||c.fadingOverlayIds.push(t.data.id)},this.handleOverlayFadeEnd=function(t){c.fadingOverlayIds=c.fadingOverlayIds.filter(function(e){return e!==t.data.id})},this.handleOverlayFadeOutStart=function(t){c.fadingOutOverlayIds.includes(t.data.id)||c.fadingOutOverlayIds.push(t.data.id)},this.handleOverlayFadeOutEnd=function(t){c.fadingOutOverlayIds=c.fadingOutOverlayIds.filter(function(e){return e!==t.data.id})},this.handleOverlayFlashStart=function(t){c.flashingOverlayIds.includes(t.data.id)||c.flashingOverlayIds.push(t.data.id)},this.handleOverlayFlashEnd=function(t){c.flashingOverlayIds=c.flashingOverlayIds.filter(function(e){return e!==t.data.id})},this.handleOverlayTweensRemoved=function(t){c.flashingOverlayIds=c.flashingOverlayIds.filter(function(e){return e!==t.data.id}),c.fadingOverlayIds=c.fadingOverlayIds.filter(function(e){return e!==t.data.id}),c.fadingOutOverlayIds=c.fadingOutOverlayIds.filter(function(e){return e!==t.data.id})},this.handleUgcChanged=function(){c.tryChangeState(h.syncingUgc)},this.isStateChangeAllowed=function(t,e){return t==h.default||e==h.default||e==h.changingTwoPageMode||(e==h.dragging?this.state==h.springing:e==h.springing&&this.state==h.dragging)},this.defaultState=function(){this.state=h.default},this.tryChangeState=function(t){return this.state==t||!!this.isStateChangeAllowed(this.state,t)&&(this.state=t,!0)},this.setLowestZoomLevel=function(){var t=this.getLeftTray().getLowestZoomStateZ(),i=this.getCentreTray().getLowestZoomStateZ(),n=this.getRightTray().getLowestZoomStateZ();return t==i?void(e.lowestZoomLevel=t):i==n?void(e.lowestZoomLevel=i):void(e.lowestZoomLevel=Math.min(t,n,i))},this.getBasePage=function(){var t=this.currentPage;return t?t-(t+this.pageIndexOffset)%this.getPagesPerTray():0},this.getPagesPerTray=function(){return e.twoPageMode?2:1},this.setTray=function(t,i){return i<=-this.getPagesPerTray()||i>this.getNumberOfPages()-1?void t.empty():(i=Math.max(i,0),e.twoPageMode?void(!e.hasIntroPage&&0==i||i==this.getNumberOfPages()-1?t.setPages(this.getPage(i)):t.setPages(this.getPage(i),this.getPage(i+1))):void t.setPages(this.getPage(i)))},this.performReveal=function(){this.getCentreTray().triggerShow()},this.goNextPageUnanimated=function(){this.goNextPage(!0)},this.goNextPage=function(t,i){return this.isLastPage()?(this.bouncePage(-this.bounceVelocity),!1):e.pageTurnEnabled&&e.twoPageMode&&!1!==e.userPreferences.pageTurn&&!i?c.getCentreTray().currentZoomStateIndex>0?(s.emit("shifter",s.ZOOM,this,{direction:-3,scaled:!1,x:0,y:0}),void T(function(){c.goNextPage(t)})):!(this.state==h.turning||!this.tryChangeState(h.turning))&&void b(r.DIRECTION.NEXT,function(){m(!0)}):m(t)};var m=function(t){c.moveTraysLeft(t);var e=c.changeCurrentPage(c.getCentreTray().getBasePage());return c.setTray(c.getRightTray(),c.getBasePage()+c.getCentreTray().length),y(e)},v=function(t){c.moveTraysRight(t);var e=c.changeCurrentPage(c.getCentreTray().getBasePage()),i=1==c.currentPage?1:c.getPagesPerTray();return c.setTray(c.getLeftTray(),c.getBasePage()-i),y(e)},y=function(t){return c.resetZoomLevels(),c.getCentreTray().setToTop(),s.emit("shifter",s.PAGE_CHANGED,this,t),!0};this.goPreviousPageUnanimated=function(){this.goPreviousPage(!0)},this.goPreviousPage=function(t,i){return this.isFirstPage()?(this.bouncePage(this.bounceVelocity),!1):e.pageTurnEnabled&&e.twoPageMode&&!1!==e.userPreferences.pageTurn&&!i?c.getCentreTray().currentZoomStateIndex>0?(s.emit("shifter",s.ZOOM,this,{direction:-3,scaled:!1,x:0,y:0}),void T(function(){c.goPreviousPage(t)})):!(this.state==h.turning||!this.tryChangeState(h.turning))&&void b(r.DIRECTION.PREVIOUS,function(){v(!0)}):v(t)};var b=function(t,e){var i=r.createAnimation(c.getCentreTray(),t==r.DIRECTION.PREVIOUS?c.getLeftTray():c.getRightTray(),c.currentPage,t);c.getCentreTray().container.addChild(i.animationLayer),u.hide(),d.hide();for(var n=0;n<c.getCentreTray().pages.length;++n)for(var s=c.getCentreTray().pages[n],o=0;o<s.zoomLevels.length;++o){var a=s.zoomLevels[o];a.zoomLevelView&&_(a.zoomLevelView.container.parent)}i.start(function(){w(),d.show(),u.show(),c.getCentreTray().container.removeChild(i.animationLayer),"function"==typeof e&&(e(),c.displacement=0),c.resize()})},_=function(t){t.visible=!1,f.push(t)},w=function(){for(;f.length>0;){f.pop().visible=!0}},T=function(t){l.push(t)},x=function(){if(0!=l.length){l.shift()()}};this.isLastPage=function(){return this.getBasePage()+this.getCentreTray().length>this.getNumberOfPages()-1||0==this.getRightTray().length},this.isFirstPage=function(){return 0==this.getBasePage()||0==this.getLeftTray().length},this.bouncePage=function(t){this.velocity=t,this.tryChangeState(h.springing)},this.goToPage=function(t){if(!this.getCentreTray().hasPage(t))return this.getLeftTray().hasPage(t)?void this.goPreviousPage():this.getRightTray().hasPage(t)?void this.goNextPage():void(t>this.currentPage?this.skipToPageRight(t):this.skipToPageLeft(t))},this.goToSnapPage=function(t){this.stopAllTweens();var e=this.changeCurrentPage(t);this.repageAll(),this.clearFakePages(),this.defaultState(),this.updatePosition(),this.recentre(),s.emit("shifter",s.PAGE_CHANGED,this,e)},this.skipToPageRight=function(t){if(this.tryChangeState(h.skipping)){var e=t-this.currentPage-1,i=this.changeCurrentPage(t);this.moveTraysLeft(),this.setTray(this.getCentreTray(),t),this.resetZoomLevels();var n=this.getLeftTray().addFakePages(e),r=this.getXOffset()+n;this.getLeftTray().reposition(-r),this.displacement=r/this.displacementRatio,this.getCentreTray().setToTop(),s.emit("shifter",s.PAGE_CHANGED,this,i)}},this.skipToPageLeft=function(t){if(this.tryChangeState(h.skipping)){var e=this.currentPage-t-1,i=this.changeCurrentPage(t);this.moveTraysRight(),this.setTray(this.getCentreTray(),t),this.resetZoomLevels();var n=this.getCentreTray().addFakePages(e),r=this.getXOffset()+n;this.getRightTray().reposition(r),this.displacement=-r/this.displacementRatio,this.getCentreTray().setToTop(),s.emit("shifter",s.PAGE_CHANGED,this,i)}},this.stopAllTweens=function(){for(var t=0,e=this.trays.length;t<e;t++)this.trays[t].stopTweens()},this.moveTraysLeft=function(t){this.trays.push(this.trays.splice(0,1)[0]),this.updateTrayLocation(),this.container.addChildAt(this.container.getChildAt(2),0),this.displacement=Math.min(this.displacement+this.displacementScreen,this.displacementScreen),this.shouldFireUpdateEvent=!0,this.updatePosition(),this.tryChangeState(t?h.default:h.springing)},this.moveTraysRight=function(t){this.trays.unshift(this.trays.pop()),this.updateTrayLocation(),this.container.addChild(this.container.getChildAt(0)),this.displacement=Math.max(this.displacement-this.displacementScreen,-this.displacementScreen),this.shouldFireUpdateEvent=!0,this.updatePosition(),this.tryChangeState(t?h.default:h.springing)},this.getPage=function(t){var i=this.pages[t];return i.encrypted&&e.decryptionKey&&i.decrypt(e.decryptionKey),i.initialised||i.init(),i},this.updatePosition=function(){var t=this.getXOffset();this.getLeftTray().reposition(-t),this.getRightTray().reposition(t),this.getCentreTray().reposition(0)},this.updateTrayLocation=function(){this.getLeftTray().setIsCentre(!1),this.getRightTray().setIsCentre(!1),this.getCentreTray().setIsCentre(!0)},this.getXOffset=function(){return e.width},this.getLeftTray=function(){return this.trays[0]},this.getCentreTray=function(){return this.trays[1]},this.getRightTray=function(){return this.trays[2]},this.repageLeftRightTrays=function(){var t=this.getBasePage();this.setTray(this.getRightTray(),t+this.getCentreTray().length),this.setTray(this.getLeftTray(),t-this.getPagesPerTray())},this.repageAll=function(){if(this.initialised){var t=this.getBasePage();this.setTray(this.getCentreTray(),t),this.setTray(this.getRightTray(),t+this.getCentreTray().length),this.setTray(this.getLeftTray(),t-this.getPagesPerTray())}},this.resize=function(){this.tryChangeState(h.resizing),this.stopAllFakeAnimations(),this.recentre(),this.updatePosition(),this.container.x=0,this.velocity=0,this.displacement=0,this.displacementRatio=e.width/this.displacementScreen,this.setLowestZoomLevel(),this.repageAll()},this.recentre=function(){this.container.regX=-e.width/2,this.container.regY=-e.height/2,this.container.x=this.container.y=0},this.forceEndSkip=function(){this.recentre(),this.updatePosition(),this.clearFakePages(),this.repageLeftRightTrays()},this.clearFakePages=function(){for(var t=0;t<3;t++)this.trays[t].removeFakePages()},this.applyMaskToOverlayContainerIfNecessary=function(){this.getLeftTray().applyMaskToOverlayContainerIfNecessary(),this.getCentreTray().applyMaskToOverlayContainerIfNecessary(),this.getRightTray().applyMaskToOverlayContainerIfNecessary()},this.handleDragStart=function(t){this.getCentreTray().canDrag()&&this.tryChangeState(h.dragging)&&(this.lastDragData={x:t.data.deltaX,y:t.data.deltaY})},this.handleDrag=function(t){if(this.state==h.dragging){this.lastZoomData=null;var i=(t.data.deltaX-this.lastDragData.x)*e.pixelDensity,n=(t.data.deltaY-this.lastDragData.y)*e.pixelDensity;if(this.lastDragData={x:t.data.deltaX,y:t.data.deltaY},i>0&&this.container.x<0||i<0&&this.container.x>0){var r=this.container.x+i;return void(this.container.x=Math.max(-e.width,Math.min(r,e.width)))}var s=i;this.getCentreTray().isEmpty()||(s=this.getCentreTray().handleMove(i,n));var r=this.container.x+s;this.container.x=Math.max(-e.width,Math.min(r,e.width))}},this.handleDragEnd=function(t){if(this.state!=h.dragging||!this.lastDragData)return void(this.lastDragData=null);if(this.tryChangeState(h.springing),this.lastDragData=null,this.velocity=0,this.displacement=this.container.x/this.displacementRatio,t){var e=Math.min(t.data.velocityX*this.velocityScale,this.velocityMax);this.velocity=Math.abs(t.data.angle)<90?e:-e}this.getCentreTray().isEmpty()||this.getCentreTray().moveEnd();var i=Math.round((this.container.x+this.velocity)/this.getXOffset());i<0?this.goNextPage(!1,!0):i>0&&this.goPreviousPage(!1,!0)},this.update=function(t){var e=this.prevState==this.state;if(this.prevState=this.state,this.state!=h.skipping&&this.state!=h.springing)return this.state==h.default?(x(),0!==this.fadingTileIds.length||0!==this.fadingOverlayIds.length||0!==this.fadingOutOverlayIds.length||0!==this.flashingOverlayIds.length||!e):(this.state!=h.resizing&&this.state!=h.fittingWidth&&this.state!=h.syncingUgc||this.tryChangeState(h.default),!0);var n=0;do{var r=(this.springCoefficient*this.displacement+this.dampingCoefficient*this.velocity)/this.mass;this.velocity+=r/i.fps,this.displacement+=this.velocity/i.fps,n+=i.tickTimeMs}while(n<t);var o=Math.abs(this.displacement);return this.shouldFireUpdateEvent&&o<this.triggerMarker&&(this.repageAll(),this.updatePosition(),this.clearFakePages(),
this.applyMaskToOverlayContainerIfNecessary(),this.shouldFireUpdateEvent=!1,this.tryChangeState(h.springing)),o<1&&Math.abs(this.velocity)<1&&(this.performReveal(),this.defaultState(),this.displacement=0,this.velocity=0),this.container.x=Math.round(this.displacement*this.displacementRatio),this.state!=h.default&&s.emit("shifter",s.SHIFTER_SPRINGING,this,{}),!0},this.zoom=function(t){this.state!=h.default&&this.state!=h.springing||(this.tryChangeState(h.zooming),this.getCentreTray().zoom(t.data.direction,t.data.x,t.data.y,a))},this.zoomScale=function(t){if(this.tryChangeState(h.zooming)){var e=t.data.x,i=t.data.y;if(t.data.end)return void this.zoomScaleEnd(e,i);if(!this.lastZoomData)return void(this.lastZoomData={page:this.getCentreTray().getBasePage(),startScale:this.getCentreTray().getScale(),startPinchScale:t.data.scale,x:e,y:i});var n=t.data.scale*this.lastZoomData.startScale;this.getCentreTray().zoomScale(n,e,i),this.lastZoomData.x=e,this.lastZoomData.y=i}},this.zoomScaleEnd=function(t,e){if(!this.lastZoomData||this.lastZoomData.page!=this.getCentreTray().getBasePage())return this.defaultState(),void(this.lastZoomData=null);t&&e||(t=this.lastZoomData.x,e=this.lastZoomData.y),this.getCentreTray().zoomResolve(t,e),this.defaultState(),this.lastZoomData=null},this.resetZoomLevels=function(){for(var t=0;t<3;t++)this.trays[t].resetZoom()},this.emptyAll=function(){for(var t=0;t<3;t++)this.trays[t].empty()},this.snapNewPageMode=function(){var t=this.getPagesPerTray(),e=this.getBasePage();1==t&&(this.getLeftTray().applyMaskToOverlayContainer(),this.getRightTray().applyMaskToOverlayContainer()),this.emptyAll(),this.setTray(this.getLeftTray(),e-t),this.setTray(this.getCentreTray(),e),this.setTray(this.getRightTray(),e+this.getCentreTray().length),this.updatePosition(),this.recentre(),this.setLowestZoomLevel()},this.newFit=function(){this.tryChangeState(h.fittingWidth),this.emptyAll();var t=this.getPagesPerTray(),e=this.getBasePage();this.setTray(this.getLeftTray(),e-t),this.setTray(this.getCentreTray(),e),this.setTray(this.getRightTray(),e+this.getCentreTray().length),this.updatePosition(),this.getCentreTray().setToTop(),this.recentre(),this.setLowestZoomLevel()},this.willNewFitHaveVisibleEffect=function(){var t=this.getCentreTray().getZoomBounds();return!(t.width>.9*e.width&&t.width<1.1*e.width)},this.triggerFalseZoom=function(){this.getCentreTray().anim_falseZoomIn(a)},this.newTwoPageMode=function(){this.tryChangeState(h.changingTwoPageMode);var t=this.areAnyPagesAnimating();this.snapNewPageMode();var i=this.getPagesPerTray(),n=this.currentPage%2==this.pageIndexOffset,r=this.getCentreTray().getBasePage();return 0==r&&!e.hasIntroPage||r==this.getNumberOfPages()-1?void this.getCentreTray().anim_wobble(a):t?void this.stopAllFakeAnimations():1==i?(this.getCentreTray().anim_fakePairToSingle(n,a),void(n?this.getRightTray().anim_fakeMoveToAdjacentTray(!n,a):this.getLeftTray().anim_fakeMoveToAdjacentTray(!n,a))):(2==i&&(this.getCentreTray().anim_fakeSingleToPair(n,a),this.getCentreTray().anim_fakeMoveFromAdjacentTray(!n,a)),void(this.willNewFitHaveVisibleEffect()||e.setFitOnlyWidth(!1)))},this.areAnyPagesAnimating=function(){for(var t=0,e=this.trays.length;t<e;t++)if(this.trays[t].areAnyPagesAnimating())return!0;return!1},this.stopAllFakeAnimations=function(){for(var t=0,e=this.trays.length;t<e;t++)this.trays[t].stopFakeAnimations()},this.getCurrentPage=function(){var t=this.getCentreTray();return t.isEmpty()?null:t.findPage(this.currentPage)},this.handleTap=function(t){return this.state==h.default&&this.getCentreTray().handleTap(t)},this.changeCurrentPage=function(t){var i={oldPage:this.currentPage};return e.twoPageMode&&(0!=this.currentPage||e.hasIntroPage)&&this.currentPage+1<this.getNumberOfPages()&&(i.oldPage2=this.currentPage+1),this.currentPage=t,i.page=t,e.twoPageMode&&(0!=this.currentPage||e.hasIntroPage)&&t+1<this.getNumberOfPages()&&(i.page2=t+1),i},this.getCurrentPageNumber=function(){return this.currentPage},this.getNumberOfPages=function(){return this.pages.length},this.loggedIn=function(){this.repageAll(),this.resize()},this.isPageShowing=function(t){var i=e.twoPageMode&&(e.hasIntroPage||this.getCurrentPageNumber()>0)&&this.getCurrentPageNumber()<this.getNumberOfPages();return this.getCurrentPageNumber()==t||i&&this.getCurrentPageNumber()+1==t},this.isPageInTray=function(t){return this.getLeftTray().hasPage(t)||this.getCentreTray().hasPage(t)||this.getRightTray().hasPage(t)},s.subscribe(s.ALL,s.DRAG,s.callback(this,this.handleDrag),!1),s.subscribe(s.ALL,s.DRAG_END,s.callback(this,this.handleDragEnd),!1),s.subscribe(s.ALL,s.DRAG_START,s.callback(this,this.handleDragStart),!1),s.subscribe(s.ALL,s.ZOOM,s.callback(this,this.zoom),!1),s.subscribe(s.ALL,s.ZOOM_SCALE,s.callback(this,this.zoomScale),!1),s.subscribe(s.ALL,s.RESIZE,s.callback(this,this.resize),!1),s.subscribe(s.ALL,s.TWO_UP_CHANGED,s.callback(this,this.newTwoPageMode),!1),s.subscribe(s.ALL,s.FIT_CHANGED,s.callback(this,this.newFit),!1),s.subscribe(s.ALL,s.LOGIN_SUCCESS,s.callback(this,this.loggedIn),!1)},EMITTER_NAME:"shifter"}}),define("model/phoneOverlay",["events","config","model/overlay","utils/statistics","utils/tools"],function(t,e,i,n,r){var s=function(t,n,s,o,a,h,c,l){i.Overlay.call(this,t,n,s,o,a,h,c,l),this.contactNumber=h["@t"],this.rectColour=e.phoneOverlayColour,this.init=function(){return this.createRectAndHitArea(),this.rect},this.clicked=function(){r.openURL("tel:"+this.contactNumber,!1)}};return s.prototype=i.Overlay.prototype,{PhoneOverlay:s}}),define("controllers/overlayController",["model/webLinkOverlay","views/overlayView","model/emailLinkOverlay","model/pageLinkOverlay","model/productOverlay","model/audioOverlay","model/videoOverlay","model/imageOverlay","model/htmlOverlay","model/launchableHtmlOverlay","model/contentOverlay","model/urlContentOverlay","model/overlay","events","constants","resources","config","controllers/shifter","utils/tools","model/phoneOverlay"],function(t,e,i,n,r,s,o,a,h,c,l,u,d,f,g,p,m,v,y,b){return{OverlayController:function(_){this.initialised=!1,this.maxOverlayId=1,this.pageNumber=_,this.overlays=[],this.launchableOverlays=[],this.overlayView=new e.OverlayView,this.init=function(e){f.subscribe(l.EMITTER_NAME,f.TRIGGER,f.callback(this,this.toggleTargetVisibilityAndTriggerContent)),f.subscribe(v.EMITTER_NAME,f.PAGE_CHANGED,f.callback(this,this.hideAllTriggeredOverlaysIfPageChanged));for(var u in e)switch(u){case"ol":this.createOverlays(t.WebLinkOverlay,e.ol);break;case"e":this.createOverlays(i.EmailLinkOverlay,e.e);break;case"pn":this.createOverlays(b.PhoneOverlay,e.pn);break;case"il":this.createOverlays(n.PageLinkOverlay,e.il);break;case"pc":(p.priceList||p.rollovers)&&this.createOverlays(r.ProductOverlay,e.pc);break;case"a":this.createOverlays(s.AudioOverlay,e.a);break;case"v":this.createOverlays(o.VideoOverlay,e.v);break;case"i":this.createOverlays(a.ImageOverlay,e.i);break;case"html":this.createOverlays(h.HtmlOverlay,e.html);break;case"lHtml":this.createOverlays(c.LaunchableHtmlOverlay,e.lHtml,this.launchableOverlays);break;case"trigger":this.createOverlays(l.ContentOverlay,e.trigger);break;case"c":this.createUrlContentOverlays(e.c);break;default:continue}this.reorderOverlaysByZIndex();for(var d=0,g=this.overlays.length;d<g;d++)this.overlayView.addOverlay(this.overlays[d].init())},this.toggleTargetVisibilityAndTriggerContent=function(t){if(t.data.pageNumber==this.pageNumber)for(var e=0;e<this.overlays.length;e++)this.overlays[e].triggerableId==t.data.triggerTargetId&&this.overlays[e].triggerToggle(),this.overlays[e]==t.target&&this.overlayView.replaceOverlay(this.overlays[e].rect,e)},this.hideAllTriggeredOverlaysIfPageChanged=function(t){t.data.oldPage!=this.pageNumber&&t.data.oldPage2!=this.pageNumber||this.hideAllTriggeredOverlaysAndRestoreTriggerMainContent()},this.hideAllTriggeredOverlaysAndRestoreTriggerMainContent=function(){for(var t=0;t<this.overlays.length;t++)this.overlays[t].triggerTargetId&&this.overlays[t].showAlternateContent&&(this.overlays[t].toggleContent(),this.overlayView.replaceOverlay(this.overlays[t].rect,t)),this.overlays[t].triggerableId&&this.overlays[t].triggerOff()},this.createUrlContentOverlays=function(t){t=t instanceof Array?t:[t];for(var e=0;e<t.length;e++){switch(y.getContentTypeFromUrl(t[e]["@t"])){case g.urlContentOverlayTypes.youTube:this.createOverlays(u.UrlContentOverlay,t[e]);break;case g.urlContentOverlayTypes.image:this.createOverlays(a.ImageOverlay,t[e]);break;case g.urlContentOverlayTypes.video:this.createOverlays(o.VideoOverlay,t[e]);break;case g.urlContentOverlayTypes.audio:this.createOverlays(s.AudioOverlay,t[e])}}},this.createOverlays=function(t,e,i){e=e instanceof Array?e:[e];for(var n=0;n<e.length;n++){var r=e[n]["#text"].split(","),s=new t(r[0],r[1],r[2],r[3],e[n]["@z"],e[n],this.pageNumber,this.maxOverlayId);this.maxOverlayId++,s.isValid&&(this.overlays.push(s),i&&i.push(s))}},this.reorderOverlaysByZIndex=function(){this.overlays.sort(d.Overlay.zIndexComparator)},this.pageReady=function(){this.flashOverlays(),this.triggerAutoPlayMedia()},this.triggerAutoPlayMedia=function(){for(var t=0;t<this.overlays.length;t++)this.overlays[t].triggerAutoPlay()},this.flashOverlays=function(){for(var t=0;t<this.overlays.length;t++)this.overlays[t].flash(g.pauseBeforeOverlayFlash)},this.getContainer=function(){return this.overlayView.container},this.scaleOverlays=function(t,e){var i=t.width/e.width,n=t.height/e.height;this.getContainer().set({scaleX:i,scaleY:n})},this.handleTap=function(t){for(var e=this.overlays.length-1;e>=0;e--)if(this.overlays[e].handleTap(t))return!0;return!1},this.handleMouseInteraction=function(t){for(var e=this.overlays.length-1;e>=0&&!this.handleOverlayMouseInteraction(t,this.overlays[e]);e--);for(var i=e-1;i>=0;i--)this.overlays[i].mouseOut()},this.handleOverlayMouseInteraction=function(t,e){return!e.intersect({x:t.pageX*m.pixelDensity,y:(t.pageY-m.readerYOffset)*m.pixelDensity})||this.getContainer().mask&&!this.intersectWhenMaskApplied({x:t.pageX*m.pixelDensity,y:(t.pageY-m.readerYOffset)*m.pixelDensity})?(e.isMouseIn&&e.mouseOut(),!1):(e.isMouseIn||e.mouseIn(),!0)},this.intersectWhenMaskApplied=function(t){return!!this.getContainer()&&(t={x:this.getContainer().globalToLocal(t.x,0).x,y:this.getContainer().globalToLocal(0,t.y).y},t.x>0&&t.y>0&&t.x<this.pageWidth&&t.y<this.pageHeight)},this.hide=function(){for(var t=0;t<this.overlays.length;t++)this.overlays[t]instanceof h.HtmlOverlay&&this.overlays[t].hide()},this.setOverlaysHitArea=function(t,e){this.pageWidth=t,this.pageHeight=e;for(var i=0,n=this.getContainer().getNumChildren();i<n;i++){var r=new createjs.Shape,s=this.getContainer().mask?Math.min(this.overlays[i].width,t-this.overlays[i].x):this.overlays[i].width,o=this.getContainer().mask?Math.min(this.overlays[i].height,e-this.overlays[i].y):this.overlays[i].height;r.graphics.beginFill("#000").drawRect(this.overlays[i].x,this.overlays[i].y,s,o),this.getContainer().getChildAt(i).hitArea=r}}}}});var fabric=fabric||{version:"1.5.0"};"undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow?fabric.document.createWindow():fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",function(){function t(t,e){this.__eventListeners[t]&&(e?fabric.util.removeFromArray(this.__eventListeners[t],e):this.__eventListeners[t].length=0)}function e(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function i(e,i){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in e)t.call(this,n,e[n]);else t.call(this,e,i);return this}}function n(t,e){if(this.__eventListeners){var i=this.__eventListeners[t];if(i){for(var n=0,r=i.length;r>n;n++)i[n].call(this,e||{});return this}}}fabric.Observable={observe:e,stopObserving:i,fire:n,on:e,off:i,trigger:n}}(),fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var t=0,e=arguments.length;e>t;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(t,e,i){var n=this.getObjects();return i?n[e]=t:n.splice(e,0,t),this._onObjectAdded(t),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var t,e=this.getObjects(),i=0,n=arguments.length;n>i;i++)-1!==(t=e.indexOf(arguments[i]))&&(e.splice(t,1),this._onObjectRemoved(arguments[i]));return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),n=i.length;n--;)t.call(e,i[n],n,i);return this},getObjects:function(t){return void 0===t?this._objects:this._objects.filter(function(e){return e.type===t})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(t){return this.getObjects().indexOf(t)>-1},complexity:function(){return this.getObjects().reduce(function(t,e){return t+=e.complexity?e.complexity():0},0)}},function(t){var e=Math.sqrt,i=Math.atan2,n=Math.PI/180;fabric.util={removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*n},radiansToDegrees:function(t){return t/n},rotatePoint:function(t,e,i){var n=Math.sin(i),r=Math.cos(i);t.subtractEquals(e);var s=t.x*r-t.y*n,o=t.x*n+t.y*r;return new fabric.Point(s,o).addEquals(e)},transformPoint:function(t,e,i){return i?new fabric.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new fabric.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},invertTransform:function(t){var e=t.slice(),i=1/(t[0]*t[3]-t[1]*t[2]);e=[i*t[3],-i*t[1],-i*t[2],i*t[0],0,0];var n=fabric.util.transformPoint({x:t[4],y:t[5]},e);return e[4]=-n.x,e[5]=-n.y,e},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),n=parseFloat(t);switch(e||(e=fabric.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*fabric.DPI/25.4;case"cm":return n*fabric.DPI/2.54;case"in":return n*fabric.DPI;case"pt":return n*fabric.DPI/72;case"pc":return n*fabric.DPI/72*12;case"em":return n*e;default:return n}},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},resolveNamespace:function(e){if(!e)return fabric;for(var i=e.split("."),n=i.length,r=t||fabric.window,s=0;n>s;++s)r=r[i[s]];return r},loadImage:function(t,e,i,n){if(!t)return void(e&&e.call(i,t));var r=fabric.util.createImage();r.onload=function(){e&&e.call(i,r),r=r.onload=r.onerror=null},r.onerror=function(){fabric.log("Error loading "+r.src),e&&e.call(i,null,!0),r=r.onload=r.onerror=null},0!==t.indexOf("data")&&void 0!==n&&(r.crossOrigin=n),r.src=t},enlivenObjects:function(t,e,i,n){function r(){++o===a&&e&&e(s)}t=t||[];var s=[],o=0,a=t.length;return a?void t.forEach(function(t,e){if(!t||!t.type)return void r();var o=fabric.util.getKlass(t.type,i);o.async?o.fromObject(t,function(i,o){o||(s[e]=i,n&&n(t,s[e])),r()}):(s[e]=o.fromObject(t),n&&n(t,s[e]),r())}):void(e&&e(s))},groupSVGElements:function(t,e,i){var n;return n=new fabric.PathGroup(t,e),void 0!==i&&n.setSourcePath(i),n},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var n=0,r=i.length;r>n;n++)i[n]in t&&(e[i[n]]=t[i[n]])},drawDashedLine:function(t,n,r,s,o,a){var h=s-n,c=o-r,l=e(h*h+c*c),u=i(c,h),d=a.length,f=0,g=!0;for(t.save(),t.translate(n,r),t.moveTo(0,0),t.rotate(u),n=0;l>n;)n+=a[f++%d],n>l&&(n=l),t[g?"lineTo":"moveTo"](n,0),g=!g;t.restore()},createCanvasElement:function(t){return t||(t=fabric.document.createElement("canvas")),t.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(t),t},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(t){for(var e=t.prototype,i=e.stateProperties.length;i--;){var n=e.stateProperties[i],r=n.charAt(0).toUpperCase()+n.slice(1),s="set"+r,o="get"+r;e[o]||(e[o]=function(t){return new Function('return this.get("'+t+'")')}(n)),e[s]||(e[s]=function(t){return new Function("value",'return this.set("'+t+'", value)')}(n))}},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,i,n){n>0&&(e>n?e-=n:e=0,i>n?i-=n:i=0);for(var r=!0,s=t.getImageData(e,i,2*n||1,2*n||1),o=3,a=s.data.length;a>o;o+=4){if(!1===(r=0>=s.data[o]))break}return s=null,r}}}("undefined"!=typeof exports?exports:this),function(){function t(t,n,s,o,h,c,l){var u=a.call(arguments);if(r[u])return r[u];var d=Math.PI,f=l*d/180,g=Math.sin(f),p=Math.cos(f),m=0,v=0;s=Math.abs(s),o=Math.abs(o);var y=-p*t*.5-g*n*.5,b=-p*n*.5+g*t*.5,_=s*s,w=o*o,T=b*b,x=y*y,S=_*w-_*T-w*x,C=0;if(0>S){var E=Math.sqrt(1-S/(_*w));s*=E,o*=E}else C=(h===c?-1:1)*Math.sqrt(S/(_*T+w*x));var O=C*s*b/o,A=-C*o*y/s,P=p*O-g*A+.5*t,k=g*O+p*A+.5*n,L=i(1,0,(y-O)/s,(b-A)/o),I=i((y-O)/s,(b-A)/o,(-y-O)/s,(-b-A)/o);0===c&&I>0?I-=2*d:1===c&&0>I&&(I+=2*d);for(var D=Math.ceil(Math.abs(I/d*2)),M=[],j=I/D,R=8/3*Math.sin(j/4)*Math.sin(j/4)/Math.sin(j/2),N=L+j,F=0;D>F;F++)M[F]=e(L,N,p,g,s,o,P,k,R,m,v),m=M[F][4],v=M[F][5],L=N,N+=j;return r[u]=M,M}function e(t,e,i,n,r,o,h,c,l,u,d){var f=a.call(arguments);if(s[f])return s[f];var g=Math.cos(t),p=Math.sin(t),m=Math.cos(e),v=Math.sin(e),y=i*r*m-n*o*v+h,b=n*r*m+i*o*v+c,_=u+l*(-i*r*p-n*o*g),w=d+l*(-n*r*p+i*o*g),T=y+l*(i*r*v+n*o*m),x=b+l*(n*r*v-i*o*m);return s[f]=[_,w,T,x,y,b],s[f]}function i(t,e,i,n){var r=Math.atan2(e,t),s=Math.atan2(n,i);return s>=r?s-r:2*Math.PI-(r-s)}function n(t,e,i,n,r,s,h,c){var l=a.call(arguments);if(o[l])return o[l];var u,d,f,g,p,m,v,y,b=Math.sqrt,_=Math.min,w=Math.max,T=Math.abs,x=[],S=[[],[]];d=6*t-12*i+6*r,u=-3*t+9*i-9*r+3*h,f=3*i-3*t;for(var C=0;2>C;++C)if(C>0&&(d=6*e-12*n+6*s,u=-3*e+9*n-9*s+3*c,f=3*n-3*e),T(u)<1e-12){if(T(d)<1e-12)continue;(g=-f/d)>0&&1>g&&x.push(g)}else 0>(v=d*d-4*f*u)||(y=b(v),p=(-d+y)/(2*u),p>0&&1>p&&x.push(p),(m=(-d-y)/(2*u))>0&&1>m&&x.push(m));for(var E,O,A,P=x.length,k=P;P--;)g=x[P],A=1-g,E=A*A*A*t+3*A*A*g*i+3*A*g*g*r+g*g*g*h,S[0][P]=E,O=A*A*A*e+3*A*A*g*n+3*A*g*g*s+g*g*g*c,S[1][P]=O;S[0][k]=t,S[1][k]=e,S[0][k+1]=h,S[1][k+1]=c;var L=[{x:_.apply(null,S[0]),y:_.apply(null,S[1])},{x:w.apply(null,S[0]),y:w.apply(null,S[1])}];return o[l]=L,L}var r={},s={},o={},a=Array.prototype.join;fabric.util.drawArc=function(e,i,n,r){for(var s=r[0],o=r[1],a=r[2],h=r[3],c=r[4],l=r[5],u=r[6],d=[[],[],[],[]],f=t(l-i,u-n,s,o,h,c,a),g=0,p=f.length;p>g;g++)d[g][0]=f[g][0]+i,d[g][1]=f[g][1]+n,d[g][2]=f[g][2]+i,d[g][3]=f[g][3]+n,d[g][4]=f[g][4]+i,d[g][5]=f[g][5]+n,e.bezierCurveTo.apply(e,d[g])},fabric.util.getBoundsOfArc=function(e,i,r,s,o,a,h,c,l){for(var u=0,d=0,f=[],g=[],p=t(c-e,l-i,r,s,a,h,o),m=[[],[]],v=0,y=p.length;y>v;v++)f=n(u,d,p[v][0],p[v][1],p[v][2],p[v][3],p[v][4],p[v][5]),m[0].x=f[0].x+e,m[0].y=f[0].y+i,m[1].x=f[1].x+e,m[1].y=f[1].y+i,g.push(m[0]),g.push(m[1]),u=p[v][4],d=p[v][5];return g},fabric.util.getBoundsOfCurve=n}(),function(){function t(t,e){for(var i=r.call(arguments,2),n=[],s=0,o=t.length;o>s;s++)n[s]=i.length?t[s][e].apply(t[s],i):t[s][e].call(t[s]);return n}function e(t,e){return n(t,e,function(t,e){return t>=e})}function i(t,e){return n(t,e,function(t,e){return e>t})}function n(t,e,i){if(t&&0!==t.length){var n=t.length-1,r=e?t[n][e]:t[n];if(e)for(;n--;)i(t[n][e],r)&&(r=t[n][e]);else for(;n--;)i(t[n],r)&&(r=t[n]);return r}}var r=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0===i)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==Number.POSITIVE_INFINITY&&n!==Number.NEGATIVE_INFINITY&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1;for(var r=n>=0?n:Math.max(i-Math.abs(n),0);i>r;r++)if(r in e&&e[r]===t)return r;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var i=0,n=this.length>>>0;n>i;i++)i in this&&t.call(e,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(t,e){for(var i=[],n=0,r=this.length>>>0;r>n;n++)n in this&&(i[n]=t.call(e,this[n],n,this));return i}),Array.prototype.every||(Array.prototype.every=function(t,e){for(var i=0,n=this.length>>>0;n>i;i++)if(i in this&&!t.call(e,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t,e){for(var i=0,n=this.length>>>0;n>i;i++)if(i in this&&t.call(e,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(t,e){for(var i,n=[],r=0,s=this.length>>>0;s>r;r++)r in this&&(i=this[r],t.call(e,i,r,this)&&n.push(i));return n}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var e,i=this.length>>>0,n=0;if(arguments.length>1)e=arguments[1];else for(;;){if(n in this){e=this[n++];break}if(++n>=i)throw new TypeError}for(;i>n;n++)n in this&&(e=t.call(null,e,this[n],n,this));return e}),fabric.util.array={invoke:t,min:i,max:e}}(),function(){function t(t,e){for(var i in e)t[i]=e[i];return t}function e(e){return t({},e)}fabric.util.object={extend:t,clone:e}}(),function(){function t(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})}function e(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())}function i(t){return t.replace(/&/g,"&").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:t,capitalize:e,escapeXml:i}}(),function(){var t=Array.prototype.slice,e=Function.prototype.apply,i=function(){};Function.prototype.bind||(Function.prototype.bind=function(n){var r,s=this,o=t.call(arguments,1);return r=o.length?function(){return e.call(s,this instanceof i?this:n,o.concat(t.call(arguments)))}:function(){return e.call(s,this instanceof i?this:n,arguments)},i.prototype=this.prototype,r.prototype=new i,r})}(),function(){function t(){}function e(t){var e=this.constructor.superclass.prototype[t];return arguments.length>1?e.apply(this,n.call(arguments,1)):e.call(this)}function i(){function i(){this.initialize.apply(this,arguments)}var s=null,a=n.call(arguments,0);"function"==typeof a[0]&&(s=a.shift()),i.superclass=s,i.subclasses=[],s&&(t.prototype=s.prototype,i.prototype=new t,s.subclasses.push(i));for(var h=0,c=a.length;c>h;h++)o(i,a[h],s);return i.prototype.initialize||(i.prototype.initialize=r),i.prototype.constructor=i,i.prototype.callSuper=e,i}var n=Array.prototype.slice,r=function(){},s=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),o=function(t,e,i){for(var n in e)t.prototype[n]=n in t.prototype&&"function"==typeof t.prototype[n]&&(e[n]+"").indexOf("callSuper")>-1?function(t){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var r=e[t].apply(this,arguments);return this.constructor.superclass=n,"initialize"!==t?r:void 0}}(n):e[n],s&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};fabric.util.createClass=i}(),function(){function t(t){var e,i,n=Array.prototype.slice.call(arguments,1),r=n.length;for(i=0;r>i;i++)if(e=typeof t[n[i]],!/^(?:function|object|unknown)$/.test(e))return!1;return!0}function e(t,e){return{handler:e,wrappedHandler:i(t,e)}}function i(t,e){return function(i){e.call(o(t),i||fabric.window.event)}}function n(t,e){return function(i){if(p[t]&&p[t][e])for(var n=p[t][e],r=0,s=n.length;s>r;r++)n[r].call(this,i||fabric.window.event)}}function r(t,e){t||(t=fabric.window.event);var i=t.target||(typeof t.srcElement!==h?t.srcElement:null),n=fabric.util.getScrollLeftTop(i,e);return{x:m(t)+n.left,y:v(t)+n.top}}function s(t,e,i){var n="touchend"===t.type?"changedTouches":"touches";return t[n]&&t[n][0]?t[n][0][e]-(t[n][0][e]-t[n][0][i])||t[i]:t[i]}var o,a,h="unknown",c=function(){var t=0;return function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+t++)}}();!function(){var t={};o=function(e){return t[e]},a=function(e,i){t[e]=i}}();var l,u,d=t(fabric.document.documentElement,"addEventListener","removeEventListener")&&t(fabric.window,"addEventListener","removeEventListener"),f=t(fabric.document.documentElement,"attachEvent","detachEvent")&&t(fabric.window,"attachEvent","detachEvent"),g={},p={};d?(l=function(t,e,i){t.addEventListener(e,i,!1)},u=function(t,e,i){t.removeEventListener(e,i,!1)}):f?(l=function(t,i,n){var r=c(t);a(r,t),g[r]||(g[r]={}),g[r][i]||(g[r][i]=[]);var s=e(r,n);g[r][i].push(s),t.attachEvent("on"+i,s.wrappedHandler)},u=function(t,e,i){var n,r=c(t);if(g[r]&&g[r][e])for(var s=0,o=g[r][e].length;o>s;s++)(n=g[r][e][s])&&n.handler===i&&(t.detachEvent("on"+e,n.wrappedHandler),g[r][e][s]=null)}):(l=function(t,e,i){var r=c(t);if(p[r]||(p[r]={}),!p[r][e]){p[r][e]=[];var s=t["on"+e];s&&p[r][e].push(s),t["on"+e]=n(r,e)}p[r][e].push(i)},u=function(t,e,i){var n=c(t);if(p[n]&&p[n][e])for(var r=p[n][e],s=0,o=r.length;o>s;s++)r[s]===i&&r.splice(s,1)}),fabric.util.addListener=l,fabric.util.removeListener=u;var m=function(t){return typeof t.clientX!==h?t.clientX:0},v=function(t){return typeof t.clientY!==h?t.clientY:0};fabric.isTouchSupported&&(m=function(t){return s(t,"pageX","clientX")},v=function(t){return s(t,"pageY","clientY")}),fabric.util.getPointer=r,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function t(t,e){var i=t.style;if(!i)return t;if("string"==typeof e)return t.style.cssText+=";"+e,e.indexOf("opacity")>-1?s(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var n in e)if("opacity"===n)s(t,e[n]);else{var r="float"===n||"cssFloat"===n?void 0===i.styleFloat?"cssFloat":"styleFloat":n;i[r]=e[n]}return t}var e=fabric.document.createElement("div"),i="string"==typeof e.style.opacity,n="string"==typeof e.style.filter,r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,s=function(t){return t};i?s=function(t,e){return t.style.opacity=e,t}:n&&(s=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),r.test(i.filter)?(e=e>=.9999?"":"alpha(opacity="+100*e+")",i.filter=i.filter.replace(r,e)):i.filter+=" alpha(opacity="+100*e+")",t}),fabric.util.setStyle=t}(),function(){function t(t){return"string"==typeof t?fabric.document.getElementById(t):t}function e(t,e){var i=fabric.document.createElement(t);for(var n in e)"class"===n?i.className=e[n]:"for"===n?i.htmlFor=e[n]:i.setAttribute(n,e[n]);return i}function i(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)}function n(t,i,n){return"string"==typeof i&&(i=e(i,n)),t.parentNode&&t.parentNode.replaceChild(i,t),i.appendChild(t),i}function r(t,e){var i,n,r=0,s=0,o=fabric.document.documentElement,a=fabric.document.body||{scrollLeft:0,scrollTop:0};for(n=t;t&&t.parentNode&&!i;)t=t.parentNode,1===t.nodeType&&"fixed"===fabric.util.getElementStyle(t,"position")&&(i=t),1===t.nodeType&&n!==e&&"absolute"===fabric.util.getElementStyle(t,"position")?(r=0,s=0):t===fabric.document?(r=a.scrollLeft||o.scrollLeft||0,s=a.scrollTop||o.scrollTop||0):(r+=t.scrollLeft||0,s+=t.scrollTop||0);return{left:r,top:s}}function s(t){var e,i,n=t&&t.ownerDocument,r={left:0,top:0},s={left:0,top:0},o={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!n)return{left:0,top:0};for(var a in o)s[o[a]]+=parseInt(c(t,a),10)||0;return e=n.documentElement,void 0!==t.getBoundingClientRect&&(r=t.getBoundingClientRect()),i=fabric.util.getScrollLeftTop(t,null),{left:r.left+i.left-(e.clientLeft||0)+s.left,top:r.top+i.top-(e.clientTop||0)+s.top}}var o,a=Array.prototype.slice,h=function(t){return a.call(t,0)};try{o=h(fabric.document.childNodes)instanceof Array}catch(t){}o||(h=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e});var c;c=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(t,e){var i=fabric.document.defaultView.getComputedStyle(t,null);return i?i[e]:void 0}:function(t,e){var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),i},function(){function t(t){return void 0!==t.onselectstart&&(t.onselectstart=fabric.util.falseFunction),n?t.style[n]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t}function e(t){return void 0!==t.onselectstart&&(t.onselectstart=null),n?t.style[n]="":"string"==typeof t.unselectable&&(t.unselectable=""),t}var i=fabric.document.documentElement.style,n="userSelect"in i?"userSelect":"MozUserSelect"in i?"MozUserSelect":"WebkitUserSelect"in i?"WebkitUserSelect":"KhtmlUserSelect"in i?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=t,fabric.util.makeElementSelectable=e}(),function(){function t(t,e){var i=fabric.document.getElementsByTagName("head")[0],n=fabric.document.createElement("script"),r=!0;n.onload=n.onreadystatechange=function(t){if(r){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;r=!1,e(t||fabric.window.event),n=n.onload=n.onreadystatechange=null}},n.src=t,i.appendChild(n)}fabric.util.getScript=t}(),fabric.util.getById=t,fabric.util.toArray=h,fabric.util.makeElement=e,fabric.util.addClass=i,fabric.util.wrapElement=n,fabric.util.getScrollLeftTop=r,fabric.util.getElementOffset=s,fabric.util.getElementStyle=c}(),function(){function t(t,e){return t+(/\?/.test(t)?"&":"?")+e}function e(){}function i(i,r){r||(r={});var s,o=r.method?r.method.toUpperCase():"GET",a=r.onComplete||function(){},h=n();return h.onreadystatechange=function(){4===h.readyState&&(a(h),h.onreadystatechange=e)},"GET"===o&&(s=null,"string"==typeof r.parameters&&(i=t(i,r.parameters))),h.open(o,i,!0),("POST"===o||"PUT"===o)&&h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),h.send(s),h}var n=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=t.length;e--;)try{if(t[e]())return t[e]}catch(t){}}();fabric.util.request=i}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(t){void 0!==console[t]&&"function"==typeof console[t].apply&&(fabric[t]=function(){return console[t].apply(console,arguments)})}),function(){function t(t){e(function(i){t||(t={});var n,r=i||+new Date,s=t.duration||500,o=r+s,a=t.onChange||function(){},h=t.abort||function(){return!1},c=t.easing||function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},l="startValue"in t?t.startValue:0,u="endValue"in t?t.endValue:100,d=t.byValue||u-l;t.onStart&&t.onStart(),function i(u){n=u||+new Date;var f=n>o?s:n-r;return h()?void(t.onComplete&&t.onComplete()):(a(c(f,l,d,s)),n>o?void(t.onComplete&&t.onComplete()):void e(i))}(r)})}function e(){return i.apply(fabric.window,arguments)}
var i=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t){fabric.window.setTimeout(t,1e3/60)};fabric.util.animate=t,fabric.util.requestAnimFrame=e}(),function(){function t(t,e,i,n){return t<Math.abs(e)?(t=e,n=i/4):n=i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:n}}function e(t,e,i){return t.a*Math.pow(2,10*(e-=1))*Math.sin(2*(e*i-t.s)*Math.PI/t.p)}function i(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e}function n(t,e,i,n){return t/=n/2,1>t?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e}function r(t,e,i,n){return i*(t/=n)*t*t*t+e}function s(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e}function o(t,e,i,n){return t/=n/2,1>t?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e}function a(t,e,i,n){return i*(t/=n)*t*t*t*t+e}function h(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e}function c(t,e,i,n){return t/=n/2,1>t?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e}function l(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e}function u(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e}function d(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e}function f(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e}function g(t,e,i,n){return t===n?e+i:i*(1-Math.pow(2,-10*t/n))+e}function p(t,e,i,n){return 0===t?e:t===n?e+i:(t/=n/2,1>t?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e)}function m(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e}function v(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e}function y(t,e,i,n){return t/=n/2,1>t?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e}function b(i,n,r,s){var o=0,a=r;return 0===i?n:1===(i/=s)?n+r:(o||(o=.3*s),-e(t(a,r,o,1.70158),i,s)+n)}function _(e,i,n,r){var s=0,o=n;if(0===e)return i;if(1===(e/=r))return i+n;s||(s=.3*r);var a=t(o,n,s,1.70158);return a.a*Math.pow(2,-10*e)*Math.sin(2*(e*r-a.s)*Math.PI/a.p)+a.c+i}function w(i,n,r,s){var o=0,a=r;if(0===i)return n;if(2===(i/=s/2))return n+r;o||(o=.3*s*1.5);var h=t(a,r,o,1.70158);return 1>i?-.5*e(h,i,s)+n:h.a*Math.pow(2,-10*(i-=1))*Math.sin(2*(i*s-h.s)*Math.PI/h.p)*.5+h.c+n}function T(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e}function x(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e}function S(t,e,i,n,r){return void 0===r&&(r=1.70158),t/=n/2,1>t?i/2*t*t*((1+(r*=1.525))*t-r)+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e}function C(t,e,i,n){return i-E(n-t,0,i,n)+e}function E(t,e,i,n){return(t/=n)<1/2.75?7.5625*i*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}function O(t,e,i,n){return n/2>t?.5*C(2*t,0,i,n)+e:.5*E(2*t-n,0,i,n)+.5*i+e}fabric.util.ease={easeInQuad:function(t,e,i,n){return i*(t/=n)*t+e},easeOutQuad:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},easeInOutQuad:function(t,e,i,n){return t/=n/2,1>t?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,n){return i*(t/=n)*t*t+e},easeOutCubic:i,easeInOutCubic:n,easeInQuart:r,easeOutQuart:s,easeInOutQuart:o,easeInQuint:a,easeOutQuint:h,easeInOutQuint:c,easeInSine:l,easeOutSine:u,easeInOutSine:d,easeInExpo:f,easeOutExpo:g,easeInOutExpo:p,easeInCirc:m,easeOutCirc:v,easeInOutCirc:y,easeInElastic:b,easeOutElastic:_,easeInOutElastic:w,easeInBack:T,easeOutBack:x,easeInOutBack:S,easeInBounce:C,easeOutBounce:E,easeInOutBounce:O}}(),function(t){"use strict";function e(t){return t in w?w[t]:t}function i(t,e,i,n){var r,s="[object Array]"===Object.prototype.toString.call(e);return"fill"!==t&&"stroke"!==t||"none"!==e?"strokeDashArray"===t?e=e.replace(/,/g," ").split(/\s+/).map(function(t){return parseFloat(t)}):"transformMatrix"===t?e=i&&i.transformMatrix?_(i.transformMatrix,g.parseTransformAttribute(e)):g.parseTransformAttribute(e):"visible"===t?(e="none"!==e&&"hidden"!==e,i&&!1===i.visible&&(e=!1)):"originX"===t?e="start"===e?"left":"end"===e?"right":"center":r=s?e.map(b):b(e,n):e="",!s&&isNaN(r)?e:r}function n(t){for(var e in T)if(t[e]&&void 0!==t[T[e]]&&0!==t[e].indexOf("url(")){var i=new g.Color(t[e]);t[e]=i.setAlpha(y(i.getAlpha()*t[T[e]],2)).toRgba()}return t}function r(t,n){var r,s;t.replace(/;$/,"").split(";").forEach(function(t){var o=t.split(":");r=e(o[0].trim().toLowerCase()),s=i(r,o[1].trim()),n[r]=s})}function s(t,n){var r,s;for(var o in t)void 0!==t[o]&&(r=e(o.toLowerCase()),s=i(r,t[o]),n[r]=s)}function o(t,e){var i={};for(var n in g.cssRules[e])if(a(t,n.split(" ")))for(var r in g.cssRules[e][n])i[r]=g.cssRules[e][n][r];return i}function a(t,e){var i,n=!0;return i=c(t,e.pop()),i&&e.length&&(n=h(t,e)),i&&n&&0===e.length}function h(t,e){for(var i,n=!0;t.parentNode&&1===t.parentNode.nodeType&&e.length;)n&&(i=e.pop()),t=t.parentNode,n=c(t,i);return 0===e.length}function c(t,e){var i,n=t.nodeName,r=t.getAttribute("class"),s=t.getAttribute("id");if(i=new RegExp("^"+n,"i"),e=e.replace(i,""),s&&e.length&&(i=new RegExp("#"+s+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")),r&&e.length){r=r.split(" ");for(var o=r.length;o--;)i=new RegExp("\\."+r[o]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(i,"")}return 0===e.length}function l(t){for(var e=t.getElementsByTagName("use");e.length;){for(var i,n=e[0],r=n.getAttribute("xlink:href").substr(1),s=n.getAttribute("x")||0,o=n.getAttribute("y")||0,a=t.getElementById(r).cloneNode(!0),h=(a.getAttribute("transform")||"")+" translate("+s+", "+o+")",c=0,l=n.attributes,u=l.length;u>c;c++){var d=l.item(c);"x"!==d.nodeName&&"y"!==d.nodeName&&"xlink:href"!==d.nodeName&&("transform"===d.nodeName?h=d.nodeValue+" "+h:a.setAttribute(d.nodeName,d.nodeValue))}a.setAttribute("transform",h),a.setAttribute("instantiated_by_use","1"),a.removeAttribute("id"),i=n.parentNode,i.replaceChild(a,n)}}function u(t,e,i){var n,r,s,o,a=t.getAttribute("viewBox"),h=1,c=1,l=0,u=0;if(a&&(a=a.match(x))&&(l=-parseFloat(a[1]),u=-parseFloat(a[2]),n=parseFloat(a[3]),r=parseFloat(a[4]),e&&e!==n&&(h=e/n),i&&i!==r&&(c=i/r),c=h=h>c?c:h,1!==h||1!==c||0!==l||0!==u)){if(s=" matrix("+h+" 0 0 "+c+" "+l*h+" "+u*c+") ","svg"===t.tagName){for(o=t.ownerDocument.createElement("g");null!=t.firstChild;)o.appendChild(t.firstChild);t.appendChild(o)}else o=t,s=o.getAttribute("transform")+s;o.setAttribute("transform",s)}}function d(t){var e=t.objects,i=t.options;return e=e.map(function(t){return g[m(t.type)].fromObject(t)}),{objects:e,options:i}}function f(t,e,i){e[i]&&e[i].toSVG&&t.push('<pattern x="0" y="0" id="',i,'Pattern" ','width="',e[i].source.width,'" height="',e[i].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',e[i].source.width,'" height="',e[i].source.height,'" xlink:href="',e[i].source.src,'"></image></pattern>')}var g=t.fabric||(t.fabric={}),p=g.util.object.extend,m=g.util.string.capitalize,v=g.util.object.clone,y=g.util.toFixed,b=g.util.parseUnit,_=g.util.multiplyTransformMatrices,w={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},T={stroke:"strokeOpacity",fill:"fillOpacity"};g.cssRules={},g.gradientDefs={},g.parseTransformAttribute=function(){function t(t,e){var i=e[0];t[0]=Math.cos(i),t[1]=Math.sin(i),t[2]=-Math.sin(i),t[3]=Math.cos(i)}function e(t,e){var i=e[0],n=2===e.length?e[1]:e[0];t[0]=i,t[3]=n}function i(t,e){t[2]=Math.tan(g.util.degreesToRadians(e[0]))}function n(t,e){t[1]=Math.tan(g.util.degreesToRadians(e[0]))}function r(t,e){t[4]=e[0],2===e.length&&(t[5]=e[1])}var s=[1,0,0,1,0,0],o=g.reNum,a="(?:\\s+,?\\s*|,\\s*)",h="(?:(skewX)\\s*\\(\\s*("+o+")\\s*\\))",c="(?:(skewY)\\s*\\(\\s*("+o+")\\s*\\))",l="(?:(rotate)\\s*\\(\\s*("+o+")(?:"+a+"("+o+")"+a+"("+o+"))?\\s*\\))",u="(?:(scale)\\s*\\(\\s*("+o+")(?:"+a+"("+o+"))?\\s*\\))",d="(?:(translate)\\s*\\(\\s*("+o+")(?:"+a+"("+o+"))?\\s*\\))",f="(?:(matrix)\\s*\\(\\s*("+o+")"+a+"("+o+")"+a+"("+o+")"+a+"("+o+")"+a+"("+o+")"+a+"("+o+")\\s*\\))",p="(?:"+f+"|"+d+"|"+u+"|"+l+"|"+h+"|"+c+")",m="(?:"+p+"(?:"+a+p+")*)",v="^\\s*(?:"+m+"?)\\s*$",y=new RegExp(v),b=new RegExp(p,"g");return function(o){var a=s.concat(),h=[];if(!o||o&&!y.test(o))return a;o.replace(b,function(o){var c=new RegExp(p).exec(o).filter(function(t){return""!==t&&null!=t}),l=c[1],u=c.slice(2).map(parseFloat);switch(l){case"translate":r(a,u);break;case"rotate":u[0]=g.util.degreesToRadians(u[0]),t(a,u);break;case"scale":e(a,u);break;case"skewX":i(a,u);break;case"skewY":n(a,u);break;case"matrix":a=u}h.push(a.concat()),a=s.concat()});for(var c=h[0];h.length>1;)h.shift(),c=g.util.multiplyTransformMatrices(c,h[0]);return c}}();var x=new RegExp("^\\s*("+g.reNum+"+)\\s*,?\\s*("+g.reNum+"+)\\s*,?\\s*("+g.reNum+"+)\\s*,?\\s*("+g.reNum+"+)\\s*$");g.parseSVGDocument=function(){function t(t,e){for(;t&&(t=t.parentNode);)if(e.test(t.nodeName)&&!t.getAttribute("instantiated_by_use"))return!0;return!1}var e=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,i=/^(symbol|image|marker|pattern|view)$/;return function(n,r,s){if(n){l(n);var o,a,h=new Date,c=g.Object.__uid++,d=!1;if(n.getAttribute("width")&&"100%"!==n.getAttribute("width")&&(o=b(n.getAttribute("width"))),n.getAttribute("height")&&"100%"!==n.getAttribute("height")&&(a=b(n.getAttribute("height"))),!o||!a){var f=n.getAttribute("viewBox");f&&(f=f.match(x))?(o=parseFloat(f[3]),a=parseFloat(f[4])):d=!0}u(n,o,a);var p=g.util.toArray(n.getElementsByTagName("*"));if(0===p.length&&g.isLikelyNode){p=n.selectNodes('//*[name(.)!="svg"]');for(var m=[],y=0,_=p.length;_>y;y++)m[y]=p[y];p=m}var w=p.filter(function(n){return i.test(n.tagName)&&u(n,0,0),e.test(n.tagName)&&!t(n,/^(?:pattern|defs|symbol)$/)});if(!w||w&&!w.length)return void(r&&r([],{}));var T={width:o,height:a,svgUid:c,toBeParsed:d};g.gradientDefs[c]=g.getGradientDefs(n),g.cssRules[c]=g.getCSSRules(n),g.parseElements(w,function(t){g.documentParsingTime=new Date-h,r&&r(t,T)},v(T),s)}}}();var S={has:function(t,e){e(!1)},get:function(){},set:function(){}},C=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+g.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+g.reNum+"))?\\s+(.*)");p(g,{parseFontDeclaration:function(t,e){var i=t.match(C);if(i){var n=i[1],r=i[3],s=i[4],o=i[5],a=i[6];n&&(e.fontStyle=n),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),s&&(e.fontSize=b(s)),a&&(e.fontFamily=a),o&&(e.lineHeight="normal"===o?1:o)}},getGradientDefs:function(t){var e,i,n,r,s=t.getElementsByTagName("linearGradient"),o=t.getElementsByTagName("radialGradient"),a=0,h=[],c={},l={};for(h.length=s.length+o.length,i=s.length;i--;)h[a++]=s[i];for(i=o.length;i--;)h[a++]=o[i];for(;a--;)e=h[a],r=e.getAttribute("xlink:href"),n=e.getAttribute("id"),r&&(l[n]=r.substr(1)),c[n]=e;for(n in l){var u=c[l[n]].cloneNode(!0);for(e=c[n];u.firstChild;)e.appendChild(u.firstChild)}return c},parseAttributes:function(t,r,s){if(t){var a,h,c={};void 0===s&&(s=t.getAttribute("svgUid")),t.parentNode&&/^symbol|[g|a]$/i.test(t.parentNode.nodeName)&&(c=g.parseAttributes(t.parentNode,r,s)),h=c&&c.fontSize||t.getAttribute("font-size")||g.Text.DEFAULT_SVG_FONT_SIZE;var l=r.reduce(function(n,r){return a=t.getAttribute(r),a&&(r=e(r),a=i(r,a,c,h),n[r]=a),n},{});return l=p(l,p(o(t,s),g.parseStyleAttribute(t))),l.font&&g.parseFontDeclaration(l.font,l),n(p(c,l))}},parseElements:function(t,e,i,n){new g.ElementsParser(t,e,i,n).parse()},parseStyleAttribute:function(t){var e={},i=t.getAttribute("style");return i?("string"==typeof i?r(i,e):s(i,e),e):e},parsePointsAttribute:function(t){if(!t)return null;t=t.replace(/,/g," ").trim(),t=t.split(/\s+/);var e,i,n=[];for(e=0,i=t.length;i>e;e+=2)n.push({x:parseFloat(t[e]),y:parseFloat(t[e+1])});return n},getCSSRules:function(t){for(var n,r=t.getElementsByTagName("style"),s={},o=0,a=r.length;a>o;o++){var h=r[o].textContent;h=h.replace(/\/\*[\s\S]*?\*\//g,""),""!==h.trim()&&(n=h.match(/[^{]*\{[\s\S]*?\}/g),n=n.map(function(t){return t.trim()}),n.forEach(function(t){for(var n=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),r={},o=n[2].trim(),a=o.replace(/;$/,"").split(/\s*;\s*/),h=0,c=a.length;c>h;h++){var l=a[h].split(/\s*:\s*/),u=e(l[0]),d=i(u,l[1],l[0]);r[u]=d}t=n[1],t.split(",").forEach(function(t){""!==(t=t.replace(/^svg/i,"").trim())&&(s[t]=g.util.object.clone(r))})}))}return s},loadSVGFromURL:function(t,e,i){function n(n){var r=n.responseXML;r&&!r.documentElement&&g.window.ActiveXObject&&n.responseText&&(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),r&&r.documentElement&&g.parseSVGDocument(r.documentElement,function(i,n){S.set(t,{objects:g.util.array.invoke(i,"toObject"),options:n}),e(i,n)},i)}t=t.replace(/^\n\s*/,"").trim(),S.has(t,function(i){i?S.get(t,function(t){var i=d(t);e(i.objects,i.options)}):new g.util.request(t,{method:"get",onComplete:n})})},loadSVGFromString:function(t,e,i){t=t.trim();var n;if("undefined"!=typeof DOMParser){var r=new DOMParser;r&&r.parseFromString&&(n=r.parseFromString(t,"text/xml"))}else g.window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));g.parseSVGDocument(n.documentElement,function(t,i){e(t,i)},i)},createSVGFontFacesMarkup:function(t){for(var e="",i=0,n=t.length;n>i;i++)"text"===t[i].type&&t[i].path&&(e+=["@font-face {","font-family: ",t[i].fontFamily,"; ","src: url('",t[i].path,"')","}"].join(""));return e&&(e=['<style type="text/css">',"<![CDATA[",e,"]]>","</style>"].join("")),e},createSVGRefElementsMarkup:function(t){var e=[];return f(e,t,"backgroundColor"),f(e,t,"overlayColor"),e.join("")}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(t,e,i,n){this.elements=t,this.callback=e,this.options=i,this.reviver=n,this.svgUid=i&&i.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var t=0,e=this.elements.length;e>t;t++)this.elements[t].setAttribute("svgUid",this.svgUid),function(t,e){setTimeout(function(){t.createObject(t.elements[e],e)},0)}(this,t)},fabric.ElementsParser.prototype.createObject=function(t,e){var i=fabric[fabric.util.string.capitalize(t.tagName)];if(i&&i.fromElement)try{this._createObject(i,t,e)}catch(t){fabric.log(t)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(t,e,i){if(t.async)t.fromElement(e,this.createCallback(i,e),this.options);else{var n=t.fromElement(e,this.options);this.resolveGradient(n,"fill"),this.resolveGradient(n,"stroke"),this.reviver&&this.reviver(e,n),this.instances[i]=n,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(t,e){var i=this;return function(n){i.resolveGradient(n,"fill"),i.resolveGradient(n,"stroke"),i.reviver&&i.reviver(e,n),i.instances[t]=n,i.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(t,e){var i=t.get(e);if(/^url\(/.test(i)){var n=i.slice(5,i.length-1);fabric.gradientDefs[this.svgUid][n]&&t.set(e,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][n],t))}},fabric.ElementsParser.prototype.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),this.callback(this.instances))},function(t){"use strict";function e(t,e){this.x=t,this.y=e}var i=t.fabric||(t.fabric={});i.Point?i.warn("fabric.Point is already defined"):(i.Point=e,e.prototype={constructor:e,add:function(t){return new e(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new e(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new e(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new e(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new e(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new e(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,i){return new e(this.x+(t.x-this.x)*i,this.y+(t.y-this.y)*i)},distanceFrom:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},midPointFrom:function(t){return new e(this.x+(t.x-this.x)/2,this.y+(t.y-this.y)/2)},min:function(t){return new e(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new e(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){this.x=t,this.y=e},setFromPoint:function(t){this.x=t.x,this.y=t.y},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i}})}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){this.status=t,this.points=[]}var i=t.fabric||(t.fabric={});i.Intersection?i.warn("fabric.Intersection is already defined"):(i.Intersection=e,i.Intersection.prototype={appendPoint:function(t){this.points.push(t)},appendPoints:function(t){this.points=this.points.concat(t)}},i.Intersection.intersectLineLine=function(t,n,r,s){var o,a=(s.x-r.x)*(t.y-r.y)-(s.y-r.y)*(t.x-r.x),h=(n.x-t.x)*(t.y-r.y)-(n.y-t.y)*(t.x-r.x),c=(s.y-r.y)*(n.x-t.x)-(s.x-r.x)*(n.y-t.y);if(0!==c){var l=a/c,u=h/c;l>=0&&1>=l&&u>=0&&1>=u?(o=new e("Intersection"),o.points.push(new i.Point(t.x+l*(n.x-t.x),t.y+l*(n.y-t.y)))):o=new e}else o=new e(0===a||0===h?"Coincident":"Parallel");return o},i.Intersection.intersectLinePolygon=function(t,i,n){for(var r=new e,s=n.length,o=0;s>o;o++){var a=n[o],h=n[(o+1)%s],c=e.intersectLineLine(t,i,a,h);r.appendPoints(c.points)}return r.points.length>0&&(r.status="Intersection"),r},i.Intersection.intersectPolygonPolygon=function(t,i){for(var n=new e,r=t.length,s=0;r>s;s++){var o=t[s],a=t[(s+1)%r],h=e.intersectLinePolygon(o,a,i);n.appendPoints(h.points)}return n.points.length>0&&(n.status="Intersection"),n},i.Intersection.intersectPolygonRectangle=function(t,n,r){var s=n.min(r),o=n.max(r),a=new i.Point(o.x,s.y),h=new i.Point(s.x,o.y),c=e.intersectLinePolygon(s,a,t),l=e.intersectLinePolygon(a,o,t),u=e.intersectLinePolygon(o,h,t),d=e.intersectLinePolygon(h,s,t),f=new e;return f.appendPoints(c.points),f.appendPoints(l.points),f.appendPoints(u.points),f.appendPoints(d.points),f.points.length>0&&(f.status="Intersection"),f})}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function i(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}var n=t.fabric||(t.fabric={});n.Color?n.warn("fabric.Color is already defined."):(n.Color=e,n.Color.prototype={_tryParsingColor:function(t){var i;return t in e.colorNameMap&&(t=e.colorNameMap[t]),"transparent"===t?void this.setSource([255,255,255,0]):(i=e.sourceFromHex(t),i||(i=e.sourceFromRgb(t)),i||(i=e.sourceFromHsl(t)),void(i&&this.setSource(i)))},_rgbToHsl:function(t,e,i){t/=255,e/=255,i/=255;var r,s,o,a=n.util.array.max([t,e,i]),h=n.util.array.min([t,e,i]);if(o=(a+h)/2,a===h)r=s=0;else{var c=a-h;switch(s=o>.5?c/(2-a-h):c/(a+h),a){case t:r=(e-i)/c+(i>e?6:0);break;case e:r=(i-t)/c+2;break;case i:r=(t-e)/c+4}r/=6}return[Math.round(360*r),Math.round(100*s),Math.round(100*o)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e,i,n=this.getSource();return t=n[0].toString(16),t=1===t.length?"0"+t:t,e=n[1].toString(16),e=1===e.length?"0"+e:e,i=n[2].toString(16),i=1===i.length?"0"+i:i,t.toUpperCase()+e.toUpperCase()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),i=t[3];return this.setSource([e,e,e,i]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),n=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,n]),this},overlayWith:function(t){t instanceof e||(t=new e(t));for(var i=[],n=this.getAlpha(),r=this.getSource(),s=t.getSource(),o=0;3>o;o++)i.push(Math.round(.5*r[o]+.5*s[o]));return i[3]=n,this.setSource(i),this}},n.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,n.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,n.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,n.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},n.Color.fromRgb=function(t){return e.fromSource(e.sourceFromRgb(t))},n.Color.sourceFromRgb=function(t){var i=t.match(e.reRGBa);if(i){var n=parseInt(i[1],10)/(/%$/.test(i[1])?100:1)*(/%$/.test(i[1])?255:1),r=parseInt(i[2],10)/(/%$/.test(i[2])?100:1)*(/%$/.test(i[2])?255:1),s=parseInt(i[3],10)/(/%$/.test(i[3])?100:1)*(/%$/.test(i[3])?255:1);return[parseInt(n,10),parseInt(r,10),parseInt(s,10),i[4]?parseFloat(i[4]):1]}},n.Color.fromRgba=e.fromRgb,n.Color.fromHsl=function(t){return e.fromSource(e.sourceFromHsl(t))},n.Color.sourceFromHsl=function(t){var n=t.match(e.reHSLa);if(n){var r,s,o,a=(parseFloat(n[1])%360+360)%360/360,h=parseFloat(n[2])/(/%$/.test(n[2])?100:1),c=parseFloat(n[3])/(/%$/.test(n[3])?100:1);if(0===h)r=s=o=c;else{var l=.5>=c?c*(h+1):c+h-c*h,u=2*c-l;r=i(u,l,a+1/3),s=i(u,l,a),o=i(u,l,a-1/3)}return[Math.round(255*r),Math.round(255*s),Math.round(255*o),n[4]?parseFloat(n[4]):1]}},n.Color.fromHsla=e.fromHsl,n.Color.fromHex=function(t){return e.fromSource(e.sourceFromHex(t))},n.Color.sourceFromHex=function(t){if(t.match(e.reHex)){var i=t.slice(t.indexOf("#")+1),n=3===i.length,r=n?i.charAt(0)+i.charAt(0):i.substring(0,2),s=n?i.charAt(1)+i.charAt(1):i.substring(2,4),o=n?i.charAt(2)+i.charAt(2):i.substring(4,6);return[parseInt(r,16),parseInt(s,16),parseInt(o,16),1]}},n.Color.fromSource=function(t){var i=new e;return i.setSource(t),i})}("undefined"!=typeof exports?exports:this),function(){function t(t){var e,i,n,r=t.getAttribute("style"),s=t.getAttribute("offset");if(s=parseFloat(s)/(/%$/.test(s)?100:1),s=0>s?0:s>1?1:s,r){var o=r.split(/\s*;\s*/);""===o[o.length-1]&&o.pop();for(var a=o.length;a--;){var h=o[a].split(/\s*:\s*/),c=h[0].trim(),l=h[1].trim();"stop-color"===c?e=l:"stop-opacity"===c&&(n=l)}}return e||(e=t.getAttribute("stop-color")||"rgb(0,0,0)"),n||(n=t.getAttribute("stop-opacity")),e=new fabric.Color(e),i=e.getAlpha(),n=isNaN(parseFloat(n))?1:parseFloat(n),n*=i,{offset:s,color:e.toRgb(),opacity:n}}function e(t){return{x1:t.getAttribute("x1")||0,y1:t.getAttribute("y1")||0,x2:t.getAttribute("x2")||"100%",y2:t.getAttribute("y2")||0}}function i(t){return{x1:t.getAttribute("fx")||t.getAttribute("cx")||"50%",y1:t.getAttribute("fy")||t.getAttribute("cy")||"50%",r1:0,x2:t.getAttribute("cx")||"50%",y2:t.getAttribute("cy")||"50%",r2:t.getAttribute("r")||"50%"}}function n(t,e,i){var n,r=0,s=1,o="";for(var a in e)n=parseFloat(e[a],10),s="string"==typeof e[a]&&/^\d+%$/.test(e[a])?.01:1,"x1"===a||"x2"===a||"r2"===a?(s*="objectBoundingBox"===i?t.width:1,r="objectBoundingBox"===i?t.left||0:0):("y1"===a||"y2"===a)&&(s*="objectBoundingBox"===i?t.height:1,r="objectBoundingBox"===i?t.top||0:0),e[a]=n*s+r;if("ellipse"===t.type&&null!==e.r2&&"objectBoundingBox"===i&&t.rx!==t.ry){var h=t.ry/t.rx;o=" scale(1, "+h+")",e.y1&&(e.y1/=h),e.y2&&(e.y2/=h)}return o}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(t){t||(t={});var e={};this.id=fabric.Object.__uid++,this.type=t.type||"linear",e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice(),t.gradientTransform&&(this.gradientTransform=t.gradientTransform),this.offsetX=t.offsetX||this.offsetX,this.offsetY=t.offsetY||this.offsetY},addColorStop:function(t){for(var e in t){var i=new fabric.Color(t[e]);this.colorStops.push({offset:e,color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(t){var e,i,n=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(t,e){return t.offset-e.offset}),!t.group||"path-group"!==t.group.type)for(var r in n)"x1"===r||"x2"===r||"r2"===r?n[r]+=this.offsetX-t.width/2:("y1"===r||"y2"===r)&&(n[r]+=this.offsetY-t.height/2);i='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(i+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?e=["<linearGradient ",i,' x1="',n.x1,'" y1="',n.y1,'" x2="',n.x2,'" y2="',n.y2,'">\n']:"radial"===this.type&&(e=["<radialGradient ",i,' cx="',n.x2,'" cy="',n.y2,'" r="',n.r2,'" fx="',n.x1,'" fy="',n.y1,'">\n']);for(var s=0;s<this.colorStops.length;s++)e.push("<stop ",'offset="',100*this.colorStops[s].offset+"%",'" style="stop-color:',this.colorStops[s].color,null!=this.colorStops[s].opacity?";stop-opacity: "+this.colorStops[s].opacity:";",'"/>\n');return e.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),e.join("")},toLive:function(t,e){var i,n,r=fabric.util.object.clone(this.coords);if(this.type){if(e.group&&"path-group"===e.group.type)for(n in r)"x1"===n||"x2"===n?r[n]+=-this.offsetX+e.width/2:("y1"===n||"y2"===n)&&(r[n]+=-this.offsetY+e.height/2);if("text"===e.type||"i-text"===e.type)for(n in r)"x1"===n||"x2"===n?r[n]-=e.width/2:("y1"===n||"y2"===n)&&(r[n]-=e.height/2);"linear"===this.type?i=t.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(i=t.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2));for(var s=0,o=this.colorStops.length;o>s;s++){var a=this.colorStops[s].color,h=this.colorStops[s].opacity,c=this.colorStops[s].offset;void 0!==h&&(a=new fabric.Color(a).setAlpha(h).toRgba()),i.addColorStop(parseFloat(c),a)}return i}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(r,s){var o,a=r.getElementsByTagName("stop"),h="linearGradient"===r.nodeName?"linear":"radial",c=r.getAttribute("gradientUnits")||"objectBoundingBox",l=r.getAttribute("gradientTransform"),u=[],d={};"linear"===h?d=e(r):"radial"===h&&(d=i(r));for(var f=a.length;f--;)u.push(t(a[f]));o=n(s,d,c);var g=new fabric.Gradient({type:h,coords:d,colorStops:u,offsetX:-s.left,offsetY:-s.top});return(l||""!==o)&&(g.gradientTransform=fabric.parseTransformAttribute((l||"")+o)),g},forObject:function(t,e){return e||(e={}),n(t,e.coords,"userSpaceOnUse"),new fabric.Gradient(e)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(t){if(t||(t={}),this.id=fabric.Object.__uid++,t.source)if("string"==typeof t.source)if(void 0!==fabric.util.getFunctionBody(t.source))this.source=new Function(fabric.util.getFunctionBody(t.source));else{var e=this;this.source=fabric.util.createImage(),fabric.util.loadImage(t.source,function(t){e.source=t})}else this.source=t.source;t.repeat&&(this.repeat=t.repeat),t.offsetX&&(this.offsetX=t.offsetX),t.offsetY&&(this.offsetY=t.offsetY)},toObject:function(){var t;return"function"==typeof this.source?t=String(this.source):"string"==typeof this.source.src&&(t=this.source.src),{source:t,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(t){var e="function"==typeof this.source?this.source():this.source,i=e.width/t.getWidth(),n=e.height/t.getHeight(),r=this.offsetX/t.getWidth(),s=this.offsetY/t.getHeight(),o="";return("repeat-x"===this.repeat||"no-repeat"===this.repeat)&&(n=1),("repeat-y"===this.repeat||"no-repeat"===this.repeat)&&(i=1),e.src?o=e.src:e.toDataURL&&(o=e.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+s+'" width="'+i+'" height="'+n+'">\n<image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+o+'"></image>\n</pattern>\n'},toLive:function(t){var e="function"==typeof this.source?this.source():this.source;if(!e)return"";if(void 0!==e.src){if(!e.complete)return"";if(0===e.naturalWidth||0===e.naturalHeight)return""}return t.createPattern(e,this.repeat)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.toFixed;e.Shadow?e.warn("fabric.Shadow is already defined."):(e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(t){"string"==typeof t&&(t=this._parseShadow(t));for(var i in t)this[i]=t[i];this.id=e.Object.__uid++},_parseShadow:function(t){var i=t.trim(),n=e.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(n[1],10)||0,offsetY:parseInt(n[2],10)||0,blur:parseInt(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(t){var e="SourceAlpha",n=40,r=40;return!t||t.fill!==this.color&&t.stroke!==this.color||(e="SourceGraphic"),t.width&&t.height&&(n=100*i(Math.abs(this.offsetX/t.getWidth()),2)+20,r=100*i(Math.abs(this.offsetY/t.getHeight()),2)+20),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+n+'%" width="'+(100+2*n)+'%" >\n\t<feGaussianBlur in="'+e+'" stdDeviation="'+i(this.blur?this.blur/2:0,3)+'" result="blurOut"></feGaussianBlur>\n\t<feColorMatrix result="matrixOut" in="blurOut" type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.30 0" ></feColorMatrix >\n\t<feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset>\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var t={},i=e.Shadow.prototype;return this.color!==i.color&&(t.color=this.color),this.blur!==i.blur&&(t.blur=this.blur),this.offsetX!==i.offsetX&&(t.offsetX=this.offsetX),this.offsetY!==i.offsetY&&(t.offsetY=this.offsetY),t}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)}("undefined"!=typeof exports?exports:this),function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var t=fabric.util.object.extend,e=fabric.util.getElementOffset,i=fabric.util.removeFromArray,n=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(t,e){e||(e={}),this._initStatic(t,e),fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,
viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(t,e){this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this._setImageSmoothing(),e.overlayImage&&this.setOverlayImage(e.overlayImage,this.renderAll.bind(this)),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,this.renderAll.bind(this)),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,this.renderAll.bind(this)),e.overlayColor&&this.setOverlayColor(e.overlayColor,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},_setImageSmoothing:function(){var t=this.getContext();t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,t.mozImageSmoothingEnabled=this.imageSmoothingEnabled,t.msImageSmoothingEnabled=this.imageSmoothingEnabled,t.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(t,e,i,n){return"string"==typeof e?fabric.util.loadImage(e,function(e){this[t]=new fabric.Image(e,n),i&&i()},this,n&&n.crossOrigin):(n&&e.setOptions(n),this[t]=e,i&&i()),this},__setBgOverlayColor:function(t,e,i){if(e&&e.source){var n=this;fabric.util.loadImage(e.source,function(r){n[t]=new fabric.Pattern({source:r,repeat:e.repeat,offsetX:e.offsetX,offsetY:e.offsetY}),i&&i()})}else this[t]=e,i&&i();return this},_createCanvasElement:function(){var t=fabric.document.createElement("canvas");if(t.style||(t.style={}),!t)throw n;return this._initCanvasElement(t),t},_initCanvasElement:function(t){if(fabric.util.createCanvasElement(t),void 0===t.getContext)throw n},_initOptions:function(t){for(var e in t)this[e]=t[e];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){this.lowerCanvasEl=fabric.util.getById(t)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i;e=e||{};for(var n in t)i=t[n],e.cssOnly||(this._setBackstoreDimension(n,t[n]),i+="px"),e.backstoreOnly||this._setCssDimension(n,i);return e.cssOnly||this.renderAll(),this.calcOffset(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(t){var e=this.getActiveGroup();this.viewportTransform=t,this.renderAll();for(var i=0,n=this._objects.length;n>i;i++)this._objects[i].setCoords();return e&&e.setCoords(),this},zoomToPoint:function(t,e){var i=t;t=fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform)),this.viewportTransform[0]=e,this.viewportTransform[3]=e;var n=fabric.util.transformPoint(t,this.viewportTransform);this.viewportTransform[4]+=i.x-n.x,this.viewportTransform[5]+=i.y-n.y,this.renderAll();for(var r=0,s=this._objects.length;s>r;r++)this._objects[r].setCoords();return this},setZoom:function(t){return this.zoomToPoint(new fabric.Point(0,0),t),this},absolutePan:function(t){this.viewportTransform[4]=-t.x,this.viewportTransform[5]=-t.y,this.renderAll();for(var e=0,i=this._objects.length;i>e;e++)this._objects[e].setCoords();return this},relativePan:function(t){return this.absolutePan(new fabric.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(t,e){if(e){t.save();var i=this.viewportTransform;t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._shouldRenderObject(e)&&e.render(t),t.restore(),this.controlsAboveOverlay||e._renderControls(t)}},_shouldRenderObject:function(t){return!!t&&(t!==this.getActiveGroup()||!this.preserveObjectStacking)},_onObjectAdded:function(t){this.stateful&&t.setupState(),t.canvas=this,t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.getActiveObject()===t&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared")),this.fire("object:removed",{target:t}),t.fire("removed")},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(t){var e=this[!0===t&&this.interactive?"contextTop":"contextContainer"],i=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),t||this.clearContext(e),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,e),this._renderBackground(e),this._renderObjects(e,i),this._renderActiveGroup(e,i),this.clipTo&&e.restore(),this._renderOverlay(e),this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.fire("after:render"),this},_renderObjects:function(t,e){var i,n;if(!e||this.preserveObjectStacking)for(i=0,n=this._objects.length;n>i;++i)this._draw(t,this._objects[i]);else for(i=0,n=this._objects.length;n>i;++i)this._objects[i]&&!e.contains(this._objects[i])&&this._draw(t,this._objects[i])},_renderActiveGroup:function(t,e){if(e){var i=[];this.forEachObject(function(t){e.contains(t)&&i.push(t)}),e._set("objects",i),this._draw(t,e)}},_renderBackground:function(t){this.backgroundColor&&(t.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(t):this.backgroundColor,t.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)),this.backgroundImage&&this._draw(t,this.backgroundImage)},_renderOverlay:function(t){this.overlayColor&&(t.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(t):this.overlayColor,t.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height)),this.overlayImage&&this._draw(t,this.overlayImage)},renderTop:function(){var t=this.contextTop||this.contextContainer;this.clearContext(t),this.selection&&this._groupSelector&&this._drawSelection();var e=this.getActiveGroup();return e&&e.render(t),this._renderOverlay(t),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(t){return this._centerObject(t,new fabric.Point(this.getCenter().left,t.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(t){return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(t){var e=this.getCenter();return this._centerObject(t,new fabric.Point(e.left,e.top)),this.renderAll(),this},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(e,i){var n={objects:this._toObjects(e,i)};return t(n,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,n,i),n},_toObjects:function(t,e){return this.getObjects().map(function(i){return this._toObject(i,t,e)},this)},_toObject:function(t,e,i){var n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);var r=this._realizeGroupTransformOnObject(t),s=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=n),this._unwindGroupTransformOnObject(t,r),s},_realizeGroupTransformOnObject:function(t){var e=["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"];if(t.group&&t.group===this.getActiveGroup()){var i={};return e.forEach(function(e){i[e]=t[e]}),this.getActiveGroup().realizeTransform(t),i}return null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},__serializeBgOverlay:function(){var t={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(t.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(t.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(t.overlayImage=this.overlayImage.toObject()),t},svgViewportTransformation:!0,toSVG:function(t,e){t||(t={});var i=[];return this._setSVGPreamble(i,t),this._setSVGHeader(i,t),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage"),this._setSVGObjects(i,e),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage"),i.push("</svg>"),i.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){var i,n,r;e.viewBox?(i=e.viewBox.width,n=e.viewBox.height):(i=this.width,n=this.height,this.svgViewportTransformation||(r=this.viewportTransform,i/=r[0],n/=r[3])),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',i,'" ','height="',n,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,e.viewBox?'viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(t,e){for(var i=0,n=this.getObjects(),r=n.length;r>i;i++){var s=n[i],o=this._realizeGroupTransformOnObject(s);t.push(s.toSVG(e)),this._unwindGroupTransformOnObject(s,o)}},_setSVGBgOverlayImage:function(t,e){this[e]&&this[e].toSVG&&t.push(this[e].toSVG())},_setSVGBgOverlayColor:function(t,e){this[e]&&this[e].source?t.push('<rect x="',this[e].offsetX,'" y="',this[e].offsetY,'" ','width="',"repeat-y"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.width:this.width,'" height="',"repeat-x"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source.height:this.height,'" fill="url(#'+e+'Pattern)"',"></rect>"):this[e]&&"overlayColor"===e&&t.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[e],'"',"></rect>")},sendToBack:function(t){return i(this._objects,t),this._objects.unshift(t),this.renderAll&&this.renderAll()},bringToFront:function(t){return i(this._objects,t),this._objects.push(t),this.renderAll&&this.renderAll()},sendBackwards:function(t,e){var n=this._objects.indexOf(t);if(0!==n){var r=this._findNewLowerIndex(t,n,e);i(this._objects,t),this._objects.splice(r,0,t),this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(t,e,i){var n;if(i){n=e;for(var r=e-1;r>=0;--r){if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}}else n=e-1;return n},bringForward:function(t,e){var n=this._objects.indexOf(t);if(n!==this._objects.length-1){var r=this._findNewUpperIndex(t,n,e);i(this._objects,t),this._objects.splice(r,0,t),this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(t,e,i){var n;if(i){n=e;for(var r=e+1;r<this._objects.length;++r){if(t.intersectsWithObject(this._objects[r])||t.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(t)){n=r;break}}}else n=e+1;return n},moveTo:function(t,e){return i(this._objects,t),this._objects.splice(e,0,t),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),t(fabric.StaticCanvas.prototype,fabric.Observable),t(fabric.StaticCanvas.prototype,fabric.Collection),t(fabric.StaticCanvas.prototype,fabric.DataURLExporter),t(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=fabric.util.createCanvasElement();if(!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"getImageData":return void 0!==i.getImageData;case"setLineDash":return void 0!==i.setLineDash;case"toDataURL":return void 0!==e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(t){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(t){return this.shadow=new fabric.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var t=this.canvas.contextTop;t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offsetX,t.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t){this.canvas=t,this._points=[]},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){this._points.push(t)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);this._addPoint(e)},_render:function(){var t=this.canvas.contextTop,e=this.canvas.viewportTransform,i=this._points[0],n=this._points[1];t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.beginPath(),2===this._points.length&&i.x===n.x&&i.y===n.y&&(i.x-=.5,n.x+=.5),t.moveTo(i.x,i.y);for(var r=1,s=this._points.length;s>r;r++){var o=i.midPointFrom(n);t.quadraticCurveTo(i.x,i.y,o.x,o.y),i=this._points[r],n=this._points[r+1]}t.lineTo(i.x,i.y),t.stroke(),t.restore()},convertPointsToSVGPath:function(t){var e=[],i=new fabric.Point(t[0].x,t[0].y),n=new fabric.Point(t[1].x,t[1].y);e.push("M ",t[0].x," ",t[0].y," ");for(var r=1,s=t.length;s>r;r++){var o=i.midPointFrom(n);e.push("Q ",i.x," ",i.y," ",o.x," ",o.y," "),i=new fabric.Point(t[r].x,t[r].y),r+1<t.length&&(n=new fabric.Point(t[r+1].x,t[r+1].y))}return e.push("L ",i.x," ",i.y," "),e},createPath:function(t){var e=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===t)return void this.canvas.renderAll();var e=this.createPath(t);this.canvas.add(e),e.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:e})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop,n=this.canvas.viewportTransform;i.save(),i.transform(n[0],n[1],n[2],n[3],n[4],n[5]),i.fillStyle=e.fill,i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),i.closePath(),i.fill(),i.restore()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.points.length;n>i;i++){var r=this.points[i],s=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&s.setShadow(this.shadow),e.push(s)}var o=new fabric.Group(e,{originX:"center",originY:"center"});o.canvas=this.canvas,this.canvas.add(o),this.canvas.fire("path:created",{path:o}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},addPoint:function(t){var e=new fabric.Point(t.x,t.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=n,this.points.push(e),e}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render()},onMouseMove:function(t){this.addSprayChunk(t),this.render()},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;n>i;i++)for(var r=this.sprayChunks[i],s=0,o=r.length;o>s;s++){var a=new fabric.Rect({width:r[s].width,height:r[s].width,left:r[s].x+1,top:r[s].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&a.setShadow(this.shadow),e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var h=new fabric.Group(e,{originX:"center",originY:"center"});h.canvas=this.canvas,this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},_getOptimizedRects:function(t){for(var e,i={},n=0,r=t.length;r>n;n++)e=t[n].left+""+t[n].top,i[e]||(i[e]=t[n]);var s=[];for(e in i)s.push(i[e]);return s},render:function(){var t=this.canvas.contextTop;t.fillStyle=this.color;var e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]);for(var i=0,n=this.sprayChunkPoints.length;n>i;i++){var r=this.sprayChunkPoints[i];void 0!==r.opacity&&(t.globalAlpha=r.opacity),t.fillRect(r.x,r.y,r.width,r.width)}t.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];for(var e,i,n,r=this.width/2,s=0;s<this.density;s++){e=fabric.util.getRandomInt(t.x-r,t.x+r),i=fabric.util.getRandomInt(t.y-r,t.y+r),n=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var o=new fabric.Point(e,i);o.width=n,this.randomOpacity&&(o.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(o)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=fabric.document.createElement("canvas"),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var e=this.callSuper("createPath",t);return e.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),e}}),function(){var t=fabric.util.getPointer,e=fabric.util.degreesToRadians,i=fabric.util.radiansToDegrees,n=Math.atan2,r=Math.abs;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(t,e){e||(e={}),this._initStatic(t,e),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_resetCurrentTransform:function(t){var e=this._currentTransform;e.target.set({scaleX:e.original.scaleX,scaleY:e.original.scaleY,left:e.original.left,top:e.original.top}),this._shouldCenterTransform(t,e.target)?"rotate"===e.action?this._setOriginToCenter(e.target):("center"!==e.originX&&(e.mouseXSign="right"===e.originX?-1:1),"center"!==e.originY&&(e.mouseYSign="bottom"===e.originY?-1:1),e.originX="center",e.originY="center"):(e.originX=e.original.originX,e.originY=e.original.originY)},containsPoint:function(t,e){var i=this.getPointer(t,!0),n=this._normalizePointer(e,i);return e.containsPoint(n)||e._findTargetCorner(i)},_normalizePointer:function(t,e){var i,n=this.getActiveGroup(),r=e.x,s=e.y;return n&&"group"!==t.type&&n.contains(t)&&(i=new fabric.Point(n.left,n.top),i=fabric.util.transformPoint(i,this.viewportTransform,!0),r-=i.x,s-=i.y),{x:r,y:s}},isTargetTransparent:function(t,e,i){var n=t.hasBorders,r=t.transparentCorners;t.hasBorders=t.transparentCorners=!1,this._draw(this.contextCache,t),t.hasBorders=n,t.transparentCorners=r;var s=fabric.util.isTransparent(this.contextCache,e,i,this.targetFindTolerance);return this.clearContext(this.contextCache),s},_shouldClearSelection:function(t,e){var i=this.getActiveGroup(),n=this.getActiveObject();return!e||e&&i&&!i.contains(e)&&i!==e&&!t.shiftKey||e&&!e.evented||e&&!e.selectable&&n&&n!==e},_shouldCenterTransform:function(t,e){if(e){var i,n=this._currentTransform;return"scale"===n.action||"scaleX"===n.action||"scaleY"===n.action?i=this.centeredScaling||e.centeredScaling:"rotate"===n.action&&(i=this.centeredRotation||e.centeredRotation),i?!t.altKey:t.altKey}},_getOriginFromCorner:function(t,e){var i={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?i.x="right":("mr"===e||"tr"===e||"br"===e)&&(i.x="left"),"tl"===e||"mt"===e||"tr"===e?i.y="bottom":("bl"===e||"mb"===e||"br"===e)&&(i.y="top"),i},_getActionFromCorner:function(t,e){var i="drag";return e&&(i="ml"===e||"mr"===e?"scaleX":"mt"===e||"mb"===e?"scaleY":"mtr"===e?"rotate":"scale"),i},_setupCurrentTransform:function(t,i){if(i){var n=this.getPointer(t),r=i._findTargetCorner(this.getPointer(t,!0)),s=this._getActionFromCorner(i,r),o=this._getOriginFromCorner(i,r);this._currentTransform={target:i,action:s,scaleX:i.scaleX,scaleY:i.scaleY,offsetX:n.x-i.left,offsetY:n.y-i.top,originX:o.x,originY:o.y,ex:n.x,ey:n.y,left:i.left,top:i.top,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:i.left,top:i.top,scaleX:i.scaleX,scaleY:i.scaleY,originX:o.x,originY:o.y},this._resetCurrentTransform(t)}},_translateObject:function(t,e){var i=this._currentTransform.target;i.get("lockMovementX")||i.set("left",t-this._currentTransform.offsetX),i.get("lockMovementY")||i.set("top",e-this._currentTransform.offsetY)},_scaleObject:function(t,e,i){var n=this._currentTransform,r=n.target,s=r.get("lockScalingX"),o=r.get("lockScalingY"),a=r.get("lockScalingFlip");if(!s||!o){var h=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),c=r.toLocalPoint(new fabric.Point(t,e),n.originX,n.originY);this._setLocalMouse(c,n),this._setObjectScale(c,n,s,o,i,a),r.setPositionByOrigin(h,n.originX,n.originY)}},_setObjectScale:function(t,e,i,n,r,s){var o=e.target,a=!1,h=!1,c=o.stroke?o.strokeWidth:0;e.newScaleX=t.x/(o.width+c/2),e.newScaleY=t.y/(o.height+c/2),s&&e.newScaleX<=0&&e.newScaleX<o.scaleX&&(a=!0),s&&e.newScaleY<=0&&e.newScaleY<o.scaleY&&(h=!0),"equally"!==r||i||n?r?"x"!==r||o.get("lockUniScaling")?"y"!==r||o.get("lockUniScaling")||h||n||o.set("scaleY",e.newScaleY):a||i||o.set("scaleX",e.newScaleX):(a||i||o.set("scaleX",e.newScaleX),h||n||o.set("scaleY",e.newScaleY)):a||h||this._scaleObjectEqually(t,o,e),a||h||this._flipObject(e,r)},_scaleObjectEqually:function(t,e,i){var n=t.y+t.x,r=e.stroke?e.strokeWidth:0,s=(e.height+r/2)*i.original.scaleY+(e.width+r/2)*i.original.scaleX;i.newScaleX=i.original.scaleX*n/s,i.newScaleY=i.original.scaleY*n/s,e.set("scaleX",i.newScaleX),e.set("scaleY",i.newScaleY)},_flipObject:function(t,e){t.newScaleX<0&&"y"!==e&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&"x"!==e&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var i=e.target;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0&&(e.mouseXSign=-e.mouseXSign)),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0&&(e.mouseYSign=-e.mouseYSign)),r(t.x)>i.padding?t.x<0?t.x+=i.padding:t.x-=i.padding:t.x=0,r(t.y)>i.padding?t.y<0?t.y+=i.padding:t.y-=i.padding:t.y=0},_rotateObject:function(t,e){var r=this._currentTransform;if(!r.target.get("lockRotation")){var s=n(r.ey-r.top,r.ex-r.left),o=n(e-r.top,t-r.left),a=i(o-s+r.theta);0>a&&(a=360+a),r.target.angle=a%360}},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.setAngle(0)},_drawSelection:function(){var t=this.contextTop,e=this._groupSelector,i=e.left,n=e.top,s=r(i),o=r(n);if(t.fillStyle=this.selectionColor,t.fillRect(e.ex-(i>0?0:-i),e.ey-(n>0?0:-n),s,o),t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1){var a=e.ex+.5-(i>0?0:s),h=e.ey+.5-(n>0?0:o);t.beginPath(),fabric.util.drawDashedLine(t,a,h,a+s,h,this.selectionDashArray),fabric.util.drawDashedLine(t,a,h+o-1,a+s,h+o-1,this.selectionDashArray),fabric.util.drawDashedLine(t,a,h,a,h+o,this.selectionDashArray),fabric.util.drawDashedLine(t,a+s-1,h,a+s-1,h+o,this.selectionDashArray),t.closePath(),t.stroke()}else t.strokeRect(e.ex+.5-(i>0?0:s),e.ey+.5-(n>0?0:o),s,o)},_isLastRenderedObject:function(t){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(t,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(t,!0))},findTarget:function(t,e){if(!this.skipTargetFind){if(this._isLastRenderedObject(t))return this.lastRenderedObjectWithControlsAboveOverlay;var i=this.getActiveGroup();if(i&&!e&&this.containsPoint(t,i))return i;var n=this._searchPossibleTargets(t);return this._fireOverOutEvents(n),n}},_fireOverOutEvents:function(t){t?this._hoveredTarget!==t&&(this.fire("mouse:over",{target:t}),t.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=t):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(t,e,i){if(e&&e.visible&&e.evented&&this.containsPoint(t,e)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,i.x,i.y))return!0}},_searchPossibleTargets:function(t){for(var e,i=this.getPointer(t,!0),n=this._objects.length;n--;)if(!this._objects[n].group&&this._checkTarget(t,this._objects[n],i)){this.relatedTarget=this._objects[n],e=this._objects[n];break}return e},getPointer:function(e,i,n){n||(n=this.upperCanvasEl);var r,s=t(e,n),o=n.getBoundingClientRect(),a=o.width||0,h=o.height||0;return a&&h||("top"in o&&"bottom"in o&&(h=Math.abs(o.top-o.bottom)),"right"in o&&"left"in o&&(a=Math.abs(o.right-o.left))),this.calcOffset(),s.x=s.x-this._offset.left,s.y=s.y-this._offset.top,i||(s=fabric.util.transformPoint(s,fabric.util.invertTransform(this.viewportTransform))),r=0===a||0===h?{width:1,height:1}:{width:n.width/a,height:n.height/h},{x:s.x*r.width,y:s.y*r.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+t),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.getWidth()||t.width,i=this.getHeight()||t.height;fabric.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0}),t.width=e,t.height=i,fabric.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(t){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=t,t.set("active",!0)},setActiveObject:function(t,e){return this._setActiveObject(t),this.renderAll(),this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(t){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:t}),this},_setActiveGroup:function(t){this._activeGroup=t,t&&t.set("active",!0)},setActiveGroup:function(t,e){return this._setActiveGroup(t),
t&&(this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var t=this.getActiveGroup();t&&t.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(t){return this._discardActiveGroup(),this.fire("selection:cleared",{e:t}),this},deactivateAll:function(){for(var t=this.getObjects(),e=0,i=t.length;i>e;e++)t[e].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(t){var e=this.getActiveGroup()||this.getActiveObject();return e&&this.fire("before:selection:cleared",{target:e,e:t}),this.deactivateAll(),e&&this.fire("selection:cleared",{e:t}),this},drawControls:function(t){var e=this.getActiveGroup();e?this._drawGroupControls(t,e):this._drawObjectsControls(t)},_drawGroupControls:function(t,e){e._renderControls(t)},_drawObjectsControls:function(t){for(var e=0,i=this._objects.length;i>e;++e)this._objects[e]&&this._objects[e].active&&(this._objects[e]._renderControls(t),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[e])}});for(var s in fabric.StaticCanvas)"prototype"!==s&&(fabric.Canvas[s]=fabric.StaticCanvas[s]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var t={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=fabric.util.addListener,i=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),e(fabric.window,"resize",this._onResize),e(this.upperCanvasEl,"mousedown",this._onMouseDown),e(this.upperCanvasEl,"mousemove",this._onMouseMove),e(this.upperCanvasEl,"mousewheel",this._onMouseWheel),e(this.upperCanvasEl,"touchstart",this._onMouseDown),e(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){i(fabric.window,"resize",this._onResize),i(this.upperCanvasEl,"mousedown",this._onMouseDown),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"mousewheel",this._onMouseWheel),i(this.upperCanvasEl,"touchstart",this._onMouseDown),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t,e){this.__onMouseWheel&&this.__onMouseWheel(t,e)},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onMouseDown:function(t){this.__onMouseDown(t),e(fabric.document,"touchend",this._onMouseUp),e(fabric.document,"touchmove",this._onMouseMove),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===t.type?i(this.upperCanvasEl,"mousedown",this._onMouseDown):(e(fabric.document,"mouseup",this._onMouseUp),e(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(t){if(this.__onMouseUp(t),i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"touchend",this._onMouseUp),i(fabric.document,"mousemove",this._onMouseMove),i(fabric.document,"touchmove",this._onMouseMove),e(this.upperCanvasEl,"mousemove",this._onMouseMove),e(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===t.type){var n=this;setTimeout(function(){e(n.upperCanvasEl,"mousedown",n._onMouseDown)},400)}},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t,e){var i=this.getActiveGroup()||this.getActiveObject();return!!(t&&(t.isMoving||t!==i)||!t&&i||!t&&!i&&!this._groupSelector||e&&this._previousPointer&&this.selection&&(e.x!==this._previousPointer.x||e.y!==this._previousPointer.y))},__onMouseUp:function(t){var e;if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);this._currentTransform?(this._finalizeCurrentTransform(),e=this._currentTransform.target):e=this.findTarget(t,!0);var i=this._shouldRender(e,this.getPointer(t));this._maybeGroupObjects(t),e&&(e.isMoving=!1),i&&this.renderAll(),this._handleCursorAndEvent(t,e)},_handleCursorAndEvent:function(t,e){this._setCursorFromEvent(t,e);var i=this;setTimeout(function(){i._setCursorFromEvent(t,e)},50),this.fire("mouse:up",{target:e,e:t}),e&&e.fire("mouseup",{e:t})},_finalizeCurrentTransform:function(){var t=this._currentTransform,e=t.target;e._scaling&&(e._scaling=!1),e.setCoords(),this.stateful&&e.hasStateChanged()&&(this.fire("object:modified",{target:e}),e.fire("modified")),this._restoreOriginXY(e)},_restoreOriginXY:function(t){if(this._previousOriginX&&this._previousOriginY){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.discardActiveObject(t).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var e=fabric.util.invertTransform(this.viewportTransform),i=fabric.util.transformPoint(this.getPointer(t,!0),e);this.freeDrawingBrush.onMouseDown(i),this.fire("mouse:down",{e:t});var n=this.findTarget(t);void 0!==n&&n.fire("mousedown",{e:t,target:n})},_onMouseMoveInDrawingMode:function(t){if(this._isCurrentlyDrawing){var e=fabric.util.invertTransform(this.viewportTransform),i=fabric.util.transformPoint(this.getPointer(t,!0),e);this.freeDrawingBrush.onMouseMove(i)}this.setCursor(this.freeDrawingCursor),this.fire("mouse:move",{e:t});var n=this.findTarget(t);void 0!==n&&n.fire("mousemove",{e:t,target:n})},_onMouseUpInDrawingMode:function(t){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:t});var e=this.findTarget(t);void 0!==e&&e.fire("mouseup",{e:t,target:e})},__onMouseDown:function(t){if(("which"in t?1===t.which:1===t.button)||fabric.isTouchSupported){if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._currentTransform){var e=this.findTarget(t),i=this.getPointer(t,!0);this._previousPointer=i;var n=this._shouldRender(e,i),r=this._shouldGroup(t,e);this._shouldClearSelection(t,e)?this._clearSelection(t,e,i):r&&(this._handleGrouping(t,e),e=this.getActiveGroup()),e&&e.selectable&&!r&&(this._beforeTransform(t,e),this._setupCurrentTransform(t,e)),n&&this.renderAll(),this.fire("mouse:down",{target:e,e:t}),e&&e.fire("mousedown",{e:t})}}},_beforeTransform:function(t,e){this.stateful&&e.saveState(),e._findTargetCorner(this.getPointer(t))&&this.onBeforeScaleRotate(e),e!==this.getActiveGroup()&&e!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(e,t))},_clearSelection:function(t,e,i){this.deactivateAllWithDispatch(t),e&&e.selectable?this.setActiveObject(e,t):this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0})},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center",t.originY="center",t.left=e.x,t.top=e.y,this._currentTransform.left=t.left,this._currentTransform.top=t.top},_setCenterToOrigin:function(t){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(t){var e,i;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!(void 0!==t.touches&&t.touches.length>1)){var n=this._groupSelector;n?(i=this.getPointer(t,!0),n.left=i.x-n.ex,n.top=i.y-n.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t),!e||e&&!e.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(t,e)),this.fire("mouse:move",{target:e,e:t}),e&&e.fire("mousemove",{e:t})}},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,this._beforeScaleTransform(t,i),this._performTransformAction(t,i,e),this.renderAll()},_performTransformAction:function(t,e,i){var n=i.x,r=i.y,s=e.target,o=e.action;"rotate"===o?(this._rotateObject(n,r),this._fire("rotating",s,t)):"scale"===o?(this._onScale(t,e,n,r),this._fire("scaling",s,t)):"scaleX"===o?(this._scaleObject(n,r,"x"),this._fire("scaling",s,t)):"scaleY"===o?(this._scaleObject(n,r,"y"),this._fire("scaling",s,t)):(this._translateObject(n,r),this._fire("moving",s,t),this.setCursor(this.moveCursor))},_fire:function(t,e,i){this.fire("object:"+t,{target:e,e:i}),e.fire(t,{e:i})},_beforeScaleTransform:function(t,e){if("scale"===e.action||"scaleX"===e.action||"scaleY"===e.action){var i=this._shouldCenterTransform(t,e.target);(i&&("center"!==e.originX||"center"!==e.originY)||!i&&"center"===e.originX&&"center"===e.originY)&&(this._resetCurrentTransform(t),e.reset=!0)}},_onScale:function(t,e,i,n){!t.shiftKey&&!this.uniScaleTransform||e.target.get("lockUniScaling")?(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(t,e.target),e.currentAction="scaleEqually",this._scaleObject(i,n,"equally")):(e.currentAction="scale",this._scaleObject(i,n))},_setCursorFromEvent:function(t,e){if(!e||!e.selectable)return this.setCursor(this.defaultCursor),!1;var i=this.getActiveGroup(),n=e._findTargetCorner&&(!i||!i.contains(e))&&e._findTargetCorner(this.getPointer(t,!0));return n?this._setCornerCursor(n,e):this.setCursor(e.hoverCursor||this.hoverCursor),!0},_setCornerCursor:function(e,i){if(e in t)this.setCursor(this._getRotatedCornerCursor(e,i));else{if("mtr"!==e||!i.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(e,i){var n=Math.round(i.getAngle()%360/45);return 0>n&&(n+=8),n+=t[e],n%=8,this.cursorMap[n]}})}(),function(){var t=Math.min,e=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var i=this.getActiveObject();return t.shiftKey&&(this.getActiveGroup()||i&&i!==e)&&this.selection},_handleGrouping:function(t,e){(e!==this.getActiveGroup()||(e=this.findTarget(t,!0))&&!e.isType("group"))&&(this.getActiveGroup()?this._updateActiveGroup(e,t):this._createActiveGroup(e,t),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(t,e){var i=this.getActiveGroup();if(i.contains(t)){if(i.removeWithUpdate(t),this._resetObjectTransform(i),t.set("active",!1),1===i.size())return this.discardActiveGroup(e),void this.setActiveObject(i.item(0))}else i.addWithUpdate(t),this._resetObjectTransform(i);this.fire("selection:created",{target:i,e:e}),i.set("active",!0)},_createActiveGroup:function(t,e){if(this._activeObject&&t!==this._activeObject){var i=this._createGroup(t);i.addWithUpdate(),this.setActiveGroup(i),this._activeObject=null,this.fire("selection:created",{target:i,e:e})}t.set("active",!0)},_createGroup:function(t){var e=this.getObjects(),i=e.indexOf(this._activeObject)<e.indexOf(t),n=i?[this._activeObject,t]:[t,this._activeObject];return new fabric.Group(n,{canvas:this})},_groupSelectedObjects:function(t){var e=this._collectObjects();1===e.length?this.setActiveObject(e[0],t):e.length>1&&(e=new fabric.Group(e.reverse(),{canvas:this}),e.addWithUpdate(),this.setActiveGroup(e,t),e.saveCoords(),this.fire("selection:created",{target:e}),this.renderAll())},_collectObjects:function(){for(var i,n=[],r=this._groupSelector.ex,s=this._groupSelector.ey,o=r+this._groupSelector.left,a=s+this._groupSelector.top,h=new fabric.Point(t(r,o),t(s,a)),c=new fabric.Point(e(r,o),e(s,a)),l=r===o&&s===a,u=this._objects.length;u--&&!((i=this._objects[u])&&i.selectable&&i.visible&&(i.intersectsWithRect(h,c)||i.isContainedWithinRect(h,c)||i.containsPoint(h)||i.containsPoint(c))&&(i.set("active",!0),n.push(i),l)););return n},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t);var e=this.getActiveGroup();e&&(e.setObjectsCoords().setCoords(),e.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(t){t||(t={});var e=t.format||"png",i=t.quality||1,n=t.multiplier||1,r={left:t.left,top:t.top,width:t.width,height:t.height};return 1!==n?this.__toDataURLWithMultiplier(e,i,r,n):this.__toDataURL(e,i,r)},__toDataURL:function(t,e,i){this.renderAll(!0);var n=this.upperCanvasEl||this.lowerCanvasEl,r=this.__getCroppedCanvas(n,i);"jpg"===t&&(t="jpeg");var s=fabric.StaticCanvas.supports("toDataURLWithQuality")?(r||n).toDataURL("image/"+t,e):(r||n).toDataURL("image/"+t);return this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),r&&(r=null),s},__getCroppedCanvas:function(t,e){var i,n;return("left"in e||"top"in e||"width"in e||"height"in e)&&(i=fabric.util.createCanvasElement(),n=i.getContext("2d"),i.width=e.width||this.width,i.height=e.height||this.height,n.drawImage(t,-e.left||0,-e.top||0)),i},__toDataURLWithMultiplier:function(t,e,i,n){var r=this.getWidth(),s=this.getHeight(),o=r*n,a=s*n,h=this.getActiveObject(),c=this.getActiveGroup(),l=this.contextTop||this.contextContainer;n>1&&this.setWidth(o).setHeight(a),l.scale(n,n),i.left&&(i.left*=n),i.top&&(i.top*=n),i.width?i.width*=n:1>n&&(i.width=o),i.height?i.height*=n:1>n&&(i.height=a),c?this._tempRemoveBordersControlsFromGroup(c):h&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0);var u=this.__toDataURL(t,e,i);return this.width=r,this.height=s,l.scale(1/n,1/n),this.setWidth(r).setHeight(s),c?this._restoreBordersControlsOnGroup(c):h&&this.setActiveObject&&this.setActiveObject(h),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),u},toDataURLWithMultiplier:function(t,e,i){return this.toDataURL({format:t,multiplier:e,quality:i})},_tempRemoveBordersControlsFromGroup:function(t){t.origHasControls=t.hasControls,t.origBorderColor=t.borderColor,t.hasControls=!0,t.borderColor="rgba(0,0,0,0)",t.forEachObject(function(t){t.origBorderColor=t.borderColor,t.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(t){t.hideControls=t.origHideControls,t.borderColor=t.origBorderColor,t.forEachObject(function(t){t.borderColor=t.origBorderColor,delete t.origBorderColor})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,i){return this.loadFromJSON(t,e,i)},loadFromJSON:function(t,e,i){if(t){var n="string"==typeof t?JSON.parse(t):t;this.clear();var r=this;return this._enlivenObjects(n.objects,function(){r._setBgOverlay(n,e)},i),this}},_setBgOverlay:function(t,e){var i=this,n={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(t.backgroundImage||t.overlayImage||t.background||t.overlay))return void(e&&e());var r=function(){n.backgroundImage&&n.overlayImage&&n.backgroundColor&&n.overlayColor&&(i.renderAll(),e&&e())};this.__setBgOverlay("backgroundImage",t.backgroundImage,n,r),this.__setBgOverlay("overlayImage",t.overlayImage,n,r),this.__setBgOverlay("backgroundColor",t.background,n,r),this.__setBgOverlay("overlayColor",t.overlay,n,r),r()},__setBgOverlay:function(t,e,i,n){var r=this;return e?void("backgroundImage"===t||"overlayImage"===t?fabric.Image.fromObject(e,function(e){r[t]=e,i[t]=!0,n&&n()}):this["set"+fabric.util.string.capitalize(t,!0)](e,function(){i[t]=!0,n&&n()})):void(i[t]=!0)},_enlivenObjects:function(t,e,i){var n=this;if(!t||0===t.length)return void(e&&e());var r=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(t,function(t){t.forEach(function(t,e){n.insertAt(t,e,!0)}),n.renderOnAddRemove=r,e&&e()},null,i)},_toDataURL:function(t,e){this.clone(function(i){e(i.toDataURL(t))})},_toDataURLWithMultiplier:function(t,e,i){this.clone(function(n){i(n.toDataURLWithMultiplier(t,e))})},clone:function(t,e){var i=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(e){e.loadFromJSON(i,function(){t&&t(e)})})},cloneWithoutData:function(t){var e=fabric.document.createElement("canvas");e.width=this.getWidth(),e.height=this.getHeight();var i=new fabric.Canvas(e);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.toFixed,r=e.util.string.capitalize,s=e.util.degreesToRadians,o=e.StaticCanvas.supports("setLineDash");e.Object||(e.Object=e.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(t){t&&this.setOptions(t)},_initGradient:function(t){!t.fill||!t.fill.colorStops||t.fill instanceof e.Gradient||this.set("fill",new e.Gradient(t.fill))},_initPattern:function(t){!t.fill||!t.fill.source||t.fill instanceof e.Pattern||this.set("fill",new e.Pattern(t.fill)),!t.stroke||!t.stroke.source||t.stroke instanceof e.Pattern||this.set("stroke",new e.Pattern(t.stroke))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var i=e.util.getFunctionBody(t.clipTo);void 0!==i&&(this.clipTo=new Function("ctx",i))}},setOptions:function(t){for(var e in t)this.set(e,t[e]);this._initGradient(t),this._initPattern(t),this._initClipping(t)},transform:function(t,e){var i=e?this._getLeftTopCoords():this.getCenterPoint();t.translate(i.x,i.y),t.rotate(s(this.angle)),t.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(t){var i=e.Object.NUM_FRACTION_DIGITS,r={type:this.type,originX:this.originX,originY:this.originY,left:n(this.left,i),top:n(this.top,i),width:n(this.width,i),height:n(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:n(this.strokeWidth,i),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:n(this.strokeMiterLimit,i),scaleX:n(this.scaleX,i),scaleY:n(this.scaleY,i),angle:n(this.getAngle(),i),flipX:this.flipX,flipY:this.flipY,opacity:n(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};return this.includeDefaultValues||(r=this._removeDefaultValues(r)),e.util.populateWithProperties(this,r,t),r},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(t){var i=e.util.getKlass(t.type).prototype;return i.stateProperties.forEach(function(e){t[e]===i[e]&&delete t[e]}),t},toString:function(){return"#<fabric."+r(this.type)+">"},get:function(t){return this[t]},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,i){return("scaleX"===t||"scaleY"===t)&&(i=this._constrainScale(i)),"scaleX"===t&&0>i?(this.flipX=!this.flipX,i*=-1):"scaleY"===t&&0>i?(this.flipY=!this.flipY,i*=-1):"width"===t||"height"===t?this.minScaleLimit=n(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"!==t||!i||i instanceof e.Shadow||(i=new e.Shadow(i)),this[t]=i,this},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},setSourcePath:function(t){return this.sourcePath=t,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(t,i){0===this.width&&0===this.height||!this.visible||(t.save(),this._setupCompositeOperation(t),i||this.transform(t),this._setStrokeStyles(t),this._setFillStyles(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this._setOpacity(t),this._setShadow(t),this.clipTo&&e.util.clipContext(this,t),this._render(t,i),this.clipTo&&t.restore(),this._removeShadow(t),this._restoreCompositeOperation(t),t.restore())},_setOpacity:function(t){this.group&&this.group._setOpacity(t),t.globalAlpha*=this.opacity},_setStrokeStyles:function(t){this.stroke&&(t.lineWidth=this.strokeWidth,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,t.strokeStyle=this.stroke.toLive?this.stroke.toLive(t,this):this.stroke)},_setFillStyles:function(t){this.fill&&(t.fillStyle=this.fill.toLive?this.fill.toLive(t,this):this.fill)},_renderControls:function(t,i){if(this.active&&!i){var n=this.getViewportTransform();t.save();var r;this.group&&(r=e.util.transformPoint(this.group.getCenterPoint(),n),t.translate(r.x,r.y),t.rotate(s(this.group.angle))),r=e.util.transformPoint(this.getCenterPoint(),n,null!=this.group),this.group&&(r.x*=this.group.scaleX,r.y*=this.group.scaleY),t.translate(r.x,r.y),t.rotate(s(this.angle)),this.drawBorders(t),this.drawControls(t),t.restore()}},_setShadow:function(t){if(this.shadow){var e=this.canvas&&this.canvas.viewportTransform[0]||1,i=this.canvas&&this.canvas.viewportTransform[3]||1;t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*(e+i)*(this.scaleX+this.scaleY)/4,t.shadowOffsetX=this.shadow.offsetX*e*this.scaleX,t.shadowOffsetY=this.shadow.offsetY*i*this.scaleY}},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_renderFill:function(t){if(this.fill){if(t.save(),this.fill.gradientTransform){var e=this.fill.gradientTransform;t.transform.apply(t,e)}this.fill.toLive&&t.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t)}},_renderStroke:function(t){if(this.stroke&&0!==this.strokeWidth){if(t.save(),this.strokeDashArray)1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),o?(t.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(t)):this._renderDashedStroke&&this._renderDashedStroke(t),t.stroke();else{if(this.stroke.gradientTransform){var e=this.stroke.gradientTransform;t.transform.apply(t,e)}this._stroke?this._stroke(t):t.stroke()}this._removeShadow(t),t.restore()}},clone:function(t,i){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(i),t):new e.Object(this.toObject(i))},cloneAsImage:function(t){var i=this.toDataURL();return e.util.loadImage(i,function(i){t&&t(new e.Image(i))}),this},toDataURL:function(t){t||(t={});var i=e.util.createCanvasElement(),n=this.getBoundingRect();i.width=n.width,i.height=n.height,e.util.wrapElement(i,"div");var r=new e.StaticCanvas(i);"jpg"===t.format&&(t.format="jpeg"),"jpeg"===t.format&&(r.backgroundColor="#fff");var s={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new e.Point(i.width/2,i.height/2),"center","center");var o=this.canvas;r.add(this);var a=r.toDataURL(t);return this.set(s).setCoords(),this.canvas=o,r.dispose(),r=null,a},isType:function(t){return this.type===t},complexity:function(){return 0},toJSON:function(t){return this.toObject(t)},setGradient:function(t,i){i||(i={});var n={colorStops:[]};n.type=i.type||(i.r1||i.r2?"radial":"linear"),n.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},(i.r1||i.r2)&&(n.coords.r1=i.r1,n.coords.r2=i.r2);for(var r in i.colorStops){var s=new e.Color(i.colorStops[r]);n.colorStops.push({offset:r,color:s.toRgb(),opacity:s.getAlpha()})}return this.set(t,e.Gradient.forObject(this,n))},setPatternFill:function(t){return this.set("fill",new e.Pattern(t))},setShadow:function(t){return this.set("shadow",t?new e.Shadow(t):null)},setColor:function(t){return this.set("fill",t),this},setAngle:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(t,e){e=e||this.canvas.getPointer(t);var i=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:e.x-i.x,y:e.y-i.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(this._prevGlobalCompositeOperation=t.globalCompositeOperation,t.globalCompositeOperation=this.globalCompositeOperation)},_restoreCompositeOperation:function(t){this.globalCompositeOperation&&this._prevGlobalCompositeOperation&&(t.globalCompositeOperation=this._prevGlobalCompositeOperation)}}),e.util.createAccessors(e.Object),e.Object.prototype.rotate=e.Object.prototype.setAngle,i(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(e,i,n){var r=e.x,s=e.y,o=this.stroke?this.strokeWidth:0;return"left"===i?r=e.x+(this.getWidth()+o*this.scaleX)/2:"right"===i&&(r=e.x-(this.getWidth()+o*this.scaleX)/2),"top"===n?s=e.y+(this.getHeight()+o*this.scaleY)/2:"bottom"===n&&(s=e.y-(this.getHeight()+o*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(r,s),e,t(this.angle))},translateToOriginPoint:function(e,i,n){var r=e.x,s=e.y,o=this.stroke?this.strokeWidth:0;return"left"===i?r=e.x-(this.getWidth()+o*this.scaleX)/2:"right"===i&&(r=e.x+(this.getWidth()+o*this.scaleX)/2),"top"===n?s=e.y-(this.getHeight()+o*this.scaleY)/2:"bottom"===n&&(s=e.y+(this.getHeight()+o*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(r,s),e,t(this.angle))},getCenterPoint:function(){var t=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(e,i,n){var r,s,o=this.getCenterPoint(),a=this.stroke?this.strokeWidth:0;return i&&n?(r="left"===i?o.x-(this.getWidth()+a*this.scaleX)/2:"right"===i?o.x+(this.getWidth()+a*this.scaleX)/2:o.x,s="top"===n?o.y-(this.getHeight()+a*this.scaleY)/2:"bottom"===n?o.y+(this.getHeight()+a*this.scaleY)/2:o.y):(r=this.left,s=this.top),fabric.util.rotatePoint(new fabric.Point(e.x,e.y),o,-t(this.angle)).subtractEquals(new fabric.Point(r,s))},setPositionByOrigin:function(t,e,i){var n=this.translateToCenterPoint(t,e,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(e){var i=t(this.angle),n=this.getWidth()/2,r=Math.cos(i)*n,s=Math.sin(i)*n,o=this.getWidth(),a=Math.cos(i)*o,h=Math.sin(i)*o;"center"===this.originX&&"left"===e||"right"===this.originX&&"center"===e?(this.left-=r,this.top-=s):"left"===this.originX&&"center"===e||"center"===this.originX&&"right"===e?(this.left+=r,this.top+=s):"left"===this.originX&&"right"===e?(this.left+=a,this.top+=h):"right"===this.originX&&"left"===e&&(this.left-=a,this.top-=h),this.setCoords(),this.originX=e},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(t,e){var i=this.oCoords,n=new fabric.Point(i.tl.x,i.tl.y),r=new fabric.Point(i.tr.x,i.tr.y),s=new fabric.Point(i.bl.x,i.bl.y),o=new fabric.Point(i.br.x,i.br.y);return"Intersection"===fabric.Intersection.intersectPolygonRectangle([n,r,o,s],t,e).status},intersectsWithObject:function(t){function e(t){return{tl:new fabric.Point(t.tl.x,t.tl.y),tr:new fabric.Point(t.tr.x,t.tr.y),bl:new fabric.Point(t.bl.x,t.bl.y),br:new fabric.Point(t.br.x,t.br.y)}}var i=e(this.oCoords),n=e(t.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonPolygon([i.tl,i.tr,i.br,i.bl],[n.tl,n.tr,n.br,n.bl]).status},isContainedWithinObject:function(t){var e=t.getBoundingRect(),i=new fabric.Point(e.left,e.top),n=new fabric.Point(e.left+e.width,e.top+e.height);return this.isContainedWithinRect(i,n)},isContainedWithinRect:function(t,e){var i=this.getBoundingRect();return i.left>=t.x&&i.left+i.width<=e.x&&i.top>=t.y&&i.top+i.height<=e.y},containsPoint:function(t){var e=this._getImageLines(this.oCoords),i=this._findCrossPoints(t,e);return 0!==i&&i%2==1},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,n,r,s,o,a,h=0;for(var c in e)if(a=e[c],!(a.o.y<t.y&&a.d.y<t.y||a.o.y>=t.y&&a.d.y>=t.y||(a.o.x===a.d.x&&a.o.x>=t.x?(o=a.o.x,t.y):(i=0,n=(a.d.y-a.o.y)/(a.d.x-a.o.x),r=t.y-i*t.x,s=a.o.y-n*a.o.x,o=-(r-s)/(i-n),r+i*o),o>=t.x&&(h+=1),2!==h)))break;return h},getBoundingRectWidth:function(){return this.getBoundingRect().width},
getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var t=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],e=fabric.util.array.min(t),i=fabric.util.array.max(t),n=Math.abs(e-i),r=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],s=fabric.util.array.min(r),o=fabric.util.array.max(r);return{left:e,top:s,width:n,height:Math.abs(s-o)}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?0>t?-this.minScaleLimit:this.minScaleLimit:t},scale:function(t){return t=this._constrainScale(t),0>t&&(this.flipX=!this.flipX,this.flipY=!this.flipY,t*=-1),this.scaleX=t,this.scaleY=t,this.setCoords(),this},scaleToWidth:function(t){var e=this.getBoundingRectWidth()/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRectHeight()/this.getHeight();return this.scale(t/this.height/e)},setCoords:function(){var e=t(this.angle),i=this.getViewportTransform(),n=function(t){return fabric.util.transformPoint(t,i)},r=this._calculateCurrentDimensions(!1),s=r.x,o=r.y;0>s&&(s=Math.abs(s));var a=Math.sqrt(Math.pow(s/2,2)+Math.pow(o/2,2)),h=Math.atan(isFinite(o/s)?o/s:0),c=Math.cos(h+e)*a,l=Math.sin(h+e)*a,u=Math.sin(e),d=Math.cos(e),f=this.getCenterPoint(),g=new fabric.Point(s,o),p=new fabric.Point(f.x-c,f.y-l),m=new fabric.Point(p.x+g.x*d,p.y+g.x*u),v=n(new fabric.Point(p.x-g.y*u,p.y+g.y*d)),y=n(new fabric.Point(m.x-g.y*u,m.y+g.y*d)),b=n(p),_=n(m),w=new fabric.Point((b.x+v.x)/2,(b.y+v.y)/2),T=new fabric.Point((_.x+b.x)/2,(_.y+b.y)/2),x=new fabric.Point((y.x+_.x)/2,(y.y+_.y)/2),S=new fabric.Point((y.x+v.x)/2,(y.y+v.y)/2),C=new fabric.Point(T.x+u*this.rotatingPointOffset,T.y-d*this.rotatingPointOffset);return this.oCoords={tl:b,tr:_,br:y,bl:v,ml:w,mt:T,mr:x,mb:S,mtr:C},this._setCornerCoords&&this._setCornerCoords(),this}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas.moveTo(this,t),this}}),fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var t=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",e=this.fillRule,i=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"",s=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=void 0!==this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;";return["stroke: ",i,"; ","stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",s,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",a,"; ","fill: ",t,"; ","fill-rule: ",e,"; ","opacity: ",h,";",this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"",c].join("")},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var t=fabric.util.toFixed,e=this.getAngle(),i=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],n=fabric.util.transformPoint(this.getCenterPoint(),i),r=fabric.Object.NUM_FRACTION_DIGITS,s="path-group"===this.type?"":"translate("+t(n.x,r)+" "+t(n.y,r)+")",o=0!==e?" rotate("+t(e,r)+")":"",a=1===this.scaleX&&1===this.scaleY&&1===i[0]&&1===i[3]?"":" scale("+t(this.scaleX*i[0],r)+" "+t(this.scaleY*i[3],r)+")",h="path-group"===this.type?this.width*i[0]:0,c=this.flipX?" matrix(-1 0 0 1 "+h+" 0) ":"",l="path-group"===this.type?this.height*i[3]:0;return[s,o,a,c,this.flipY?" matrix(1 0 0 -1 0 "+l+")":""].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var t=[];return this.fill&&this.fill.toLive&&t.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&t.push(this.stroke.toSVG(this,!1)),this.shadow&&t.push(this.shadow.toSVG(this)),t}}),fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(t){return this.get(t)!==this.originalState[t]},this)},saveState:function(t){return this.stateProperties.forEach(function(t){this.originalState[t]=this.get(t)},this),t&&t.stateProperties&&t.stateProperties.forEach(function(t){this.originalState[t]=this.get(t)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var t=fabric.util.degreesToRadians,e=function(){return"undefined"!=typeof G_vmlCanvasManager};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||!this.active)return!1;var e,i,n=t.x,r=t.y;for(var s in this.oCoords)if(this.isControlVisible(s)&&("mtr"!==s||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==s&&"mr"!==s&&"mb"!==s&&"ml"!==s)&&(i=this._getImageLines(this.oCoords[s].corner),0!==(e=this._findCrossPoints({x:n,y:r},i))&&e%2==1))return this.__corner=s,s;return!1},_setCornerCoords:function(){var e,i,n=this.oCoords,r=t(45-this.angle),s=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,o=s*Math.cos(r),a=s*Math.sin(r);for(var h in n)e=n[h].x,i=n[h].y,n[h].corner={tl:{x:e-a,y:i-o},tr:{x:e+o,y:i-a},bl:{x:e-o,y:i+a},br:{x:e+a,y:i+o}}},_calculateCurrentDimensions:function(t){var e=this.getViewportTransform(),i=this.strokeWidth,n=this.width,r=this.height,s="round"===this.strokeLineCap||"square"===this.strokeLineCap,o="line"===this.type&&0===this.width,a="line"===this.type&&0===this.height,h=o||a,c=s&&a||!h,l=s&&o||!h;return o?n=i:a&&(r=i),c&&(n+=0>n?-i:i),l&&(r+=0>r?-i:i),n=n*this.scaleX+2*this.padding,r=r*this.scaleY+2*this.padding,t?fabric.util.transformPoint(new fabric.Point(n,r),e,!0):{x:n,y:r}},drawBorders:function(t){if(!this.hasBorders)return this;t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=this.borderColor,t.lineWidth=1/this.borderScaleFactor;var e=this._calculateCurrentDimensions(!0),i=e.x,n=e.y;if(this.group&&(i*=this.group.scaleX,n*=this.group.scaleY),t.strokeRect(~~(-i/2)-.5,~~(-n/2)-.5,1+~~i,1+~~n),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var r=-n/2;t.beginPath(),t.moveTo(0,r),t.lineTo(0,r-this.rotatingPointOffset),t.closePath(),t.stroke()}return t.restore(),this},drawControls:function(t){if(!this.hasControls)return this;var e=this._calculateCurrentDimensions(!0),i=e.x,n=e.y,r=-i/2,s=-n/2,o=this.cornerSize/2,a=this.transparentCorners?"strokeRect":"fillRect";return t.save(),t.lineWidth=1,t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=t.fillStyle=this.cornerColor,this._drawControl("tl",t,a,r-o,s-o),this._drawControl("tr",t,a,r+i-o,s-o),this._drawControl("bl",t,a,r-o,s+n-o),this._drawControl("br",t,a,r+i-o,s+n-o),this.get("lockUniScaling")||(this._drawControl("mt",t,a,r+i/2-o,s-o),this._drawControl("mb",t,a,r+i/2-o,s+n-o),this._drawControl("mr",t,a,r+i-o,s+n/2-o),this._drawControl("ml",t,a,r-o,s+n/2-o)),this.hasRotatingPoint&&this._drawControl("mtr",t,a,r+i/2-o,s-this.rotatingPointOffset-o),t.restore(),this},_drawControl:function(t,i,n,r,s){if(this.isControlVisible(t)){var o=this.cornerSize;e()||this.transparentCorners||i.clearRect(r,s,o,o),i[n](r,s,o,o)}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){t||(t={});for(var e in t)this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(t,e){e=e||{};var i=function(){},n=e.onComplete||i,r=e.onChange||i,s=this;return fabric.util.animate({startValue:t.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(e){t.set("left",e),s.renderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxCenterObjectV:function(t,e){e=e||{};var i=function(){},n=e.onComplete||i,r=e.onChange||i,s=this;return fabric.util.animate({startValue:t.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(e){t.set("top",e),s.renderAll(),r()},onComplete:function(){t.setCoords(),n()}}),this},fxRemove:function(t,e){e=e||{};var i=function(){},n=e.onComplete||i,r=e.onChange||i,s=this;return fabric.util.animate({startValue:t.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){t.set("active",!1)},onChange:function(e){t.set("opacity",e),s.renderAll(),r()},onComplete:function(){s.remove(t),n()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[];for(t in arguments[0])i.push(t);for(var n=0,r=i.length;r>n;n++)t=i[n],e=n!==r-1,this._animate(t,arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(t,e,i,n){var r,s=this;e=e.toString(),i=i?fabric.util.object.clone(i):{},~t.indexOf(".")&&(r=t.split("."));var o=r?this.get(r[0])[r[1]]:this.get(t);"from"in i||(i.from=o),e=~e.indexOf("=")?o+parseFloat(e.replace("=","")):parseFloat(e),fabric.util.animate({startValue:i.from,endValue:e,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(s)},onChange:function(e){r?s[r[0]][r[1]]=e:s.set(t,e),n||i.onChange&&i.onChange()},onComplete:function(){n||(s.setCoords(),i.onComplete&&i.onComplete())}})}}),function(t){"use strict";function e(t,e){var i=t.origin,n=t.axis1,r=t.axis2,s=t.dimension,o=e.nearest,a=e.center,h=e.farthest;return function(){switch(this.get(i)){case o:return Math.min(this.get(n),this.get(r));case a:return Math.min(this.get(n),this.get(r))+.5*this.get(s);case h:return Math.max(this.get(n),this.get(r))}}}var i=t.fabric||(t.fabric={}),n=i.util.object.extend,r={x1:1,x2:1,y1:1,y2:1},s=i.StaticCanvas.supports("setLineDash");i.Line?i.warn("fabric.Line is already defined"):(i.Line=i.util.createClass(i.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(t,e){e=e||{},t||(t=[0,0,0,0]),this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t||(t={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),void 0!==r[t]&&this._setWidthHeight(),this},_getLeftToOriginX:e({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:e({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t,e){if(t.beginPath(),e){var i=this.getCenterPoint();t.translate(i.x-this.strokeWidth/2,i.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&s){var n=this.calcLinePoints();t.moveTo(n.x1,n.y1),t.lineTo(n.x2,n.y2)}t.lineWidth=this.strokeWidth;var r=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=r},_renderDashedStroke:function(t){var e=this.calcLinePoints();t.beginPath(),i.util.drawDashedLine(t,e.x1,e.y1,e.x2,e.y2,this.strokeDashArray),t.closePath()},toObject:function(t){return n(this.callSuper("toObject",t),this.calcLinePoints())},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,i=t*this.width*.5,n=e*this.height*.5;return{x1:i,x2:t*this.width*-.5,y1:n,y2:e*this.height*-.5}},toSVG:function(t){var e=this._createBaseSVGMarkup(),i={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(i=this.calcLinePoints()),e.push("<line ",'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),i.Line.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),i.Line.fromElement=function(t,e){var r=i.parseAttributes(t,i.Line.ATTRIBUTE_NAMES),s=[r.x1||0,r.y1||0,r.x2||0,r.y2||0];return new i.Line(s,n(r,e))},i.Line.fromObject=function(t){var e=[t.x1,t.y1,t.x2,t.y2];return new i.Line(e,t)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";function e(t){return"radius"in t&&t.radius>=0}var i=t.fabric||(t.fabric={}),n=Math.PI,r=i.util.object.extend;i.Circle?i.warn("fabric.Circle is already defined."):(i.Circle=i.util.createClass(i.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*n,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("radius",t.radius||0),this.startAngle=t.startAngle||this.startAngle,this.endAngle=t.endAngle||this.endAngle},_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return r(this.callSuper("toObject",t),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=0,r=0,s=(this.endAngle-this.startAngle)%(2*n);if(0===s)this.group&&"path-group"===this.group.type&&(i=this.left+this.radius,r=this.top+this.radius),e.push("<circle ",'cx="'+i+'" cy="'+r+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var o=Math.cos(this.startAngle)*this.radius,a=Math.sin(this.startAngle)*this.radius,h=Math.cos(this.endAngle)*this.radius,c=Math.sin(this.endAngle)*this.radius,l=s>n?"1":"0";e.push('<path d="M '+o+" "+a," A "+this.radius+" "+this.radius," 0 ",+l+" 1"," "+h+" "+c,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.arc(e?this.left+this.radius:0,e?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(t),this._renderStroke(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){this.radius=t,this.set("width",2*t).set("height",2*t)},complexity:function(){return 1}}),i.Circle.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),i.Circle.fromElement=function(t,n){n||(n={});var s=i.parseAttributes(t,i.Circle.ATTRIBUTE_NAMES);if(!e(s))throw new Error("value of `r` attribute is required and can not be negative");s.left=s.left||0,s.top=s.top||0;var o=new i.Circle(r(s,n));return o.left-=o.radius,o.top-=o.radius,o},i.Circle.fromObject=function(t){return new i.Circle(t)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Triangle?e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("width",t.width||100).set("height",t.height||100)},_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var i=this.width/2,n=this.height/2;t.beginPath(),e.util.drawDashedLine(t,-i,n,0,-n,this.strokeDashArray),e.util.drawDashedLine(t,0,-n,i,n,this.strokeDashArray),e.util.drawDashedLine(t,i,n,-i,n,this.strokeDashArray),t.closePath()},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.width/2,n=this.height/2,r=[-i+" "+n,"0 "+-n,i+" "+n].join(",");return e.push("<polygon ",'points="',r,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Triangle.fromObject=function(t){return new e.Triangle(t)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=2*Math.PI,n=e.util.object.extend;e.Ellipse?e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,initialize:function(t){t=t||{},this.callSuper("initialize",t),this.set("rx",t.rx||0),this.set("ry",t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return n(this.callSuper("toObject",t),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=0,n=0;return this.group&&"path-group"===this.group.type&&(i=this.left+this.rx,n=this.top+this.ry),e.push("<ellipse ",'cx="',i,'" cy="',n,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(e?this.left+this.rx:0,e?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,i,!1),t.restore(),this._renderFill(t),this._renderStroke(t)},complexity:function(){return 1}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(t,i){i||(i={});var r=e.parseAttributes(t,e.Ellipse.ATTRIBUTE_NAMES);r.left=r.left||0,r.top=r.top||0;var s=new e.Ellipse(n(r,i));return s.top-=s.ry,s.left-=s.rx,s},e.Ellipse.fromObject=function(t){return new e.Ellipse(t)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;if(e.Rect)return void console.warn("fabric.Rect is already defined");var n=e.Object.prototype.stateProperties.concat();n.push("rx","ry","x","y"),e.Rect=e.util.createClass(e.Object,{stateProperties:n,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(t){t=t||{},this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t,e){if(1===this.width&&1===this.height)return void t.fillRect(0,0,1,1);var i=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,r=this.width,s=this.height,o=e?this.left:-this.width/2,a=e?this.top:-this.height/2,h=0!==i||0!==n,c=.4477152502;t.beginPath(),t.moveTo(o+i,a),t.lineTo(o+r-i,a),h&&t.bezierCurveTo(o+r-c*i,a,o+r,a+c*n,o+r,a+n),t.lineTo(o+r,a+s-n),h&&t.bezierCurveTo(o+r,a+s-c*n,o+r-c*i,a+s,o+r-i,a+s),t.lineTo(o+i,a+s),h&&t.bezierCurveTo(o+c*i,a+s,o,a+s-c*n,o,a+s-n),t.lineTo(o,a+n),h&&t.bezierCurveTo(o,a+c*n,o+c*i,a,o+i,a),t.closePath(),this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var i=-this.width/2,n=-this.height/2,r=this.width,s=this.height;t.beginPath(),e.util.drawDashedLine(t,i,n,i+r,n,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n,i+r,n+s,this.strokeDashArray),e.util.drawDashedLine(t,i+r,n+s,i,n+s,this.strokeDashArray),e.util.drawDashedLine(t,i,n+s,i,n,this.strokeDashArray),t.closePath()},toObject:function(t){var e=i(this.callSuper("toObject",t),{rx:this.get("rx")||0,ry:this.get("ry")||0});return this.includeDefaultValues||this._removeDefaultValues(e),e},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.left,n=this.top;return this.group&&"path-group"===this.group.type||(i=-this.width/2,n=-this.height/2),e.push("<rect ",'x="',i,'" y="',n,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(t,n){if(!t)return null;n=n||{};var r=e.parseAttributes(t,e.Rect.ATTRIBUTE_NAMES);r.left=r.left||0,r.top=r.top||0;var s=new e.Rect(i(n?e.util.object.clone(n):{},r));return s.visible=s.width>0&&s.height>0,s},e.Rect.fromObject=function(t){return new e.Rect(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Polyline?e.warn("fabric.Polyline is already defined"):(e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(t,i){return e.Polygon.prototype.initialize.call(this,t,i)},_calcDimensions:function(){return e.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return e.Polygon.prototype._applyPointOffset.call(this)},toObject:function(t){return e.Polygon.prototype.toObject.call(this,t)},toSVG:function(t){return e.Polygon.prototype.toSVG.call(this,t)},_render:function(t){e.Polygon.prototype.commonRender.call(this,t)&&(this._renderFill(t),this._renderStroke(t))},_renderDashedStroke:function(t){var i,n;t.beginPath();for(var r=0,s=this.points.length;s>r;r++)i=this.points[r],n=this.points[r+1]||i,e.util.drawDashedLine(t,i.x,i.y,n.x,n.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElement=function(t,i){if(!t)return null;i||(i={});var n=e.parsePointsAttribute(t.getAttribute("points")),r=e.parseAttributes(t,e.Polyline.ATTRIBUTE_NAMES);return new e.Polyline(n,e.util.object.extend(r,i))},e.Polyline.fromObject=function(t){var i=t.points;return new e.Polyline(i,t,!0)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,s=e.util.toFixed;e.Polygon?e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e),this._calcDimensions(),"top"in e||(this.top=this.minY),"left"in e||(this.left=this.minX)},_calcDimensions:function(){var t=this.points,e=n(t,"x"),i=n(t,"y"),s=r(t,"x"),o=r(t,"y");this.width=s-e||0,this.height=o-i||0,this.minX=e||0,this.minY=i||0},_applyPointOffset:function(){this.points.forEach(function(t){t.x-=this.minX+this.width/2,t.y-=this.minY+this.height/2},this)},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat()})},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),n=0,r=this.points.length;r>n;n++)e.push(s(this.points[n].x,2),",",s(this.points[n].y,2)," ");return i.push("<",this.type," ",'points="',e.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),t?t(i.join("")):i.join("")},_render:function(t){this.commonRender(t)&&(this._renderFill(t),(this.stroke||this.strokeDashArray)&&(t.closePath(),this._renderStroke(t)))},commonRender:function(t){var e,i=this.points.length;if(!i||isNaN(this.points[i-1].y))return!1;t.beginPath(),this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null),t.moveTo(this.points[0].x,this.points[0].y);for(var n=0;i>n;n++)e=this.points[n],t.lineTo(e.x,e.y);return!0},_renderDashedStroke:function(t){e.Polyline.prototype._renderDashedStroke.call(this,t),t.closePath()},complexity:function(){return this.points.length}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=function(t,n){if(!t)return null;n||(n={});var r=e.parsePointsAttribute(t.getAttribute("points")),s=e.parseAttributes(t,e.Polygon.ATTRIBUTE_NAMES);return new e.Polygon(r,i(s,n))},e.Polygon.fromObject=function(t){return new e.Polygon(t.points,t,!0)})}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.array.min,n=e.util.array.max,r=e.util.object.extend,s=Object.prototype.toString,o=e.util.drawArc,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},h={m:"l",M:"L"};e.Path?e.warn("fabric.Path is already defined"):(e.Path=e.util.createClass(e.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(t,e){if(e=e||{},this.setOptions(e),!t)throw new Error("`path` argument is required");var i="[object Array]"===s.call(t);this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||(this.path=this._parsePath()),this._setPositionDimensions(),e.sourcePath&&this.setSourcePath(e.sourcePath))},_setPositionDimensions:function(){var t=this._parseDimensions();this.minX=t.left,this.minY=t.top,this.width=t.width,this.height=t.height,t.left+="center"===this.originX?this.width/2:"right"===this.originX?this.width:0,t.top+="center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0,this.top=this.top||t.top,this.left=this.left||t.left,this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(t){var e,i,n,r=null,s=0,a=0,h=0,c=0,l=0,u=0,d=-this.pathOffset.x,f=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(d=0,f=0),t.beginPath();for(var g=0,p=this.path.length;p>g;++g){switch(e=this.path[g],e[0]){case"l":h+=e[1],c+=e[2],t.lineTo(h+d,c+f);break;case"L":h=e[1],c=e[2],t.lineTo(h+d,c+f);break;case"h":h+=e[1],t.lineTo(h+d,c+f);break;case"H":h=e[1],t.lineTo(h+d,c+f);break;case"v":c+=e[1],t.lineTo(h+d,c+f);break;case"V":c=e[1],t.lineTo(h+d,c+f);break;case"m":h+=e[1],c+=e[2],s=h,a=c,t.moveTo(h+d,c+f);break;case"M":h=e[1],c=e[2],s=h,a=c,t.moveTo(h+d,c+f);break;case"c":i=h+e[5],n=c+e[6],l=h+e[3],u=c+e[4],t.bezierCurveTo(h+e[1]+d,c+e[2]+f,l+d,u+f,i+d,n+f),h=i,c=n;break;case"C":h=e[5],c=e[6],l=e[3],u=e[4],t.bezierCurveTo(e[1]+d,e[2]+f,l+d,u+f,h+d,c+f);break;case"s":i=h+e[3],n=c+e[4],null===r[0].match(/[CcSs]/)?(l=h,u=c):(l=2*h-l,u=2*c-u),t.bezierCurveTo(l+d,u+f,h+e[1]+d,c+e[2]+f,i+d,n+f),l=h+e[1],u=c+e[2],h=i,c=n;break;case"S":i=e[3],n=e[4],null===r[0].match(/[CcSs]/)?(l=h,u=c):(l=2*h-l,u=2*c-u),t.bezierCurveTo(l+d,u+f,e[1]+d,e[2]+f,i+d,n+f),h=i,c=n,l=e[1],u=e[2];break;case"q":i=h+e[3],n=c+e[4],l=h+e[1],u=c+e[2],t.quadraticCurveTo(l+d,u+f,i+d,n+f),h=i,c=n;break;case"Q":i=e[3],n=e[4],t.quadraticCurveTo(e[1]+d,e[2]+f,i+d,n+f),h=i,c=n,l=e[1],u=e[2];break;case"t":i=h+e[1],n=c+e[2],null===r[0].match(/[QqTt]/)?(l=h,u=c):(l=2*h-l,u=2*c-u),t.quadraticCurveTo(l+d,u+f,i+d,n+f),h=i,c=n;break;case"T":i=e[1],n=e[2],null===r[0].match(/[QqTt]/)?(l=h,u=c):(l=2*h-l,u=2*c-u),t.quadraticCurveTo(l+d,u+f,i+d,n+f),h=i,c=n;break;case"a":o(t,h+d,c+f,[e[1],e[2],e[3],e[4],e[5],e[6]+h+d,e[7]+c+f]),h+=e[6],c+=e[7];break;case"A":o(t,h+d,c+f,[e[1],e[2],e[3],e[4],e[5],e[6]+d,e[7]+f]),h=e[6],c=e[7];break;case"z":case"Z":h=s,c=a,t.closePath()}r=e}this._renderFill(t),this._renderStroke(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){var e=r(this.callSuper("toObject",t),{path:this.path.map(function(t){return t.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(e.sourcePath=this.sourcePath),this.transformMatrix&&(e.transformMatrix=this.transformMatrix),e},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.path=this.sourcePath),delete e.sourcePath,e},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),n="",r=0,s=this.path.length;s>r;r++)e.push(this.path[r].join(" "));var o=e.join(" ");return this.group&&"path-group"===this.group.type||(n=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),i.push("<path ",'d="',o,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),n,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),t?t(i.join("")):i.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,i,n,r,s=[],o=[],c=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,l=0,u=this.path.length;u>l;l++){for(t=this.path[l],n=t.slice(1).trim(),o.length=0;i=c.exec(n);)o.push(i[0]);r=[t.charAt(0)];for(var d=0,f=o.length;f>d;d++)e=parseFloat(o[d]),isNaN(e)||r.push(e);var g=r[0],p=a[g.toLowerCase()],m=h[g]||g;if(r.length-1>p)for(var v=1,y=r.length;y>v;v+=p)s.push([g].concat(r.slice(v,v+p))),g=m;else s.push(r)}return s},_parseDimensions:function(){for(var t,r,s,o,a=[],h=[],c=null,l=0,u=0,d=0,f=0,g=0,p=0,m=0,v=this.path.length;v>m;++m){switch(t=this.path[m],t[0]){case"l":d+=t[1],f+=t[2],o=[];break;case"L":d=t[1],f=t[2],o=[];break;case"h":d+=t[1],o=[];break;case"H":d=t[1],o=[];break;case"v":f+=t[1],o=[];break;case"V":f=t[1],o=[];break;case"m":d+=t[1],f+=t[2],l=d,u=f,o=[];break;case"M":d=t[1],f=t[2],l=d,u=f,o=[];break;case"c":r=d+t[5],s=f+t[6],g=d+t[3],p=f+t[4],o=e.util.getBoundsOfCurve(d,f,d+t[1],f+t[2],g,p,r,s),d=r,f=s;break;case"C":d=t[5],f=t[6],g=t[3],p=t[4],o=e.util.getBoundsOfCurve(d,f,t[1],t[2],g,p,d,f);break;case"s":r=d+t[3],s=f+t[4],null===c[0].match(/[CcSs]/)?(g=d,p=f):(g=2*d-g,p=2*f-p),o=e.util.getBoundsOfCurve(d,f,g,p,d+t[1],f+t[2],r,s),g=d+t[1],p=f+t[2],d=r,f=s;break;case"S":r=t[3],s=t[4],null===c[0].match(/[CcSs]/)?(g=d,p=f):(g=2*d-g,p=2*f-p),o=e.util.getBoundsOfCurve(d,f,g,p,t[1],t[2],r,s),d=r,f=s,g=t[1],p=t[2];break;case"q":r=d+t[3],s=f+t[4],g=d+t[1],p=f+t[2],o=e.util.getBoundsOfCurve(d,f,g,p,g,p,r,s),d=r,f=s;break;case"Q":g=t[1],p=t[2],o=e.util.getBoundsOfCurve(d,f,g,p,g,p,t[3],t[4]),d=t[3],f=t[4];break;case"t":r=d+t[1],s=f+t[2],null===c[0].match(/[QqTt]/)?(g=d,p=f):(g=2*d-g,p=2*f-p),o=e.util.getBoundsOfCurve(d,f,g,p,g,p,r,s),d=r,f=s;break;case"T":r=t[1],s=t[2],null===c[0].match(/[QqTt]/)?(g=d,p=f):(g=2*d-g,p=2*f-p),o=e.util.getBoundsOfCurve(d,f,g,p,g,p,r,s),d=r,f=s;break;case"a":o=e.util.getBoundsOfArc(d,f,t[1],t[2],t[3],t[4],t[5],t[6]+d,t[7]+f),d+=t[6],f+=t[7];break;case"A":o=e.util.getBoundsOfArc(d,f,t[1],t[2],t[3],t[4],t[5],t[6],t[7]),d=t[6],f=t[7];break;case"z":case"Z":d=l,f=u}c=t,o.forEach(function(t){a.push(t.x),h.push(t.y)}),a.push(d),h.push(f)}var y=i(a),b=i(h);return{left:y,top:b,width:n(a)-y,height:n(h)-b}}}),e.Path.fromObject=function(t,i){"string"==typeof t.path?e.loadSVGFromURL(t.path,function(n){var r=n[0],s=t.path;delete t.path,e.util.object.extend(r,t),r.setSourcePath(s),i(r)}):i(new e.Path(t.path,t))},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(t,i,n){var s=e.parseAttributes(t,e.Path.ATTRIBUTE_NAMES);i&&i(new e.Path(s.d,r(s,n)))},e.Path.async=!0)}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.invoke,r=e.Object.prototype.toObject;e.PathGroup?e.warn("fabric.PathGroup is already defined"):(e.PathGroup=e.util.createClass(e.Path,{type:"path-group",fill:"",initialize:function(t,e){e=e||{},this.paths=t||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;e.toBeParsed&&(this.parseDimensionsFromPaths(e),delete e.toBeParsed),this.setOptions(e),this.setCoords(),e.sourcePath&&this.setSourcePath(e.sourcePath)},parseDimensionsFromPaths:function(t){for(var i,n,r,s,o,a=[],h=[],c=this.transformMatrix,l=this.paths.length;l--;){r=this.paths[l],s=r.height+r.strokeWidth,o=r.width+r.strokeWidth,i=[{x:r.left,y:r.top},{x:r.left+o,y:r.top},{x:r.left,y:r.top+s},{x:r.left+o,y:r.top+s}];for(var u=0;u<i.length;u++)n=i[u],c&&(n=e.util.transformPoint(n,c,!1)),a.push(n.x),h.push(n.y)}t.width=Math.max.apply(null,a),t.height=Math.max.apply(null,h)},render:function(t){if(this.visible){
t.save(),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.transform(t),this._setShadow(t),this.clipTo&&e.util.clipContext(this,t),t.translate(-this.width/2,-this.height/2);for(var i=0,n=this.paths.length;n>i;++i)this.paths[i].render(t,!0);this.clipTo&&t.restore(),this._removeShadow(t),t.restore()}},_set:function(t,e){if("fill"===t&&e&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(t,e);return this.callSuper("_set",t,e)},toObject:function(t){var e=i(r.call(this,t),{paths:n(this.getObjects(),"toObject",t)});return this.sourcePath&&(e.sourcePath=this.sourcePath),e},toDatalessObject:function(t){var e=this.toObject(t);return this.sourcePath&&(e.paths=this.sourcePath),e},toSVG:function(t){for(var e=this.getObjects(),i=this.getPointByOrigin("left","top"),n="translate("+i.x+" "+i.y+")",r=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),n,this.getSvgTransform(),'" ',">\n"],s=0,o=e.length;o>s;s++)r.push(e[s].toSVG(t));return r.push("</g>\n"),t?t(r.join("")):r.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var t=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(e){return(e.get("fill")||"").toLowerCase()===t})},complexity:function(){return this.paths.reduce(function(t,e){return t+(e&&e.complexity?e.complexity():0)},0)},getObjects:function(){return this.paths}}),e.PathGroup.fromObject=function(t,i){"string"==typeof t.paths?e.loadSVGFromURL(t.paths,function(n){var r=t.paths;delete t.paths;var s=e.util.groupSVGElements(n,t,r);i(s)}):e.util.enlivenObjects(t.paths,function(n){delete t.paths,i(new e.PathGroup(n,t))})},e.PathGroup.async=!0)}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max,s=e.util.array.invoke;if(!e.Group){var o={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",initialize:function(t,e){e=e||{},this._objects=t||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;this.originalState={},this.callSuper("initialize"),e.originX&&(this.originX=e.originX),e.originY&&(this.originY=e.originY),this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",e),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(t){var e=t.getLeft(),i=t.getTop(),n=this.getCenterPoint();t.set({originalLeft:e,originalTop:i,left:e-n.x,top:i-n.y}),t.setCoords(),t.__origHasControls=t.hasControls,t.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),t&&(this._objects.push(t),t.group=this),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(t){t.set("active",!0),t.group=this},removeWithUpdate:function(t){return this._moveFlippedObject(t),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(t){t.group=this},_onObjectRemoved:function(t){delete t.group,t.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(t,e){if(t in this.delegatedProperties)for(var i=this._objects.length;i--;)this._objects[i].set(t,e);this.callSuper("_set",t,e)},toObject:function(t){return i(this.callSuper("toObject",t),{objects:s(this._objects,"toObject",t)})},render:function(t){if(this.visible){t.save(),this.clipTo&&e.util.clipContext(this,t),this.transform(t);for(var i=0,n=this._objects.length;n>i;i++)this._renderObject(this._objects[i],t);this.clipTo&&t.restore(),t.restore()}},_renderControls:function(t,e){this.callSuper("_renderControls",t,e);for(var i=0,n=this._objects.length;n>i;i++)this._objects[i]._renderControls(t)},_renderObject:function(t,e){var i=t.hasRotatingPoint;t.visible&&(t.hasRotatingPoint=!1,t.render(e),t.hasRotatingPoint=i)},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){return this._moveFlippedObject(t),this._setObjectPosition(t),t},_moveFlippedObject:function(t){var e=t.get("originX"),i=t.get("originY"),n=t.getCenterPoint();t.set({originX:"center",originY:"center",left:n.x,top:n.y}),this._toggleFlipping(t);var r=t.getPointByOrigin(e,i);return t.set({originX:e,originY:i,left:r.x,top:r.y}),this},_toggleFlipping:function(t){this.flipX&&(t.toggle("flipX"),t.set("left",-t.get("left")),t.setAngle(-t.getAngle())),this.flipY&&(t.toggle("flipY"),t.set("top",-t.get("top")),t.setAngle(-t.getAngle()))},_restoreObjectState:function(t){return this._setObjectPosition(t),t.setCoords(),t.hasControls=t.__origHasControls,delete t.__origHasControls,t.set("active",!1),t.setCoords(),delete t.group,this},_setObjectPosition:function(t){var e=this.getCenterPoint(),i=this._getRotatedLeftTop(t);t.set({angle:t.getAngle()+this.getAngle(),left:e.x+i.left,top:e.y+i.top,scaleX:t.get("scaleX")*this.get("scaleX"),scaleY:t.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(t){var e=this.getAngle()*(Math.PI/180);return{left:-Math.sin(e)*t.getTop()*this.get("scaleY")+Math.cos(e)*t.getLeft()*this.get("scaleX"),top:Math.cos(e)*t.getTop()*this.get("scaleY")+Math.sin(e)*t.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords()}),this},_calcBounds:function(t){for(var e,i,n=[],r=[],s=["tr","br","bl","tl"],o=0,a=this._objects.length;a>o;++o){e=this._objects[o],e.setCoords();for(var h=0;h<s.length;h++)i=s[h],n.push(e.oCoords[i].x),r.push(e.oCoords[i].y)}this.set(this._getBounds(n,r,t))},_getBounds:function(t,i,s){var o=e.util.invertTransform(this.getViewportTransform()),a=e.util.transformPoint(new e.Point(n(t),n(i)),o),h=e.util.transformPoint(new e.Point(r(t),r(i)),o),c={width:h.x-a.x||0,height:h.y-a.y||0};return s||(c.left=a.x||0,c.top=a.y||0,"center"===this.originX&&(c.left+=c.width/2),"right"===this.originX&&(c.left+=c.width),"center"===this.originY&&(c.top+=c.height/2),"bottom"===this.originY&&(c.top+=c.height)),c},toSVG:function(t){for(var e=["<g ",'transform="',this.getSvgTransform(),'">\n'],i=0,n=this._objects.length;n>i;i++)e.push(this._objects[i].toSVG(t));return e.push("</g>\n"),t?t(e.join("")):e.join("")},get:function(t){if(t in o){if(this[t])return this[t];for(var e=0,i=this._objects.length;i>e;e++)if(this._objects[e][t])return!0;return!1}return t in this.delegatedProperties?this._objects[0]&&this._objects[0].get(t):this[t]}}),e.Group.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){delete t.objects,i&&i(new e.Group(n,t))})},e.Group.async=!0}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=fabric.util.object.extend;t.fabric||(t.fabric={}),t.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(t,e){e||(e={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",e),this._initElement(t,e),this._initConfig(e),e.filters&&(this.filters=e.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(t,e,i){return this._element=t,this._originalElement=t,this._initConfig(i),0!==this.filters.length?this.applyFilters(e):e&&e(),this},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var t=this.getElement();return{width:t.width,height:t.height}},_stroke:function(t){t.save(),this._setStrokeStyles(t),t.beginPath(),t.strokeRect(-this.width/2,-this.height/2,this.width,this.height),t.closePath(),t.restore()},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,n=this.width,r=this.height;t.save(),this._setStrokeStyles(t),t.beginPath(),fabric.util.drawDashedLine(t,e,i,e+n,i,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i,e+n,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e+n,i+r,e,i+r,this.strokeDashArray),fabric.util.drawDashedLine(t,e,i+r,e,i,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){return e(this.callSuper("toObject",t),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(t){return t&&t.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},toSVG:function(t){var e=[],i=-this.width/2,n=-this.height/2,r="none";if(this.group&&"path-group"===this.group.type&&(i=this.left,n=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(r="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),e.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',i,'" y="',n,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',r,'"',"></image>\n"),this.stroke||this.strokeDashArray){var s=this.fill;this.fill=null,e.push("<rect ",'x="',i,'" y="',n,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=s}return e.push("</g>\n"),t?t(e.join("")):e.join("")},getSrc:function(){return this.getElement()?this.getElement().src||this.getElement()._src:void 0},setSrc:function(t,e,i){fabric.util.loadImage(t,function(t){return this.setElement(t,e,i)},this,i&&i.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(t,e){this.constructor.fromObject(this.toObject(e),t)},applyFilters:function(t,e,i,n){if(e=e||this.filters,i=i||this._originalElement){var r=i,s=fabric.util.createCanvasElement(),o=fabric.util.createImage(),a=this;return s.width=r.width,s.height=r.height,s.getContext("2d").drawImage(r,0,0,r.width,r.height),0===e.length?(this._element=i,t&&t(),s):(e.forEach(function(t){t&&t.applyTo(s,t.scaleX||a.scaleX,t.scaleY||a.scaleY),!n&&t&&"Resize"===t.type&&(a.width*=t.scaleX,a.height*=t.scaleY)}),o.width=s.width,o.height=s.height,fabric.isLikelyNode?(o.src=s.toBuffer(void 0,fabric.Image.pngCompression),a._element=o,!n&&(a._filteredEl=o),t&&t()):(o.onload=function(){a._element=o,!n&&(a._filteredEl=o),t&&t(),o.onload=s=r=null},o.src=s.toDataURL("image/png")),s)}},_render:function(t,e){var i,n,r,s=this._findMargins();i=e?this.left:-this.width/2,n=e?this.top:-this.height/2,"slice"===this.meetOrSlice&&(t.beginPath(),t.rect(i,n,this.width,this.height),t.clip()),!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,r=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):r=this._element,r&&t.drawImage(r,i+s.marginX,n+s.marginY,s.width,s.height),this._renderStroke(t)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var t,e,i=this.width,n=this.height,r=0,s=0;return("none"!==this.alignX||"none"!==this.alignY)&&(t=[this.width/this._element.width,this.height/this._element.height],e="meet"===this.meetOrSlice?Math.min.apply(null,t):Math.max.apply(null,t),i=this._element.width*e,n=this._element.height*e,"Mid"===this.alignX&&(r=(this.width-i)/2),"Max"===this.alignX&&(r=this.width-i),"Mid"===this.alignY&&(s=(this.height-n)/2),"Max"===this.alignY&&(s=this.height-n)),{width:i,height:n,marginX:r,marginY:s}},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width),this.set("height",t.height)},_initElement:function(t){this.setElement(fabric.util.getById(t)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){t||(t={}),this.setOptions(t),this._setWidthHeight(t),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t.filters&&t.filters.length?fabric.util.enlivenObjects(t.filters,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()?this.getElement().width||0:0,this.height="height"in t?t.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(t,e){fabric.util.loadImage(t.src,function(i){fabric.Image.prototype._initFilters.call(t,t,function(n){t.filters=n||[];var r=new fabric.Image(i,t);e&&e(r)})},null,t.crossOrigin)},fabric.Image.fromURL=function(t,e,i){fabric.util.loadImage(t,function(t){e&&e(new fabric.Image(t,i))},null,i&&i.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(t,i,n){var r,s,o,a=fabric.parseAttributes(t,fabric.Image.ATTRIBUTE_NAMES),h="xMidYMid",c="meet";a.preserveAspectRatio&&(o=a.preserveAspectRatio.split(" ")),o&&o.length&&(c=o.pop(),"meet"!==c&&"slice"!==c?(h=c,c="meet"):o.length&&(h=o.pop())),r="none"!==h?h.slice(1,4):"none",s="none"!==h?h.slice(5,8):"none",a.alignX=r,a.alignY=s,a.meetOrSlice=c,fabric.Image.fromURL(a["xlink:href"],i,e(n?fabric.util.object.clone(n):{},a))},fabric.Image.async=!0,fabric.Image.pngCompression=1)}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.getAngle()%360;return t>0?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(t){t=t||{};var e=function(){},i=t.onComplete||e,n=t.onChange||e,r=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){r.setAngle(t),n()},onComplete:function(){r.setCoords(),i()},onStart:function(){r.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.renderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Brightness=e.util.createClass(e.Image.filters.BaseFilter,{type:"Brightness",initialize:function(t){t=t||{},this.brightness=t.brightness||0},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=this.brightness,s=0,o=n.length;o>s;s+=4)n[s]+=r,n[s+1]+=r,n[s+2]+=r;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{brightness:this.brightness})}}),e.Image.filters.Brightness.fromObject=function(t){return new e.Image.filters.Brightness(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Convolute=e.util.createClass(e.Image.filters.BaseFilter,{type:"Convolute",initialize:function(t){t=t||{},this.opaque=t.opaque,this.matrix=t.matrix||[0,0,0,0,1,0,0,0,0];var i=e.util.createCanvasElement();this.tmpCtx=i.getContext("2d")},_createImageData:function(t,e){return this.tmpCtx.createImageData(t,e)},applyTo:function(t){for(var e=this.matrix,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=Math.round(Math.sqrt(e.length)),s=Math.floor(r/2),o=n.data,a=n.width,h=n.height,c=a,l=h,u=this._createImageData(c,l),d=u.data,f=this.opaque?1:0,g=0;l>g;g++)for(var p=0;c>p;p++){for(var m=g,v=p,y=4*(g*c+p),b=0,_=0,w=0,T=0,x=0;r>x;x++)for(var S=0;r>S;S++){var C=m+x-s,E=v+S-s;if(!(0>C||C>h||0>E||E>a)){var O=4*(C*a+E),A=e[x*r+S];b+=o[O]*A,_+=o[O+1]*A,w+=o[O+2]*A,T+=o[O+3]*A}}d[y]=b,d[y+1]=_,d[y+2]=w,d[y+3]=T+f*(255-T)}i.putImageData(u,0,0)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=function(t){return new e.Image.filters.Convolute(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.GradientTransparency=e.util.createClass(e.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(t){t=t||{},this.threshold=t.threshold||100},applyTo:function(t){for(var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),n=i.data,r=this.threshold,s=n.length,o=0,a=n.length;a>o;o+=4)n[o+3]=r+255*(s-o)/s;e.putImageData(i,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold})}}),e.Image.filters.GradientTransparency.fromObject=function(t){return new e.Image.filters.GradientTransparency(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Image.filters.Grayscale=e.util.createClass(e.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,s=n.width*n.height*4,o=0;s>o;)e=(r[o]+r[o+1]+r[o+2])/3,r[o]=e,r[o+1]=e,r[o+2]=e,o+=4;i.putImageData(n,0,0)}}),e.Image.filters.Grayscale.fromObject=function(){return new e.Image.filters.Grayscale}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Image.filters.Invert=e.util.createClass(e.Image.filters.BaseFilter,{type:"Invert",applyTo:function(t){var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,s=r.length;for(e=0;s>e;e+=4)r[e]=255-r[e],r[e+1]=255-r[e+1],r[e+2]=255-r[e+2];i.putImageData(n,0,0)}}),e.Image.filters.Invert.fromObject=function(){return new e.Image.filters.Invert}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Mask=e.util.createClass(e.Image.filters.BaseFilter,{type:"Mask",initialize:function(t){t=t||{},this.mask=t.mask,this.channel=[0,1,2,3].indexOf(t.channel)>-1?t.channel:0},applyTo:function(t){if(this.mask){var i,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),s=r.data,o=this.mask.getElement(),a=e.util.createCanvasElement(),h=this.channel,c=r.width*r.height*4;a.width=o.width,a.height=o.height,a.getContext("2d").drawImage(o,0,0,o.width,o.height);var l=a.getContext("2d").getImageData(0,0,o.width,o.height),u=l.data;for(i=0;c>i;i+=4)s[i+3]=u[i+h];n.putImageData(r,0,0)}},toObject:function(){return i(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),e.Image.filters.Mask.fromObject=function(t,i){e.util.loadImage(t.mask.src,function(n){t.mask=new e.Image(n,t.mask),i&&i(new e.Image.filters.Mask(t))})},e.Image.filters.Mask.async=!0}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Noise=e.util.createClass(e.Image.filters.BaseFilter,{type:"Noise",initialize:function(t){t=t||{},this.noise=t.noise||0},applyTo:function(t){for(var e,i=t.getContext("2d"),n=i.getImageData(0,0,t.width,t.height),r=n.data,s=this.noise,o=0,a=r.length;a>o;o+=4)e=(.5-Math.random())*s,r[o]+=e,r[o+1]+=e,r[o+2]+=e;i.putImageData(n,0,0)},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=function(t){return new e.Image.filters.Noise(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Pixelate=e.util.createClass(e.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(t){t=t||{},this.blocksize=t.blocksize||4},applyTo:function(t){var e,i,n,r,s,o,a,h=t.getContext("2d"),c=h.getImageData(0,0,t.width,t.height),l=c.data,u=c.height,d=c.width;for(i=0;u>i;i+=this.blocksize)for(n=0;d>n;n+=this.blocksize){e=4*i*d+4*n,r=l[e],s=l[e+1],o=l[e+2],a=l[e+3];for(var f=i,g=i+this.blocksize;g>f;f++)for(var p=n,m=n+this.blocksize;m>p;p++)e=4*f*d+4*p,l[e]=r,l[e+1]=s,l[e+2]=o,l[e+3]=a}h.putImageData(c,0,0)},toObject:function(){return i(this.callSuper("toObject"),{blocksize:this.blocksize})}}),e.Image.filters.Pixelate.fromObject=function(t){return new e.Image.filters.Pixelate(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.RemoveWhite=e.util.createClass(e.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(t){t=t||{},this.threshold=t.threshold||30,this.distance=t.distance||20},applyTo:function(t){for(var e,i,n,r=t.getContext("2d"),s=r.getImageData(0,0,t.width,t.height),o=s.data,a=this.threshold,h=this.distance,c=255-a,l=Math.abs,u=0,d=o.length;d>u;u+=4)e=o[u],i=o[u+1],n=o[u+2],e>c&&i>c&&n>c&&l(e-i)<h&&l(e-n)<h&&l(i-n)<h&&(o[u+3]=1);r.putImageData(s,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),e.Image.filters.RemoveWhite.fromObject=function(t){return new e.Image.filters.RemoveWhite(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Image.filters.Sepia=e.util.createClass(e.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(t){var e,i,n=t.getContext("2d"),r=n.getImageData(0,0,t.width,t.height),s=r.data,o=s.length;for(e=0;o>e;e+=4)i=.3*s[e]+.59*s[e+1]+.11*s[e+2],s[e]=i+100,s[e+1]=i+50,s[e+2]=i+255;n.putImageData(r,0,0)}}),e.Image.filters.Sepia.fromObject=function(){return new e.Image.filters.Sepia}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={});e.Image.filters.Sepia2=e.util.createClass(e.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(t){var e,i,n,r,s=t.getContext("2d"),o=s.getImageData(0,0,t.width,t.height),a=o.data,h=a.length;for(e=0;h>e;e+=4)i=a[e],n=a[e+1],r=a[e+2],a[e]=(.393*i+.769*n+.189*r)/1.351,a[e+1]=(.349*i+.686*n+.168*r)/1.203,a[e+2]=(.272*i+.534*n+.131*r)/2.14;s.putImageData(o,0,0)}}),e.Image.filters.Sepia2.fromObject=function(){return new e.Image.filters.Sepia2}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Tint=e.util.createClass(e.Image.filters.BaseFilter,{type:"Tint",initialize:function(t){t=t||{},this.color=t.color||"#000000",this.opacity=void 0!==t.opacity?t.opacity:new e.Color(this.color).getAlpha()},applyTo:function(t){var i,n,r,s,o,a,h,c,l,u=t.getContext("2d"),d=u.getImageData(0,0,t.width,t.height),f=d.data,g=f.length;for(l=new e.Color(this.color).getSource(),n=l[0]*this.opacity,r=l[1]*this.opacity,s=l[2]*this.opacity,c=1-this.opacity,i=0;g>i;i+=4)o=f[i],a=f[i+1],h=f[i+2],f[i]=n+o*c,f[i+1]=r+a*c,f[i+2]=s+h*c;u.putImageData(d,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),e.Image.filters.Tint.fromObject=function(t){return new e.Image.filters.Tint(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.Image.filters.Multiply=e.util.createClass(e.Image.filters.BaseFilter,{type:"Multiply",initialize:function(t){t=t||{},this.color=t.color||"#000000"},applyTo:function(t){var i,n,r=t.getContext("2d"),s=r.getImageData(0,0,t.width,t.height),o=s.data,a=o.length;for(n=new e.Color(this.color).getSource(),i=0;a>i;i+=4)o[i]*=n[0]/255,o[i+1]*=n[1]/255,o[i+2]*=n[2]/255;r.putImageData(s,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color})}}),e.Image.filters.Multiply.fromObject=function(t){return new e.Image.filters.Multiply(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric;e.Image.filters.Blend=e.util.createClass({type:"Blend",initialize:function(t){t=t||{},this.color=t.color||"#000",this.image=t.image||!1,this.mode=t.mode||"multiply",this.alpha=t.alpha||1},applyTo:function(t){var i,n,r,s,o,a,h,c,l,u,d=t.getContext("2d"),f=d.getImageData(0,0,t.width,t.height),g=f.data,p=!1;if(this.image){p=!0;var m=e.util.createCanvasElement();m.width=this.image.width,m.height=this.image.height;var v=new e.StaticCanvas(m);v.add(this.image);u=v.getContext("2d").getImageData(0,0,v.width,v.height).data}else u=new e.Color(this.color).getSource(),i=u[0]*this.alpha,n=u[1]*this.alpha,r=u[2]*this.alpha;for(var y=0,b=g.length;b>y;y+=4)switch(s=g[y],o=g[y+1],a=g[y+2],p&&(i=u[y]*this.alpha,n=u[y+1]*this.alpha,r=u[y+2]*this.alpha),this.mode){case"multiply":g[y]=s*i/255,g[y+1]=o*n/255,g[y+2]=a*r/255;break;case"screen":g[y]=1-(1-s)*(1-i),g[y+1]=1-(1-o)*(1-n),g[y+2]=1-(1-a)*(1-r);break;case"add":g[y]=Math.min(255,s+i),g[y+1]=Math.min(255,o+n),g[y+2]=Math.min(255,a+r);break;case"diff":case"difference":g[y]=Math.abs(s-i),g[y+1]=Math.abs(o-n),g[y+2]=Math.abs(a-r);break;case"subtract":h=s-i,c=o-n,l=a-r,g[y]=0>h?0:h,g[y+1]=0>c?0:c,g[y+2]=0>l?0:l;break;case"darken":g[y]=Math.min(s,i),g[y+1]=Math.min(o,n),g[y+2]=Math.min(a,r);break;case"lighten":g[y]=Math.max(s,i),g[y+1]=Math.max(o,n),g[y+2]=Math.max(a,r)}d.putImageData(f,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.Blend.fromObject=function(t){return new e.Image.filters.Blend(t)}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=Math.pow,n=Math.floor,r=Math.sqrt,s=Math.abs,o=Math.max,a=Math.round,h=Math.sin,c=Math.ceil;e.Image.filters.Resize=e.util.createClass(e.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(t,e,i){this.rcpScaleX=1/e,this.rcpScaleY=1/i;var n,r=t.width,s=t.height,o=a(r*e),h=a(s*i);"sliceHack"===this.resizeType&&(n=this.sliceByTwo(t,r,s,o,h)),"hermite"===this.resizeType&&(n=this.hermiteFastResize(t,r,s,o,h)),"bilinear"===this.resizeType&&(n=this.bilinearFiltering(t,r,s,o,h)),"lanczos"===this.resizeType&&(n=this.lanczosResize(t,r,s,o,h)),t.width=o,t.height=h,t.getContext("2d").putImageData(n,0,0)},sliceByTwo:function(t,i,r,s,a){var h,c=t.getContext("2d"),l=.5,u=.5,d=1,f=1,g=!1,p=!1,m=i,v=r,y=e.util.createCanvasElement(),b=y.getContext("2d");for(s=n(s),a=n(a),y.width=o(s,i),y.height=o(a,r),s>i&&(l=2,d=-1),a>r&&(u=2,f=-1),h=c.getImageData(0,0,i,r),t.width=o(s,i),t.height=o(a,r),c.putImageData(h,0,0);!g||!p;)i=m,r=v,s*d<n(m*l*d)?m=n(m*l):(m=s,g=!0),a*f<n(v*u*f)?v=n(v*u):(v=a,p=!0),h=c.getImageData(0,0,i,r),b.putImageData(h,0,0),c.clearRect(0,0,m,v),c.drawImage(y,0,0,i,r,0,0,m,v);return c.getImageData(0,0,s,a)},lanczosResize:function(t,e,o,a,l){function u(t){var h,c,d,f,O,A,P,k,L,I,D;for(C.x=(t+.5)*y,E.x=n(C.x),h=0;l>h;h++){for(C.y=(h+.5)*b,E.y=n(C.y),O=0,A=0,P=0,k=0,L=0,c=E.x-T;c<=E.x+T;c++)if(!(0>c||c>=e)){I=n(1e3*s(c-C.x)),S[I]||(S[I]={});for(var M=E.y-x;M<=E.y+x;M++)0>M||M>=o||(D=n(1e3*s(M-C.y)),S[I][D]||(S[I][D]=v(r(i(I*_,2)+i(D*w,2))/1e3)),(d=S[I][D])>0&&(f=4*(M*e+c),O+=d,A+=d*p[f],P+=d*p[f+1],k+=d*p[f+2],L+=d*p[f+3]))}f=4*(h*a+t),m[f]=A/O,m[f+1]=P/O,m[f+2]=k/O,m[f+3]=L/O}return++t<a?u(t):g}var d=t.getContext("2d"),f=d.getImageData(0,0,e,o),g=d.getImageData(0,0,a,l),p=f.data,m=g.data,v=function(t){return function(e){if(e>t)return 0;if(e*=Math.PI,s(e)<1e-16)return 1;var i=e/t;return h(e)*h(i)/e/i}}(this.lanczosLobes),y=this.rcpScaleX,b=this.rcpScaleY,_=2/this.rcpScaleX,w=2/this.rcpScaleY,T=c(y*this.lanczosLobes/2),x=c(b*this.lanczosLobes/2),S={},C={},E={};return u(0)},bilinearFiltering:function(t,e,i,r,s){var o,a,h,c,l,u,d,f,g,p,m,v,y,b=0,_=this.rcpScaleX,w=this.rcpScaleY,T=t.getContext("2d"),x=4*(e-1),S=T.getImageData(0,0,e,i),C=S.data,E=T.getImageData(0,0,r,s),O=E.data;for(d=0;s>d;d++)for(f=0;r>f;f++)for(l=n(_*f),u=n(w*d),g=_*f-l,p=w*d-u,y=4*(u*e+l),m=0;4>m;m++)o=C[y+m],a=C[y+4+m],h=C[y+x+m],c=C[y+x+4+m],v=o*(1-g)*(1-p)+a*g*(1-p)+h*p*(1-g)+c*g*p,O[b++]=v;return E},hermiteFastResize:function(t,e,i,o,a){for(var h=this.rcpScaleX,l=this.rcpScaleY,u=c(h/2),d=c(l/2),f=t.getContext("2d"),g=f.getImageData(0,0,e,i),p=g.data,m=f.getImageData(0,0,o,a),v=m.data,y=0;a>y;y++)for(var b=0;o>b;b++){for(var _=4*(b+y*o),w=0,T=0,x=0,S=0,C=0,E=0,O=0,A=(y+.5)*l,P=n(y*l);(y+1)*l>P;P++)for(var k=s(A-(P+.5))/d,L=(b+.5)*h,I=k*k,D=n(b*h);(b+1)*h>D;D++){var M=s(L-(D+.5))/u,j=r(I+M*M);j>1&&-1>j||(w=2*j*j*j-3*j*j+1)>0&&(M=4*(D+P*e),O+=w*p[M+3],x+=w,p[M+3]<255&&(w=w*p[M+3]/250),S+=w*p[M],C+=w*p[M+1],E+=w*p[M+2],T+=w)}v[_]=S/T,v[_+1]=C/T,v[_+2]=E/T,v[_+3]=O/x}return m},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaley:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=function(){return new e.Image.filters.Resize}}("undefined"!=typeof exports?exports:this),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.object.clone,r=e.util.toFixed,s=e.StaticCanvas.supports("setLineDash");if(e.Text)return void e.warn("fabric.Text is already defined");var o=e.Object.prototype.stateProperties.concat();o.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:o,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(t,e){e=e||{},this.text=t,this.__skipDimension=!0,this.setOptions(e),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(t){if(!this.__skipDimension){t||(t=e.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this._textLines=this.text.split(this._reNewline),this._clearCache();var i=this.textAlign;this.textAlign="left",this.width=this._getTextWidth(t),this.textAlign=i,this.height=this._getTextHeight(t)}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(t){this.clipTo&&e.util.clipContext(this,t),this._renderTextBackground(t),this._renderText(t),this._renderTextDecoration(t),this.clipTo&&t.restore()},_renderText:function(t){t.save(),this._translateForTextAlign(t),this._setOpacity(t),this._setShadow(t),this._setupCompositeOperation(t),this._renderTextFill(t),this._renderTextStroke(t),this._restoreCompositeOperation(t),this._removeShadow(t),t.restore()},_translateForTextAlign:function(t){"left"!==this.textAlign&&"justify"!==this.textAlign&&t.translate("center"===this.textAlign?this.width/2:this.width,0)},_setTextStyles:function(t){t.textBaseline="alphabetic",this.skipTextAlign||(t.textAlign=this.textAlign),t.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(t){for(var e=this._getLineWidth(t,0),i=1,n=this._textLines.length;n>i;i++){var r=this._getLineWidth(t,i);r>e&&(e=r)}return e},_renderChars:function(t,e,i,n,r){e[t](i,n,r)},_renderTextLine:function(t,e,i,n,r,s){if(r-=this.fontSize*this._fontSizeFraction,"justify"!==this.textAlign)return void this._renderChars(t,e,i,n,r,s);var o=this._getLineWidth(e,s),a=this.width
;if(a>=o)for(var h=i.split(/\s+/),c=this._getWidthOfWords(e,i,s),l=a-c,u=h.length-1,d=l/u,f=0,g=0,p=h.length;p>g;g++)this._renderChars(t,e,h[g],n+f,r,s),f+=e.measureText(h[g]).width+d;else this._renderChars(t,e,i,n,r,s)},_getWidthOfWords:function(t,e){return t.measureText(e.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(t){if(this.fill||this._skipFillStrokeCheck){for(var e=0,i=0,n=this._textLines.length;n>i;i++){var r=this._getHeightOfLine(t,i),s=r/this.lineHeight;this._renderTextLine("fillText",t,this._textLines[i],this._getLeftOffset(),this._getTopOffset()+e+s,i),e+=r}this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t)}},_renderTextStroke:function(t){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var e=0;t.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),s&&t.setLineDash(this.strokeDashArray)),t.beginPath();for(var i=0,n=this._textLines.length;n>i;i++){var r=this._getHeightOfLine(t,i),o=r/this.lineHeight;this._renderTextLine("strokeText",t,this._textLines[i],this._getLeftOffset(),this._getTopOffset()+e+o,i),e+=r}t.closePath(),t.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(t){this._renderTextBoxBackground(t),this._renderTextLinesBackground(t)},_renderTextBoxBackground:function(t){this.backgroundColor&&(t.save(),t.fillStyle=this.backgroundColor,t.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),t.restore())},_renderTextLinesBackground:function(t){var e=0,i=this._getHeightOfLine();if(this.textBackgroundColor){t.save(),t.fillStyle=this.textBackgroundColor;for(var n=0,r=this._textLines.length;r>n;n++){if(""!==this._textLines[n]){var s=this._getLineWidth(t,n),o=this._getLineLeftOffset(s);t.fillRect(this._getLeftOffset()+o,this._getTopOffset()+e,s,this.fontSize*this._fontSizeMult)}e+=i}t.restore()}},_getLineLeftOffset:function(t){return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__lineOffsets=[]},_shouldClearCache:function(){var t=!1;for(var e in this._dimensionAffectingProps)this["__"+e]!==this[e]&&(this["__"+e]=this[e],t=!0);return t},_getLineWidth:function(t,e){return this.__lineWidths[e]?this.__lineWidths[e]:(this.__lineWidths[e]=t.measureText(this._textLines[e]).width,this.__lineWidths[e])},_renderTextDecoration:function(t){if(this.textDecoration){var e=this.height/2,i=this,n=[];this.textDecoration.indexOf("underline")>-1&&n.push(.85),this.textDecoration.indexOf("line-through")>-1&&n.push(.43),this.textDecoration.indexOf("overline")>-1&&n.push(-.12),n.length>0&&function(n){var r,s,o,a,h=0;for(r=0,s=i._textLines.length;s>r;r++){var c=i._getLineWidth(t,r),l=i._getLineLeftOffset(c),u=i._getHeightOfLine(t,r);for(o=0,a=n.length;a>o;o++)t.fillRect(i._getLeftOffset()+l,h+(i._fontSizeMult-1+n[o])*i.fontSize-e,c,i.fontSize/15);h+=u}}(n)}},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(t,e){this.visible&&(t.save(),this._setTextStyles(t),this._shouldClearCache()&&this._initDimensions(t),e||this.transform(t),this._setStrokeStyles(t),this._setFillStyles(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.group&&"path-group"===this.group.type&&t.translate(this.left,this.top),this._render(t),t.restore())},toObject:function(t){var e=i(this.callSuper("toObject",t),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});return this.includeDefaultValues||this._removeDefaultValues(e),e},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this._getSVGLeftTopOffsets(this.ctx),n=this._getSVGTextAndBg(i.textTop,i.textLeft);return this._wrapSVGTextAndBg(e,n),t?t(e.join("")):e.join("")},_getSVGLeftTopOffsets:function(t){var e=this._getHeightOfLine(t,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:e}},_wrapSVGTextAndBg:function(t,e){t.push('\t<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',e.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >',e.textSpans.join(""),"</text>\n","\t</g>\n")},_getSVGTextAndBg:function(t,e){var i=[],n=[],r=0;this._setSVGBg(n);for(var s=0,o=this._textLines.length;o>s;s++)this.textBackgroundColor&&this._setSVGTextLineBg(n,s,e,t,r),this._setSVGTextLineText(s,i,r,e,t,n),r+=this._getHeightOfLine(this.ctx,s);return{textSpans:i,textBgRects:n}},_setSVGTextLineText:function(t,i,n,s,o){var a=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-o+n-this.height/2;i.push('<tspan x="',r(s+this._getLineLeftOffset(this.__lineWidths[t]),4),'" ','y="',r(a,4),'" ',this._getFillAttributes(this.fill),">",e.util.string.escapeXml(this._textLines[t]),"</tspan>")},_setSVGTextLineBg:function(t,e,i,n,s){t.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',r(i+this._getLineLeftOffset(this.__lineWidths[e]),4),'" y="',r(s-this.height/2,4),'" width="',r(this.__lineWidths[e],4),'" height="',r(this._getHeightOfLine(this.ctx,e)/this.lineHeight,4),'"></rect>\n')},_setSVGBg:function(t){this.backgroundColor&&t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',r(-this.width/2,4),'" y="',r(-this.height/2,4),'" width="',r(this.width,4),'" height="',r(this.height,4),'"></rect>\n')},_getFillAttributes:function(t){var i=t&&"string"==typeof t?new e.Color(t):"";return i&&i.getSource()&&1!==i.getAlpha()?'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_set:function(t,e){this.callSuper("_set",t,e),t in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(t,i){if(!t)return null;var n=e.parseAttributes(t,e.Text.ATTRIBUTE_NAMES);i=e.util.object.extend(i?e.util.object.clone(i):{},n),i.top=i.top||0,i.left=i.left||0,"dx"in n&&(i.left+=n.dx),"dy"in n&&(i.top+=n.dy),"fontSize"in i||(i.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE),i.originX||(i.originX="left");var r=t.textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),s=new e.Text(r,i),o=0;return"left"===s.originX&&(o=s.getWidth()/2),"right"===s.originX&&(o=-s.getWidth()/2),s.set({left:s.getLeft()+o,top:s.getTop()-s.getHeight()/2+s.fontSize*(.18+s._fontSizeFraction)}),s},e.Text.fromObject=function(t){return new e.Text(t.text,n(t))},e.util.createAccessors(e.Text)}("undefined"!=typeof exports?exports:this),function(){var t=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!1,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(t,e){this.styles=e?e.styles||{}:{},this.callSuper("initialize",t,e),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__maxFontHeights=[],this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var t=this.styles;for(var e in t)for(var i in t[e])for(var n in t[e][i])return!1;return!0},setSelectionStart:function(t){t=Math.max(t,0),this.selectionStart!==t&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionStart=t),this._updateTextarea()},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this.selectionEnd!==t&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionEnd=t),this._updateTextarea()},getSelectionStyles:function(t,e){if(2===arguments.length){for(var i=[],n=t;e>n;n++)i.push(this.getSelectionStyles(n));return i}var r=this.get2DCursorLocation(t);return this.styles[r.lineIndex]?this.styles[r.lineIndex][r.charIndex]||{}:{}},setSelectionStyles:function(t){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,t);else for(var e=this.selectionStart;e<this.selectionEnd;e++)this._extendStyles(e,t);return this._clearCache(),this},_extendStyles:function(t,e){var i=this.get2DCursorLocation(t);this.styles[i.lineIndex]||(this.styles[i.lineIndex]={}),this.styles[i.lineIndex][i.charIndex]||(this.styles[i.lineIndex][i.charIndex]={}),fabric.util.object.extend(this.styles[i.lineIndex][i.charIndex],e)},_render:function(t){this.callSuper("_render",t),this.ctx=t,this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var t,e,i=this.text.split("");this.canvas.contextTop?(e=this.canvas.contextTop,e.save(),e.transform.apply(e,this.canvas.viewportTransform),this.transform(e)):(e=this.ctx,e.save()),this.selectionStart===this.selectionEnd?(t=this._getCursorBoundaries(i,"cursor"),this.renderCursor(t,e)):(t=this._getCursorBoundaries(i,"selection"),this.renderSelection(i,t,e)),e.restore()}},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);var e=this.text.slice(0,t),i=e.split(this._reNewline);return{lineIndex:i.length-1,charIndex:i[i.length-1].length}},getCurrentCharStyle:function(t,e){var i=this.styles[t]&&this.styles[t][0===e?0:e-1];return{fontSize:i&&i.fontSize||this.fontSize,fill:i&&i.fill||this.fill,textBackgroundColor:i&&i.textBackgroundColor||this.textBackgroundColor,textDecoration:i&&i.textDecoration||this.textDecoration,fontFamily:i&&i.fontFamily||this.fontFamily,fontWeight:i&&i.fontWeight||this.fontWeight,fontStyle:i&&i.fontStyle||this.fontStyle,stroke:i&&i.stroke||this.stroke,strokeWidth:i&&i.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(t,e){return this.styles[t]&&this.styles[t][0===e?0:e-1]&&this.styles[t][0===e?0:e-1].fontSize||this.fontSize},getCurrentCharColor:function(t,e){return this.styles[t]&&this.styles[t][0===e?0:e-1]&&this.styles[t][0===e?0:e-1].fill||this.cursorColor},_getCursorBoundaries:function(t,e){var i=Math.round(this._getLeftOffset()),n=this._getTopOffset(),r=this._getCursorBoundariesOffsets(t,e);return{left:i,top:n,leftOffset:r.left+r.lineLeft,topOffset:r.top}},_getCursorBoundariesOffsets:function(t,e){for(var i=0,n=0,r=0,s=0,o=0,a=0;a<this.selectionStart;a++)"\n"===t[a]?(o=0,s+=this._getHeightOfLine(this.ctx,n),n++,r=0):(o+=this._getWidthOfChar(this.ctx,t[a],n,r),r++),i=this._getCachedLineOffset(n);return"cursor"===e&&(s+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,n)/this.lineHeight-this.getCurrentCharFontSize(n,r)*(1-this._fontSizeFraction)),{top:s,left:o,lineLeft:i}},_getCachedLineOffset:function(t){var e=this._getLineWidth(this.ctx,t);return this.__lineOffsets[t]||(this.__lineOffsets[t]=this._getLineLeftOffset(e))},renderCursor:function(t,e){var i=this.get2DCursorLocation(),n=i.lineIndex,r=i.charIndex,s=this.getCurrentCharFontSize(n,r),o=0===n&&0===r?this._getCachedLineOffset(n):t.leftOffset;e.fillStyle=this.getCurrentCharColor(n,r),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+o,t.top+t.topOffset,this.cursorWidth/this.scaleX,s)},renderSelection:function(t,e,i){i.fillStyle=this.selectionColor;for(var n=this.get2DCursorLocation(this.selectionStart),r=this.get2DCursorLocation(this.selectionEnd),s=n.lineIndex,o=r.lineIndex,a=s;o>=a;a++){var h=this._getCachedLineOffset(a)||0,c=this._getHeightOfLine(this.ctx,a),l=0,u=this._textLines[a];if(a===s)for(var d=0,f=u.length;f>d;d++)d>=n.charIndex&&(a!==o||d<r.charIndex)&&(l+=this._getWidthOfChar(i,u[d],a,d)),d<n.charIndex&&(h+=this._getWidthOfChar(i,u[d],a,d));else if(a>s&&o>a)l+=this._getLineWidth(i,a)||5;else if(a===o)for(var g=0,p=r.charIndex;p>g;g++)l+=this._getWidthOfChar(i,u[g],a,g);i.fillRect(e.left+h,e.top+e.topOffset,l,c),e.topOffset+=c}},_renderChars:function(t,e,i,n,r,s){if(this.isEmptyStyles())return this._renderCharsFast(t,e,i,n,r);this.skipTextAlign=!0,n-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var o,a=this._getHeightOfLine(e,s),h=this._getCachedLineOffset(s),c=i.split(""),l="";n+=h||0,e.save(),r-=a/this.lineHeight*this._fontSizeFraction;for(var u=0,d=c.length;d>=u;u++){o=o||this.getCurrentCharStyle(s,u);var f=this.getCurrentCharStyle(s,u+1);(this._hasStyleChanged(o,f)||u===d)&&(this._renderChar(t,e,s,u-1,l,n,r,a),l="",o=f),l+=c[u]}e.restore()},_renderCharsFast:function(t,e,i,n,r){this.skipTextAlign=!1,"fillText"===t&&this.fill&&this.callSuper("_renderChars",t,e,i,n,r),"strokeText"===t&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",t,e,i,n,r)},_renderChar:function(t,e,i,n,r,s,o,a){var h,c,l,u=this._fontSizeFraction*a/this.lineHeight;if(this.styles&&this.styles[i]&&(h=this.styles[i][n])){var d=h.stroke||this.stroke,f=h.fill||this.fill;e.save(),c=this._applyCharStylesGetWidth(e,r,i,n,h),l=this._getHeightOfChar(e,r,i,n),f&&e.fillText(r,s,o),d&&e.strokeText(r,s,o),this._renderCharDecoration(e,h,s,o,u,c,l),e.restore(),e.translate(c,0)}else"strokeText"===t&&this.stroke&&e[t](r,s,o),"fillText"===t&&this.fill&&e[t](r,s,o),c=this._applyCharStylesGetWidth(e,r,i,n),this._renderCharDecoration(e,null,s,o,u,c,this.fontSize),e.translate(e.measureText(r).width,0)},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.fontSize!==e.fontSize||t.textBackgroundColor!==e.textBackgroundColor||t.textDecoration!==e.textDecoration||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth},_renderCharDecoration:function(t,e,i,n,r,s,o){var a=e?e.textDecoration||this.textDecoration:this.textDecoration;a&&(a.indexOf("underline")>-1&&t.fillRect(i,n+o/10,s,o/15),a.indexOf("line-through")>-1&&t.fillRect(i,n-o*(this._fontSizeFraction+this._fontSizeMult-1)+o/15,s,o/15),a.indexOf("overline")>-1&&t.fillRect(i,n-(this._fontSizeMult-this._fontSizeFraction)*o,s,o/15))},_renderTextLine:function(t,e,i,n,r,s){this.isEmptyStyles()||(r+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",t,e,i,n,r,s)},_renderTextDecoration:function(t){return this.isEmptyStyles()?this.callSuper("_renderTextDecoration",t):void 0},_renderTextLinesBackground:function(t){if(this.textBackgroundColor||this.styles){t.save(),this.textBackgroundColor&&(t.fillStyle=this.textBackgroundColor);for(var e=0,i=0,n=this._textLines.length;n>i;i++){var r=this._getHeightOfLine(t,i);if(""!==this._textLines[i]){var s=this._getLineWidth(t,i),o=this._getCachedLineOffset(i);if(this.textBackgroundColor&&(t.fillStyle=this.textBackgroundColor,t.fillRect(this._getLeftOffset()+o,this._getTopOffset()+e,s,r/this.lineHeight)),this.styles[i])for(var a=0,h=this._textLines[i].length;h>a;a++)if(this.styles[i]&&this.styles[i][a]&&this.styles[i][a].textBackgroundColor){var c=this._textLines[i][a];t.fillStyle=this.styles[i][a].textBackgroundColor,t.fillRect(this._getLeftOffset()+o+this._getWidthOfCharsAt(t,i,a),this._getTopOffset()+e,this._getWidthOfChar(t,c,i,a)+1,r/this.lineHeight)}e+=r}else e+=r}t.restore()}},_getCacheProp:function(t,e){return t+e.fontFamily+e.fontSize+e.fontWeight+e.fontStyle+e.shadow},_applyCharStylesGetWidth:function(e,i,n,r,s){var o=s||this.styles[n]&&this.styles[n][r];o=o?t(o):{},this._applyFontStyles(o);var a=this._getCacheProp(i,o);if(this.isEmptyStyles()&&this._charWidthsCache[a]&&this.caching)return this._charWidthsCache[a];"string"==typeof o.shadow&&(o.shadow=new fabric.Shadow(o.shadow));var h=o.fill||this.fill;return e.fillStyle=h.toLive?h.toLive(e,this):h,o.stroke&&(e.strokeStyle=o.stroke&&o.stroke.toLive?o.stroke.toLive(e,this):o.stroke),e.lineWidth=o.strokeWidth||this.strokeWidth,e.font=this._getFontDeclaration.call(o),this._setShadow.call(o,e),this.caching?(this._charWidthsCache[a]||(this._charWidthsCache[a]=e.measureText(i).width),this._charWidthsCache[a]):e.measureText(i).width},_applyFontStyles:function(t){t.fontFamily||(t.fontFamily=this.fontFamily),t.fontSize||(t.fontSize=this.fontSize),t.fontWeight||(t.fontWeight=this.fontWeight),t.fontStyle||(t.fontStyle=this.fontStyle)},_getStyleDeclaration:function(e,i){return this.styles[e]&&this.styles[e][i]?t(this.styles[e][i]):{}},_getWidthOfChar:function(t,e,i,n){if("justify"===this.textAlign&&/\s/.test(e))return this._getWidthOfSpace(t,i);var r=this._getStyleDeclaration(i,n);this._applyFontStyles(r);var s=this._getCacheProp(e,r);if(this._charWidthsCache[s]&&this.caching)return this._charWidthsCache[s];if(t){t.save();var o=this._applyCharStylesGetWidth(t,e,i,n);return t.restore(),o}},_getHeightOfChar:function(t,e,i,n){return this.styles[i]&&this.styles[i][n]?this.styles[i][n].fontSize||this.fontSize:this.fontSize},_getHeightOfCharAt:function(t,e,i){var n=this._textLines[e][i];return this._getHeightOfChar(t,n,e,i)},_getWidthOfCharsAt:function(t,e,i){var n,r,s=0;for(n=0;i>n;n++)r=this._textLines[e][n],s+=this._getWidthOfChar(t,r,e,n);return s},_getLineWidth:function(t,e){return this.__lineWidths[e]?this.__lineWidths[e]:(this.__lineWidths[e]=this._getWidthOfCharsAt(t,e,this._textLines[e].length),this.__lineWidths[e])},_getWidthOfSpace:function(t,e){if(this.__widthOfSpace[e])return this.__widthOfSpace[e];var i=this._textLines[e],n=this._getWidthOfWords(t,i,e),r=this.width-n,s=i.length-i.replace(/\s+/g,"").length,o=r/s;return this.__widthOfSpace[e]=o,o},_getWidthOfWords:function(t,e,i){for(var n=0,r=0;r<e.length;r++){var s=e[r];s.match(/\s/)||(n+=this._getWidthOfChar(t,s,i,r))}return n},_getHeightOfLine:function(t,e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var i=this._textLines[e],n=this._getHeightOfChar(t,i[0],e,0),r=1,s=i.length;s>r;r++){var o=this._getHeightOfChar(t,i[r],e,r);o>n&&(n=o)}return this.__maxFontHeights[e]=n,this.__lineHeights[e]=n*this.lineHeight*this._fontSizeMult,this.__lineHeights[e]},_getTextHeight:function(t){for(var e=0,i=0,n=this._textLines.length;n>i;i++)e+=this._getHeightOfLine(t,i);return e},_renderTextBoxBackground:function(t){this.backgroundColor&&(t.save(),t.fillStyle=this.backgroundColor,t.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),t.restore())},toObject:function(e){return fabric.util.object.extend(this.callSuper("toObject",e),{styles:t(this.styles)})}}),fabric.IText.fromObject=function(e){return new fabric.IText(e.text,t(e))}}(),function(){var t=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var t=this;setTimeout(function(){t.selected=!0},100)})},initAddedHandler:function(){var t=this;this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers()),t.canvas&&(t.canvas._iTextInstances=t.canvas._iTextInstances||[],t.canvas._iTextInstances.push(t))})},initRemovedHandler:function(){var t=this;this.on("removed",function(){t.canvas&&(t.canvas._iTextInstances=t.canvas._iTextInstances||[],fabric.util.removeFromArray(t.canvas._iTextInstances,t))})},_initCanvasHandlers:function(){var t=this;this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers(t.canvas)}),this.canvas.on("mouse:up",function(){t.canvas._iTextInstances&&t.canvas._iTextInstances.forEach(function(t){t.__isMousedown=!1})}),this.canvas.on("object:selected",function(){fabric.IText.prototype.exitEditingOnOthers(t.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,e,i,n){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},t.animate("_currentCursorOpacity",e,{duration:i,onComplete:function(){r.isAborted||t[n]()},onChange:function(){t.canvas&&(t.canvas.clearContext(t.canvas.contextTop||t.ctx),t.renderCursorOrSelection())},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var e=this,i=t?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&(this.canvas.clearContext(this.canvas.contextTop||this.ctx),this.renderCursorOrSelection()),this._cursorTimeout2&&clearTimeout(this._cursorTimeout2),this._cursorTimeout2=setTimeout(function(){e._tick()},i)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0),this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(t){var e=0,i=t-1;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i--;for(;/\S/.test(this.text.charAt(i))&&i>-1;)e++,i--;return t-e},findWordBoundaryRight:function(t){var e=0,i=t;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i++;for(;/\S/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,i=t-1;!/\n/.test(this.text.charAt(i))&&i>-1;)e++,i--;return t-e},findLineBoundaryRight:function(t){for(var e=0,i=t;!/\n/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},getNumNewLinesInSelectedText:function(){for(var t=this.getSelectedText(),e=0,i=0,n=t.split(""),r=n.length;r>i;i++)"\n"===n[i]&&e++;return e},searchWordBoundary:function(t,e){for(var i=this._reSpace.test(this.text.charAt(t))?t-1:t,n=this.text.charAt(i),r=/[ \n\.,;!\?\-]/;!r.test(n)&&i>0&&i<this.text.length;)i+=e,n=this.text.charAt(i);return r.test(n)&&"\n"!==n&&(i+=1===e?0:1),i},selectWord:function(t){var e=this.searchWordBoundary(t,-1),i=this.searchWordBoundary(t,1);this.setSelectionStart(e),this.setSelectionEnd(i)},selectLine:function(t){var e=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);this.setSelectionStart(e),this.setSelectionEnd(i)},enterEditing:function(){return!this.isEditing&&this.editable?(this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.renderAll(),this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this):this):void 0},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.selected=!1,t.isEditing&&t.exitEditing()})},initMouseMoveHandler:function(){var t=this;this.canvas.on("mouse:move",function(e){if(t.__isMousedown&&t.isEditing){var i=t.getSelectionStartFromPointer(e.e);i>=t.__selectionStartOnMouseDown?(t.setSelectionStart(t.__selectionStartOnMouseDown),t.setSelectionEnd(i)):(t.setSelectionStart(i),t.setSelectionEnd(t.__selectionStartOnMouseDown))}})},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},_removeCharsFromTo:function(t,e){for(var i=e;i!==t;){var n=this.get2DCursorLocation(i).charIndex;i--;var r=this.get2DCursorLocation(i).charIndex,s=r>n;s?this.removeStyleObject(s,i+1):this.removeStyleObject(0===this.get2DCursorLocation(i).charIndex,i)}this.text=this.text.slice(0,t)+this.text.slice(e),this._clearCache()},insertChars:function(t,e){var i="\n"===this.text.slice(this.selectionStart,this.selectionStart+1);this.text=this.text.slice(0,this.selectionStart)+t+this.text.slice(this.selectionEnd),this.selectionStart===this.selectionEnd&&this.insertStyleObjects(t,i,e),this.setSelectionStart(this.selectionStart+t.length),this.setSelectionEnd(this.selectionStart),this._clearCache(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(e,i,n){this.shiftLineStyles(e,1),this.styles[e+1]||(this.styles[e+1]={});var r=this.styles[e][i-1],s={};if(n)s[0]=t(r),this.styles[e+1]=s;else{for(var o in this.styles[e])parseInt(o,10)>=i&&(s[parseInt(o,10)-i]=this.styles[e][o],delete this.styles[e][o]);this.styles[e+1]=s}this._clearCache()},insertCharStyleObject:function(e,i,n){var r=this.styles[e],s=t(r);0!==i||n||(i=1);for(var o in s){var a=parseInt(o,10);a>=i&&(r[a+1]=s[a])}this.styles[e][i]=n||t(r[i-1]),this._clearCache()},insertStyleObjects:function(t,e,i){var n=this.get2DCursorLocation(),r=n.lineIndex,s=n.charIndex;this.styles[r]||(this.styles[r]={}),"\n"===t?this.insertNewlineStyleObject(r,s,e):i?this._insertStyles(this.copiedStyles):this.insertCharStyleObject(r,s)},_insertStyles:function(t){for(var e=0,i=t.length;i>e;e++){var n=this.get2DCursorLocation(this.selectionStart+e),r=n.lineIndex,s=n.charIndex;this.insertCharStyleObject(r,s,t[e])}},shiftLineStyles:function(e,i){var n=t(this.styles);for(var r in this.styles){var s=parseInt(r,10);s>e&&(this.styles[s+i]=n[s])}},removeStyleObject:function(e,i){var n=this.get2DCursorLocation(i),r=n.lineIndex,s=n.charIndex;if(e){var o=this._textLines[r-1],a=o?o.length:0;this.styles[r-1]||(this.styles[r-1]={});for(s in this.styles[r])this.styles[r-1][parseInt(s,10)+a]=this.styles[r][s];this.shiftLineStyles(r,-1)}else{var h=this.styles[r];if(h){delete h[s+(this.selectionStart===this.selectionEnd?-1:0)]}var c=t(h);for(var l in c){var u=parseInt(l,10);u>=s&&0!==u&&(h[u-1]=c[u],delete h[u])}}},insertNewline:function(){this.insertChars("\n")}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(t){this.__newClickTime=+new Date;var e=this.canvas.getPointer(t.e);this.isTripleClick(e)?(this.fire("tripleclick",t),this._stopEvent(t.e)):this.isDoubleClick(e)&&(this.fire("dblclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y&&this.__lastIsEditing},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(t){this.selectWord(this.getSelectionStartFromPointer(t.e))}),this.on("tripleclick",function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))})},initMousedownHandler:function(){this.on("mousedown",function(t){var e=this.canvas.getPointer(t.e);this.__mousedownX=e.x,this.__mousedownY=e.y,this.__isMousedown=!0,this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea),this.selected&&this.setCursorByClick(t.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},_isObjectMoved:function(t){var e=this.canvas.getPointer(t);return this.__mousedownX!==e.x||this.__mousedownY!==e.y},initMouseupHandler:function(){this.on("mouseup",function(t){this.__isMousedown=!1,this._isObjectMoved(t.e)||(this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t);t.shiftKey?e<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(e)):this.setSelectionEnd(e):(this.setSelectionStart(e),this.setSelectionEnd(e))},_getLocalRotatedPointer:function(t){var e=this.canvas.getPointer(t),i=new fabric.Point(e.x,e.y),n=new fabric.Point(this.left,this.top),r=fabric.util.rotatePoint(i,n,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(t,r)},getSelectionStartFromPointer:function(t){for(var e,i=this._getLocalRotatedPointer(t),n=0,r=0,s=0,o=0,a=0,h=this._textLines.length;h>a;a++){e=this._textLines[a].split(""),s+=this._getHeightOfLine(this.ctx,a)*this.scaleY;var c=this._getLineWidth(this.ctx,a);r=this._getLineLeftOffset(c)*this.scaleX,this.flipX&&(this._textLines[a]=e.reverse().join(""));for(var l=0,u=e.length;u>l;l++){var d=e[l];if(n=r,r+=this._getWidthOfChar(this.ctx,d,a,this.flipX?u-l:l)*this.scaleX,!(s<=i.y||r<=i.x))return this._getNewSelectionStartFromOffset(i,n,r,o+a,u);o++}if(i.y<s)return this._getNewSelectionStartFromOffset(i,n,r,o+a,u)}return this.text.length},_getNewSelectionStartFromOffset:function(t,e,i,n,r){var s=t.x-e,o=i-t.x,a=o>s?0:1,h=n+a;return this.flipX&&(h=r-h),h>this.text.length&&(h=this.text.length),h}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){
this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing){if(t.keyCode in this._keysMap)this[this._keysMap[t.keyCode]](t);else{if(!(t.keyCode in this._ctrlKeysMap&&(t.ctrlKey||t.metaKey)))return;this[this._ctrlKeysMap[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.renderAll()}},forwardDelete:function(t){this.selectionStart===this.selectionEnd&&this.moveCursorRight(t),this.removeChars(t)},copy:function(t){var e=this.getSelectedText(),i=this._getClipboardData(t);i&&i.setData("text",e),this.copiedText=e,this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(t){var e=null,i=this._getClipboardData(t);(e=i?i.getData("text"):this.copiedText)&&this.insertChars(e,!0)},cut:function(t){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(t))},_getClipboardData:function(t){return t&&(t.clipboardData||fabric.window.clipboardData)},onKeyPress:function(t){!this.isEditing||t.metaKey||t.ctrlKey||(0!==t.which&&this.insertChars(String.fromCharCode(t.which)),t.stopPropagation())},getDownCursorOffset:function(t,e){var i,n,r=e?this.selectionEnd:this.selectionStart,s=this.text.slice(0,r),o=this.text.slice(r),a=s.slice(s.lastIndexOf("\n")+1),h=o.match(/(.*)\n?/)[1],c=(o.match(/.*\n(.*)\n?/)||{})[1]||"",l=this.get2DCursorLocation(r);if(l.lineIndex===this._textLines.length-1||t.metaKey||34===t.keyCode)return this.text.length-r;var u=this._getLineWidth(this.ctx,l.lineIndex);n=this._getLineLeftOffset(u);for(var d=n,f=l.lineIndex,g=0,p=a.length;p>g;g++)i=a[g],d+=this._getWidthOfChar(this.ctx,i,f,g);var m=this._getIndexOnNextLine(l,c,d);return h.length+1+m},_getIndexOnNextLine:function(t,e,i){for(var n,r=t.lineIndex+1,s=this._getLineWidth(this.ctx,r),o=this._getLineLeftOffset(s),a=o,h=0,c=0,l=e.length;l>c;c++){var u=e[c],d=this._getWidthOfChar(this.ctx,u,r,c);if((a+=d)>i){n=!0;var f=a-d,g=a;h=Math.abs(f-i)>Math.abs(g-i)?c+1:c;break}}return n||(h=e.length),h},moveCursorDown:function(t){this.abortCursorAnimation(),this._currentCursorOpacity=1;var e=this.getDownCursorOffset(t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorDownWithShift(e):this.moveCursorDownWithoutShift(e),this.initDelayedCursor()},moveCursorDownWithoutShift:function(t){this._selectionDirection="right",this.setSelectionStart(this.selectionStart+t),this.setSelectionEnd(this.selectionStart)},swapSelectionPoints:function(){var t=this.selectionEnd;this.setSelectionEnd(this.selectionStart),this.setSelectionStart(t)},moveCursorDownWithShift:function(t){this.selectionEnd===this.selectionStart&&(this._selectionDirection="right"),"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd+t):this.setSelectionStart(this.selectionStart+t),this.selectionEnd<this.selectionStart&&"left"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="right"),this.selectionEnd>this.text.length&&this.setSelectionEnd(this.text.length)},getUpCursorOffset:function(t,e){var i=e?this.selectionEnd:this.selectionStart,n=this.get2DCursorLocation(i);if(0===n.lineIndex||t.metaKey||33===t.keyCode)return i;for(var r,s=this.text.slice(0,i),o=s.slice(s.lastIndexOf("\n")+1),a=(s.match(/\n?(.*)\n.*$/)||{})[1]||"",h=this._getLineWidth(this.ctx,n.lineIndex),c=this._getLineLeftOffset(h),l=c,u=n.lineIndex,d=0,f=o.length;f>d;d++)r=o[d],l+=this._getWidthOfChar(this.ctx,r,u,d);return a.length-this._getIndexOnPrevLine(n,a,l)+o.length},_getIndexOnPrevLine:function(t,e,i){for(var n,r=t.lineIndex-1,s=this._getLineWidth(this.ctx,r),o=this._getLineLeftOffset(s),a=o,h=0,c=0,l=e.length;l>c;c++){var u=e[c],d=this._getWidthOfChar(this.ctx,u,r,c);if((a+=d)>i){n=!0;var f=a-d,g=a;h=Math.abs(f-i)>Math.abs(g-i)?c:c-1;break}}return n||(h=e.length-1),h},moveCursorUp:function(t){this.abortCursorAnimation(),this._currentCursorOpacity=1;var e=this.getUpCursorOffset(t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorUpWithShift(e):this.moveCursorUpWithoutShift(e),this.initDelayedCursor()},moveCursorUpWithShift:function(t){this.selectionEnd===this.selectionStart&&(this._selectionDirection="left"),"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd-t):this.setSelectionStart(this.selectionStart-t),this.selectionEnd<this.selectionStart&&"right"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="left")},moveCursorUpWithoutShift:function(t){this.selectionStart===this.selectionEnd&&this.setSelectionStart(this.selectionStart-t),this.setSelectionEnd(this.selectionStart),this._selectionDirection="left"},moveCursorLeft:function(t){(0!==this.selectionStart||0!==this.selectionEnd)&&(this.abortCursorAnimation(),this._currentCursorOpacity=1,t.shiftKey?this.moveCursorLeftWithShift(t):this.moveCursorLeftWithoutShift(t),this.initDelayedCursor())},_move:function(t,e,i){this["selectionStart"===e?"setSelectionStart":"setSelectionEnd"](t.altKey?this["findWordBoundary"+i](this[e]):t.metaKey||35===t.keyCode||36===t.keyCode?this["findLineBoundary"+i](this[e]):this[e]+("Left"===i?-1:1))},_moveLeft:function(t,e){this._move(t,e,"Left")},_moveRight:function(t,e){this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this._moveLeft(t,"selectionStart"),this.setSelectionEnd(this.selectionStart)},moveCursorLeftWithShift:function(t){"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(t,"selectionStart"),"\n"===this.text.charAt(this.selectionStart)&&this.setSelectionStart(this.selectionStart-1))},moveCursorRight:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,t.shiftKey?this.moveCursorRightWithShift(t):this.moveCursorRightWithoutShift(t),this.initDelayedCursor())},moveCursorRightWithShift:function(t){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):(this._selectionDirection="right",this._moveRight(t,"selectionEnd"),"\n"===this.text.charAt(this.selectionEnd-1)&&this.setSelectionEnd(this.selectionEnd+1))},moveCursorRightWithoutShift:function(t){this._selectionDirection="right",this.selectionStart===this.selectionEnd?(this._moveRight(t,"selectionStart"),this.setSelectionEnd(this.selectionStart)):(this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText()),this.setSelectionStart(this.selectionEnd))},removeChars:function(t){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(t):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this._clearCache(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(t){if(0!==this.selectionStart)if(t.metaKey){var e=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)}else if(t.altKey){var i=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(i,this.selectionStart),this.setSelectionStart(i)}else{var n="\n"===this.text.slice(this.selectionStart-1,this.selectionStart);this.removeStyleObject(n),this.setSelectionStart(this.selectionStart-1),this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)}}}),fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(t,e,i,n,r,s){this.styles[t]?this._setSVGTextLineChars(t,e,i,n,s):this.callSuper("_setSVGTextLineText",t,e,i,n,r)},_setSVGTextLineChars:function(t,e,i,n,r){for(var s=this._textLines[t].split(""),o=0,a=this._getSVGLineLeftOffset(t)-this.width/2,h=this._getSVGLineTopOffset(t),c=this._getHeightOfLine(this.ctx,t),l=0,u=s.length;u>l;l++){var d=this.styles[t][l]||{};e.push(this._createTextCharSpan(s[l],d,a,h.lineTop+h.offset,o));var f=this._getWidthOfChar(this.ctx,s[l],t,l);d.textBackgroundColor&&r.push(this._createTextCharBg(d,a,h.lineTop,c,f,o)),o+=f}},_getSVGLineLeftOffset:function(t){return fabric.util.toFixed(this._getLineLeftOffset(this.__lineWidths[t]),2)},_getSVGLineTopOffset:function(t){for(var e=0,i=0,n=0;t>n;n++)e+=this._getHeightOfLine(this.ctx,n);return i=this._getHeightOfLine(this.ctx,n),{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*i/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(t,e,i,n,r,s){return['<rect fill="',t.textBackgroundColor,'" x="',e+s,'" y="',i-this.height/2,'" width="',r,'" height="',n/this.lineHeight,'"></rect>'].join("")},_createTextCharSpan:function(t,e,i,n,r){var s=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},e));return['<tspan x="',i+r,'" y="',n-this.height/2,'" ',e.fontFamily?'font-family="'+e.fontFamily.replace(/"/g,"'")+'" ':"",e.fontSize?'font-size="'+e.fontSize+'" ':"",e.fontStyle?'font-style="'+e.fontStyle+'" ':"",e.fontWeight?'font-weight="'+e.fontWeight+'" ':"",e.textDecoration?'text-decoration="'+e.textDecoration+'" ':"",'style="',s,'">',fabric.util.string.escapeXml(t),"</tspan>"].join("")}}),function(){function request(t,e,i){var n=URL.parse(t);n.port||(n.port=0===n.protocol.indexOf("https:")?443:80);var r=0===n.protocol.indexOf("https:")?HTTPS:HTTP,s=r.request({hostname:n.hostname,port:n.port,path:n.path,method:"GET"},function(t){var n="";e&&t.setEncoding(e),t.on("end",function(){i(n)}),t.on("data",function(e){200===t.statusCode&&(n+=e)})});s.on("error",function(t){fabric.log(t.errno===process.ECONNREFUSED?"ECONNREFUSED: connection refused to "+n.hostname+":"+n.port:t.message)}),s.end()}function requestFs(t,e){require("fs").readFile(t,function(t,i){if(t)throw fabric.log(t),t;e(i)})}if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(t,e,i){function n(n){r.src=new Buffer(n,"binary"),r._src=t,e&&e.call(i,r)}var r=new Image;t&&(t instanceof Buffer||0===t.indexOf("data"))?(r.src=r._src=t,e&&e.call(i,r)):t&&0!==t.indexOf("http")?requestFs(t,n):t?request(t,"binary",n):e&&e.call(i,t)},fabric.loadSVGFromURL=function(t,e,i){t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),0!==t.indexOf("http")?requestFs(t,function(t){fabric.loadSVGFromString(t.toString(),e,i)}):request(t,"",function(t){fabric.loadSVGFromString(t,e,i)})},fabric.loadSVGFromString=function(t,e,i){var n=(new DOMParser).parseFromString(t);fabric.parseSVGDocument(n.documentElement,function(t,i){e&&e(t,i)},i)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(t,e){fabric.util.loadImage(t.src,function(i){var n=new fabric.Image(i);n._initConfig(t),n._initFilters(t,function(t){n.filters=t||[],e&&e(n)})})},fabric.createCanvasForNode=function(t,e,i,n){n=n||i;var r=fabric.document.createElement("canvas"),s=new Canvas(t||600,e||600,n);r.style={},r.width=s.width,r.height=s.height;var o=fabric.Canvas||fabric.StaticCanvas,a=new o(r,i);return a.contextContainer=s.getContext("2d"),a.nodeCanvas=s,a.Font=Canvas.Font,a},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(t){return this.nodeCanvas.createJPEGStream(t)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(t,e){return origSetWidth.call(this,t,e),this.nodeCanvas.width=t,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(t,e){return origSetHeight.call(this,t,e),this.nodeCanvas.height=t,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}(),window.fabric=fabric,"function"==typeof define&&define.amd&&define("fabric",[],function(){return fabric}),define("model/ugc/pageHighlight",[],function(){return{CURRENT_OBJECT_DATA_VERSION:3,PageHighlight:function(t,e,i,n,r){this.pageNumber=t,this.svgData=e,this.objectDataVersion=i,this.lastModified=n||(new Date).getTime(),this.lastSynced=r||0,this.id=function(){return this.pageNumber},this.isSynced=function(){return this.lastModified<=this.lastSynced},this.getSvgData=function(){return this.svgData},this.setSvgData=function(t){this.svgData=t,this.touch()},this.deleteHighlight=function(){this.svgData=null,this.touch()},this.touch=function(){this.lastModified=(new Date).getTime()},this.getWriteableObject=function(){return{pageNumber:this.pageNumber,svgData:this.svgData,objectDataVersion:this.objectDataVersion,lastModified:this.lastModified,lastSynced:this.lastSynced}}}}}),define("ui/highlightingCanvas",["api","events","config","constants","resources","model/ugc/pageHighlight","shared/ui/messageBox","ui/uiTools","utils/tools","utils/statistics","fabric","jquery"],function(t,e,i,n,r,s,o,a,h,c,l,u){var d,f,g,p,m,v,y=!1,b=!1,_=!1,w=!1,T=[],x=[],S={},C=u("#yudu_highlightingCanvasContainer"),E={},O=function(t){L(t),R(),e.subscribe(e.ALL,e.PAGE_CHANGED,M),e.subscribe(e.ALL,e.TWO_UP_CHANGED,j),e.subscribe(e.ALL,e.LOGIN_SUCCESS,R)},A=function(t,e){e.reset&&P(),e.merge?k(t):L(t),R(),e.reset||H(!0)},P=function(){S={};for(var t=0,e=g.shifter.getNumberOfPages();t<e;t+=1)E[t]=!0},k=function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=JSON.parse(t[e]);if(S[e]){if(i.svgData){var n=S[e],r=u("<div></div>");r[0].innerHTML=n.getSvgData();var s=r.children("svg").children("path").last(),o=u("<div></div>");o[0].innerHTML=i.svgData,s.after(o.children("svg").children("path")),n.setSvgData(r[0].innerHTML),E[e]=!0}}else S[e]=I(i),E[e]=!0}},L=function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=JSON.parse(t[e]);if(S[e]&&S[e].lastModified>i.lastModified)continue;S[e]=I(i),E[e]=!0}},I=function(t){var e=t.svgData;return e||(e=null),new s.PageHighlight(t.pageNumber,e,t.objectDataVersion,t.lastModified,t.lastSynced)},D=function(t){u("#yudu_pageHighlightsContainer .yudu_pageHighlights").hide()},M=function(t){y?(B(),D(),R(t),F()):(D(),R(t))},j=function(t){y?(B(),R(t),F()):R(t)},R=function(t){if(m=g.shifter.getCentreTray().pages[0],v=g.shifter.getCentreTray().pages[1],!m.encrypted){var e=m.page.number;m.updatePageHighlightsContainer(S[e],!!E[e]);var i=u("#yudu_pageHighlights_"+e);N(i,m.page),i.show(),E[e]=!1}if(v&&!v.encrypted){var n=v.page.number;v.updatePageHighlightsContainer(S[n],!!E[n]);var r=u("#yudu_pageHighlights_"+n);N(r,v.page),r.show(),E[n]=!1}},N=function(t,e){t[0].firstElementChild&&t[0].firstElementChild.setAttribute("viewBox","0 0 "+e.width+" "+e.height)},F=function(t){if(r.yuduBook.settings.highlightsEnabled){w=0==m.page.number&&i.hasIntroPage;var e;e=w&&v?v:m;var n=X();e.pageHighlightsLevel.setupCanvasElementContainer(n),n.width>0&&n.height>0?(e.pageHighlightsLevel.setupFabricCanvasContainer(W()),Y(),b=!0):(o.displayByCode("highlights.introPageWarning"),b=!1)}},B=function(){if(b){if(v)if(w)G();else{var t=p.getObjects(),e=[],i=[];u.each(t,function(t,n){var r=n.getBoundingRect();r.left<m.page.width?(e.push(n),r.left+r.width>m.page.width&&i.push(n)):i.push(n)}),p.clear(),u.each(e,function(t,e){p.add(e)}),z(),p.clear(),u.each(i,function(t,e){e.left-=m.page.width,p.add(e)}),G()}else z();p.clear(),it(),H(!1)}},H=function(t){e.emit("pageHighlights",e.UGC_CHANGED,this,{pageHighlights:S,fromSync:t})},U=function(t){var e=t?v.page:m.page,i=u("#yudu_pageHighlights_"+e.number)[0];i.innerHTML=p.toSVG({viewBox:{x:0,y:0,width:e.width,height:e.height}}),i.firstElementChild.setAttribute("width","100%"),i.firstElementChild.setAttribute("height","100%"),S[e.number]?S[e.number].setSvgData(i.innerHTML):S[e.number]=new s.PageHighlight(e.number,i.innerHTML,s.CURRENT_OBJECT_DATA_VERSION)},z=function(){U(!1)},G=function(){U(!0)},W=function(){return p=new l.Canvas("yudu_highlightingCanvas",{isDrawingMode:!_,perPixelTargetFind:!0,allowTouchScrolling:!1,targetFindTolerance:0,selection:!1}),p.freeDrawingBrush.color=d,p.freeDrawingBrush.width=f,e.yuduOn(p,"path:created",function(t){q(t.path),t.path.selectable=!1,V(),x=[]}),_&&ht(),p},q=function(t){var e=t.path;if(e&&!(e.length<1))for(var i=0;i<e.length;i++){var n=e[i];"Q"==n[0]&&5==n.length?e[i]=["L",n[3],n[4]]:"T"==n[0]&&3==n.length&&(e[i]=["L",n[1],n[2]])}},V=function(){var t=[];u.each(p.getObjects(),function(e,i){t.push(i)}),T.push(t)},X=function(){var t=0,e=0;w||(t+=m.page.width,e=m.page.height),v&&(t+=v.page.width,e=Math.max(e,v.page.height));var i=document.createElement("canvas");return i.id="yudu_highlightingCanvas",i.width=t,i.height=e,i.style.border="0px",i},Y=function(){w||Z(!0),v&&Z(!1),V()},Z=function(t){var e=t?m:v;u.each(u("#yudu_pageHighlights_"+e.page.number+" svg path"),function(e,i){var n=Q(i),r=new l.Path(i.getAttribute("d")),s=i.style.strokeWidth.replace("px","");r.set({selectable:!1,fill:null,stroke:i.style.stroke,strokeWidth:s,strokeLineCap:"round",strokeLineJoin:"round",originX:"left",originY:"top"}),t||w||(r.left+=m.page.width),r.left+=n.left-s/2,r.top+=n.top-s/2,(t||w||r.getBoundingRect().left>m.page.width)&&p.add(r)})},Q=function(t){for(var e=0,i=0,n=t.getAttribute("transform"),r=/translate\(\s*([^\s,)]+)[ ,]+([^\s,)]+)/g,s=r.exec(n);s;)e+=parseFloat(s[1]),i+=parseFloat(s[2]),s=r.exec(n);return{left:e,top:i}},K=function(t){var e=S&&S[t]&&!!S[t].svgData;if(e){e=u(S[t].svgData).find("path").length>0}return e},J=function(){return!g.isShowingEncryptedPage()},$=function(){F(),C.show(),y=!0},tt=function(){C.hide(),it(),y=!1,b=!1},et=function(){it()},it=function(){T=[],x=[]},nt=function(){p&&(p.clear(),V())},rt=function(){if(T.length>1){x.push(T.pop()),p.clear();var t=T[T.length-1];u.each(t,function(t,e){p.add(e)}),p.renderAll()}},st=function(){if(x.length>0){p.clear();var t=x.pop();u.each(t,function(t,e){p.add(e)}),V(),p.renderAll()}},ot=function(t){d=t,p&&(p.freeDrawingBrush.color=d)},at=function(t){f=t,p&&(p.freeDrawingBrush.width=f)},ht=function(){p&&(p.isDrawingMode=!1,e.yuduOn(p,"mouse:down",lt))},ct=function(){p&&(p.off("mouse:down",lt),p.off("mouse:move",dt),p.off("mouse:up",ut))},lt=function(t){dt(t),e.yuduOn(p,"mouse:move",dt),e.yuduOn(p,"mouse:up",ut)},ut=function(t){p.off("mouse:move",dt),p.off("mouse:up",ut)},dt=function(t){if(_){for(var e=!1,i=!0;i;){var n=p.findTarget(t.e,null);n?(e=!0,p.remove(n)):i=!1}e&&(x=[],V())}else ct()},ft=function(t){_=t,p.isDrawingMode=!t,_?ht():ct()};return{init:O,reinit:A,setReader:e.callback(this,function(t){g=t}),eraserMode:ft,setBrushWidth:at,setBrushColour:ot,pageHasHighlight:K,pagesSupportHighlights:J,showHighlightingCanvas:$,hideHighlightingCanvas:tt,saveCanvas:B,cancel:et,clearCanvas:nt,undo:rt,redo:st}}),define("controllers/pageHighlightsController",["model/overlay","events","constants","resources","config","controllers/shifter","utils/tools","fabric","../ui/highlightingCanvas"],function(t,e,i,n,r,s,o,a,h){return{PageHighlightsController:function(t){this.highlightsContainerCreated=!1,this.pageNumber=t,this.htmlElement=null,this.domElement=null,this.canvas=null,this.pageHighlightsContainer=$("#yudu_pageHighlightsContainer"),this.highlightingCanvasContainer=$("#yudu_highlightingCanvasContainer")[0],this.container=new createjs.Container,this.setupCanvasElementContainer=function(t){for(;this.highlightingCanvasContainer.firstChild;)this.highlightingCanvasContainer.removeChild(this.highlightingCanvasContainer.firstChild);this.htmlElement=t,this.domElement=new createjs.DOMElement(this.htmlElement),this.highlightingCanvasContainer.appendChild(this.htmlElement)},this.setupFabricCanvasContainer=function(t){this.canvas=t,this.getContainer().addChild(new createjs.DOMElement(document.getElementsByClassName("canvas-container")[0]))},this.createHighlightsContainer=function(){this.highlightsContainer=document.createElement("div"),this.highlightsContainer.id="yudu_pageHighlights_"+this.pageNumber,this.highlightsContainer.className="yudu_pageHighlights",this.highlightsContainer.style.width=this.pageWidth+"px",this.highlightsContainer.style.height=this.pageHeight+"px",this.pageHighlightsContainer.append(this.highlightsContainer),this.getContainer().addChild(new createjs.DOMElement(this.highlightsContainer)),this.highlightsContainerCreated=!0},this.updateHighlightsContainer=function(t,e){var i=!1;this.highlightsContainerCreated||(this.createHighlightsContainer(),i=!0),(e||i)&&(t&&t.svgData?this.highlightsContainer.innerHTML=t.svgData:e&&(this.highlightsContainer.innerHTML=""))},this.getContainer=function(){return this.container},this.scaleHighlights=function(t,e){var i=t.width/e.width,n=t.height/e.height;this.getContainer().set({scaleX:i,scaleY:n})},this.setHitArea=function(t,e){this.pageWidth=t,this.pageHeight=e;for(var i=0,n=this.getContainer().getNumChildren();i<n;i++){var r=new createjs.Shape,s=t,o=e;r.graphics.beginFill("#000").drawRect(0,0,s,o),this.getContainer().getChildAt(i).hitArea=r}}}}}),define("model/ugc/note",["../../events","constants","config","resources","tween","utils/tools","jquery","jquery.hammer"],function(t,e,i,n,r,s,o){var a,h=e.ugcNotePlaceholderUrl,c=e.ugcNotePlaceholderDragUrl,l=e.ugcNoteDragTimeout;return{Note:function(e,n,u,d,f,g,p,m,v,y){this.pageNumber=e,this.text=n,this.x=Number(u),this.y=Number(d),this.zIndex=Number(f)||0,this.clipping=g||{},this.id=p||s.createUID(),this.lastModified=m||(new Date).getTime(),this.lastSynced=v||0,this.isDeleted=y||!1,this.downStarted=!1,this.inDraggingMode=!1,this.rect=null,this.hitArea=null,this.htmlElement=null,this.domElement=!1,this.isInDom=!1,this.notesContainer=o("#yudu_notes")[0],this.isMouseIn=!1,this.init=function(e){if(t.subscribe(t.ALL,t.PAGE_CHANGED,t.callback(this,this.toggleVisibility),!1),t.subscribe(t.ALL,t.TWO_UP_CHANGED,t.callback(this,this.toggleVisibility),!1),this.rect=new r.Container,this.rect.x=this.x,this.rect.y=this.y,this.createNoteContainer(),e)try{s.overrideProperty(this.domElement,this.domElement.style,"transform","_yudu_ugc_noteTrans",function(){},function(){t.emit("note",t.NOTE_TRANSFORM_CHANGED,this,{})})}catch(e){var i=setInterval(function(){t.emit("note",t.NOTE_TRANSFORM_CHECK,this,{intervalId:i})},100)}return this.rect},this.createNoteContainer=function(){this.isInDom=!1,this.domElement=document.createElement("img"),this.domElement.src=h,t.yuduOn(o(this.domElement),i.deviceUsesClicks?"mousedown":"touchstart",t.callback(this,this.handleStartEvent)),t.yuduAddEventListener(this.domElement,"MSHoldVisual",function(t){t.preventDefault()},!1),this.rect.addChildAt(new r.DOMElement(this.domElement)),this.toggleVisibility()},this.handleStartEvent=function(e){t.yuduOn(o("#yudu_reader"),i.deviceUsesClicks?"mouseup":"touchend",t.callback(this,this.handleEndEvent)),this.downStarted=!0,a=setTimeout(t.callback(this,this.timerExpired),l),t.yuduOn(o(this.domElement),i.deviceUsesClicks?"mouseout":"touchleave",t.callback(this,this.cancelDrag)),e.preventDefault()},this.cancelDrag=function(t){clearTimeout(a),o(this.domElement).off(i.deviceUsesClicks?"mouseout":"touchleave"),this.downStarted=!1,t.preventDefault()},this.handleEndEvent=function(e){o("#yudu_reader").off(i.deviceUsesClicks?"mouseup":"touchend",t.callback(this,this.handleEndEvent)),this.downStarted&&(this.downStarted=!1,clearTimeout(a),this.domElement.src=h,o(this.domElement).off(i.deviceUsesClicks?"mouseout":"touchleave"),this.inDraggingMode?t.emit("note",t.NOTE_MOVED,this,{note:this,rect:this.domElement.getBoundingClientRect()}):t.emit("note",t.VIEW_NOTE,this,{note:this,rect:this.domElement.getBoundingClientRect(),isNew:!1}),this.inDraggingMode=!1,e.preventDefault())},this.timerExpired=function(e){this.domElement.src=c,o(this.domElement).off(i.deviceUsesClicks?"mouseout":"touchleave"),this.inDraggingMode=!0,t.emit("note",t.NOTE_DRAG_START,this,{note:this})},this.move=function(t,e,i,n,r){var s=this.rect.globalToLocal(t.x,t.y);this.rect.x=this.keepWithinLimits(0,this.rect.x+s.x-n/2,e),this.rect.y=this.keepWithinLimits(0,this.rect.y+s.y-r/2,i),this.x=this.rect.x,this.y=this.rect.y,this.touch()},this.keepWithinLimits=function(t,e,i){return Math.max(t,Math.min(e,i))},this.pageChanged=function(){this.toggleVisibility()},this.toggleVisibility=function(){shifter.isPageShowing(this.pageNumber)?(this.addToDom(!0),o(this.domElement).show()):(this.addToDom(!1),this.isInDom&&o(this.domElement).hide())},this.addToDom=function(t){this.isInDom||!t&&!shifter.isPageInTray(e)||(this.isInDom=!0,this.notesContainer.appendChild(this.domElement))},this.removeDomElement=function(t){o(this.domElement).remove(),t&&(this.isDeleted=!0,this.touch())},this.setNoteText=function(t){this.text=t,this.touch()},this.getGlobalLocation=function(){return this.rect.localToGlobal(this.x,this.y)};this.touch=function(){this.lastModified=(new Date).getTime()},this.getWriteableObject=function(){return{id:this.id,pageNumber:this.pageNumber,locationX:this.x,locationY:this.y,zIndex:this.zIndex,text:this.text,clipping:this.clipping,lastModified:this.lastModified,lastSynced:this.lastSynced,isDeleted:this.isDeleted}}},EMITTER_NAME:"note",setShifter:t.callback(this,function(t){shifter=t})}}),define("views/noteView",["easel"],function(t){return{NoteView:function(){this.container=new t.Container,this.addNote=function(t){this.container.addChild(t)},this.removeNote=function(t){this.container.removeChild(t)},this.hide=function(){this.container.visible=!1},this.show=function(){this.container.visible=!0}}}}),define("controllers/noteController",["model/ugc/note","views/noteView","events","constants","resources","config","controllers/shifter","utils/tools"],function(t,e,i,n,r,s,o,a){return{NoteController:function(i){this.initialised=!1,this.pageNumber=i,this.notes=[],this.noteView=new e.NoteView,this.minimumZIndex=3e3,this.maximumZIndex=4e3,this.currentZIndex=this.minimumZIndex+1,this.populateNotes=function(t,e){e&&this.initialised&&this.removeAllNotesFromDom(),this.initialised&&!e||this.createNotes(t),this.initialised=!0},this.deleteNote=function(t){this.removeNote(t,!0)},this.removeNote=function(t,e){for(var i=0;i<this.notes.length;i++)if(this.notes[i].id==t.id){this.noteView.removeNote(this.notes[i].rect),e&&this.notes[i].removeDomElement(!0);break}},this.removeAllNotesFromDom=function(){for(var t=0;t<this.notes.length;t++)this.noteView.removeNote(this.notes[t].rect),this.notes[t].removeDomElement(!1);this.notes=[]},this.addNote=function(t){this.noteView.addNote(t.rect),this.notes.push(t),t.pageWidth=this.pageWidth,t.pageHeight=this.pageHeight},this.moveNote=function(t,e){var i=$(t.domElement).width(),n=$(t.domElement).height(),r=this.pageWidth-i,s=this.pageHeight-n;t.move(e,r,s,i,n)},this.createNoteAtPoint=function(e){var i=this.getContainer().globalToLocal(e.x,e.y),n=new t.Note(this.pageNumber,"",i.x,i.y);return this.notes.push(n),this.noteView.addNote(n.init(!0)),this.setCurrentZIndex(n),n},this.createNotes=function(t){if(t){t=t instanceof Array?t:[t];for(var e=0;e<t.length;e++){var i=t[e];i.isDeleted||(this.notes.push(i),this.noteView.addNote(i.init(!1)),i.zIndex>0?(this.assignCustomZIndex(i,i.zIndex),this.currentZIndex=Math.max(i.zIndex+this.minimumZIndex+1,this.currentZIndex)):this.setCurrentZIndex(i))}}},this.assignCustomZIndex=function(t,e){var i=e;if(e>=0&&e<this.maximumZIndex-this.minimumZIndex)i=e+this.minimumZIndex;else if(e<this.minimumZIndex||e>this.maximumZIndex)return void this.setCurrentZIndex(t,!1);$(t.domElement).css("zIndex",i),t.zIndex=e},this.assignCurrentZIndex=function(t){$(t.domElement).css("zIndex",this.currentZIndex),t.zIndex=this.currentZIndex-this.minimumZIndex},this.setCurrentZIndex=function(t,e){this.assignCurrentZIndex(t),this.currentZIndex++,e||this.checkZIndexLimits()},this.checkZIndexLimits=function(){this.currentZIndex>=this.maximumZIndex&&this.resetNotesCounter()},this.resetNotesCounter=function(){this.currentZIndex=this.minimumZIndex+1;var t=this.notes.length;this.reorderNotesByZIndex();for(var e=0;e<t;e++){var i=this.notes[e];this.setCurrentZIndex(i,!0)}},this.reorderNotesByZIndex=function(){this.notes.sort(t.Note.zIndexComparator)},this.getContainer=function(){return this.noteView.container},this.scaleNotes=function(t,e){var i=t.width/e.width,n=t.height/e.height;this.getContainer().set({scaleX:i,scaleY:n})},this.handleTap=function(t){for(var e=this.notes.length-1;e>=0;e--)if(this.notes[e].handleTap(t))return!0;return!1},this.hide=function(){},this.setNotesHitArea=function(t,e){this.pageWidth=t,this.pageHeight=e;for(var i=0,n=this.getContainer().getNumChildren();i<n;i++){var r=new createjs.Shape,s=this.getContainer().mask?Math.min(this.notes[i].width,t-this.notes[i].x):this.notes[i].width,o=this.getContainer().mask?Math.min(this.notes[i].height,e-this.notes[i].y):this.notes[i].height;r.graphics.beginFill("#000").drawRect(this.notes[i].x,this.notes[i].y,s,o),this.getContainer().getChildAt(i).hitArea=r}}}}}),define("model/searchOverlay",["config","model/overlay"],function(t,e){return{SearchOverlay:function(i,n,r,s,o){e.Overlay.call(this,i,n,r,s,void 0,void 0,void 0,o),this.rectColour=t.searchOverlayColour,this.init=function(){return this.createRectAndHitArea(),this.rect}}}}),define("controllers/searchOverlayController",["model/searchOverlay","views/overlayView","constants"],function(t,e,i){return{SearchOverlayController:function(){this.initialised=!1,this.overlays=[],this.overlayView=new e.OverlayView,this.init=function(e){for(var i=0;i<e.length;i++){var n=e[i].split(","),r=new t.SearchOverlay(n[0],n[1],n[2],n[3]);this.overlays.push(r),this.overlayView.addOverlay(r.init())}},this.getContainer=function(){return this.overlayView.container},this.scaleOverlays=function(t,e){var i=t.width/e.width,n=t.height/e.height;this.getContainer().set({scaleX:i,scaleY:n})},this.flashOverlays=function(){for(var t=0;t<this.overlays.length;t++)this.overlays[t].flash(i.pauseBeforeOverlayFlash)}}}}),define("controllers/pageController",["events","controllers/zoomLevelController","model/page","views/pageView","controllers/overlayController","controllers/pageHighlightsController","controllers/noteController","controllers/searchOverlayController","fetching/fetchHandler","resources","utils/tools","config"],function(t,e,i,n,r,s,o,a,h,c,l,u){return{PageController:function(d,f,g){this.initialised=!1,this.encrypted=f.isEnc,this.pageInfo=f,this.zoomSettings=g,this.z=-1,this.init=function(){this.initialised=!0,this.pageView=new n.PageView,this.zoomLevels=[],this.zoomLevelCount=0,this.shouldFlashOverlaysOnLoaded=!1,this.createSkeletonZoomLevels(this.zoomSettings,this.getPageInfo().zooms),this.mask=new createjs.Shape,this.mask.graphics.beginFill("#000").drawRect(0,0,this.page.width,this.page.height),this.overlayLevel=new r.OverlayController(this.page.number),this.overlayLevel.init(this.getPageInfo().ols),
this.overlayLevel.getContainer().mask=this.mask,this.overlayLevel.setOverlaysHitArea(this.page.width,this.page.height),u.highlightsEnabled&&(this.pageHighlightsLevel=new s.PageHighlightsController(this.page.number),this.pageHighlightsLevel.getContainer().mask=this.mask,this.pageHighlightsLevel.setHitArea(this.page.width,this.page.height)),u.notesEnabled&&(this.noteLevel=new o.NoteController(this.page.number),this.noteLevel.getContainer().mask=this.mask,this.noteLevel.setNotesHitArea(this.page.width,this.page.height)),t.subscribe(t.ALL,t.ZOOMLEVEL_TILESLOADED,t.callback(this,this.zoomLevelLoadedImages),!1)},this.setUpNotes=function(t,e){this.noteLevel.populateNotes(t,e)},this.decrypt=function(e){if(this.pageInfo.isEnc){var n;try{n=l.decryptPage(this.pageInfo,e)}catch(t){return}n&&(this.encrypted=!1,this.pageInfo=n,this.page=new i.Page(this.page.number,this.pageInfo.label,this.pageInfo.w,this.pageInfo.h,this.pageInfo.folder,this.pageInfo.pattern),u.pageDecrypted=!0,this.initialised=!1,t.unsubscribe(t.ALL,t.ZOOMLEVEL_TILESLOADED),t.unsubscribe(t.ALL,t.DECRYPT_ALL_PAGES,this.decryptionCallback,!0),t.emit(yudu_events.ALL,yudu_events.THUMBNAILS.UPDATE_THUMBNAIL,this,{pageNumber:this.page.number}),t.emit(t.ALL,t.PAGE_DECRYPTED,this,{}))}},this.decryptionCallback=t.callback(this,function(t){this.decrypt(t.data.key)}),this.getPageInfo=function(){return this.pageInfo.isEnc?c.yuduBook.settings.placeHolderPage:this.pageInfo},this.createSkeletonZoomLevels=function(t,i){for(var n=0;n<i.length;n++){var r=new e.ZoomLevelController(n,t[n],i[n],this.page.baseURL,this.page.filePattern,this.page.number);this.zoomLevels.push(r)}this.zoomLevelCount=i.length},this.unloadAllTiles=function(){if(this.initialised){for(var t=0,e=0,i=this.zoomLevels.length;e<i;e++)t+=this.zoomLevels[e].unload();return this.pageView.container.removeAllChildren(),t}},this.createZoomLevel=function(t){var e=this.zoomLevels[t];e.init(),e.hide(),this.pageView.container.addChild(e.getContainer())},this.triggerShow=function(){this.overlaysPageReadyWhenNextLoaded(),h.isFullyLoaded(this.page.number,this.z)&&this.overlaysPageReady()},this.overlaysPageReadyWhenNextLoaded=function(){this.shouldFlashOverlaysOnLoaded=!0},this.overlaysPageReady=function(){this.shouldFlashOverlaysOnLoaded=!1,this.overlayLevel.pageReady(),this.flashSearchOverlays()},this.updatePageHighlightsContainer=function(t,e){this.pageHighlightsLevel.updateHighlightsContainer(t,e)},this.zoomLevelLoadedImages=function(t){this.shouldFlashOverlaysOnLoaded&&this.pageView.isShowing()&&this.z==t.data.z&&this.page.number==t.data.pageNumber&&this.overlaysPageReady()},this.getPageNumber=function(){return this.page.number},this.isIntroPage=function(){return u.hasIntroPage&&0==this.getPageNumber()},this.getPageLabel=function(){return this.page.label},this.getPageWidth=function(){return this.page.width},this.getPageHeight=function(){return this.page.height},this.isPageEncrypted=function(){return this.encrypted},this.setAlignment=function(t){for(var e=0,i=this.zoomLevels.length;e<i;e++)this.zoomLevels[e].setAlignment(t)},this.resetAlignments=function(t){this.setAlignment(t),this.getContainer().resetPosition()},this.getContainer=function(){return this.pageView.container},this.prepareZoomLevel=function(t){this.zoomLevels[t].initialised||this.createZoomLevel(t)},this.endZoomOn=function(t){var e=this.overlayLevel.getContainer();if(this.pageHighlightsLevel)var i=this.pageHighlightsLevel.getContainer();if(this.noteLevel)var n=this.noteLevel.getContainer();if(this.searchOverlayLevel)var r=this.searchOverlayLevel.getContainer();var s=this.zoomLevels[t];if(this.z>=0){var o=this.zoomLevels[this.z];o.initialised&&(o.hide(),o.getContainer().removeChild(e),i&&o.getContainer().removeChild(i),n&&o.getContainer().removeChild(n),r&&o.getContainer().removeChild(r))}this.z=t,s.initialised||this.createZoomLevel(t),s.getContainer().addChild(e),i&&s.getContainer().addChild(i),n&&s.getContainer().addChild(n),r&&s.getContainer().addChild(r),s.show(),this.overlayLevel.scaleOverlays(s.zoomLevel,this.page),this.pageHighlightsLevel&&this.pageHighlightsLevel.scaleHighlights(s.zoomLevel,this.page),this.noteLevel&&this.noteLevel.scaleNotes(s.zoomLevel,this.page),this.searchOverlayLevel&&this.searchOverlayLevel.scaleOverlays(s.zoomLevel,this.page),this.mask.set({scaleX:this.overlayLevel.getContainer().scaleX,scaleY:this.overlayLevel.getContainer().scaleY})},this.deleteNote=function(t){this.noteLevel.deleteNote(t)},this.canCreateNoteAt=function(t){return!this.isIntroPage()},this.noteIsWithinPageBounds=function(t){var e=this.pageView.container.getBounds(),i=this.pageView.container.localToGlobal(e.x,e.y);if(this.noteLevel.getContainer().mask)n=this.pageView.container.localToGlobal(e.x+this.zoomLevels[this.z].zoomLevel.width,e.y+this.zoomLevels[this.z].zoomLevel.height);else var n=this.pageView.container.localToGlobal(e.x+e.width,e.y+e.height);return!(t.x<i.x||t.y<i.y||t.x>n.x||t.y>n.y)},this.canDragNoteTo=function(t){return this.canCreateNoteAt(t)&&this.noteIsWithinPageBounds(t)},this.handleTap=function(e){var i=this.pageView.container.getBounds(),n=this.pageView.container.localToGlobal(i.x,i.y),r=this.pageView.container.localToGlobal(i.x+i.width,i.y+i.height);return this.encrypted&&e.x>n.x&&e.y>n.y&&e.x<r.x&&e.y<r.y?(t.emit(t.ALL,t.SHOW_LOGIN,this,{}),!0):(this.overlayLevel.getContainer().mask&&(n=this.pageView.container.localToGlobal(i.x,i.y),r=this.pageView.container.localToGlobal(i.x+this.zoomLevels[this.z].zoomLevel.width,i.y+this.zoomLevels[this.z].zoomLevel.height)),!(e.x<n.x||e.y<n.y||e.x>r.x||e.y>r.y)&&(!!this.overlayLevel&&this.overlayLevel.handleTap(e)))},this.page=new i.Page(d,this.getPageInfo().label,this.getPageInfo().w,this.getPageInfo().h,this.getPageInfo().folder,this.getPageInfo().pattern),this.createSearchOverlayLevel=function(t){this.searchOverlayLevel=new a.SearchOverlayController,this.searchOverlayLevel.init(t),this.zoomLevels&&this.z>=0&&(this.zoomLevels[this.z].getContainer().addChild(this.searchOverlayLevel.getContainer()),this.searchOverlayLevel.scaleOverlays(this.zoomLevels[this.z].zoomLevel,this.page))},this.removeSearchOverlayLevel=function(){this.searchOverlayLevel&&this.zoomLevels&&this.z>=0&&this.zoomLevels[this.z].getContainer().removeChild(this.searchOverlayLevel.getContainer()),this.searchOverlayLevel=!1},this.flashSearchOverlays=function(){this.searchOverlayLevel&&this.searchOverlayLevel.flashOverlays()},this.encrypted&&t.subscribe(t.ALL,t.DECRYPT_ALL_PAGES,this.decryptionCallback,!0)}}}),define("model/ugc/bookmark",[],function(){return{Bookmark:function(t,e,i,n){this.pageNumber=t,this.isDeleted=!e,this.lastModified=i||(new Date).getTime(),this.lastSynced=n||0,this.id=function(){return this.pageNumber},this.deleteItem=function(){this.isDeleted=!0,this.touch()},this.unDeleteItem=function(){this.isDeleted=!1,this.touch()},this.isSynced=function(){return this.lastModified<=this.lastSynced},this.touch=function(){this.lastModified=(new Date).getTime()},this.getWriteableObject=function(){return{pageNumber:this.pageNumber,isDeleted:this.isDeleted,lastModified:this.lastModified,lastSynced:this.lastSynced}}}}}),define("ui/bookmarks",["jquery","events","config","shared/ui/messageBox","model/ugc/bookmark"],function(t,e,i,n,r){var s,o,a,h,c,l,u={},d=function(t){l=i.twoPageMode,p(t),e.subscribe(e.ALL,e.PAGE_CHANGED,e.callback(this,_)),e.subscribe(e.ALL,e.TWO_UP_CHANGED,e.callback(this,b)),e.subscribe(e.ALL,yudu_events.TOOLBAR.LOADED,e.callback(this,_))},f=function(t,e){e.reset&&g(),p(t),_(),e.reset||y(!0)},g=function(){u={}},p=function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=JSON.parse(t[e]);if(u[e]&&u[e].lastModified>i.lastModified)continue;u[e]=new r.Bookmark(i.pageNumber,!i.isDeleted,i.lastModified,i.lastSynced)}},m=function(t){return u&&u[t]&&!u[t].isDeleted},v=function(){if(x())a=!1,u[o]?u[o].deleteItem():u[o]=new r.Bookmark(o,!1),l&&(c=!1,u[h]?u[h].deleteItem():u[h]=new r.Bookmark(h,!1));else{var t;if(0==o&&i.hasIntroPage){if(!l)return void n.displayByCode("bookmarks.introPageWarning");c=!0,t=h}else a=!0,t=o;u[t]?u[t].unDeleteItem():u[t]=new r.Bookmark(t,!0)}y(!1),w()},y=function(t){e.emit("bookmarks",e.UGC_CHANGED,this,{bookmarks:u,fromSync:t})},b=function(t){l=i.twoPageMode,_(t)},_=function(t){o=s.shifter.getCentreTray().pages[0].page.number,a=u[o]&&!u[o].isDeleted;var e=s.shifter.getCentreTray().pages[1];l&&e&&(h=e.page.number,c=u[h]&&!u[h].isDeleted),w()},w=function(){window.yudu_commonSettings.toolbarLoaded?T():e.subscribe(e.ALL,yudu_events.TOOLBAR.LOADED,function(){T()})},T=function(){e.emit("bookmarks",yudu_events.TOOLBAR.UPDATE_BOOKMARK_BUTTON,this,{bookmarkOn:x()})},x=function(){return a||l&&c};return{init:d,reinit:f,pageHasBookmark:m,setReader:e.callback(this,function(t){s=t}),toggleBookmark:v,updatePages:_,twoUpChanged:b,bookmarkIconStatus:x,updateBookmarkButton:w}}),define("ui/loading",["api","events","config","constants","resources","shared/localisation","jquery"],function(t,e,i,n,r,s,o){var a=o("#yudu_backgroundLoadCover"),h=0,c=[],l=1,u=function(t,h){d(),f(),a.append(r.loadingHtml),window.yudu_commonFunctions.injectJavascript(n.baseResourcesFolder+r.loadingConfig.mainJavascriptFilePath),s.localiseHtml(a),o("#yudu_loadThrobber").remove(),e.subscribe(e.ALL,e.TILE_FETCHED,m),e.subscribe(e.ALL,e.ZOOMLEVEL_TILESLOADED,v),c.push(t),i.twoPageMode&&!i.hasIntroPage&&t>0&&t<h-1&&c.push(t+(t%2?1:-1)),l=c.length},d=function(){r.yuduBook.settings;window.yudu_loadingSettings={bgTopColour:i.bgTopColour,bgBottomColour:i.bgBottomColour,loadingString:s.get("loading.tiles"),lastProgressReport:0,loaded:!1}},f=function(){window.yudu_loadingFunctions={setGradientBackground:g,fadeLoadingScreen:p}},g=function(t,e){e.bgTopColour&&e.bgBottomColour&&(t[0].style.background="#"+e.bgTopColour,t[0].style.background="-webkit-gradient(linear, left top, left bottom, color-stop(0%, #"+e.bgTopColour+"), color-stop(100%, #"+e.bgBottomColour+"))",t[0].style.background="-webkit-linear-gradient(top, #"+e.bgTopColour+",#"+e.bgBottomColour+")",t[0].style.background="-o-linear-gradient(top, #"+e.bgTopColour+",#"+e.bgBottomColour+")",t[0].style.background="-moz-linear-gradient(top, #"+e.bgTopColour+",#"+e.bgBottomColour+")",t[0].style.background="-ms-linear-gradient(top, #"+e.bgTopColour+",#"+e.bgBottomColour+")",t[0].style.background="linear-gradient(to bottom, #"+e.bgTopColour+",#"+e.bgBottomColour+")")},p=function(t){a.fadeOut(t)},m=function(t){h++;var i=Math.min(h/t.data.numTiles*100/l,100);e.emit(yudu_events.ALL,yudu_events.LOADING.DISPLAY_PROGRESS,this,{percentage:i}),yudu_loadingSettings.lastProgressReport=i},v=function(t){var i=o.inArray(t.data.pageNumber,c);i>=0&&c.splice(i,1),0==c.length&&(e.emit(yudu_events.ALL,yudu_events.LOADING.DISPLAY_PROGRESS,this,{percentage:100}),yudu_loadingSettings.lastProgressReport=100,e.emit(yudu_events.ALL,yudu_events.LOADING.END_LOADING),yudu_loadingSettings.loaded=!0,y())},y=function(){e.emit("loading",e.LOADING_FINISHED,this,{}),e.unsubscribe(e.ALL,e.TILE_FETCHED,m),e.unsubscribe(e.ALL,e.ZOOMLEVEL_TILESLOADED,v)};return{init:u}}),define("utils/userOptions",["shared/storage"],function(t){var e={NO_SHOW_INFORMATION:"noShoddInfoBox",NO_SHOW_NOTE_MESSAGE:"noShowNoteMessage",NO_SHOW_BOOKMARK_MESSAGE:"noShowBookmarkMessage"};return{shouldShowInformationBox:function(){return!t.getItem(e.NO_SHOW_INFORMATION)},setNoShowInformationBox:function(){t.setItem(e.NO_SHOW_INFORMATION,!0)},shouldShowNoteInfoBox:function(){return!t.getItem(e.NO_SHOW_NOTE_MESSAGE)},setNoShowNoteInfoBox:function(){t.setItem(e.NO_SHOW_NOTE_MESSAGE,!0)},shouldShowBookmarkInfoBox:function(){return!t.getItem(e.NO_SHOW_BOOKMARK_MESSAGE)},setNoShowBookmarkInfoBox:function(){t.setItem(e.NO_SHOW_BOOKMARK_MESSAGE,!0)}}}),define("ui/notes",["config","events","interactions","model/ugc/note","controllers/shifter","shared/ui/messageBox","shared/localisation","utils/userOptions","shared/hammerManager","jquery","jquery.hammer"],function(t,e,i,n,r,s,o,a,h,c){var l,u,d,f,g=c("#yudu_noteBackground"),p=c("#yudu_notes"),m=c("#yudu_reader"),v=c("#yudu_noteCloseButton"),y=c("#yudu_noteContainer"),b=c("#yudu_noteText"),_=c("#yudu_clippingContainer"),w=c("#yudu_clippingImage"),T={editCancelButton:c("#yudu_editNoteCancelButton"),editOkButton:c("#yudu_editNoteOkButton"),viewDeleteButton:c("#yudu_viewNoteDeleteButton"),viewBrowseButton:c("#yudu_viewNoteBrowseButton"),viewOkButton:c("#yudu_viewNoteOkButton")},x=null,S=null,C=!1,E={},O={},A={},P=!1,k=0,L=function(t){M(t),U(),d=g.hammer({transform_always_block:!0}),f=p.hammer({transform_always_block:!0}),e.subscribe(n.EMITTER_NAME,e.VIEW_NOTE,e.callback(this,Z)),e.subscribe(n.EMITTER_NAME,e.NOTE_DRAG_START,e.callback(this,setupNoteDrag)),e.subscribe(e.ALL,e.PAGE_CHANGED,H),e.subscribe(e.ALL,e.TWO_UP_CHANGED,H),e.subscribe(e.ALL,e.LOGIN_SUCCESS,H),e.subscribe(e.ALL,e.RESIZE,e.callback(this,K)),H()},I=function(t,e){e.reset&&D(),M(t),H(),e.reset||ot(!0)},D=function(){E={},O={},k=0;for(var t=0,e=reader.shifter.getNumberOfPages();t<e;t+=1)A[t]=!0},M=function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=JSON.parse(t[e]),n=E[i.id];if(n&&n.lastModified>i.lastModified)continue;i.isDeleted?j(i,!0):R(i)}},j=function(t,e){var i=E[t.id];if(i){var n=i.pageNumber,r=O[n];if(r&&r.length)for(var s=0,o=r.length;s<o;s+=1){var a=r[s];if(a.id==i.id){1==r.length?delete O[n]:r.splice(s,1),A[n]=!0;break}}e&&delete E[t.id],k--}},R=function(t){var e=new n.Note(t.pageNumber,t.text,t.locationX,t.locationY,t.zIndex,t.clipping,t.id,t.lastModified,!1);j(t,!1),F(e),A[e.pageNumber]=!0,k++},N=function(t){return O&&O[t]&&O[t].length>0},F=function(t){var e=t.pageNumber;O.hasOwnProperty(e)?O[e].push(t):O[e]=[t],E[t.id]=t},B=function(t){var e=t.pageNumber,i=O[e];i.length<2?delete O[e]:i.splice(i.indexOf(t),1)},H=function(t){if(l=reader.shifter.getCentreTray().pages[0],!l.encrypted){var e=l.page.number;l.setUpNotes(O[e],!!A[e]),A[e]=!1}if((u=reader.shifter.getCentreTray().pages[1])&&!u.encrypted){var i=u.page.number;u.setUpNotes(O[i],!!A[i]),A[i]=!1}},U=function(){h.createTapManager(v[0]).on("tap",G),h.createTapManager(T.editCancelButton[0]).on("tap",J),h.createTapManager(T.editOkButton[0]).on("tap",$),h.createTapManager(T.viewDeleteButton[0]).on("tap",tt),h.createTapManager(T.viewBrowseButton[0]).on("tap",nt),h.createTapManager(T.viewOkButton[0]).on("tap",rt),e.yuduOn(b,t.clickAction,function(){g.focus(),b.focus()})},z=function(){reader.isShowingEncryptedPage()||(i.setAllowKeyNavigation(!1),e.yuduOn(d,"tap",W),g.addClass("yudu_createNote"),y.addClass("yudu_dirtyNote"),g.show())},G=function(){x=null,d.off("tap",W),i.setAllowKeyNavigation(!0),g.hide(),C&&a.shouldShowNoteInfoBox()&&(s.displayByCode("note.firstNoteCreated"),a.setNoShowNoteInfoBox())},W=function(i){var n={x:i.gesture.center.pageX*t.pixelDensity,y:(i.gesture.center.pageY-t.readerYOffset)*t.pixelDensity},r=null;l.noteIsWithinPageBounds(n)?l.canCreateNoteAt(n)?r=l.noteLevel.createNoteAtPoint(n):s.displayByCode("note.introPageWarning"):u&&u.canDragNoteTo(n)&&(r=u.noteLevel.createNoteAtPoint(n)),r&&(k++,q.sub(r)),e.emit("notes",e.NOTES_BACKGROUND_INTERACTION,this,{})},q=function(){var t,i,r=function(){Q(t,!0),a()},s=function(e){t&&""!==t.domElement.style.transform&&(Q(t,!0),e&&clearInterval(e.data.intervalId),a())},o=function(o){i=!0,t=o,e.subscribe(n.EMITTER_NAME,e.NOTE_TRANSFORM_CHANGED,r,!0),e.subscribe(n.EMITTER_NAME,e.NOTE_TRANSFORM_CHECK,s,!0)},a=function(){i=!1,t=null,e.unsubscribe(n.EMITTER_NAME,e.NOTE_TRANSFORM_CHANGED,r,!0),e.unsubscribe(n.EMITTER_NAME,e.NOTE_TRANSFORM_CHECK,s,!0)};return{sub:o,isSubbed:function(){return i}}}();this.setupNoteDrag=function(t){S=t.data.note,Y(S,!0),e.yuduOn(f,"drag",V),e.yuduOn(m,"mouseup",X)};var V=function(e){var i={x:e.gesture.center.pageX*t.pixelDensity,y:(e.gesture.center.pageY-t.readerYOffset)*t.pixelDensity},n=reader.pages[S.pageNumber];if(n.canDragNoteTo(i))n.noteLevel.moveNote(S,i);else if(t.twoPageMode){var r=(S.pageNumber+(t.hasIntroPage?0:1))%2==1,s=r?S.pageNumber-1:S.pageNumber+1,o=reader.pages[s];o&&o.canDragNoteTo(i)&&(n.noteLevel.removeNote(S,!1),o.noteLevel.addNote(S),o.noteLevel.moveNote(S,i),B(S),S.pageNumber=s,F(S),ot(!1))}},X=function(t){Y(S,!1),f.off("drag",V),m.off("mouseup",X),ot(!1)},Y=function(t,e){e?reader.pages[t.pageNumber].noteLevel.assignCurrentZIndex(t):reader.pages[t.pageNumber].noteLevel.setCurrentZIndex(t)},Z=function(t){var e=t.data.note;Q(e,!1)},Q=function(t,e){d.off("tap",W),x=t,b.val(x.text),C=e,C?y.addClass("yudu_dirtyNote"):y.removeClass("yudu_dirtyNote"),g.removeClass("yudu_createNote"),y.bind("input propertychange",st),x.clipping&&x.clipping.url?(w.css("background-image",'url("'+x.clipping.url+'")'),_.show(),P||(P=y.height()),y.height(P+_.height())):(w.css("background-image",""),_.hide(),P&&y.height(P)),K(),i.setAllowKeyNavigation(!1),g.show(),b.focus()},K=function(){if(x){var t=x.domElement.getBoundingClientRect(),e=y.width(),i=y.height(),n=c(window).width(),r=c(window).height(),s=t.top,o=t.left,a=t.width,h=t.height,l=Math.min(r-i,Math.max(0,s-(i-h)/2));y.css("top",l);var u;u=o<n/2?Math.min(n-e,o+a):Math.max(0,o-e),y.css("left",u)}},J=function(t){C?et():G()},$=function(t){x.setNoteText(b.val()),E.hasOwnProperty(x.id)||F(x),G(),ot(!1)},tt=function(t){s.displayTwoButtonPopup(o.get("note.deleteNoteMessage"),et,it)},et=function(t){reader.pages[x.pageNumber].noteLevel.deleteNote(x),j(x.getWriteableObject(),!1),ot(!1),G()},it=function(t){},nt=function(t){var e=x;$(t),at.show(e)},rt=function(t){G()},st=function(){y.addClass("yudu_dirtyNote")},ot=function(t){e.emit("notes",e.UGC_CHANGED,this,{notes:E,fromSync:t})},at=function(){var i=!1,n=!1,r=c("#yudu_notesBrowseBackground"),o=c("#yudu_notesBrowseCloseButton"),a=c("#yudu_notesBrowseLabelNote"),h=c("#yudu_notesBrowseLabelPage"),l=c("#yudu_notesBrowseImage"),u=c("#yudu_notesBrowseText"),d=c("#yudu_notesBrowsePreviousImage"),f=c("#yudu_notesBrowseNextImage"),g=!1,p=!1,m=!1,v=!1,y=!1,b=!1,_=!1,w=!1,T=!1,x=!1,S=0,C=function(){return n||(S=t.hasIntroPage?0:1,e.subscribe("notes",e.UGC_CHANGED,A,!1),o.click(function(){p=!1,W()}),d.parent().parent().click(H),f.parent().parent().click(B),g=l.hammer({transform_always_block:!0,prevent_default:!0}),e.yuduOn(g,"dragend",z),e.yuduOn(g,"dragstart",U),n=!0),v?(y=D(v))<0?void P("notes.browse.modificationWarning"):(M(),j(),void R()):void P("notes.browse.error")},A=function(t){if(i){var e=E[v.id];e&&!e.isDeleted&&e.pageNumber&&e.pageNumber==v.pageNumber||P("notes.browse.modificationWarning"),v=E[v.id],C(),L()}},P=function(t){W(),s.displayByCode(t||"notes.browse.error")},L=function(){I(l,v),u.val(v.text),a.text("Note "+(x+y+1)+" of "+k),h.text("On page: "+(v.pageNumber+S)),I(f,b),I(d,w)},I=function(t,e){e?e.clipping&&e.clipping.url?t.css("background-image","url("+e.clipping.url+")"):yudu_thumbnailsFunctions.generateThumbnailUrlCss(yudu_thumbnailsFunctions.getThumbnailFileName(e.pageNumber),function(e){t.css("background-image",e)}):t.css("background-image","")},D=function(t){var e=t.pageNumber,i=O[e];if(i&&i.length)for(var n=0,r=i.length;n<r;n+=1)if(t.id==i[n].id)return n;return-1},M=function(){for(var t=v.pageNumber,e=0,i=0;i<t;i++)O[i]&&(e+=O[i].length);x=e},j=function(){b=!1;var t=O[v.pageNumber];if(y+1<t.length)_=y+1,b=t[_];else{var e=N();e>=0&&(_=0,b=O[e][_])}},R=function(){if(w=!1,y>0)T=y-1,w=O[v.pageNumber][T];else{var t=F();if(t>=0){var e=O[t];T=e.length-1,w=e[T]}}},N=function(){for(var t=v.pageNumber+1,e=reader.shifter.getNumberOfPages();t<e;t+=1)if(O[t]&&O[t].length>0)return t;return-1},F=function(){for(var t=v.pageNumber-1;t>=1-S;t--)if(O[t]&&O[t].length>0)return t;return-1},B=function(){b&&(w=v,T=y,v=b,y=_,y-T!=1&&(x+=O[w.pageNumber].length),j(),L())},H=function(){w&&(b=v,_=y,v=w,y=T,_-y!=1&&(x-=O[v.pageNumber].length),R(),L())},U=function(t){p=!0,m=t.gesture},z=function(t){var e=t.gesture.deltaX-m.deltaX;e>15?H():e<-15&&B(),p=!1},G=function(t){v=t,C(),L(),r.css("display","block"),i=!0},W=function(){r.css("display",""),i=!1,e.emit(e.ALL,e.GOTO_PAGE,this,{pageNumber:v.pageNumber+S}),v=!1};return{show:G,hide:W}}();return{init:L,reinit:I,pageHasNote:N,setReader:e.callback(this,function(t){reader=t}),showNotesCreationMode:z}}),define("utils/ugcApi",["config"],function(t){return new function(){var e=!1,i=!1,n=!1;this.emptyFunction=function(){},this.bookmarksReinit=this.emptyFunction(),this.highlightsReinit=this.emptyFunction(),this.notesReinit=this.emptyFunction(),this.falseFunction=function(){return!1},this.pageHasBookmark=this.falseFunction,this.pageHasHighlight=this.falseFunction,this.pageHasNote=this.falseFunction,this.init=function(){t.bookmarksEnabled&&(e=require("ui/bookmarks"),this.bookmarksReinit=e.reinit,this.pageHasBookmark=e.pageHasBookmark),t.highlightsEnabled&&(i=require("ui/highlightingCanvas"),this.highlightsReinit=i.reinit,this.pageHasHighlight=i.pageHasHighlight),t.notesEnabled&&(n=require("ui/notes"),this.notesReinit=n.reinit,this.pageHasNote=n.pageHasNote)}}}),define("ui/thumbnails",["events","constants","resources","config","shared/localisation","shared/utils/stringUtils","utils/tools","utils/ugcApi","jquery","utils/encryptedResourceFetchingUtils"],function(t,e,i,n,r,s,o,a,h,c){var l=function(r){for(var o=r.pages,a=[],c=0,l=o.length;c<l;c++){var f={width:t.callback(o[c],o[c].getPageWidth),height:t.callback(o[c],o[c].getPageHeight),encrypted:t.callback(o[c],o[c].isPageEncrypted),label:t.callback(o[c],o[c].getPageLabel)};a.push(f)}u(a),d(r),t.subscribe(t.ALL,t.PAGE_CHANGED,m),t.subscribe(t.ALL,t.LOGIN_SUCCESS,function(){t.emit(yudu_events.ALL,yudu_events.COMMON.LOGIN_SUCCESS)});var g=n.isDesktop?i.thumbnailsConfig.desktopPosition:i.thumbnailsConfig.touchPosition;h("#yudu_thumbnailBar"+s.capitalizeFirstLetter(g)).append(i.thumbnailsHtml),window.yudu_commonFunctions.injectJavascript(e.baseResourcesFolder+i.thumbnailsConfig.mainJavascriptFilePath)},u=function(t,i){window.yudu_thumbnailsSettings={pagesDetails:t,introString:r.get("thumbnails.intro"),pageString:r.get("thumbnails.page"),primarySegmentString:r.get("thumbnails.segments.primary"),bookmarksSegmentString:r.get("thumbnails.segments.bookmarks"),highlightsSegmentString:r.get("thumbnails.segments.pageHighlights"),notesSegmentString:r.get("thumbnails.segments.notes"),fps:e.fps,tickTimeMs:e.tickTimeMs,baseThumbnailFolder:e.baseThumbnailFolder}},d=function(e){window.yudu_thumbnailsFunctions={getCurrentPage:function(){return e.getCurrentPage().getPageNumber()},getThumbnailUrl:function(t){return yudu_thumbnailsSettings.baseThumbnailFolder+t+".jpg"},generateThumbnailUrl:function(t,e){var i=yudu_thumbnailsSettings.baseThumbnailFolder+t+".jpg";c.useResourceAsCallbackArgument(i,e)},getThumbnailUrlCss:function(t){return"url("+yudu_thumbnailsFunctions.getThumbnailUrl(t)+")"},generateThumbnailUrlCss:function(t,e){yudu_thumbnailsFunctions.generateThumbnailUrl(t,function(t){e("url("+t+")")})},getThumbnailFileName:function(e){return 0===e&&yudu_commonSettings.hasIntroPage?"intro":!n.isUserLoggedIn&&yudu_thumbnailsSettings.pagesDetails[e].encrypted()?(t.emit(t.ALL,t.NEEDS_BACKGROUND_LOGIN_ATTEMPT,this,{}),"placeholder"):""+e},pageHasBookmarks:o.returnDynamicInput(function(){return a.pageHasBookmark}),pageHasHighlights:o.returnDynamicInput(function(){return a.pageHasHighlight}),pageHasNotes:o.returnDynamicInput(function(){return a.pageHasNote}),addElementToStage:function(t){f(t,e)},toggleThumbnails:g}},f=function(t,e){e.stage.addChild(t)},g=function(e,i){t.emit(yudu_events.ALL,yudu_events.THUMBNAILS.TOGGLE_THUMBNAILS,this,{toggle:e,show:i})},p=function(t){return t.page2?t.page+"-"+t.page2:""+t.page},m=function(e){var i={page:e.data.page};e.data.page2&&(i.page2=e.data.page2),i.pageString=p(i),t.emit(yudu_events.ALL,yudu_events.THUMBNAILS.PAGE_CHANGED,this,i)};return{EMITTER_NAME:"thumbnails",init:l,makeSettingsAvailableForBrandableThumbnails:u,makeFunctionsAvailableForBrandableThumbnails:d}}),define("utils/cssUtils",[],function(){return{applyPixelLimitToCssDimension:function(t,e){if("string"==typeof t){var i=t.trim();return!i.length||i.length<=2||"px"!==i.substring(i.length-2)?t:(i=parseInt(i),"number"==typeof i&&""+i!="NaN"?Math.min(i,e)+"px":"auto")}}}}),define("ui/search",["events","constants","jquery","config","resources","api","interactions","shared/localisation","utils/statistics","utils/cssUtils","ui/uiTools","shared/utils/appUtils"],function(t,e,i,n,r,s,o,a,h,c,l,u){var d,f,g,p,m,v,y,b,_,w,T,x=i("#yudu_desktopSearchResultsContainer"),S=i("#yudu_closeSearchResults"),C=i("#yudu_desktopLocalSearch"),E=i("#yudu_desktopArchiveSearch"),O=i("#yudu_desktopSearchButtonContainer"),A=i("#yudu_mobileLocalSearch"),P=i("#yudu_mobileArchiveSearch"),k=i("#yudu_mobileSearchButtonContainer"),L=i("#yudu_mobileSearchBackground"),I=i("#yudu_mobileSearchContainer"),D=i("#yudu_iOSHelperContainer"),M=null,j=function(){R(),n.isDesktop?(window.yudu_searchFunctions={setBrandableSearchComponents:N,positionDesktopSearchResults:H,customiseDesktopSearchResults:U},t.emit(yudu_events.ALL,yudu_events.TOOLBAR.SEARCH_READY)):F(),t.yuduOn(L,n.clickAction,st),t.yuduOn(I,"touchmove",function(t){t.preventDefault()}),l.enableScrollingWithoutDocumentBouncing(D)},R=function(){d=i("#yudu_mobileSearchText"),f=i("#yudu_mobileSearchGo");var t=e.toolbarIconBasePath+(n.shouldUseHighRes?e.toolbarIconHighResPrefix:"")+"search"+e.toolbarIconFileExtension;f.css("background-image","url("+t+")"),g=i(n.isDesktop?"#yudu_desktopNoResults":"#yudu_mobileNoResults"),p=i(n.isDesktop?"#yudu_desktopSearching":"#yudu_mobileSearching"),m=i(n.isDesktop?"#yudu_desktopSearchResultsList":"#yudu_mobileSearchResultsList")},N=function(t,e){d=i(t),f=i(e),F()},F=function(){t.yuduOn(d,"keydown",G),t.yuduOn(d,"focus",function(){o.setAllowKeyNavigation(!1)}),t.yuduOn(d,"blur",function(){o.setAllowKeyNavigation(!0)}),t.yuduOn(S,"click",t.callback(this,J)),t.yuduOn(d,n.clickAction,function(){I.focus(),d.focus()}),t.yuduOn(f,n.clickAction,t.callback(this,function(){W(v)})),z()},B=function(t){if(n.isDesktop)var e=t?E:C,i=t?C:E;else var e=t?P:A,i=t?A:P;e.addClass("yudu_activeSearchButton"),i.removeClass("yudu_activeSearchButton")},H=function(t,e){var i=n.width/n.pixelDensity-x.width();x.css("top",t.top);var r=c.applyPixelLimitToCssDimension(t.left,i);r&&x.css("left",r),x.css("bottom",t.bottom);var s=c.applyPixelLimitToCssDimension(t.right,i);s&&x.css("right",s),x.css("border-radius",e.topLeft+" "+e.topRight+" "+e.bottomRight+" "+e.bottomLeft)},U=function(t){x.css("background-color",t)},z=function(){var e=r.yuduBook.settings.archiveSearchEnabled;if(u.deviceType.isAndroid()||u.deviceType.isMetro()||!e)return O.remove(),void k.remove();if(t.yuduOn(C,n.clickAction,t.callback(this,it)),t.yuduOn(E,n.clickAction,t.callback(this,nt)),t.yuduOn(A,n.clickAction,t.callback(this,it)),t.yuduOn(P,n.clickAction,t.callback(this,nt)),localStorage.results){B(!0),y=JSON.parse(localStorage.getItem("results"));var i=JSON.parse(localStorage.getItem("searchQuery"));localStorage.removeItem("results"),localStorage.removeItem("searchQuery"),d.val(i),v=!0,T={},_=[];for(var s=0,o=y.length;s<o;s++)r.yuduBook.settings.id==y[s].bookId?(y[s].sameBook=!0,_.push(y[s].page-1),X(_[_.length-1],2)):y[s].sameBook&&(y[s].sameBook=!1);x.show(),Q()}else B(!1)},G=function(t){13==t.which&&W(v)},W=function(t){document.activeElement.blur(),(w=d.val())&&(p.show(),g.hide(),(n.isDesktop?m:D).empty(),m.hide(),$(),n.isDesktop&&x.show(),y=[],T={},h.search({searchPhrase:w}),q(t))},q=function(t){var e=r.yuduBook.settings,n=e.searchUrl,s={bookId:e.id,query:w,platform:"html",format:"xml",numberOfResultsToFetch:10,numberOfResultsAlreadyFetched:Object.keys(T).length,archiveSearch:t,useNewEncoding:!0};i.post(n,s,V,"xml")},V=function(t){_=[];var e=parseInt(i(t).find("searchResults").find("book").children("bookid").text());if(i(t).find("searchResults").find("book").children("match").each(function(){var t=parseInt(i(this).children("matchbookid").text()),n=i(this).children("pagelabel").text(),s=parseInt(i(this).find("page").text());e!=t||r.wordPositions[s-1]||_.push(s-1);var o=i(this).find("text").text();o=o.replace(/(\+)+/g," ");for(var a,h=/<hit>([^\s]*)<\/hit>/g,c=d.val(),l=[];a=h.exec(o);)l.push(a[1]);var u=i(this).children("bookname").text(),f=i(this).children("liveurl").text();y.push({bookName:u,bookUrl:f,page:s,text:o,pageLabel:n,hits:l,query:c});var g=y.length-1;e!=t?(y[g].sameBook=!1,y[g].bookId=t):(y[g].sameBook=!0,y[g].bookId=e)}),b="true"==i(t).find("searchResults").find("moreResults").text(),0==_.length)Q();else for(var n=0,s=_.length;n<s;n++)X(_[n],2)},X=function(t,n){i.ajax({url:e.wordPositionsFolder+t+".http",type:"GET",headers:{"Content-Type":"application/text",Accept:"application/text"},contentType:"application/text",dataType:"text",success:function(e){Y(t,e)},error:function(){n>0?X(t,--n):Z(t)}})},Y=function(t,e){for(var i={},n=e.split("&"),s=0;s<n.length;s++)i[n[s].substr(1,n[s].indexOf("=")-1)]=n[s].substr(n[s].indexOf("=")+1).split("%3C");r.wordPositions[t]=i,Z(t)},Z=function(t){_.splice(_.indexOf(t),1),0==_.length&&Q()},Q=function(){if(p.hide(),0==y.length)g.show();else{m.show();for(var t=0;t<y.length;t++)if(y[t].sameBook){var e=r.wordPositions[y[t].page-1],s=[];i(y[t].hits).each(function(){for(var t=encodeURIComponent(this.toLowerCase()),n=e&&e[t]?e[t]:[],r=0,o=n.length;r<o;r++)i.inArray(n[r],s)<0&&s.push(n[r])});for(var o=T[y[t].page]||[],a=0,h=s.length;a<h;a++)i.inArray(s[a],o)<0&&o.push(s[a]);T[y[t].page]=o}if(K(),n.isDesktop)for(var c in T)if(T.hasOwnProperty(c)){var l=c-(n.hasIntroPage?0:1);M.pages[l].removeSearchOverlayLevel(),M.pages[l].createSearchOverlayLevel(T[c])}}},K=function(){var e=m.is(":visible")?(n.isDesktop?m:D).children().length:0;if(y.length-e<10&&b)q();else{p.hide();for(var r=e,s=Math.min(e+10,y.length);r<s;r++){var o=parseInt(y[r].page-(n.hasIntroPage?0:1)),h=document.createElement("div");h.className="yudu_searchResult",y[r].isClickThrough&&(h.className="yudu_searchResult yudu_clickThrough",y[r].isClickThrough=!1),(n.isDesktop?m:D).append(h);var c=document.createElement("p");if(c.className="yudu_resultPage",y[r].sameBook){var l=M.pages[o];l.encrypted&&n.decryptionKey&&l.decrypt(n.decryptionKey),c.innerHTML=a.get("search.page")+y[r].pageLabel}else c.innerHTML=y[r].bookName+", "+a.get("search.page")+y[r].pageLabel;t.yuduOn(i(h),"click",t.callback(this,tt(o,y,r))),h.appendChild(c);var u=document.createElement("p");u.className="yudu_resultText",u.innerHTML=y[r].text.replace(/<hit>/g,"<span class='yudu_hitText'>").replace(/<\/hit>/g,"</span>"),h.appendChild(u)}e>0&&!n.isDesktop&&D.scrollTop(D.scrollTop()+10),(b||y.length-e-10>0)&&(n.isDesktop?m:D).scroll(function(){i(this).scrollTop()+i(this).height()+30>this.scrollHeight&&(i(this).off("scroll"),p.show(),K())})}},J=function(){S.off("click",t.callback(this,J)),x.hide(),$()},$=function(){t.unsubscribe(t.ALL,t.PAGE_CHANGED);for(var e=0;e<M.pages.length;e++)M.pages[e].removeSearchOverlayLevel()},tt=function(e,i,r){var s=i[r];return function(){if(!s.sameBook)return s.isClickThrough=!0,localStorage.results=JSON.stringify(i),localStorage.searchQuery=JSON.stringify(s.query),void window.open(s.bookUrl,"_blank");var r=M.shifter.getCentreTray().hasPage(e);if(r||M.goToPage(e),!n.isDesktop){var o=e+(n.hasIntroPage?0:1);M.pages[e].createSearchOverlayLevel(T[o]),e-1>=0&&T[o-1]&&M.pages[e-1].createSearchOverlayLevel(T[o-1]),e+1<M.pages.length&&T[o+1]&&M.pages[e+1].createSearchOverlayLevel(T[o+1]),st(),t.subscribe(t.ALL,t.PAGE_CHANGED,t.callback(this,$))}r&&(M.shifter.getCentreTray().zoom(-100,0,0),M.shifter.getCentreTray().flashSearchOverlays())}},et=function(){o.setAllowKeyNavigation(!1),I.slideDown(function(){d.focus()}),L.show()},it=function(){v=!1,rt(v)},nt=function(){v=!0,rt(v)},rt=function(t){B(t),J(),W(t)},st=function(){document.activeElement.blur(),o.setAllowKeyNavigation(!0),I.hide(),L.hide()};return{init:j,setReader:t.callback(this,function(t){M=t}),showMobileSearch:et,removeSearchHighlights:$}}),define("shared/loader",["jquery","events"],function(t,e){return new function(){self=this;var i=[],n=-1;self.fetchJson=function(e){var i={Accept:"application/json"}
;e.parameters.noCacheControlHeader||(i["Cache-control"]="no-cache"),t.ajax({url:e.parameters.src,type:"GET",headers:i,dataType:"json",cache:!1,success:function(t){s(e,t)},error:function(){o(e)}})},self.fetchImage=function(t){var i=new Image;i.onload=e.callback(this,s,t,i),i.onerror=e.callback(this,o,t),i.src=t.parameters.src},self.fetchIFrame=function(t){var i=document.createElement("iframe");i.id=t.parameters.id,i.onload=e.callback(this,s,t,i),i.onerror=e.callback(this,o,t),i.style.display="none",i.src=t.parameters.src,document.body.appendChild(i)},self.fetchHtml=function(e){t.ajax({url:e.parameters.src,type:"GET",headers:{Accept:"text/html"},dataType:"html",success:function(t){s(e,t)},error:function(){o(e)}})},self.makeAction=function(t,e,n,r,s,o){o=o||!1,s=s||0,r=r||null;var a={name:t,method:e,parameters:n,retries:s,onComplete:r,optional:o,done:!1,failed:!1};i.push(a)};var r=function(t){t.method(t)},s=function(n,r){if(n.done=!0,!n.failed&&n.onComplete&&n.onComplete(r),0==t.grep(i,function(t){return!t.done}).length){if(t.grep(i,function(t){return t.failed}).length>0)return void e.emit("loadingActions",e.CRITICAL_ERROR,this,{});self.loadNextStep()}},o=function(t){if(t.retries-=1,t.retries>0)return void r(t);t.optional||(t.failed=!0),s(t)};self.loadNextStep=function(){var t=self.getAllSteps();if(!(n>=t.length-1))if(i=[],n+=1,t[n](),i.length>0)for(var e=0,s=i.length;e<s;e++)r(i[e]);else self.loadNextStep()},self.getAllSteps=function(){return[]}}}),define("shared/global/document",[],function(){return document}),define("shared/global/screen",[],function(){return screen}),define("shared/global/window",[],function(){return window}),define("has",[],function(){return function(){return!1}}),define("shared/device",["shared/global/document","shared/global/screen","shared/global/window","has"],function(t,e,i,n){var r=null,s={desktop:"desktop",tablet:"tablet",phone:"phone"},o=function(){var n=this;n.types=s;var o=null;n.setupLibraries=function(t){r=t},n.startDeviceDetectionAsyncChecks=function(){var t={};return"getBattery"in i.navigator&&(t.batteryManagerPromise=i.navigator.getBattery().then(h)),t},n.classify=function(){if(r){if(r.ios)return r.iphone?s.phone:s.tablet;if(r.mobile)return s.phone;if(r.tablet)return s.tablet}var t=new a;return!n.mayBeTouchCapable()&&t.mayBe(s.desktop)?s.desktop:(!0===o&&t.eliminate(s.desktop),t.bestGuess())};var a=function(t){var i=this,n=function(){for(var t in s)s.hasOwnProperty(t)&&(i[t]=!0,i.count++)},r=function(t){for(var e in s)s.hasOwnProperty(e)&&(i[e]=t.mayBe(e),i[e]&&i.count++)};i.eliminate=function(t){s[t]==t&&i.mayBe[t]&&(i[t]=!1,i.count--)},i.mayBe=function(t){return i[t]},i.bestGuess=function(){if(i.count<=1)return i.byElimination();var t=Math.sqrt(Math.pow(e.width,2)+Math.pow(e.height,2));return t<864?i.byElimination(!0):t>2016?i.byElimination(!1):s.tablet},i.byElimination=function(t){if(t){if(i.mayBe(s.phone))return s.phone;if(i.mayBe(s.tablet))return s.tablet;if(i.mayBe(s.desktop))return s.desktop}else{if(i.mayBe(s.desktop))return s.desktop;if(i.mayBe(s.tablet))return s.tablet;if(i.mayBe(s.phone))return s.phone}return s.tablet},function(){i.count=0,t instanceof a?r(t):n()}()};n.mayBeTouchCapable=function(){return"ontouchstart"in i||i.navigator.pointerEnabled&&i.navigator.maxTouchPoints>1||i.navigator.msPointerEnabled&&i.navigator.msMaxTouchPoints>1||i.DocumentTouch&&t instanceof DocumentTouch};var h=function(t){t&&"boolean"==typeof t.charging&&(o=t.dischargingTime!=1/0)}},a=new o;return a}),define("utils/loadingActions",["jquery","events","config","constants","resources","shared/loader","utils/userOptions","shared/localisation","shared/device","utils/tools","utils/encryptedResourceFetchingUtils"],function(t,e,i,n,r,s,o,a,h,c,l){var u=s.fetchJson,d=s.fetchImage,f=s.fetchIFrame,g=s.fetchHtml,p=s.makeAction,m=s.loadNextStep;s.getAllSteps=function(){return[b,_,T,x,y,w,S,C]};var v=null,y=function(){if(o.shouldShowInformationBox()&&!r.yuduBook.settings.infoScreenDisabled&&"true"!=i.getFromQuery("preventInfoPage")){var t=h.mayBeTouchCapable()?n.informationTouch:n.informationDesktop;p("infoPage",f,{src:t,id:"yudu_infoFrame"},q)}},b=function(){p("yuduBook",u,{src:v},U,n.maxYuduBookFetchAttempts)},_=function(){if(c.isThisAnApp()){var t=i.getFromQuery("contentDecryptionKey");return void(t&&z({contentDecryptionKey:t}))}var e={nodeId:r.yuduBook.settings.id.toString(),isPreview:r.yuduBook.settings.preview.toString(),isWebReader:r.yuduBook.settings.isWebReader.toString()},n=c.addToUrlQueryString(r.yuduBook.settings.contentDecryptionKeyUrl,e);p("contentDecryptionKey",u,{src:n,noCacheControlHeader:!0},z)},w=function(){p("playButtonTranslucent",d,{src:n.playButtonTranslucentUrl},L),p("overlayBackground",d,{src:n.overlayBackgroundUrl},E),p("tileError",d,{src:n.tileErrorUrl},O),p("tileBackground",d,{src:n.tileBackgroundUrl},A),p("placeholderBackground",d,{src:n.placeholderBackgroundUrl},P),p("playButton",d,{src:n.playButtonUrl},k)},T=function(){p("loadingConfig",u,{src:n.brandingConfigFiles.loading},j,n.maxYuduBookFetchAttempts),p("toolbarConfig",u,{src:n.brandingConfigFiles.toolbar},I,n.maxYuduBookFetchAttempts),p("thumbnailsConfig",u,{src:n.brandingConfigFiles.thumbnails},D,n.maxYuduBookFetchAttempts),p("drawingToolbarsConfig",u,{src:n.brandingConfigFiles.drawingToolbars},M,n.maxYuduBookFetchAttempts)},x=function(){p("loadingHtml",g,{src:n.baseResourcesFolder+r.loadingConfig.mainHtmlFilePath},B,n.maxYuduBookFetchAttempts),p("toolbarHtml",g,{src:n.baseResourcesFolder+r.toolbarConfig.mainHtmlFilePath},R,n.maxYuduBookFetchAttempts),p("thumbnailsHtml",g,{src:n.baseResourcesFolder+r.thumbnailsConfig.mainHtmlFilePath},N,n.maxYuduBookFetchAttempts),p("drawingToolbarsHtml",g,{src:n.baseResourcesFolder+r.drawingToolbarsConfig.mainHtmlFilePath},F,n.maxYuduBookFetchAttempts)},S=function(){var t=r.yuduBook.settings.hasPriceList,e=r.yuduBook.settings.hasRollovers,i=r.yuduBook.settings.showYuduLogo,s=r.yuduBook.settings.showCustomLogo;t&&p("priceList",u,{src:n.priceListUrl},G,n.maxOptionalJsonFetchAttempts,!0),e&&p("rollovers",u,{src:n.rolloversUrl},W,n.maxOptionalJsonFetchAttempts,!0),s?p("logo",d,{src:n.baseResourcesFolder+r.yuduBook.settings.customLogoFilename},H):i&&p("logo",d,{src:n.logoUrl},H)},C=function(){e.emit("loadingActions",e.LOADING_ACTIONS_DONE,this,{})},E=function(t){r.overlayBackground=t},O=function(t){r.tileError=t},A=function(t){r.tileBackground=t},P=function(t){r.placeholderBackground=t},k=function(t){r.playButton=t},L=function(t){r.playButtonTranslucent=t},I=function(t){r.toolbarConfig=t},D=function(t){r.thumbnailsConfig=t},M=function(t){r.drawingToolbarsConfig=t},j=function(t){r.loadingConfig=t},R=function(t){r.toolbarHtml=t},N=function(t){r.thumbnailsHtml=t},F=function(t){r.drawingToolbarsHtml=t},B=function(t){r.loadingHtml=t},H=function(t){r.logo=t},U=function(t){r.setYuduBook(t.yuduBook),e.emit("loadingActions",e.YUDU_BOOK_LOADED,this,r.yuduBook)},z=function(t){t.contentDecryptionKey&&(i.contentDecryptionHeaders={"x-amz-server-side-encryption-customer-algorithm":"AES256","x-amz-server-side-encryption-customer-key":t.contentDecryptionKey,"x-amz-server-side-encryption-customer-key-MD5":l.getBase64MD5DigestOfBase64Message(t.contentDecryptionKey)})},G=function(t){t&&(r.priceList=t.items)},W=function(t){t&&(r.rollovers=t.items)},q=function(i){r.infoPage=i,a.localiseHtml(t(i).contents()),e.emit("loadingActions",e.INFORMATION_LOADED,this,{})};return{runLoadingActions:function(t){v=t,m()},EMITTER_NAME:"loadingActions"}}),define("utils/resizeHelper",["constants","config/pageMode","config","resources","events","shared/utils/utils","bowser"],function(t,e,i,n,r,s,o){return new function(){var a,h,c=this,l=!1,u=1,d=1;c.preinit=function(){f(),p()};var f=function(){a=document.createElement("div"),a.classList.add("yuduUtilsResizeHelper"),a.classList.add("yuduUtilsSizeDetector"),document.body.appendChild(a)},g=function(){return h||(h=document.getElementById("yudu_reader")),h};c.browserViewportWidth=function(){return a.offsetWidth},c.browserViewportHeight=function(){return a.offsetHeight},c.viewportZoomFactor=function(){return document.documentElement.offsetWidth/window.innerWidth},c.touchZoomFactorState=function(){u=d,d=c.viewportZoomFactor()},c.isIosAndHasViewportZoomed=function(){c.touchZoomFactorState();var t=!!o.ios&&d>1.0541328;return t!=l&&(l=t,r.emit("utils/resizeHelper",r.BROWSER_ZOOM_LEVEL_CHANGED,c,{isZoomedIn:l})),l},c.updateSize=function(){var s=0,o=0;i.isDesktop?"left"==n.toolbarConfig.desktopPosition||"right"==n.toolbarConfig.desktopPosition?o=parseInt(n.toolbarConfig.desktopSize):s=parseInt(n.toolbarConfig.desktopSize):i.disableToggleToolbar&&("left"==n.toolbarConfig.touchPosition||"right"==n.toolbarConfig.touchPosition?o=parseInt(n.toolbarConfig.touchSize):s=parseInt(n.toolbarConfig.touchSize));var a=c.browserViewportWidth()-o,h=c.browserViewportHeight()-s;c.isIosAndHasViewportZoomed()||(h=Math.min(h,window.innerHeight)),i.pixelDensity=window.devicePixelRatio||1;var l=document.getElementById("yudu_readerCanvas").getContext("2d"),u=l.webkitBackingStorePixelRatio||l.mozBackingStorePixelRatio||l.msBackingStorePixelRatio||l.oBackingStorePixelRatio||l.backingStorePixelRatio||1,d=i.pixelDensity/u;i.canvasResizeWidth=a,i.canvasResizeHeight=h,i.width=a*d,i.height=h*d;var f=i.width>i.height?t.orientations.landscape:t.orientations.portrait;f!=i.orientation&&(e.autoSetTwoPageMode(),i.orientation=f,window.yudu_commonSettings&&(window.yudu_commonSettings.orientation=f)),i.readerYOffset=g().offsetTop,r.emit(r.ALL,r.RESIZE,c,{width:i.width,height:i.height})};var p=function(){if(o.ios&&!(o.osversion&&parseInt(o.osversion)<10)){console.log("Preparing to handle iOS 10 zoom mode.");var t=s.performanceCriticalDebounce(c.updateSize,300),e=function(){return c.touchZoomFactorState(),d!=u},i=function(){e()&&t()};window.addEventListener("scroll",i)}};c.preinit()}}),define("shared/utils/versionUtils",[],function(){return new function(){var t=this;t.components={reader:"reader",app:"app",appAndroid:"appAndroid",appWindows:"appWindows"},t.VersionNumber=function(t,e,i,n,r){var s=this;s.class="VERSION_NUMBER";var o=function(t){var e=0;if(void 0!==t){try{e=parseInt(t)}catch(t){}isNaN(e)&&(e=0)}return e};s.component=t,s.major=o(e),s.minor=o(i),s.build=o(n),s.revision=o(r),s.isValid=function(){return s.major>0||s.minor>0||s.build>0},s.assertCanCompareTo=function(t){if(!t.class||t.class!==s.class)throw"Invalid comparison target"},s.compareTo=function(t){return s.assertCanCompareTo(t),s.major>t.major?1:s.major<t.major?-1:s.minor>t.minor?1:s.minor<t.minor?-1:s.build>t.build?1:s.build<t.build?-1:s.revision>t.revision?1:s.revision<t.revision?-1:0}},t.VersionNumber.prototype.toString=function(){var e=[this.major,this.minor,this.build].join(".");return this.component!==t.components.reader&&(e+="."+this.revision),e},t.parseVersionString=function(e,i){var n,r,s,o=i.split("."),a=o[0];return o.length>1&&(n=o[1]),o.length>2&&(r=o[2]),o.length>3&&(s=o[3]),new t.VersionNumber(e,a,n,r,s)}}}),define("version",["config","shared/utils/appUtils","shared/utils/utils","shared/utils/versionUtils"],function(t,e,i,n){var r="4.3.6";11==r.length&&"-!version"===r.substring(0,9)&&"!-"===r.substring(9,11)&&(r="9007199254740991");var s=function(t){var i=this,r=n.parseVersionString(n.components.reader,t),s=!1;i.features={phoneview:"phoneview"};var o={};i.getVersion=function(){return r},i.getAppVersion=function(){return!1===s&&(s=e.getVersion(n)),s},i.getForComponent=function(t){switch(t){case n.components.reader:return i.getVersion();case n.components.app:case n.components.appAndroid:case n.components.appWindows:if(i.getAppVersion().component===t)return i.getAppVersion()}return!1};var a=function(t){var e=h[t];if(e)for(var n in e)if(e.hasOwnProperty(n)){var r=i.getForComponent(n);if(r&&r.compareTo(e[n])<0)return void(o[t]=!1)}o[t]=!0};i.checkFeatureCompatibility=function(t){return void 0===o[t]&&a(t),o[t]};var h={};!function(t,e,i){h[t]||(h[t]={}),h[t][e]=new n.VersionNumber(e,i[0],i[1],i[2],i[3])}(i.features.phoneview,n.components.appAndroid,[10,2])},o=new s(r);return Object.defineProperty(window,"yudu_readerVersion",{get:function(){return o.getVersion().toString()}}),o}),define("controllers/articleViewController",["constants","config","resources","events","version","utils/appWrapHook","utils/tools","shared/ui/messageBox","ui/uiTools","jquery"],function(t,e,i,n,r,s,o,a,h,c){return new function(){var c=this,l=!1;c.EMITTER_NAME="articleViewController";var u=function(){"error49"===e.getFromQuery("phoneviewCriticalError")&&d()},d=function(){a.displayByCode("phoneview.criticalError",t.messageTypes.failure)},f=function(t){o.articlesAvailable()&&(r.checkFeatureCompatibility(r.features.phoneview)&&o.isThisAnApp()&&o.deviceType.isAndroid()?(t.src=window.location.toString(),t.bookId=i.yuduBook.settings.id,s.sendMessageWithParameters("openArticleView",t)):o.openURL(g(t),!1))};c.openAtPage=function(t){var e;void 0!==t&&(e=m(_(t))),f(e)},c.openAtArticle=function(t,e){var i={article:t,mode:"article"};e&&(i.page=""+_(e)),f(i)};var g=function(t){return o.addToUrlQueryString(p(),t)},p=function(){return o.addQueryStringToURL(t.articleViewerPage,"origin=reader")},m=function(t){var e=""+t,i={page:e};return e===l.page&&(i.article=l.article,void 0!==l.articleIndex&&(i.articleIndex=""+l.articleIndex)),i},v=function(t){"exitArticleView"===t.data.messageType&&y(t.data.parameters)},y=function(t){b(t),h.hideLightbox(!0),n.emit(c.EMITTER_NAME,n.TOGGLE_KEY_NAVIGATION,this,{isAllowed:!0})},b=function(t){t.pageIndex>=0?(l=t,n.emit(c.EMITTER_NAME,n.GOTO_PAGE,this,{pageNumber:t.pageIndex+1})):("error49"===t.phoneviewCriticalError&&d(),l=!1)},_=function(t){return t.getPageNumber()+(e.hasIntroPage?0:1)};!function(){n.subscribe(n.ALL,n.MESSAGE_RECEIVED_FROM_ARTICLE_VIEW,v),n.subscribe(n.ALL,n.QUERY_STRING_PARSED,u),s.registerHandlerForMessageWithParameters("exitArticleView",function(t,e){b(e)}),s.registerHandlerForMessageWithParameters("exitedArticleView",function(t,e){b(e)})}()}}),define("utils/rememberedPageUtils",["shared/storage","config"],function(t,e){var i=function(i){if(e.rememberedPageDisabled)return-1;var n=r(i),s=t.getItem(n);if(t.removeItem(n),!s)return-1;var o=s.split("-"),a=Number(o[0].trim()),h=Number(o[1].trim()),c=new Date(a);return c.setFullYear(c.getFullYear()+1),c.getTime()<(new Date).getTime()?-1:h},n=function(i,n){e.rememberedPageDisabled||t.setItem(r(i),(new Date).getTime()+"-"+n)},r=function(t){return"rememberedPage"+t};return{getRememberedPage:i,setRememberedPage:n}}),define("reader",["events","config","constants","resources","controllers/pageController","controllers/shifter","fetching/fetchHandler","model/htmlOverlay","model/ugc/note","ui/bookmarks","ui/highlightingCanvas","ui/loading","ui/notes","ui/thumbnails","ui/search","ui/uiTools","utils/tools","utils/loadingActions","utils/statistics","shared/localisation","utils/appWrapHook","utils/resizeHelper","controllers/articleViewController","config/pageMode","shared/device","utils/rememberedPageUtils","jquery","easel"],function(t,e,i,n,r,s,o,a,h,c,l,u,d,f,g,p,m,v,y,b,_,w,T,x,S,C,E,O){return{Reader:function(u){var f=this;this.elementId=u,this.tilesLoaded=!1,this.informationIsShowing=!1,this.wasInTwoUpMode=!1,e.setIsDesktop(!S.mayBeTouchCapable()),this.load=function(i){var n=m.parseQueryString(window.location.search.substr(1));e.setQueryObject(n),t.emit("reader",t.QUERY_STRING_PARSED,this,{}),t.subscribe(v.EMITTER_NAME,t.LOADING_ACTIONS_DONE,t.callback(this,this.loadAfterYuduBook),!1),t.subscribe(v.EMITTER_NAME,t.CRITICAL_ERROR,t.callback(this,this.criticalError),!1),t.subscribe(yudu_events.ALL,yudu_events.LOADING.DISPLAY_PROGRESS,this.handleTilesLoaded,!1),v.runLoadingActions(i)},this.handleTilesLoaded=function(t){100!=t.data.percentage||f.tilesLoaded||(f.tilesLoaded=!0)},this.loadAfterYuduBook=function(i){this.yuduBook=n.yuduBook,o.setReader(this),g.setReader(this),n.yuduBook.settings.bookmarksEnabled&&(e.bookmarksEnabled=!0,c.setReader(this)),n.yuduBook.settings.notesEnabled&&(e.notesEnabled=!0,d.setReader(this)),n.yuduBook.settings.highlightsEnabled&&(e.highlightsEnabled=!0,l.setReader(this)),n.yuduBook.settings.requestEmailAddress&&(e.emailCollectionEnabled=!0),this.yuduBook.settings.urlNavigationTarget&&(e.urlNavigationTarget=this.yuduBook.settings.urlNavigationTarget),e.disableExtraZoom=!!this.yuduBook.settings.disableExtraZoom,e.rememberedPageDisabled=!!this.yuduBook.settings.rememberedPageDisabled,e.editionListUrl=this.yuduBook.settings.editionListUrl,e.highlightLinksOnLoadEnabled=this.yuduBook.settings.highlightLinksOnLoadEnabled,e.disableToggleToolbar=this.yuduBook.settings.disableToggleToolbar,e.tryToOpenWebOverlaysInNewWindow=!1!==n.yuduBook.settings.openWebOverlaysInNewWindow,e.pageTurnEnabled=n.yuduBook.settings.pageTurnEnabled,e.pageTurnAudioEnabled=n.yuduBook.settings.pageTurnAudioEnabled,e.pageTurnDurationMs=n.yuduBook.settings.pageTurnDurationMs,!1===this.yuduBook.settings.allowHtmlMediaContentDownload&&(t.yuduOn(E(document),"contextmenu","video",function(t){t.preventDefault()}),t.yuduOn(E(document),"contextmenu","audio",function(t){t.preventDefault()})),e.overlap=this.yuduBook.settings.overlap||e.overlap,this.storeOverlaySettings(this.yuduBook.settings),this.setReaderBackground(this.yuduBook.settings),y.setYuduBookSettings(this.yuduBook.settings),this.yuduBook.settings.showCustomLogo?e.logoLinkUrl=this.yuduBook.settings.customLogoUrl:this.yuduBook.settings.showYuduLogo&&(e.logoLinkUrl=this.yuduBook.settings.yuduLogoUrl),e.editionLaunchableHtmlEnabled=!!this.yuduBook.settings.editionLaunchableHtml,e.orderFormEnabled=this.yuduBook.orderForm&&this.yuduBook.orderForm.orderFormEnabled,this.pages=[];var u;this.pageIndexOffset=1,this.yuduBook.settings.introPage&&(u=this.yuduBook.settings.introPage,this.pages.push(new r.PageController(0,u,this.yuduBook.zoomSettings)),e.hasIntroPage=!0,this.pageIndexOffset=0);for(var f=0;f<this.yuduBook.pages.length;f++){var p=e.hasIntroPage?f+1:f;u=this.yuduBook.pages[f],this.pages.push(new r.PageController(p,u,this.yuduBook.zoomSettings))}n.wordPositions=new Array(this.yuduBook.pages.length),this.shifter=new s.Shifter(this.pages),this.stage.addChild(this.shifter.container),a.setShifter(this.shifter),h.setShifter(this.shifter),x.configureFromYuduBook(this.yuduBook),this.handleDirectlyAccessedPage();var m=this.getStartPage();this.updateReaderSize(),this.shifter.init(m),this.updatePageTitle(),this.updateCurrentHistoryState();var v=this.getCurrentPage(),b=this.pages.indexOf(v),w={};if(e.twoPageMode&&(0!=b||e.hasIntroPage)){w=(b+(e.hasIntroPage?0:1))%2==1?{startPage:v.getPageNumber()-1,startLabel:this.pages[b-1].getPageLabel(),secondStartPage:v.getPageNumber(),secondStartLabel:v.getPageLabel()}:b+1<this.pages.length?{startPage:v.getPageNumber(),startLabel:v.getPageLabel(),secondStartPage:v.getPageNumber()+1,secondStartLabel:this.pages[b+1].getPageLabel()}:{startPage:v.getPageNumber(),startLabel:v.getPageLabel()}}else w={startPage:v.getPageNumber(),startLabel:v.getPageLabel()};if(w.indexOffset=this.pageIndexOffset,y.newVisit(w),this.updatePageNavigation(),C.setRememberedPage(this.yuduBook.settings.id,this.shifter.getCurrentPageNumber()),n.yuduBook.settings.prioritiseNavControls){var T=1;E("#yudu_interactiveOverlays").find("*").each(function(){var t=parseInt(E(this).css("z-index"),10);t>T&&(T=t)}),T+=1,E("#yudu_nextPageNav").css("z-index",T),E("#yudu_previousPageNav").css("z-index",T)}this.tryOverlayReveal(),_.init(this.hasEncryptedPage()),t.emit("reader",t.READER_LOADED,this,{success:i.data.success},!0)},this.tryOverlayReveal=function(){null==this.shifter||this.informationIsShowing||this.shifter.performReveal()},this.informationLoaded=function(){this.informationIsShowing=!0},this.informationHidden=function(){this.informationIsShowing=!1,this.tryOverlayReveal()},this.storeOverlaySettings=function(t){e.emailLinkOverlayColour=t.emailOverlayColour,e.phoneOverlayColour=t.phoneOverlayColour,e.pageLinkOverlayColour=t.pageLinkOverlayColour,e.webLinkOverlayColour=t.webOverlayColour,e.productOverlayColour=t.productCodeOverlayColour,e.launchableHtmlOverlayColour=t.htmlLightboxOverlayColour,e.contentOverlayColour=t.contentOverlayColour,e.overlayAlpha=t.defaultOverlayAlpha/100,e.transparentProductOverlays=t.transparentProductOverlays},this.setReaderBackground=function(t){var i=n.loadingConfig,r=i.bgTopColour?i.bgTopColour:t.bgTop,s=i.bgBottomColour?i.bgBottomColour:t.bgBottom;r&&s&&(this.element[0].style.background="-webkit-gradient(linear, left top, left bottom, color-stop(0%, #"+r+"), color-stop(100%, #"+s+"))",this.element[0].style.background="-webkit-linear-gradient(top, #"+r+",#"+s+")",this.element[0].style.background="-o-linear-gradient(top, #"+r+",#"+s+")",this.element[0].style.background="-moz-linear-gradient(top, #"+r+",#"+s+")",this.element[0].style.background="-ms-linear-gradient(top, #"+r+",#"+s+")",this.element[0].style.background="linear-gradient(to bottom, #"+r+",#"+s+")",E(document.body)[0].style.background="#"+r,e.bgTopColour=r,e.bgBottomColour=s)},this.updatePageTitle=function(){var t=this.shifter.getCurrentPageNumber(),i=this.yuduBook.settings.name+(t?" :: "+(t+(e.hasIntroPage?0:1)):"");document.title=i},this.criticalError=function(){this.criticalErrorElement||(this.criticalErrorElement=E('<div id="errorCover"><div id="criticalFail">'+b.get("criticalError")+"</div></div>"),E(document.body).append(this.criticalErrorElement))},this.start=function(){O.Ticker.setFPS(i.fps),O.Ticker.timingMode=O.Ticker.RAF,t.yuduAddEventListener(O.Ticker,"tick",t.callback(this,this.tick)),t.emit("reader",t.READER_STARTED,this,{},!0)},this.tick=function(t){this.shifter.update(t.delta)&&this.tilesLoaded&&this.stage.update(t)},this.getSafePageNumber=function(t){var e=-1;if("number"==typeof t)t>=0&&t<this.pages.length&&(e=t);else for(var i=0;i<this.pages.length;i++)if(this.pages[i].getPageLabel()==t){e=i;break}return e},this.isFirstPage=function(){return this.shifter.isFirstPage()},this.isLastPage=function(){return this.shifter.isLastPage()},this.nextPage=function(){this.shifter.goNextPage()},this.nextPageUnanimated=function(){this.isLastPage()||this.shifter.goNextPageUnanimated()},this.previousPage=function(){this.shifter.goPreviousPage()},this.previousPageUnanimated=function(){this.isFirstPage()||this.shifter.goPreviousPageUnanimated()},this.getCurrentPage=function(){return this.shifter.getCurrentPage()},this.getPagesInCurrentTray=function(){return this.shifter.getCentreTray().pages},this.getPage=function(t){var e=this.getSafePageNumber(t-this.pageIndexOffset);return e<0?null:this.shifter.getPage(e)},this.twoUpToggle=function(){e.fitOnlyWidth&&e.setFitOnlyWidth(!1),x.togglePageMode()},this.fitToWidth=function(t){if(e.fitOnlyWidth)return this.wasInTwoUpMode&&x.setTwoPageMode(!0),void e.setFitOnlyWidth(t);this.wasInTwoUpMode=e.twoPageMode,x.setTwoPageMode(!1),this.shifter.willNewFitHaveVisibleEffect()?e.setFitOnlyWidth(t):this.shifter.triggerFalseZoom()},this.goFullscreen=function(){var t=document.body;t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},this.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},this.resize=function(){this.stage.canvas.width=e.width,this.stage.canvas.height=e.height,this.stage.canvas.style.width=e.canvasResizeWidth+"px",this.stage.canvas.style.height=e.canvasResizeHeight+"px",this.interactionDiv.width=e.width,this.interactionDiv.height=e.height,this.interactionDiv.style.width=e.canvasResizeWidth+"px",this.interactionDiv.style.height=e.canvasResizeHeight+"px",this.scaleOverlayContainers()},this.resizeReader=function(){this.resize(),this.updateReaderSize()},this.goToPageResponder=function(t){var e=parseInt(t.data.pageNumber);this.goToPage(e-this.pageIndexOffset)},this.goToPage=function(t){var e=this.getSafePageNumber(t);e>0&&(e-=(e+this.pageIndexOffset)%this.shifter.getPagesPerTray()),e>=0&&this.shifter.goToPage(e)},this.handleTap=function(n){var r={x:n.data.center.pageX*e.pixelDensity,y:(n.data.center.pageY-e.readerYOffset)*e.pixelDensity};return this.shifter.handleTap(r)?void n.data.stopDetect():r.x<e.width*i.turnPageScreenTapThreshold?(n.data.stopDetect(),void this.previousPage()):r.x>e.width*(1-i.turnPageScreenTapThreshold)?(n.data.stopDetect(),void this.nextPage()):void t.emit("reader",t.SHOWHIDE_TOOLBAR,this,{toggle:!0})},this.scaleOverlayContainers=function(){var t=1/e.pixelDensity;this.overlayContainer.style.webkitTransform="scale("+t+","+t+")",this.overlayContainer.style.transform="scale("+t+","+t+")",this.overlayContainer.style.width=e.canvasResizeWidth+"px",this.overlayContainer.style.marginLeft=-1*e.canvasResizeWidth*(1-t)/2+"px",this.interactiveOverlayContainer.style.webkitTransform="scale("+t+","+t+")",this.interactiveOverlayContainer.style.transform="scale("+t+","+t+")",this.interactiveOverlayContainer.style.width=e.canvasResizeWidth+"px",this.interactiveOverlayContainer.style.marginLeft=-1*e.canvasResizeWidth*(1-t)/2+"px",this.highlightingCanvasContainer.style.webkitTransform="scale("+t+","+t+")",this.highlightingCanvasContainer.style.transform="scale("+t+","+t+")",this.highlightingCanvasContainer.style.width=e.canvasResizeWidth+"px",this.highlightingCanvasContainer.style.marginLeft=-1*e.canvasResizeWidth*(1-t)/2+"px",this.pageHighlightsContainer.style.webkitTransform="scale("+t+","+t+")",this.pageHighlightsContainer.style.transform="scale("+t+","+t+")",this.pageHighlightsContainer.style.width=e.canvasResizeWidth+"px",this.pageHighlightsContainer.style.marginLeft=-1*e.canvasResizeWidth*(1-t)/2+"px",this.noteContainer.style.webkitTransform="scale("+t+","+t+")",this.noteContainer.style.transform="scale("+t+","+t+")",this.noteContainer.style.width=e.canvasResizeWidth+"px",this.noteContainer.style.marginLeft=-1*e.canvasResizeWidth*(1-t)/2+"px"},this.updateReaderSize=function(){w.updateSize();for(var t=E("img",this.interactionDiv),e=0,i=t.length;e<i;e++)E(t[e]).css("top",(E(this.interactionDiv).height()-t[e].height)/2+"px")},this.element=E("#"+u),this.canvas=E('<canvas id="'+u+'Canvas" width="'+e.width+'" height="'+e.height+'"style="width: '+e.canvasResizeWidth+"px; height: "+e.canvasResizeHeight+'px"></canvas>'),this.element.append(this.canvas),this.overlayContainer=E("#yudu_overlays")[0],this.interactiveOverlayContainer=E("#yudu_interactiveOverlays")[0],this.highlightingCanvasContainer=E("#yudu_highlightingCanvasContainer")[0],this.pageHighlightsContainer=E("#yudu_pageHighlightsContainer")[0],this.noteContainer=E("#yudu_notes")[0],this.scaleOverlayContainers(),this.interactionDiv=E("#yudu_interactionDiv")[0],this.interactionDiv.style.width=e.width+"px",this.interactionDiv.style.height=e.height+"px",this.interactionDiv.style.position="absolute",this.interactionDiv.style.backgroundColor="rgba(0, 0, 0, 0)",this.stage=new O.Stage(this.canvas.attr("id")),this.stage.snapToPixel=!0,this.pageChanged=function(e){this.shifter.getCentreTray().containsEncryptedPage()&&t.emit("reader",t.SHOW_LOGIN,this,{});var i=e.data.page,n=this.pages[i],r={newPage:n.getPageNumber(),newPageLabel:n.getPageLabel(),indexOffset:this.pageIndexOffset};if(e.data.page2){var s=this.pages[e.data.page2];r.newPage2=s.getPageNumber(),r.newPageLabel2=s.getPageLabel()}y.pageView(r),((history&&history.state?history.state.page:0)||0)!=i&&(this.updatePageTitle(),this.pushPageHistory(i),this.updatePageNavigation(),C.setRememberedPage(this.yuduBook.settings.id,this.shifter.getCurrentPageNumber()))},this.pushPageHistory=function(t){var e=m.getLastPathComponent();if(null!=e){var i=m.getPrettyQueryString(t+this.pageIndexOffset);i&&i.length>2&&(e+="?"+i),history&&history.pushState&&history.pushState({page:t},document.title,e)}},this.updatePageNavigation=function(){var t=E("#yudu_previousPageNav"),i=E("#yudu_nextPageNav"),n=S.mayBeTouchCapable(),r="true"===e.getFromQuery("hideEditionNavigationArrows");n&&r||this.shifter.isFirstPage()?t.hide():t.show(),n&&r||this.shifter.isLastPage()?i.hide():i.show()},this.historyChange=function(t){if(this.shifter){if(this.criticalErrorElement)return void location.reload();t.data.page!=this.shifter.getCurrentPageNumber()&&(E("#yudu_lightboxBackground").is(":visible")&&p.hideLightbox(),this.shifter.goToSnapPage(t.data.page)),this.updatePageTitle()}},this.updateCurrentHistoryState=function(){history&&history.replaceState&&history.replaceState({page:this.shifter.getCurrentPageNumber()},document.title)},this.mouseOverEnabled=!0,this.deactivateMouseMove=function(){this.mouseOverEnabled=!1,E("#yudu_interactionDiv").off("mousemove")},this.fadeInOrOutOverlayIfNecessary=function(t){for(var e=0,i=this.shifter.getCentreTray().pages.length;e<i;e++)this.shifter.getCentreTray().pages[e].overlayLevel.handleMouseInteraction(t)},this.getNextFreePage=function(){var t=this.getCurrentPage().getPageNumber(),e=E.grep(this.pages.slice(t),function(t){return!t.encrypted});return e.length>0&&e[0].getPageNumber()+1},this.hasEncryptedPage=function(){return E.grep(this.pages,function(t){return t.encrypted}).length>0},this.isShowingEncryptedPage=function(){return this.shifter.getCentreTray().containsEncryptedPage()},this.isUgcEnabled=function(){return e.bookmarksEnabled||e.highlightsEnabled||e.notesEnabled},this.openArticleView=function(){var t;this.shifter&&(t=this.getCurrentPage()),T.openAtPage(t)},this.handleOpenArticle=function(t){t.data&&t.data.article&&T.openAtArticle(t.data.article,this.getCurrentPage())},this.handleDirectlyAccessedPage=function(){if(history&&history.pushState&&void 0==e.getFromQuery("page")){var t=m.getLastPathComponent();if(null!=t){var i=t.match(/^[\d]+/);i&&0!=i.length&&m.addPageToQueryObjectAndPushPageHistory(parseInt(i[0]),!1)}}},this.getStartPage=function(){var t=-1,i=e.getFromQuery("page"),n=C.getRememberedPage(this.yuduBook.settings.id);return void 0!=i&&i>-1?t=this.getSafePageNumber(Number(e.getFromQuery("page"))-this.pageIndexOffset):n>-1&&(t=this.getSafePageNumber(n),m.addPageToQueryObjectAndPushPageHistory(n+(e.hasIntroPage?0:1),!0)),t<=-1&&(t=this.getSafePageNumber(Number(this.yuduBook.settings.defaultStartPage)||0)),t},this.loadingFinished=function(){o.activatePreloader()},t.subscribe(t.ALL,t.TAP,t.callback(this,this.handleTap),!1),t.subscribe(t.ALL,t.RESIZE,t.callback(this,this.resize),!1),t.subscribe(t.ALL,t.GOTO_NEXT_PAGE,t.callback(this,this.nextPage),!1),t.subscribe(t.ALL,t.GOTO_PREVIOUS_PAGE,t.callback(this,this.previousPage),!1),t.subscribe(t.ALL,t.GOTO_PAGE,t.callback(this,this.goToPageResponder),!0),t.subscribe(t.ALL,t.PAGE_CHANGED,t.callback(this,this.pageChanged),!0),t.subscribe(t.ALL,t.HISTORY_CHANGE,t.callback(this,this.historyChange),!0),t.subscribe(t.ALL,t.MOUSE_MOVE_STOP,t.callback(this,this.deactivateMouseMove),!1),t.subscribe(t.ALL,t.LOADING_FINISHED,t.callback(this,this.loadingFinished),!1),t.subscribe(t.ALL,t.OPEN_ARTICLE,t.callback(this,this.handleOpenArticle),!1),t.subscribe(t.ALL,t.INFORMATION_LOADED,t.callback(this,this.informationLoaded),!1),t.subscribe(t.ALL,t.HIDE_INFORMATION,t.callback(this,this.informationHidden),!1),this.pages=null},EMITTER_NAME:"reader"}}),define("api",["reader","events","interactions"],function(t,e,i){var n=null,r=function(e){n=new t.Reader(e),n.load("yuduBook.json")},s=function(){n.resizeReader()},o=function(t,i,n){e.emit("api",e.ZOOM,this,{direction:t,scaled:!1,x:i,y:n})},a=function(){return n.getCurrentPage()},h=function(){return n.getPagesInCurrentTray()},c=function(t){return n.getPage(t)},l=function(){return n.getCurrentPage().getPageNumber()},u=function(){return n.getCurrentPage().getPageNumber()+n.pageIndexOffset},d=function(){return n.getCurrentPage().getPageLabel()},f=function(){return n.isFirstPage()},g=function(){return n.isLastPage()},p=function(){n.nextPage()},m=function(){n.nextPageUnanimated()},v=function(){n.previousPage()
},y=function(){n.previousPageUnanimated()},b=function(){n.twoUpToggle()},_=function(t){n.fitToWidth(t)},w=function(){n.goFullscreen()},T=function(){n.exitFullscreen()},x=function(t){n.goToPage(t)},S=function(){return n.getNextFreePage()},C=function(){return n.hasEncryptedPage()},E=function(){return n.isShowingEncryptedPage()},O=function(){return n.isUgcEnabled()};return{createReader:r,resizeReader:s,zoom:o,getPage:c,getPagesInCurrentTray:h,getCurrentPage:a,getCurrentPageIndex:l,getCurrentPageNumber:u,getCurrentPageLabel:d,isFirstPage:f,isLastPage:g,nextPage:p,nextPageUnanimated:m,previousPage:v,previousPageUnanimated:y,goToPage:x,twoUpToggle:b,fitToWidth:_,goFullscreen:w,exitFullscreen:T,openArticleView:function(){n.openArticleView()},getNextFreePage:S,hasEncryptedPage:C,isShowingEncryptedPage:E,isUgcEnabled:O}}),define("ui/contents",[],function(){return{Contents:function(){this.init=function(t){window.yudu_contentsSettings={contentsData:t}}}}}),define("ui/information",["config","events","interactions","resources","utils/userOptions","shared/hammerManager","jquery"],function(t,e,i,n,r,s,o){var a=null,h=function(){e.subscribe(e.ALL,e.INFORMATION_LOADED,e.callback(this,c)),e.subscribe(e.ALL,e.HIDE_INFORMATION,e.callback(this,d))},c=function(){e.subscribe(e.ALL,e.CLOSE_ACTIVE,f),i.setAllowKeyNavigation(!1),a=n.infoPage,a.style.display="block";var t=a.contentDocument;if(t){s.createTapManager(t.body).on("tap",l);for(var r=t.getElementsByClassName("noTouch"),o=0;o<r.length;o++){s.createTapManager(r[o]).on("hammer.input",u)}}},l=function(){e.emit("information",e.HIDE_INFORMATION,this,{})},u=function(t){t.srcEvent.stopPropagation()},d=function(){e.unsubscribe(e.ALL,e.CLOSE_ACTIVE,f,!1);var t=o(a).contents().find("#noRepeatShow");t&&t.prop("checked")&&r.setNoShowInformationBox(),a&&(a.blur(),o(a).hide(),a=null),e.emit("information",e.SHOWHIDE_TOOLBAR,this,{show:!0}),i.setAllowKeyNavigation(!0),e.emit("information",e.SHOW_LOGIN,this,{})},f=e.callback(this,d);return{init:h}}),define("shared/rememberMeToken",["shared/utils/eventUtils","shared/utils/utils","jquery"],function(t,e,i){var n=!1,r=!1,s=!1,o=!1,a=!1,h=!1,c=!1,l=function(t){if(!n){var e=t.settings;r=e.id,e.authenticateWithExternalAuthId&&(s=e.authenticateWithExternalAuthId,o=e.externalAuthId),a=e.rememberMeTokenBaseUrl+e.requestSingleUseShortLifeTokenPath,n=!0}},u=function(t){for(var e=0;e<t.length;e++){var i=t[e];localStorage.setItem(i.identifier+"-rememberMeTokenKey",i.key),localStorage.setItem(i.identifier+"-rememberMeTokenSecret",i.secret)}},d=function(){var t=localStorage.getItem("bookId-"+r+"-rememberMeTokenKey"),e=localStorage.getItem("bookId-"+r+"-rememberMeTokenSecret");if(t&&e&&(h={key:t,secret:e}),s){var i=localStorage.getItem("extAuthId-"+o+"-rememberMeTokenKey"),n=localStorage.getItem("extAuthId-"+o+"-rememberMeTokenSecret");i&&n&&(c={key:i,secret:n})}return h||c},f=function(t){return t.shortLifeRememberMeTokenLogin=!0,h&&(t.editionRememberMeKey=h.key,t.editionRememberMeSecret=h.secret),c&&(t.externalAuthId=o,t.extAuthIdRememberMeKey=c.key,t.extAuthIdRememberMeSecret=c.secret),t},g=function(){h=!1,c=!1,localStorage.removeItem("bookId-"+r+"-rememberMeTokenKey"),localStorage.removeItem("bookId-"+r+"-rememberMeTokenSecret"),s&&(localStorage.removeItem("extAuthId-"+o+"-rememberMeTokenKey"),localStorage.removeItem("extAuthId-"+o+"-rememberMeTokenSecret"))},p=e.throttle(function(){if(d()){var e=f({bookId:r});i.ajax({url:a,type:"POST",dataType:"json",data:e,success:t.callback(this,m)})}},9e5),m=function(t){t.success?t.authDetails&&t.authDetails.rememberMeTokens&&u(t.authDetails.rememberMeTokens):g()};return{setup:l,storeTokenDetails:u,hasTokenDetails:d,addTokenData:f,resetTokenDetails:g,requestNewTokenDetails:p}}),define("utils/rememberMeToken",["events","shared/rememberMeToken"],function(t,e){var i=function(){t.subscribe(t.ALL,t.YUDU_BOOK_LOADED,n),t.subscribe(t.ALL,t.LOADING_FINISHED,r)},n=function(t){e.setup(t.data)},r=function(){t.subscribe(t.ALL,t.ZOOM,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.ZOOM_SCALE,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.BROWSER_ZOOM_LEVEL_CHANGED,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.TAP,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.TOUCH,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.RESIZE,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.LEVEL_DRAGGED,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.PAGE_CHANGED,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.TWO_UP_CHANGED,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.DRAG,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.DRAG_END,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.DRAG_START,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.SHOWHIDE_TOOLBAR,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.MOUSE_MOVE_STOP,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.VIEW_NOTE,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.NOTE_MOVED,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.NOTES_BACKGROUND_INTERACTION,e.requestNewTokenDetails,!0),t.subscribe(t.ALL,t.CLOSE_LIGHTBOX,e.requestNewTokenDetails,!0)},s=function(){e.resetTokenDetails(),t.emit(t.ALL,t.SHOW_LOGIN,this,{})};return{init:i,storeTokenDetails:e.storeTokenDetails,hasTokenDetails:e.hasTokenDetails,addTokenData:e.addTokenData,handleLoginFailure:s}}),define("ui/login",["api","config","constants","events","interactions","resources","shared/hammerManager","shared/storage","shared/utils/utils","utils/appWrapHook","utils/rememberMeToken","utils/statistics","shared/localisation","utils/tools","shared/tools","utils/userOptions","jquery","utils/encryptedResourceFetchingUtils"],function(t,e,i,n,r,s,o,a,h,c,l,u,d,f,g,p,m,v){var y=!1,b=!1,_=!1,w={background:m("#yudu_loginBackground"),prompt:m("#yudu_loginPrompt"),explanation:m("#yudu_loginExplanation"),usernameInput:m("#yudu_username"),passwordInput:m("#yudu_password"),response:m("#yudu_loginResponse"),form:m("#yudu_loginForm"),subscribe:m("#yudu_loginSubscribe"),resetPassword:m("#yudu_resetPassword"),loginSend:m("#yudu_loginSend")},T={},x=!1,S=!1,C=!1,E=!1,O=!0,A=function(){n.subscribe(n.ALL,n.SHOW_LOGIN,n.callback(this,L)),n.subscribe(n.ALL,n.NEEDS_BACKGROUND_LOGIN_ATTEMPT,n.callback(this,D),!0),X.registerListeners(),l.init()},P=function(){if(!C){var t=s.yuduBook.settings;y=t.authenticationUrl,e.isPreviewEdition=t.preview,C=!0}},k=function(){E=!0,P(),w.form.submit(n.callback(this,function(t){return m("input").blur(),N(),K(t)})),o.createTapManager(w.subscribe[0]).on("tap",Z),o.createTapManager(w.resetPassword[0]).on("tap",Q),n.yuduOn(w.background,"touchmove",K),o.createTapManager(w.background[0]).on("tap",R),n.yuduOn(w.prompt,"touchmove",K);var t=s.yuduBook.settings;t.useCustomLoginPrompts?(T.explanation=t.loginExplanation,T.username=t.loginUsername,T.password=t.loginPassword):!1===t.drmRequiresEmailAddress&&t.isLibraryBook?(T.explanation=d.get("login.libraryPasswordExplanation"),T.password=d.get("login.password")):t.isLibraryBook?(T.explanation=d.get("login.libraryExplanation"),T.username=d.get("login.username"),T.password=d.get("login.password")):(T.explanation=d.get("login.explanation"),T.username=d.get("login.username"),T.password=d.get("login.password")),t.subscribeButtonEnabled&&(T.subscribe=t.subscribeText,b=t.subscribeUrl),t.resetPasswordButtonEnabled&&(_=t.resetPasswordUrl),n.yuduOn(w.usernameInput,e.clickAction,function(){w.background.focus(),w.usernameInput.focus()}),n.yuduOn(w.passwordInput,e.clickAction,function(){w.background.focus(),w.passwordInput.focus()})},L=function(e){var i=t.isShowingEncryptedPage(),n=t.isUgcEnabled()&&e.data&&e.data.ugcCredentialsRequested&&s.yuduBook.settings.allowUgcToOpenLogin;if((i||n)&&!D()){if(i){if((!e.data||!e.data.noSuper)&&c.trySuperLogin())return}else{if(!n)return;if(c.tryGettingSuperCredentials())return;S=!0}O=!1,M()}},I=!1,D=h.debounce(function(t){return Y.isSetup()&&Y.hasTokenDetails()?(Y.tokenLogin(t),!0):O&&""!=H()?(U(F(V(),!0)),!0):!(!l.hasTokenDetails()||0!=I)&&(I=!0,U(l.addTokenData(B())),!0)},300,!0,!1),M=function(){if(E||k(),r.setAllowKeyNavigation(!1),n.subscribe(n.ALL,n.CLOSE_ACTIVE,J),x)return void(x=!1);S?w.explanation.text(d.get("ugc.login.explanation")):w.explanation.text(T.explanation),f.showHideElement(w.usernameInput.attr("placeholder",T.username),!(!1===s.yuduBook.settings.drmRequiresEmailAddress)),w.passwordInput.attr("placeholder",T.password),!1===s.yuduBook.settings.drmRequiresEmailAddress&&w.passwordInput.addClass("noUsername"),f.showHideElement(w.subscribe,!!b),b&&w.subscribe.text(T.subscribe),f.showHideElement(w.resetPassword,!!_&&!s.yuduBook.settings.isLibraryBook),w.background.show(),w.prompt.slideDown(),j(),setTimeout(function(){w.usernameInput.focus()},0)},j=function(){n.isSubscribed(n.ALL,n.RESIZE,j,!1)||n.subscribe(n.ALL,n.RESIZE,j,!1);var t=Math.max(w.resetPassword.children("div").height(),w.loginSend.children("div").height())+"px";w.resetPassword.height(t),w.loginSend.height(t)},R=function(){n.unsubscribe(n.ALL,n.CLOSE_ACTIVE,J,!1),w.background.hide(),w.prompt.hide(),w.response.hide(),r.setAllowKeyNavigation(!0)},N=function(){q("login.contactingServer",!1),U(F(V()))},F=function(t,e){var i=B(e);return i.readerUid=t.readerUid,i.emailAddress=t.username,i.password=t.password,i},B=function(t){var i={bookId:s.yuduBook.settings.id,preview:e.isPreviewEdition,libraryCookie:t?H():""};return S&&(i.ignoreMissingKey=!0,S=!1),i},H=function(){for(var t=decodeURIComponent(document.cookie),e=t.split(";"),i=0;i<e.length;i++){for(var n=e[i];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf("library_session="))return encodeURIComponent(n.substring("library_session=".length))}return""},U=function(t){m.ajax({url:y,type:"POST",dataType:"json",data:t,success:n.callback(this,z),error:function(){O?(O=!1,M()):q("login.auth.genericError",!0)}})},z=function(t){if(!t.success)return I=!1,G(t),void(e.isLoggedIn=!1);e.isLoggedIn=!0,t.authDetails&&t.authDetails.rememberMeTokens&&l.storeTokenDetails(t.authDetails.rememberMeTokens),t.key?(e.decryptionKey=t.key,t.contentDecryptionKey&&(e.contentDecryptionHeaders={"x-amz-server-side-encryption-customer-algorithm":"AES256","x-amz-server-side-encryption-customer-key":t.contentDecryptionKey,"x-amz-server-side-encryption-customer-key-MD5":v.getBase64MD5DigestOfBase64Message(t.contentDecryptionKey)}),n.emit("login",n.LOGIN_SUCCESS,this,{credentials:X.getCredentials()})):n.emit("login",n.LOGIN_DETAILS_CHANGED,this,{credentials:X.getCredentials()}),t.tokenLoginResponse&&Y.handleSuccess(t),R()},G=function(t){t.tokenLoginResponse?Y.handleFailure():t.shortLifeRememberMeTokenResponse?l.handleLoginFailure():O?(O=!1,M()):q("login.auth.errors."+t.error,!0)},W=function(t){e.isUserLoggedIn=!0,z({key:t.data.key,success:t.data.success})},q=function(t,e){w.response.text(d.get(t)),e?(w.response.removeClass(i.messageTypes.success),w.response.addClass(i.messageTypes.failure)):(w.response.removeClass(i.messageTypes.failure),w.response.addClass(i.messageTypes.success)),w.response.show()},V=function(){return X.newCredentials(g.getUniqueUserId(),w.usernameInput.val(),w.passwordInput.val()),X.getCredentials()},X=function(){var t=!1,e=!1,i=!1,r=!1,s=!1,o=!1,a=!1,h=!1,c=!1,u=function(){n.subscribe(n.ALL,n.CHANGE_FOR_LOGIN_DETAILS,n.callback(this,d)),n.subscribe(n.ALL,n.APP_LOGIN_SUCCESS,n.callback(this,W)),n.subscribe(n.ALL,n.REQUEST_LOGIN_DETAILS,n.callback(this,f))},d=function(t){if(t&&t.data&&t.data.superLoginSuccess){var e=t.data.subscriberId||!1;p(t.data.tokenKey,t.data.tokenId,t.data.subscriberEmail,e,t.data.deviceId,t.data.username,t.data.password),n.emit("login",n.LOGIN_DETAILS_CHANGED,this,{credentials:m()})}},f=function(){v()&&n.emit("login",n.LOGIN_DETAILS_CHANGED,this,{credentials:m()})},g=function(n,o,a){e=!1,i=n,r=o,s=a,c=!1,t=r.length>0&&s.length>0},p=function(n,l,u,d,f,g,p){e=!0,o=n,a=l,h=u,c=d,i=f,r=g,s=p,t=r.length>0&&s.length>0||h.length>0&&o&&a},m=function(){var t={readerUid:i,username:r,password:s};return y()&&(t.tokenKey=o,t.tokenId=a,t.subscriberEmail=h),l.hasTokenDetails()&&(t.rememberMeTokenKey=l.hasTokenDetails().key),t},v=function(){return t},y=function(){return e};return{registerListeners:u,newCredentials:g,getHasCredentials:v,getCredentialsAreFromSuper:y,getCredentials:m,getUsername:function(){return v()&&r?r:""},getSubscriberId:function(){return c},setSubscriberId:function(t){c=t}}}(),Y=function(){var t={noTokenAvailable:"noTokenAvailable",queryString:"queryString",localStorage:"localStorage"},i=t.noTokenAvailable,r=!1,o=!1,h=!1,c=!1,l=!1,u=function(){return r||(P(),o=s.yuduBook.settings.id,d()?i=t.queryString:p()&&(i=t.localStorage),r=!0),!0},d=function(){var t=e.getFromQuery("yuduAuthToken");return!!t&&(c=t,h=e.getFromQuery("yuduAuthId"),!0)},f=function(){c&&(a.setItem(o+"-yuduAuthToken",c),a.setItem(o+"-yuduAuthId",h))},p=function(){var t=a.getItem(o+"-yuduAuthToken");return!!t&&(c=t,h=a.getItem(o+"-yuduAuthId"),!0)},m=function(){a.removeItem(o+"-yuduAuthToken",c),a.removeItem(o+"-yuduAuthId",h)},v=function(t){l=!t&&t,U(y())},y=function(){var t=B();return t.readerUid=g.getUniqueUserId(),t.tokenId=h,t.tokenValue=c,t.tokenLoginRequest=!0,t};return{isSetup:u,hasTokenDetails:function(){return!!c},tokenLogin:v,handleSuccess:function(t){if(l=!1,t.authToken){var e=t.authToken.ssoToken,i=t.authToken.uid;!0===t.authToken.internalUse&&e&&(c=e,h=i,f())}},handleFailure:function(){h=!1,c=!1,i===t.localStorage&&m();var e=l||{};n.emit("*",n.SHOW_LOGIN,this,e),l=!1}}}(),Z=function(){u.action({actionType:u.events.subscribed,extraInfo:b}),f.openURL(b,"_self",!0)},Q=function(){q("login.reset.contactingServer",!1);var t={nodeId:s.yuduBook.settings.id,emailAddress:w.usernameInput.val()};m.ajax({url:_,type:"POST",dataType:"json",data:t,success:n.callback(this,function(t){t.success?void 0!=t.url?(w.response.hide(),f.openURL(t.url,!0)):q("login.reset.sent",!1):q("login.reset.errors."+t.error,!0)}),error:function(){q("login.reset.genericError",!0)}})},K=function(t){return t.preventDefault(),!1},J=n.callback(this,R);return{init:A,getCurrentUserCredentials:X.getCredentials,getHasCredentials:X.getHasCredentials,getCredentialsAreFromSuper:X.getCredentialsAreFromSuper,getSubscriberId:X.getSubscriberId,setSubscriberId:X.setSubscriberId,EMITTER_NAME:"login"}}),define("shared/ui/sharing",["shared/constants","shared/config","shared/events","shared/resources","shared/localisation","shared/utils/appUtils","shared/utils/urlUtils","shared/ui/messageBox","shared/hammerManager","jquery"],function(t,e,i,n,r,s,o,a,h,c){var l,u,d=!1,f=!1,g=!1,p={},m=null,v=function(){return c("#shareContainer")},y=function(){i.LOADING_ACTIONS_DONE&&i.subscribe(i.ALL,i.LOADING_ACTIONS_DONE,i.callback(this,_),!1)},b=function(t){m=t,p={emailPopup:{background:c("#yudu_shareBackground"),container:c("#yudu_emailShareContainer"),fromAddress:c("#yudu_fromAddress"),toAddress:c("#yudu_toAddress"),comment:c("#yudu_comment"),form:c("#yudu_emailForm"),cancel:c("#yudu_emailCancel"),send:c("#yudu_emailSend")}},h.createTapManager(p.emailPopup.background[0]).on("tap",P)};c("input, textarea").click(function(){c("#yudu_emailSend").focus(),this.focus()});var _=function(){var e=n.yuduBook.settings.sharing;if(e){if(r.localiseHtml(v()),r.localiseHtml(p.emailPopup.container),d=e.url,f=n.yuduBook.settings.id,i.yuduOn(c(".yudu_noDrag"),"touchmove",i.callback(this,function(){return!1})),window.yudu_sharingFunctions={},window.yudu_sharingSettings={},window.yudu_sharingSettings.toolbarIconBasePath=t.toolbarIconBasePath,(e.emailEnabled||e.twitter||e.facebook||e.linkedIn)&&(window.yudu_sharingFunctions.togglePage=k),e.emailEnabled){window.yudu_sharingFunctions.shareEmail=w,p.emailPopup.form.submit(i.callback(this,function(t){return c("input").blur(),t.stopPropagation(),T(),!1}));h.createTapManager(p.emailPopup.cancel[0]).on("tap",P),l=e.emailSubject,u=e.emailBody}e.twitter&&(window.yudu_sharingFunctions.shareTwitter=i.callback(this,S,e.twitter),window.yudu_sharingSettings.twitterIconPath=t.baseRequiredFolder+"twitter.png"),e.facebook&&(window.yudu_sharingFunctions.shareFacebook=i.callback(this,S,e.facebook),window.yudu_sharingSettings.facebookIconPath=t.baseRequiredFolder+"facebook.png"),e.linkedIn&&(window.yudu_sharingFunctions.shareLinkedIn=i.callback(this,S,e.linkedIn),window.yudu_sharingSettings.linkedInIconPath=t.baseRequiredFolder+"linkedIn.png")}},w=function(){i.subscribe(i.ALL,i.CLOSE_ACTIVE,L),i.emit("sharing",i.SHARE_EMAIL_DIALOG_OPEN,this,{}),p.emailPopup.container.slideDown(),p.emailPopup.background.show()},T=function(){s.isThisAnApp()&&!e.liveUrl&&""!==e.liveUrl?(i.subscribe("appWrapHook",i.LIVE_URL_RECEIVED,x),appWrapHook.tryGettingLiveUrl(f)):x()},x=function(){i.unsubscribe("appWrapHook",i.LIVE_URL_RECEIVED,x);var t=p.emailPopup.toAddress.val(),e=E().url,n=u.replace(/#to#/gi,t);n=n.replace(/#from#/gi,p.emailPopup.fromAddress.val()),n=n.replace(/#url#/gi,"<a href='"+e+"'>"+e+"</a>"),n=n.replace(/#comments#/gi,p.emailPopup.comment.val()),o.openURL("mailto:"+t+"?subject="+encodeURIComponent(l)+"&body="+encodeURIComponent(c(n).text()),!1),i.emit("sharing",i.SHARE_TO.EMAIL,this,{shareUrl:e}),P()},S=function(t){t&&(s.isThisAnApp()&&!e.liveUrl&&""!==e.liveUrl?(i.subscribe("appWrapHook",i.LIVE_URL_RECEIVED,function(){C(t)}),appWrapHook.tryGettingLiveUrl(f)):C(t))},C=function(e){var i=E(),n={bookId:f,siteId:e,url:i.url,thumbnailUrl:i.thumbnailUrl,waitTime:4},r=!1;O(n,function(t,e){r||(r=!0,A(t,e))},function(){r||(r=!0,a.displayByCode("sharing.genericError",t.messageTypes.failure))}),setTimeout(function(){r||(r=!0,a.displayByCode("sharing.genericError",t.messageTypes.failure))},t.shareSiteTimeout)},E=function(){if(!m||"function"!=typeof m)return{};var t=e.liveUrl||location.protocol+"//"+location.host+location.pathname;return m(!g,t)},O=function(t,e,n){c.ajax({url:d,type:"POST",dataType:"json",data:t,success:i.callback(this,e,t),error:n})},A=function(e,s){if(s.success){var h=n.yuduBook.settings.sharing.facebook,c=n.yuduBook.settings.sharing.twitter,l=n.yuduBook.settings.sharing.linkedIn;h&&e.siteId==h?i.emit("sharing",i.SHARE_TO.FACEBOOK,this,{shareUrl:e.url}):c&&e.siteId==c?i.emit("sharing",i.SHARE_TO.TWITTER,this,{shareUrl:e.url}):l&&e.siteId==l&&i.emit("sharing",i.SHARE_TO.LINKED_IN,this,{shareUrl:e.url}),o.openURL(s.url,!0)}else{var u=r.get(s.error?"sharing.errors."+s.error:"sharing.genericError");a.display(u,t.messageTypes.failure)}},P=function(){i.unsubscribe(i.ALL,i.CLOSE_ACTIVE,L),i.emit("sharing",i.SHARE_EMAIL_DIALOG_CLOSE,this,{}),p.emailPopup.background.hide(),p.emailPopup.container.hide()},k=function(t){g=t},L=i.callback(this,P);return{init:b,bindEvents:y,_private:{getShareUrl:E,shareSite:S,togglePage:k}}}),define("ui/sharing",["events","constants","config","resources","api","interactions","utils/statistics","shared/ui/sharing","jquery"],function(t,e,i,n,r,s,o,a,h){function c(){var n=this;this._private=a._private,n.bindEvents=function(){a.bindEvents(),t.subscribe(t.ALL,t.SHARE_EMAIL_DIALOG_OPEN,l),t.subscribe(t.ALL,t.SHARE_EMAIL_DIALOG_CLOSE,u),t.subscribe(t.ALL,t.SHARE_TO.FACEBOOK,d),t.subscribe(t.ALL,t.SHARE_TO.TWITTER,f)},n.init=function(){a.init(h)};var h=function(t,e){var n=i.hasIntroPage?1:0,s=t?n:r.getCurrentPageIndex();s=Math.max(n,s);var o=s,a=s;i.hasIntroPage||++o;var h="?page="+o,l=a+".jpg";return{url:e+h,thumbnailUrl:c(e)+l}},c=function(t){return t.slice(0,t.lastIndexOf("/")+1)+e.baseThumbnailFolder},l=function(t){s.setAllowKeyNavigation(!1)},u=function(t){s.setAllowKeyNavigation(!0)},d=function(t){g(o.events.facebooked,t.data.shareUrl)},f=function(t){g(o.events.tweeted,t.data.shareUrl)},g=function(t,e){var i={actionType:t,extraInfo:e};o.action(i)}}return new c}),define("ui/drawingToolbars",["api","events","config","constants","resources","utils/tools","utils/statistics","ui/uiTools","ui/highlightingCanvas","shared/localisation","jquery"],function(t,e,i,n,r,s,o,a,h,c,l){var u=!1,d=!1,f=(l("#yudu_reader"),l("#yudu_pageHighlightsContainer")),g=l("#yudu_interactionDiv"),p=function(){m(),v(),y()},m=function(){window.yudu_drawingToolbarFunctions={inEraserMode:u,inPanMode:d}},v=function(){window.yudu_drawingToolbarFunctions={setDrawingBrushColour:b,setDrawingBrushWidth:_,setHighlightingMode:D,goToPreviousPage:C,goToNextPage:S,hasNextPage:E,hasPreviousPage:O,clearAll:L,undo:P,redo:k,cancel:A,save:I,penMode:w,eraserMode:T,panMode:x}},y=function(){var t,e,s,o,a;i.isDesktop?(t=r.drawingToolbarsConfig.desktopPosition,o=r.drawingToolbarsConfig.desktopEditOptionsToolbarSize,a=r.drawingToolbarsConfig.desktopDrawingOptionsToolbarSize):(t=r.drawingToolbarsConfig.touchPosition,o=r.drawingToolbarsConfig.touchEditOptionsToolbarSize,a=r.drawingToolbarsConfig.touchDrawingOptionsToolbarSize),e="topBottom"==t?"height":"width";var h=e+": calc(100% - "+(parseInt(o.replace("px",""))+parseInt(a.replace("px","")))+"px) !important;";s="topBottom"==t?"top":"left";var u=s+" : "+o+";";document.styleSheets[0].insertRule("#yudu_reader.yudu_drawingMode { "+h+u+" }",1);var d=l("#yudu_drawingToolbars");d.append(r.drawingToolbarsHtml),window.yudu_commonFunctions.injectJavascript(n.baseResourcesFolder+r.drawingToolbarsConfig.mainJavascriptFilePath),c.localiseHtml(d)},b=function(t){h.setBrushColour(t)},_=function(t){h.setBrushWidth(t)},w=function(){u=!1,d=!1,h.eraserMode(!1),g.hide()},T=function(){u=!0,d=!1,h.eraserMode(!0),g.hide()},x=function(){d=!0,u=!1,h.eraserMode(!1),g.show()},S=function(){E()&&t.nextPageUnanimated()},C=function(){O()&&t.previousPageUnanimated()},E=function(){return!t.isLastPage()},O=function(){return!t.isFirstPage()},A=function(){h.cancel(),D(!1)},P=function(){h.undo()},k=function(){h.redo()},L=function(){h.clearCanvas()},I=function(){h.saveCanvas(),D(!1)},D=function(i){if(i){if(!h.pagesSupportHighlights())return;h.showHighlightingCanvas(),f.hide(),d||g.hide(),l("#yudu_reader").addClass("yudu_drawingMode"),l("#yudu_notes").hide(),t.resizeReader()}else h.hideHighlightingCanvas(),f.show(),g.show(),l("#yudu_reader").removeClass("yudu_drawingMode"),l("#yudu_notes").show(),t.resizeReader();e.emit(yudu_events.ALL,yudu_events.DRAWING_TOOLBARS.TOGGLE_TOOLBARS,this,{show:i})};return{init:p}}),define("model/editionLaunchableHtml",["events","ui/uiTools","utils/tools","resources","api"],function(t,e,i,n,r){return{EditionLaunchableHtml:function(s){var o,a,h,c=this,l=s.extraQueryString,u=!!s.interactionEnabled,d=!!s.requiresUserCredentials,f=i.addQueryStringToURL(s.src,l);c.showContent=function(){g(),$(o).show()};var g=function(){var i={w:80,h:80,callback:t.callback(c,function(){$(".yudu_throbberWrapper",$(o)).hide(),$(".yudu_lightboxContent",$(o)).css("visibility","visible"),a=$(o).find("iframe")[0],m(),t.subscribe(t.ALL,t.PUBLIC_API_LOGIN_STATE_CHANGED,v)}),src:f,interactionEnabled:u,addCloseButton:!0,animated:!1,closeCallback:y};o=e.createIframeLightbox(i),u||(p("80%","80%"),t.yuduOn($(h),"click touchstart",t.callback(c,b)),h.style.position="fixed",h.style.top="10%",h.style.right="10%"),h&&o.appendChild(h)},p=function(t,i){e.hideIframeScrollBars($("iframe",o)[0]),h=document.createElement("div"),h.style.width=t,h.style.height=i,h.style.opacity="0",h.style.backgroundColor="black"},m=function(){if(d&&a.contentWindow){var t=window.yudu_readerApi.getCredentials(),e={editionTitle:n.yuduBook.settings.name,editionId:n.yuduBook.settings.id,editionCurrentPage:r.getCurrentPageNumber()};t.username&&t.password?a.contentWindow.postMessage({messageName:"userCredentialsAvailable",username:t.username,password:t.password,context:e},"*"):a.contentWindow.postMessage({messageName:"userCredentialsNotAvailable"},"*")}},v=t.callback(c,m),y=t.callback(c,function(){t.unsubscribe(t.ALL,t.PUBLIC_API_LOGIN_STATE_CHANGED,v)}),b=function(t){t.stopPropagation(),t.preventDefault()}}}}),define("ui/toolbar",["api","events","config","constants","resources","ui/sharing","ui/search","ui/uiTools","ui/orderForm","ui/drawingToolbars","ui/notes","ui/bookmarks","utils/tools","utils/statistics","shared/localisation","shared/utils/stringUtils","model/editionLaunchableHtml","jquery"],function(t,e,i,n,r,s,o,a,h,c,l,u,d,f,g,p,m,v){var y=!0,b=null,_=v("#controls"),w=function(){x(),S(),T()},T=function(){var t,e,s;if(i.isDesktop){var o=v("#yudu_reader");t=r.toolbarConfig.desktopPosition,e=r.toolbarConfig.desktopSize,s="top"==t||"bottom"==t?"height":"width",o.css(t,e),o.css(s,"calc(100% - "+e+")")}else{t=r.toolbarConfig.touchPosition,e=r.toolbarConfig.touchSize,s="top"==t||"bottom"==t?"height":"width";for(var a=document.styleSheets[0],h=("cssRules"in a?a.cssRules:a.rules),c="#yudu_toolbar"+p.capitalizeFirstLetter(t),l=-10-parseInt(e),u=0,d=h.length;u<d;u++)if(h[u].selectorText.indexOf(c)>-1&&h[u].selectorText.indexOf(".touchDevice")>-1&&h[u].selectorText.indexOf(".hide")>-1){h[u].style[t]=l+"px";break}}_=v("#yudu_toolbar"+p.capitalizeFirstLetter(t)),_.css(s,e),i.isDesktop||(_.addClass("touchDevice"),_.css("transition",t+" 0.4s")),_.append(r.toolbarHtml),window.yudu_commonFunctions.injectJavascript(n.baseResourcesFolder+r.toolbarConfig.mainJavascriptFilePath),g.localiseHtml(_)},x=function(){var t=r.yuduBook.settings;window.yudu_toolbarSettings={toolbarIconBasePath:n.toolbarIconBasePath,iconHighResPrefix:n.toolbarIconHighResPrefix,iconFileExtension:n.toolbarIconFileExtension,shouldUseHighRes:a.shouldUseHighRes(),hasDownloadablePdfAndIsNotApp:t.hasDownloadablePdf&&!d.isThisAnApp(),searchEnabled:t.searchEnabled,editionListEnabled:t.editionListEnabled&&!d.isThisAnApp(),sharing:{emailEnabled:t.sharing.emailEnabled,twitter:t.sharing.twitter,facebook:t.sharing.facebook,linkedIn:t.sharing.linkedIn},pageModeStopToggle:i.pageModeStopToggle,fullscreenModeEnabled:i.fullscreenCompatible&&t.fullscreenModeEnabled,bookmarksEnabled:i.bookmarksEnabled,notesEnabled:i.notesEnabled,highlightsEnabled:i.highlightsEnabled,hasArticles:r.yuduBook.settings.phoneview&&r.yuduBook.settings.phoneview.isAvailable,orderFormEnabled:i.orderFormEnabled,editionLaunchableHtmlEnabled:i.editionLaunchableHtmlEnabled,userPreferences:{pageTurn:{show:i.pageTurnEnabled,default:i.pageTurnEnabled}}},t.showCustomLogo?window.yudu_toolbarSettings.logoSrc=n.baseResourcesFolder+r.yuduBook.settings.customLogoFilename:t.showYuduLogo&&(window.yudu_toolbarSettings.logoSrc=n.logoUrl),window.yudu_toolbarSettings.logoLinkUrlExists=!!i.logoLinkUrl},S=function(){var e=r.yuduBook.settings;window.yudu_toolbarFunctions={zoomInClicked:O(this,t.zoom,1,i.width/2,i.height/2),zoomOutClicked:O(this,t.zoom,-1,i.width/2,i.height/2),prevPageClicked:O(this,t.previousPage),nextPageClicked:O(this,t.nextPage),twoUpToggleClicked:O(this,t.twoUpToggle),fitWidthClicked:O(this,A,!0),fitPageClicked:O(this,A,!1),exitFullscreen:O(this,t.exitFullscreen),articlesAvailable:d.articlesAvailable,openPhoneView:O(this,H),setAutoHide:P},i.logoLinkUrl&&(window.yudu_toolbarFunctions.logoClicked=O(this,F)),e.editionListEnabled&&!d.isThisAnApp()&&(window.yudu_toolbarFunctions.editionListClicked=O(this,k)),e.hasDownloadablePdf&&(window.yudu_toolbarFunctions.downloadPdfClicked=O(this,B,e.downloadablePdf)),e.searchEnabled&&!i.isDesktop&&(window.yudu_toolbarFunctions.searchClicked=O(this,M)),i.fullscreenCompatible&&e.fullscreenModeEnabled&&(window.yudu_toolbarFunctions.goFullscreen=O(this,t.goFullscreen)),i.orderFormEnabled&&(window.yudu_toolbarFunctions.shoppingCartClicked=O(this,N)),i.bookmarksEnabled&&(window.yudu_toolbarFunctions.bookmarkClicked=O(this,j,!1)),i.notesEnabled&&(window.yudu_toolbarFunctions.notesClicked=O(this,R,!1)),i.editionLaunchableHtmlEnabled&&(window.yudu_toolbarFunctions.editionLaunchableHtmlClicked=O(this,U,!1))},C=function(t){(t=t||!1)!=y&&(y=t,t?_.removeClass("hide"):_.addClass("hide"),t&&(D(),I()))},E=function(t){var e,n;i.disableToggleToolbar?(e=!y&&(t.data.toggle||t.data.show),n=!0):(e=!0,n=t.data.toggle?!y:!!t.data.show),e&&C(n)},O=function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(){if(y||i.isDesktop)return D(),I(),e.apply(t,n)}},A=function(n){t.fitToWidth(n),e.emit(yudu_events.ALL,yudu_events.TOOLBAR.FIT_WIDTH_OR_SCREEN_ACTION,_,{fitOnlyWidth:i.fitOnlyWidth})},P=function(t){t?b||I():D()},k=function(){var t=i.editionListUrl+"?pubId="+r.yuduBook.settings.pubId+"&editionId="+r.yuduBook.settings.id+"&bgTopColour="+i.bgTopColour+"&bgBottomColour="+i.bgBottomColour+"&textColour="+r.yuduBook.settings.editionListTextColour+"&editionListSource="+r.yuduBook.settings.editionListSource+"&windowWidth="+v(window).width()+"&windowHeight="+v(window).height(),n={w:100,h:100,callback:e.callback(this,function(){i.isDesktop&&v("iframe",v(s))[0].contentWindow.setLogo(0!=r.logo,r.logo.src,i.logoLinkUrl)}),src:t,interactionEnabled:!0,addCloseButton:!1,bgColour:"000000",animated:!0},s=a.createIframeLightbox(n);v(s).show()},L=function(){e.yuduOn(_,"touchmove",e.callback(this,function(){return!1})),e.subscribe(e.ALL,e.SHOWHIDE_TOOLBAR,E,!1),i.disableToggleToolbar||C(!1)},I=function(){i.isDesktop||i.disableToggleToolbar||(b=window.setTimeout(function(){C(!1)},n.toolbarTimeout))},D=function(){b&&(window.clearTimeout(b),b=null)},M=function(){o.showMobileSearch()},j=function(){u.toggleBookmark()},R=function(){l.showNotesCreationMode()},N=function(){h.showForDuration()},F=function(){var t=i.logoLinkUrl;f.action({actionType:f.events.logo_clicked,extraInfo:t}),d.openURL(t,!0)},B=function(t){var e=n.basePrintablesFolder+t;d.openURL(e,!0)},H=function(){t.openArticleView()},U=function(){this.launchableHtml||(this.launchableHtml=new m.EditionLaunchableHtml(r.yuduBook.settings.editionLaunchableHtml)),this.launchableHtml.showContent()};return{init:L,preInit:w}}),define("shared/commonFunctionsApi",["constants","config","events","shared/hammerManager"],function(t,e,i,n){var r={},s=function(t,e){t=t instanceof Array?t:[t];for(var i=t.length,n=Math.floor(1e3*Math.random()+1);r.hasOwnProperty(n);)n=Math.floor(1e3*Math.random()+1);r[n]=0;for(var s=0;s<i;s++){var a=$('<link rel="stylesheet" type="text/css" href="'+t[s]+'">');a.on("load",function(){o(e,i,n)}),$("head").append(a)}},o=function(t,e,i){++r[i]==e&&(delete r[i],t.call())},a=function(){i.emit(i.ALL,i.SHOWHIDE_TOOLBAR,this,{toggle:!1,show:!1})},h=function(t){var e=document.createElement("script");e.type="text/javascript",e.src=t,document.getElementsByTagName("head")[0].appendChild(e)},c=function(e){return t.baseResourcesFolder+e},l=function(t){yudu_commonSettings.width=t.data.width,yudu_commonSettings.height=t.data.height};return{init:function(){window.yudu_commonSettings=window.yudu_commonSettings||{},window.yudu_commonFunctions=window.yudu_commonFunctions||{},window.yudu_commonSettings.width=1200,window.yudu_commonSettings.height=800,window.yudu_commonSettings.pixelDensity=1,window.yudu_commonSettings.isDesktop=e.isDesktop,window.yudu_commonFunctions.loadCss=s,window.yudu_commonFunctions.injectJavascript=h,window.yudu_commonFunctions.createBrandingPath=c,window.yudu_commonFunctions.createHammerJSTapManager=n.createTapManager,window.yudu_commonFunctions.hideToolbar=a,i.subscribe(i.ALL,i.RESIZE,i.callback(this,l))}}}),define("brandableSubmodulesApi",["constants","config","events","ui/uiTools","shared/localisation","utils/tools","shared/hammerManager","easel","hammer2","jquery"],function(t,e,i,n,r,s,o,a,h,c){var l=function(){e.decryptionKey&&i.emit(i.ALL,i.DECRYPT_ALL_PAGES,this,{key:e.decryptionKey})},u=function(){window.yudu_commonSettings.toolbarLoaded=!0,i.emit(i.ALL,yudu_events.TOOLBAR.LOADED)},d=function(t){i.emit(i.ALL,i.GOTO_PAGE,this,{pageNumber:t})};return{init:function(){window.yudu_commonSettings=window.yudu_commonSettings||{},window.yudu_commonFunctions=window.yudu_commonFunctions||{},window.yudu_commonSettings.brandingFolderPath=t.baseResourcesFolder,window.yudu_commonSettings.clickAction=e.clickAction,window.yudu_commonSettings.toolbarLoaded=!1,window.yudu_commonSettings.orientation=e.orientation,window.yudu_commonSettings.hasIntroPage=e.hasIntroPage,window.yudu_commonSettings.hammerJSRecogniserPresets=o.createPresetsObject({}),window.yudu_commonSettings.createjs=a,window.yudu_commonSettings.hammerjs=h,window.yudu_commonSettings.pixelDensity=e.pixelDensity,window.yudu_commonFunctions.returnDynamicInput=s.returnDynamicInput,
window.yudu_commonFunctions.returnFunctionWithDynamicArgs=s.returnFunctionWithDynamicArgs,window.yudu_commonFunctions.decryptAllPages=l,window.yudu_commonFunctions.getLocalisedStringByCode=r.get,window.yudu_commonFunctions.enableScrollingWithoutDocumentBouncing=n.enableScrollingWithoutDocumentBouncing,window.yudu_commonFunctions.toolbarFinishedLoading=u,window.yudu_commonFunctions.createHammerJSManagerWithRecognisers=o.createManagerWithRecognisers,window.yudu_commonFunctions.createHammerJSManagerWithOptions=o.createManagerWithOptions,window.yudu_commonFunctions.createHammerJSTapManager=o.createTapManager,window.yudu_commonFunctions.goToPage=d,window.yudu_commonFunctions.updateUserPreferenceSetting=e.updateUserPreferenceSetting,i.subscribe(i.ALL,i.RESIZE,function(){yudu_commonSettings.width=e.width,yudu_commonSettings.height=e.height,i.emit(yudu_events.ALL,yudu_events.COMMON.RESIZE)}),i.subscribe(i.ALL,i.TOUCH,function(){i.emit(yudu_events.ALL,yudu_events.COMMON.TOUCH)}),i.subscribe("bookmarks",i.UGC_CHANGED,function(){i.emit(yudu_events.ALL,yudu_events.COMMON.UGC_BOOKMARKS_CHANGED)}),i.subscribe("pageHighlights",i.UGC_CHANGED,function(){i.emit(yudu_events.ALL,yudu_events.COMMON.UGC_PAGE_HIGHLIGHTS_CHANGED)}),i.subscribe("notes",i.UGC_CHANGED,function(){i.emit(yudu_events.ALL,yudu_events.COMMON.UGC_NOTES_CHANGED)}),i.subscribe(i.ALL,i.PAGE_DECRYPTED,function(){i.emit(yudu_events.ALL,yudu_events.COMMON.LOGIN_APPROVED)})}}});var LZString=function(){function t(t,e){if(!r[t]){r[t]={};for(var i=0;i<t.length;i++)r[t][t.charAt(i)]=i}return r[t][e]}var e=String.fromCharCode,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={},s={compressToBase64:function(t){if(null==t)return"";var e=s._compress(t,6,function(t){return i.charAt(t)});switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:s._decompress(e.length,32,function(n){return t(i,e.charAt(n))})},compressToUTF16:function(t){return null==t?"":s._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:s._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(t){for(var e=s.compress(t),i=new Uint8Array(2*e.length),n=0,r=e.length;r>n;n++){var o=e.charCodeAt(n);i[2*n]=o>>>8,i[2*n+1]=o%256}return i},decompressFromUint8Array:function(t){if(null===t||void 0===t)return s.decompress(t);for(var i=new Array(t.length/2),n=0,r=i.length;r>n;n++)i[n]=256*t[2*n]+t[2*n+1];var o=[];return i.forEach(function(t){o.push(e(t))}),s.decompress(o.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":s._compress(t,6,function(t){return n.charAt(t)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),s._decompress(e.length,32,function(i){return t(n,e.charAt(i))}))},compress:function(t){return s._compress(t,16,function(t){return e(t)})},_compress:function(t,e,i){if(null==t)return"";var n,r,s,o={},a={},h="",c="",l="",u=2,d=3,f=2,g=[],p=0,m=0;for(s=0;s<t.length;s+=1)if(h=t.charAt(s),Object.prototype.hasOwnProperty.call(o,h)||(o[h]=d++,a[h]=!0),c=l+h,Object.prototype.hasOwnProperty.call(o,c))l=c;else{if(Object.prototype.hasOwnProperty.call(a,l)){if(l.charCodeAt(0)<256){for(n=0;f>n;n++)p<<=1,m==e-1?(m=0,g.push(i(p)),p=0):m++;for(r=l.charCodeAt(0),n=0;8>n;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1}else{for(r=1,n=0;f>n;n++)p=p<<1|r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r=0;for(r=l.charCodeAt(0),n=0;16>n;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1}u--,0==u&&(u=Math.pow(2,f),f++),delete a[l]}else for(r=o[l],n=0;f>n;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1;u--,0==u&&(u=Math.pow(2,f),f++),o[c]=d++,l=String(h)}if(""!==l){if(Object.prototype.hasOwnProperty.call(a,l)){if(l.charCodeAt(0)<256){for(n=0;f>n;n++)p<<=1,m==e-1?(m=0,g.push(i(p)),p=0):m++;for(r=l.charCodeAt(0),n=0;8>n;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1}else{for(r=1,n=0;f>n;n++)p=p<<1|r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r=0;for(r=l.charCodeAt(0),n=0;16>n;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1}u--,0==u&&(u=Math.pow(2,f),f++),delete a[l]}else for(r=o[l],n=0;f>n;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1;0==--u&&(u=Math.pow(2,f),f++)}for(r=2,n=0;f>n;n++)p=p<<1|1&r,m==e-1?(m=0,g.push(i(p)),p=0):m++,r>>=1;for(;;){if(p<<=1,m==e-1){g.push(i(p));break}m++}return g.join("")},decompress:function(t){return null==t?"":""==t?null:s._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(t,i,n){var r,s,o,a,h,c,l,u=[],d=4,f=4,g=3,p="",m=[],v={val:n(0),position:i,index:1};for(r=0;3>r;r+=1)u[r]=r;for(o=0,h=Math.pow(2,2),c=1;c!=h;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=n(v.index++)),o|=(a>0?1:0)*c,c<<=1;switch(o){case 0:for(o=0,h=Math.pow(2,8),c=1;c!=h;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=n(v.index++)),o|=(a>0?1:0)*c,c<<=1;l=e(o);break;case 1:for(o=0,h=Math.pow(2,16),c=1;c!=h;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=n(v.index++)),o|=(a>0?1:0)*c,c<<=1;l=e(o);break;case 2:return""}for(u[3]=l,s=l,m.push(l);;){if(v.index>t)return"";for(o=0,h=Math.pow(2,g),c=1;c!=h;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=n(v.index++)),o|=(a>0?1:0)*c,c<<=1;switch(l=o){case 0:for(o=0,h=Math.pow(2,8),c=1;c!=h;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=n(v.index++)),o|=(a>0?1:0)*c,c<<=1;u[f++]=e(o),l=f-1,d--;break;case 1:for(o=0,h=Math.pow(2,16),c=1;c!=h;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=i,v.val=n(v.index++)),o|=(a>0?1:0)*c,c<<=1;u[f++]=e(o),l=f-1,d--;break;case 2:return m.join("")}if(0==d&&(d=Math.pow(2,g),g++),u[l])p=u[l];else{if(l!==f)return null;p=s+s.charAt(0)}m.push(p),u[f++]=s+p.charAt(0),d--,s=p,0==d&&(d=Math.pow(2,g),g++)}}};return s}();"function"==typeof define&&define.amd?define("lzString",[],function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString),define("utils/ugcUtils",["config","shared/storage","lzString"],function(t,e,i){var n=function(t){return JSON.parse(e.getItem(t))},r=function(t){var r=e.getItem(o(t));if(r){var a=i.decompressFromEncodedURIComponent(r),h=JSON.parse(a);return h}var h=n(t);return h&&(e.removeItem(t),s(t,h)),h},s=function(t,n){var r=JSON.stringify(n),s=i.compressToEncodedURIComponent(r);e.setItem(o(t),s)},o=function(t){return t+"-compressed"},a=function(e,i){var n={};for(var r in e)if(e.hasOwnProperty(r)){var s=JSON.parse(e[r]);if(s.lastModified>s.lastSynced){var o=r;t.hasIntroPage||(s.pageNumber+=1,i&&(o=(parseInt(r,10)+1).toString())),n[o]=s}}return n},h=function(e,i){var n={};for(var r in e)if(e.hasOwnProperty(r)){var s=r,o=e[r];if(!t.hasIntroPage)if(!o.pageNumber||o.pageNumber<=0){if(i||!o.isDeleted){console.log("Unexpected page number received from UGC sync response: ignoring element.");continue}}else o.pageNumber-=1,i&&(s=(parseInt(r,10)-1).toString());n[s]=JSON.stringify(o)}return n},c=function(i,n){var r={},s=JSON.parse(e.getItem(i));for(var o in s)if(s.hasOwnProperty(o)){var a=JSON.parse(s[o]);if(!a.pageNumber||a.pageNumber<0)continue;var h=o;if(t.hasIntroPage)a.pageNumber+=1,n&&(h=(parseInt(o,10)+1).toString());else{if(0==a.pageNumber)continue;a.pageNumber-=1,n&&(h=(parseInt(o,10)-1).toString())}r[h]=JSON.stringify(a)}e.setItem(i,JSON.stringify(r))},l=function(t){for(var e in t)if(t.hasOwnProperty(e))return!0;return!1};return{retrieveUgcFromLocalStorage:n,retrieveCompressedUgcFromLocalStorage:r,compressAndSaveUgcToLocalStorage:s,prepareUgcForSyncRequest:a,prepareUgcFromSyncResponse:h,applyIntroPageOffset:c,jsonHasContent:l,anyJsonHaveContent:function(t){for(var e=0,i=t.length;e<i;e+=1)if(l(t[e]))return!0;return!1}}}),define("utils/timerUtils",["events"],function(t){return{Countdown:function(){return this.init=function(){this.type=null,this.function=null,this.handle=null,this.running=!1},this.isRunning=function(){return this.running},this.startTimeout=function(e,i){this.reset(),this.type="timeout",this.function=e,this.handle=setTimeout(t.callback(this,this.triggerTimeout),i),this.running=!0},this.triggerTimeout=function(){this.stopCountdown();try{this.function()}catch(t){console.log(t)}this.reset()},this.startInterval=function(t,e){this.reset(),this.type="interval",this.handle=setInterval(t,e),this.running=!0},this.stopCountdown=function(){"timeout"==this.type?clearTimeout(this.handle):"interval"==this.type&&clearInterval(this.handle),this.running=!1},this.reset=function(){this.stopCountdown(),this.init()},this.init(),this}}}),define("ugc",["events","constants","config","resources","ui/login","shared/ui/messageBox","utils/ugcUtils","utils/ugcApi","utils/timerUtils","shared/localisation","shared/storage","utils/rememberMeToken"],function(t,e,i,n,r,s,o,a,h,c,l,u){var d,f,g,p,m,v="bookmarks-",y="pageHighlights-",b="notes-",_="synced-",w="introPage-",T=0,x=function(){T=n.yuduBook.settings.id,v+=T,y+=T,b+=T,_+=T,w+=T,S(""),C(),t.subscribe("bookmarks",t.UGC_CHANGED,t.callback(this,A)),t.subscribe("pageHighlights",t.UGC_CHANGED,t.callback(this,L)),t.subscribe("notes",t.UGC_CHANGED,t.callback(this,M))},S=function(t){d=v+t,f=y+t,g=b+t,p=_+t,m=w+t},C=function(){var t=l.getItem(m);if(t){if(JSON.parse(t)===i.hasIntroPage)return;o.applyIntroPageOffset(d,!0),o.applyIntroPageOffset(g,!1),o.applyIntroPageOffset(f,!0)}l.setItem(m,JSON.stringify(i.hasIntroPage))},E=function(){return o.retrieveUgcFromLocalStorage(d)},O=function(){return o.prepareUgcForSyncRequest(E(),!0)},A=function(t){var e=t.data.bookmarks,i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=JSON.stringify(e[n].getWriteableObject()));l.setItem(d,JSON.stringify(i)),t.data.fromSync||j.syncUgc({})},P=function(){return o.retrieveCompressedUgcFromLocalStorage(f)},k=function(){return o.prepareUgcForSyncRequest(P(),!0)},L=function(t){var e=t.data.pageHighlights,i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=JSON.stringify(e[n].getWriteableObject()));try{o.compressAndSaveUgcToLocalStorage(f,i)}catch(t){alert("Local Storage is full, Please erase some highlights and try again")}t.data.fromSync||j.syncUgc({})},I=function(){return o.retrieveUgcFromLocalStorage(g)},D=function(){return o.prepareUgcForSyncRequest(I(),!1)},M=function(t){var e=t.data.notes,i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=JSON.stringify(e[n].getWriteableObject()));l.setItem(g,JSON.stringify(i)),t.data.fromSync||j.syncUgc({})},j=function(){var c=0,d=!1,f=!1,g=!1,m=!1,v=!1,y=new h.Countdown,b=!1,_=function(){c=l.getItem(p)||0;var e=n.yuduBook.settings.ugcSyncBaseUrl;if(!e)return void(d=!1);d=e+n.yuduBook.settings.id,t.subscribe(t.ALL,t.LOGIN_SUCCESS,t.callback(this,w)),t.subscribe(t.ALL,t.LOGIN_DETAILS_CHANGED,t.callback(this,w)),w(),f=!0},w=function(e){if(i.isLoggedIn){if(r.getSubscriberId()&&R.subscriberIdChanged(r.getSubscriberId()))return void C();if(d){if(m)return void N.queueSubscriberInfo();if(!r.getHasCredentials()&&!u.hasTokenDetails())return void(f&&!g&&(t.emit(t.ALL,t.SHOW_LOGIN,this,{ugcCredentialsRequested:!0}),g=!0));m=!0,A(E(!1),x,S)}}},x=function(t,e,i){if(200!=i.status||!(t&&t.authenticationResult&&t.authenticationResult.userId))return void S(i,e,null);R.subscriberIdChanged(t.authenticationResult.userId)?N.queueSyncFromSubscriberInfo():setTimeout(C,0)},S=function(t,i,r){!b&&n.yuduBook.settings.ugcAllowAllPrompts&&(t.responseText&&t.responseText.error&&console&&console.log&&console.log("Remote server error message from UGC subscriber ID attempt:\n"+t.responseText.error),s.displayByCode("ugc.sync.subscriberError"),b=!0),y.startTimeout(w,e.ugcSyncRetryTimer)},C=function(e){if(d){if(m)return void N.queueSync();if(!r.getHasCredentials()&&!u.hasTokenDetails())return void(f&&!g&&(t.emit(t.ALL,t.SHOW_LOGIN,this,{ugcCredentialsRequested:!0}),g=!0));if(!r.getSubscriberId())return void w();if(R.subscriberIdChanged(r.getSubscriberId()))return void N.queueSync();m=!0;var i=!0;y.isRunning()&&(y.stopCountdown(),i=!1);var n=E(!0),s=o.anyJsonHaveContent([n.ugc.bookmarks,n.ugc.pageHighlights,n.ugc.notes]);if(v&&!i&&!s)return void M();A(n,P,j)}},E=function(t){var e=t?O():{},i=t?k():{},s=t?D():{},o=t?c:(new Date).getTime(),a=r.getCurrentUserCredentials();return a.username||delete a.username,a.password||delete a.password,{requestedEditions:{bookId:n.yuduBook.settings.id,lastSynced:o},credentials:a,ugc:{bookmarks:e,pageHighlights:i,notes:s}}},A=function(e,i,n){$.ajax({url:d,type:"POST",dataType:"json",contentType:"text/plain",data:JSON.stringify(e),success:t.callback(this,i),error:t.callback(this,n)})},P=function(t,e,i){if(200!=i.status||!(t&&t.authenticationResult&&t.authenticationResult.userId&&t.editions&&t.editions[T]&&t.editions[T].syncTime&&t.ugc))return void j(i,e,null);R.needsChanging(t.authenticationResult.userId,t)||(I(t),M())},L=function(t){I(t),M()},I=function(t){c=t.editions[T].syncTime,l.setItem(p,c),t.ugc.bookmarks&&a.bookmarksReinit(o.prepareUgcFromSyncResponse(t.ugc.bookmarks,!0),{}),t.ugc.notes&&a.notesReinit(o.prepareUgcFromSyncResponse(t.ugc.notes,!1),{}),t.ugc.pageHighlights&&a.highlightsReinit(o.prepareUgcFromSyncResponse(t.ugc.pageHighlights,!0),{}),v=!0},M=function(){m=!1,N.hasNext()?N.next():v&&y.startTimeout(C,e.ugcSyncRefreshTimer)},j=function(t,i,n){b||(t.responseText&&t.responseText.error&&console&&console.log&&console.log("Remote server error message from UGC sync attempt:\n"+t.responseText.error),s.displayByCode("ugc.syncError"),b=!0),y.startTimeout(C,e.ugcSyncRetryTimer)},N=function(){var t=!1,e=!1,i=!1,n=function(){t=!0},r=function(){e=!0},s=function(){i=!0},o=function(){setTimeout(a,0)},a=function(){e?(m=!1,setTimeout(C,0),e=!1):i?(setTimeout(w,0),i=!1):t&&(setTimeout(C,0),t=!1)};return{queueSync:n,queueSyncFromSubscriberInfo:r,queueSubscriberInfo:s,hasNext:function(){return t||e||i},next:o}}();return{syncInit:_,syncUgc:C,delayedSyncResponse:L,functionQueue:N}}(),R=function(){var e=!1,i=!1,n=!1,h={},u={},d={},f=function(t,e){n=e;var i=g(t);return i||(n=!1),i},g=function(t){return e!=t&&(i=t,m(),!0)},m=function(){var i=e,n=p;if(h=E(),u=I(),d=P(),x(),!i&&n==_&&o.anyJsonHaveContent([h,u,d])){var r={leftLabel:c.get("ugc.syncMerge.discard"),rightLabel:c.get("ugc.syncMerge.merge"),leftCallback:t.callback(this,T),rightCallback:t.callback(this,w),backgroundCallback:t.callback(this,O),text:c.get("ugc.syncMerge.message")};s.displayAdvancedTwoButtonPopup(r)}else O()},w=function(){o.jsonHasContent(h)&&(a.bookmarksReinit(h,{}),h={}),o.jsonHasContent(u)&&(a.notesReinit(u,{}),u={}),o.jsonHasContent(d)&&(a.highlightsReinit(d,{merge:!0}),d={}),T()},T=function(){l.setItem(v,JSON.stringify({})),l.setItem(y,JSON.stringify({})),l.setItem(b,JSON.stringify({})),l.setItem(_,0),O()},x=function(){S("-"+i),C();var t={reset:!0};a.bookmarksReinit(E(),t),a.highlightsReinit(P(),t),a.notesReinit(I(),t)},O=function(){e=i,r.setSubscriberId(i),n?(j.delayedSyncResponse(n),n=!1):j.functionQueue.next()};return{needsChanging:f,subscriberIdChanged:g}}();return{init:x,syncInit:j.syncInit,initialSync:j.syncUgc,retrieveBookmarks:E,retrievePageHighlights:P,retrieveNotes:I}}),define("publicApi",["api","events"],function(t,e){var i={},n=function(){v.init(),window.yudu_readerApi={getCredentials:r,nextPage:s,previousPage:o,goToPage:a,triggerLightboxOnCurrentPage:h,triggerLightboxOnPage:c,closeLightbox:d,getCurrentPageNumber:f,getCurrentPageLabel:g}},r=function(){return m.subscriberCredentials},s=function(){p(e.GOTO_NEXT_PAGE,i)},o=function(){p(e.GOTO_PREVIOUS_PAGE,i)},a=function(t){p(e.GOTO_PAGE,{pageNumber:t})},h=function(){for(var e=t.getPagesInCurrentTray(),i=0;i<e.length&&!l(e[i]);i++);},c=function(e){l(t.getPage(e))&&a(e)},l=function(t){if(t.encrypted)return!1;var e=u(t);return!!e&&(e.showContent(),!0)},u=function(t){return!(!t.overlayLevel||1!==t.overlayLevel.launchableOverlays.length)&&t.overlayLevel.launchableOverlays[0]},d=function(){p(e.CLOSE_LIGHTBOX,i)},f=function(){return t.getCurrentPageNumber()},g=function(){return t.getCurrentPageLabel()},p=function(t,i){e.emit("publicApi",t,this,i)},m=function(){return new function(){this.subscriberCredentials={}}}(),v=function(){var t=function(){i(),p(e.REQUEST_LOGIN_DETAILS,{})},i=function(){e.subscribe(e.ALL,e.LOGIN_DETAILS_CHANGED,e.callback(this,n),!0),e.subscribe(e.ALL,e.CHANGE_FOR_LOGIN_DETAILS,e.callback(this,n),!0),e.subscribe(e.ALL,e.LOGIN_SUCCESS,e.callback(this,n),!0)},n=function(t){var i={};t&&t.data&&t.data.credentials&&(i=t.data.credentials),m.subscriberCredentials=i,p(e.PUBLIC_API_LOGIN_STATE_CHANGED,i)};return{init:t}}();return{init:n}}),define("viewRedirect",["api","config","events","shared/utils/appUtils","shared/device","shared/utils/utils"],function(t,e,i,n,r,s){var o={fixedLayout:"fixedlayout",article:"article"},a={};return a[r.types.desktop]="deviceViewDesktop",a[r.types.tablet]="deviceViewTablet",a[r.types.phone]="deviceViewPhone",new function(){var h=function(){window.location.hash.indexOf("noRedirect")<0&&!l()&&!n.deviceType.isAndroid()&&i.subscribe(i.ALL,i.YUDU_BOOK_LOADED,c,!1)},c=function(e){var i=a[r.classify()];s.getLeafOrUndefined(e.data,"settings","phoneview",i)==o.article&&t.openArticleView()},l=function(){return e.getFromQuery("origin")};!function(){i.subscribe(i.ALL,i.QUERY_STRING_PARSED,h,!1)}()}}),define("ui/dataCollection",["events","config","resources","interactions","utils/stats/yuduReporting","shared/storage","utils/tools","jquery"],function(t,e,i,n,r,s,o,a){var h={},c={background:a("#yudu_dataCollectionBackground"),prompt:a("#yudu_dataCollectionPrompt"),greeting:a("#yudu_dataCollectionGreeting"),explanation:a("#yudu_dataCollectionExplanation"),infoLink:a("#yudu_dataCollectionInfoLink"),emailInput:a("#yudu_dataCollectionEmail"),validation:a("#yudu_dataCollectionValidation"),form:a("#yudu_dataCollectionForm"),dontShowAgain:a("#yudu_dataCollectionDontShowAgain"),skip:a("#yudu_dataCollectionSkip"),submit:a("#yudu_dataCollectionSubmit")},l=function(){u(),d()&&(f(),g(),p())},u=function(){var t=i.yuduBook.settings.id;h.DONT_SHOW_AGAIN=t+"-DONT_SHOW_AGAIN",h.EMAIL_COLLECTED=t+"-EMAIL_COLLECTED"},d=function(){var t=o.isThisAnApp(),e=s.getItem(h.DONT_SHOW_AGAIN),i=s.getItem(h.EMAIL_COLLECTED);return!t&&!e&&!i},f=function(){var t=i.yuduBook.settings;c.greeting.text(t.dataCollectionGreeting),c.explanation.text(t.dataCollectionExplanation),c.infoLink.prop("href",t.dataCollectionInfoUrl)},g=function(){c.form.submit(t.callback(this,function(t){return a("input").blur(),t.stopPropagation(),v(),!1})),t.yuduOn(c.skip,e.clickAction,t.callback(this,m)),t.yuduOn(c.background,e.clickAction,t.callback(this,m)),t.yuduOn(c.background,"touchmove",t.callback(this,function(t){return t.stopPropagation(),!1}))},p=function(){n.setAllowKeyNavigation(!1),t.subscribe(t.ALL,t.CLOSE_ACTIVE,m),c.background.show(),c.prompt.slideDown()},m=function(){t.unsubscribe(t.ALL,t.CLOSE_ACTIVE,m),n.setAllowKeyNavigation(!0),c.background.hide(),c.prompt.hide(),c.dontShowAgain.prop("checked")&&y()},v=function(){_()?(b(),r.email(c.emailInput.val()),m()):c.validation.show()},y=function(){s.setItem(h.DONT_SHOW_AGAIN,!0)},b=function(){s.setItem(h.EMAIL_COLLECTED,!0)},_=function(){var t=c.emailInput.val(),e=t.indexOf("@");return 0<=e&&e<t.lastIndexOf(".")};return{tryDisplay:l}}),define("ui/gaTrackerConsent",["utils/statistics","shared/localisation","resources","jquery"],function(t,e,i,n){function r(){h.removeClass("show")}function s(){localStorage.setItem(l,!1),r()}function o(){localStorage.setItem(l,!0),t.enableGoogleAnalytics(),r()}function a(){if(l=c+i.yuduBook.settings.id,i.yuduBook.settings.googleAnalyticsTrackerId&&null==localStorage.getItem(l)){h.addClass("show");var t=i.yuduBook.settings.googleAnalyticsConsentBannerText||e.get("gaTrackerConsent.message"),r=n('<div id="gaTrackerConsentMessage">'+t+"</div>"),a=i.yuduBook.settings.googleAnalyticsPrivacyPolicyUrl;if(a){var u=n('<div id="consentBannerPrivacyPolicyLink" />'),d=n("<a />",{href:a,text:"Privacy Policy",target:"_blank"});u.append(d),r.append(u)}var f=n('<div id="consentButtonContainer"></div>'),g=n('<a id="consentButton" type="button">'+e.get("gaTrackerConsent.decline")+"</a>").click(s),p=n('<a id="consentButton" type="button">'+e.get("gaTrackerConsent.accept")+"</a>").click(o);yudu_commonSettings.isDesktop||(g.addClass("touchControl"),p.addClass("touchControl")),f.append(g).append(p),h.append(r).append(f)}}var h=n("#yudu_gaTrackerConsent"),c="gaConsent-",l="";return{init:a}}),define("ui/instantiation",["events","resources","ui/contents","ui/information","ui/login","shared/ui/messageBox","ui/rollover","ui/sharing","ui/thumbnails","ui/toolbar","utils/userOptions","ui/loading","ui/search","ui/orderForm","config","ui/uiTools","ui/drawingToolbars","utils/ugcApi","ui/highlightingCanvas","ui/notes","ui/bookmarks","shared/commonFunctionsApi","brandableSubmodulesApi","ugc","publicApi","viewRedirect","ui/dataCollection","ui/gaTrackerConsent"],function(t,e,i,n,r,s,o,a,h,c,l,u,d,f,g,p,m,v,y,b,_,w,T,x,S,C,E,O){return{preLoad:function(){p.setScrollbarWidth(),n.init(),r.init(),a.bindEvents()},postLoad:function(n){var r=n.getCurrentPage().getPageNumber();w.init(),T.init(),S.init(),u.init(r,e.yuduBook.pages.length),h.init(n),(new i.Contents).init(e.yuduBook.contents),a.init(),c.preInit(),n.updateReaderSize(),c.init(),O.init(),d.init(),s.init(),v.init(),x.init(),g.bookmarksEnabled&&_.init(x.retrieveBookmarks()),g.notesEnabled&&b.init(x.retrieveNotes()),g.highlightsEnabled&&(m.init(),y.init(x.retrievePageHighlights())),n.isUgcEnabled()&&x.syncInit(),g.orderFormEnabled&&f.init(),l.shouldShowInformationBox()&&!e.yuduBook.settings.infoScreenDisabled||!n.isShowingEncryptedPage()?x.initialSync():t.emit(t.ALL,t.SHOW_LOGIN,this,{}),g.emailCollectionEnabled&&!n.isShowingEncryptedPage()&&E.tryDisplay()}}}),define("main",["api","shared/localisation","jquery","ui/instantiation","interactions","events","fetching/fetchHandler"],function(t,e,i,n,r,s,o){var a=function(t){var e=t.target;n.postLoad(e),r.init(e),e.start()};return{init:function(){e.localiseHtml(document),n.preLoad(),s.subscribe(s.ALL,s.READER_LOADED,a),o.start(),t.createReader("yudu_reader")}}}),require.config({baseUrl:"src",map:{"*":{jquery:"jquery-private"},"jquery-private":{jquery:"jquery"}},shim:{easel:{exports:"createjs"},sound:{deps:["easel"],exports:"createjs.Sound"},tween:{deps:["easel"],exports:"createjs"},"jquery.mousewheel":["jquery"],"jquery.hammer":["jquery"],fabric:["jquery"],crypto:{exports:"CryptoJS"},lzString:{exports:"lzString"}},paths:{shared:"../shared",environmentActive:"env-dev",has:"../lib/has",jquery:"../lib/jquery-3.4.1.min",easel:"../lib/easeljs-0.7.1.min",tween:"../lib/tweenjs-0.5.1.min",sound:"../lib/soundjs-1.0.0.min",hammer2:"../lib/hammer-2.0.8.noconflict","jquery.hammer":"../lib/jquery.hammer.min","jquery.mousewheel":"../lib/jquery.mousewheel",fabric:"../lib/fabric.require.min",bowser:"../lib/bowser.min",crypto:"../lib/aes",lzString:"../lib/lz-string.min"}}),require(["jquery","easel","main","resources","constants","shared/localisation","shared/device","bowser","version","jquery.hammer","jquery.mousewheel"],function(t,e,i,n,r,s,o,a){t(function(){window.$=t,console=console||{log:function(){}},e.Alignment={LEFT:1,CENTRE:2,RIGHT:3},e.Container.prototype.resetPosition=function(){this.x=0,this.y=0},o.setupLibraries(a),o.startDeviceDetectionAsyncChecks(),s.loadResources(r.customStringsPackURL,i.init)})}),define("../app",function(){});