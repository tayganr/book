var OPTIONS_BUTTON_INDEX=1,toolbarsContainer=$("#highlightingToolsContainer"),drawingOptionsToolbar=$("#drawingOptionsToolbar"),isShowing=!1,buttonFaded={nextPage:!1,prevPage:!0},editOptionsToolbarButtons={cancelButton:$("#highlightsCancel"),undoButton:$("#highlightsUndo"),clearButton:$("#highlightsClear"),redoButton:$("#highlightsRedo"),saveButton:$("#hightlightsSave")},drawingOptions={panel:$("#drawingOptionsPanel"),background:$("#drawingOptionsBackground")},colourOptions=$(".drawingOptionButton input[name\x3dcolour]:radio"),
penSizeOptions=$(".drawingOptionButton input[name\x3dpenSize]:radio"),opacityOptions=$(".drawingOptionButton input[name\x3dopacity]:radio"),drawingOptionsToolbarButtons=[],drawingOptionsButton,drawingToolbarsInit=function(){registerDrawingToolbarsForYuduEvents();addEditOptionsToolbarButtonEventListeners();yudu_commonSettings.isDesktop||(drawingOptionsToolbar.addClass("touchDevice"),drawingOptions.panel.addClass("touchDevice"));createDrawingOptionsToolbar();colourOptions.change(updateDrawingOptionsColour);
penSizeOptions.change(setBrushWidth);opacityOptions.change(setBrushColour);drawingOptions.background.on(yudu_commonSettings.clickAction,toggleDrawingOptions);setBrushColour();setBrushWidth()},addEditOptionsToolbarButtonEventListeners=function(){yudu_commonFunctions.createHammerJSTapManager(editOptionsToolbarButtons.cancelButton[0]).on("tap",yudu_drawingToolbarFunctions.cancel);yudu_commonFunctions.createHammerJSTapManager(editOptionsToolbarButtons.undoButton[0]).on("tap",yudu_drawingToolbarFunctions.undo);
yudu_commonFunctions.createHammerJSTapManager(editOptionsToolbarButtons.clearButton[0]).on("tap",yudu_drawingToolbarFunctions.clearAll);yudu_commonFunctions.createHammerJSTapManager(editOptionsToolbarButtons.redoButton[0]).on("tap",yudu_drawingToolbarFunctions.redo);yudu_commonFunctions.createHammerJSTapManager(editOptionsToolbarButtons.saveButton[0]).on("tap",yudu_drawingToolbarFunctions.save)},registerDrawingToolbarsForYuduEvents=function(){yudu_events.subscribe(yudu_events.ALL,yudu_events.COMMON.RESIZE,
positionDrawingOptionsToolbarButtons,!1);yudu_events.subscribe(yudu_events.ALL,yudu_events.DRAWING_TOOLBARS.TOGGLE_TOOLBARS,yudu_events.callback(this,this.setToolbarsVisibility),!1)},createDrawingOptionsToolbar=function(){var a=yudu_toolbarSettings.shouldUseHighRes;createDrawingOptionStandardButton("prevPage",a,previousPageClicked);createDrawingOptionsPanelButton();createDrawingOptionRadioButton("penTool",a,enterPenMode,!0);createDrawingOptionRadioButton("eraserTool",a,enterEraserMode,!1);createDrawingOptionRadioButton("panTool",
a,enterPanMode,!1);createDrawingOptionStandardButton("nextPage",a,nextPageClicked);$("#drawingOptionsToolbar .radio").on(yudu_commonSettings.clickAction,function(a){$("#drawingOptionsToolbar .radio").removeClass("selected");a.target.className+=" selected"});positionDrawingOptionsToolbarButtons()},createDrawingOptionStandardButton=function(a,b,c){createDrawingOptionButton(a,!0,b,c,function(a){yudu_commonSettings.isDesktop||a.addClass("touchControl")})},createDrawingOptionRadioButton=function(a,b,c,
e){createDrawingOptionButton(a,!0,b,c,function(a){a.addClass("radio");e&&a.addClass("selected")})},createDrawingOptionsPanelButton=function(){createDrawingOptionButton("drawingOptions",!1,!1,toggleDrawingOptions,function(a){drawingOptionsButton=a;updateDrawingOptionsColour()})},createDrawingOptionButton=function(a,b,c,e,f){var d=$('\x3ca type\x3d"button" class\x3d"drawingOptionToolbarButton" tabindex\x3d"-1" id\x3d"'+a+'"\x3e\x3c/a\x3e');"undefined"!=typeof f&&f(d);b&&(a=getIconFor(a,c),d.css("background-image",
"url("+a+")"));d.on(yudu_commonSettings.clickAction,e);drawingOptionsToolbar.append(d);drawingOptionsToolbarButtons.push(d)},getIconFor=function(a,b){"undefined"==typeof b&&(b=yudu_toolbarSettings.shouldUseHighRes);return yudu_toolbarSettings.toolbarIconBasePath+(b?yudu_toolbarSettings.iconHighResPrefix:"")+a+yudu_toolbarSettings.iconFileExtension},updateDrawingOptionsColour=function(){drawingOptionsButton.css("background-color","rgb("+$("input[name\x3dcolour]:checked").val()+")");setBrushColour()},
positionDrawingOptionsToolbarButtons=function(){for(var a=window.innerWidth/6,b=a/2-drawingOptionsToolbarButtons[0].outerWidth(!0)/2,c=0;c<drawingOptionsToolbarButtons.length;c++)drawingOptionsToolbarButtons[c].css({left:b+a*c});drawingOptions.panel.css({left:drawingOptionsToolbarButtons[OPTIONS_BUTTON_INDEX].css("left")});$(".opacityOption").css("background-image","url("+yudu_toolbarSettings.toolbarIconBasePath+"chequerboard.png)")},toggleDrawingOptions=function(){drawingOptions.panel.hasClass("hidden")?
(drawingOptions.panel.removeClass("hidden"),drawingOptions.background.show()):(drawingOptions.panel.addClass("hidden"),drawingOptions.background.hide())},setBrushColour=function(){yudu_drawingToolbarFunctions.setDrawingBrushColour("rgba("+$("input[name\x3dcolour]:checked").val()+","+$("input[name\x3dopacity]:checked").val()+")")},setBrushWidth=function(){yudu_drawingToolbarFunctions.setDrawingBrushWidth($("input[name\x3dpenSize]:checked").val())},enterPenMode=function(){yudu_drawingToolbarFunctions.penMode()},
enterEraserMode=function(){yudu_drawingToolbarFunctions.eraserMode()},enterPanMode=function(){yudu_drawingToolbarFunctions.panMode()},nextPageClicked=function(){yudu_drawingToolbarFunctions.goToNextPage();buttonFaded.prevPage&&unfadeButton("prevPage");yudu_drawingToolbarFunctions.hasNextPage()||fadeButton("nextPage")},previousPageClicked=function(){yudu_drawingToolbarFunctions.goToPreviousPage();buttonFaded.nextPage&&unfadeButton("nextPage");yudu_drawingToolbarFunctions.hasPreviousPage()||fadeButton("prevPage")},
fadePageTurnButtons=function(){yudu_drawingToolbarFunctions.hasNextPage()?unfadeButton("nextPage"):fadeButton("nextPage");yudu_drawingToolbarFunctions.hasPreviousPage()?unfadeButton("prevPage"):fadeButton("prevPage")},fadeButton=function(a){toolbarsContainer.find("a#"+a).css("opacity",.4).css("cursor","default");buttonFaded[a]=!0},unfadeButton=function(a){toolbarsContainer.find("a#"+a).css("opacity","").css("cursor","");buttonFaded[a]=!1},setToolbarsVisibility=function(a){(shouldShow=a.data.show||
!1)&&!isShowing?(toolbarsContainer.show(),fadePageTurnButtons()):!shouldShow&&isShowing&&toolbarsContainer.hide();isShowing=shouldShow},drawingButtonHit=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return b.apply(a,c)}},cssFiles=[yudu_commonFunctions.createBrandingPath("drawingToolbars/style.css")];yudu_commonFunctions.loadCss(cssFiles,drawingToolbarsInit);