var Thumbnails=function(d){this.intRegex=/^[1-9]\d*$/;this.progressBar=this.iconLabel=this.scroller=!1;this.readerOrientation=yudu_commonSettings.orientation;this.readerOrientationInit=[!1,!1];this.carouselContainerElement=$("#"+d.carouselContainerId);this.visibleWidth=yudu_commonSettings.width/yudu_commonSettings.pixelDensity;this.progression=0;this.isSpringing=!1;this.dampingCoefficient=d.mechanics&&d.mechanics.dampingCoefficient||-20;this.mass=d.mechanics&&d.mechanics.mass||10;this.velocityMax=
d.mechanics&&d.mechanics.velocityMax||1E4;this.velocityScale=d.mechanics&&d.mechanics.velocityScale||600;this.segmentedControl=!1;this.primaryIconSets={};this.leftIcons=[];this.visibleIcons=[];this.rightIcons=[];this.maxVisibleIcons=0;this.iconSize=d.initialIconSizes;this.callbacks={};this.carouselManager=null;this.isVisible=!1;this.init=function(){this.pageIndexOffset=yudu_commonSettings.hasIntroPage?0:1;this.carouselContainerElement.on("touchstart",yudu_events.callback(this,function(){return!1}));
yudu_commonSettings.isDesktop||this.carouselContainerElement.addClass("touchDevice");this.setIconSizes();yudu_events.subscribe(yudu_events.ALL,yudu_events.COMMON.RESIZE,yudu_events.callback(this,this.resize),!1);this.readerOrientationInit[this.readerOrientation]=!0;this.scroller=new CarouselScroller(this,d);d.enableCarouselLabel&&(this.iconLabel=new CarouselIconLabel(this,d));d.enableCarouselProgressBar&&(this.progressBar=new CarouselProgressBar(this,d),this.progressBar.init());this.setupThumbnails();
d.enableSegments&&this.setupSecondarySegments();this.resize();var c=this;yudu_commonSettings.createjs.Ticker.addEventListener("tick",yudu_events.callback(this,this.update));yudu_events.subscribe(yudu_events.ALL,yudu_events.THUMBNAILS.TOGGLE_THUMBNAILS,yudu_events.callback(c,function(b){c.toggle(b.data.toggle,b.data.show)}));yudu_events.subscribe(yudu_events.ALL,yudu_events.THUMBNAILS.UPDATE_THUMBNAIL,yudu_events.callback(c,function(b){c.updateThumbnail(b.data.pageNumber)}));this.carouselManager=yudu_commonFunctions.createHammerJSTapManager(this.carouselContainerElement[0]);
this.carouselManager.on("tap",yudu_events.callback(c,this.handleInteraction))};this.setupThumbnails=function(){for(var c=[],b=0;b<yudu_thumbnailsSettings.pagesDetails.length;b++){var a=yudu_thumbnailsSettings.pagesDetails[b],g=b+this.pageIndexOffset,h=this.getIconDimensionsFromFileDimensions(a.width(),a.height(),this.readerOrientation),a={id:g,filename:yudu_commonFunctions.returnFunctionWithDynamicArgs(yudu_thumbnailsFunctions.getThumbnailFileName,b),fileHeight:yudu_commonFunctions.returnDynamicInput(a.height),
fileWidth:yudu_commonFunctions.returnDynamicInput(a.width),iconClassName:d.carouselIconClassName,initialDimensions:{width:h.width,height:h.height},initialReaderOrientation:this.readerOrientation,pageNumber:g,pageDetailsIndex:b};c.push(new Thumbnail(this,a))}new CarouselIconSet(this,{id:"thumbnails",label:yudu_thumbnailsSettings.primarySegmentString,isPrimary:!0,icons:c})};this.setupSecondarySegments=function(){var c=this,b=[this.primaryIconSets.thumbnails,new CarouselIconSet(c,{id:"bookmarks",label:yudu_thumbnailsSettings.bookmarksSegmentString,
parent:this.primaryIconSets.thumbnails,filterFunction:function(a){a=a.pageNumber-c.pageIndexOffset;return yudu_thumbnailsFunctions.pageHasBookmarks()(a)},listeners:[{topic:yudu_events.COMMON.UGC_BOOKMARKS_CHANGED}]}),new CarouselIconSet(c,{id:"highlights",label:yudu_thumbnailsSettings.highlightsSegmentString,parent:this.primaryIconSets.thumbnails,filterFunction:function(a){a=a.pageNumber-c.pageIndexOffset;return yudu_thumbnailsFunctions.pageHasHighlights()(a)},listeners:[{topic:yudu_events.COMMON.UGC_PAGE_HIGHLIGHTS_CHANGED}]}),
new CarouselIconSet(c,{id:"notes",label:yudu_thumbnailsSettings.notesSegmentString,parent:this.primaryIconSets.thumbnails,filterFunction:function(a){a=a.pageNumber-c.pageIndexOffset;return yudu_thumbnailsFunctions.pageHasNotes()(a)},listeners:[{topic:yudu_events.COMMON.UGC_NOTES_CHANGED}]})];this.segmentedControl=new CarouselSegmentedControls(c,{enableSegmentAutoHide:d.enableSegmentAutoHide,carouselSegmentedControlsWrapperId:d.carouselSegmentedControlsWrapperId,carouselSegmentedControlContainerId:d.carouselSegmentedControlContainerId,
iconSets:b});this.segmentedControl.init()};this.initOrientation=function(){this.readerOrientationInit[this.readerOrientation]=!0;this.setIconSizes();this.initIconOrientations()};this.initIconOrientations=function(){for(var c in this.primaryIconSets)if(this.primaryIconSets.hasOwnProperty(c))for(var b=this.primaryIconSets[c].__original_icons,a=0;a<b.length;a++)this.updateSingleIconSize(b[a],this.readerOrientation)};this.updateSingleIconSize=function(c,b){var a=this.getIconDimensionsFromFileDimensions(c.getFileWidth(),
c.getFileHeight(),b);c.initOrientation(b,{width:a.width,height:a.height})};this.setIconSizes=function(){if(!yudu_commonSettings.isDesktop){var c=yudu_commonSettings.height/yudu_commonSettings.pixelDensity*.2,b=c/Math.sqrt(2);this.iconSize[this.readerOrientation].iconHeightLimit=Math.floor(c);this.iconSize[this.readerOrientation].iconWidthLimit=Math.floor(b);this.iconSize[this.readerOrientation].iconPadding=Math.floor(b/5)}};this.iconset=function(){return this.segmentedControl&&this.segmentedControl.selectedSegment?
this.segmentedControl.selectedSegment.iconSet:this.primaryIconSets.thumbnails?this.primaryIconSets.thumbnails:null};this.icons=function(){var c=this.iconset();return c?c.icons:[]};this.iconsLength=function(){var c=this.iconset();return c?c.length:0};this.getCurrentIconIndex=function(){var c=this.iconsLength();return Math.min(Math.max(Math.ceil(this.progression*(c-1)+.5),1),c)-1};this.getMaxIconWidth=function(){return this.iconSize[this.readerOrientation].iconWidthLimit};this.getMaxIconHeight=function(){return this.iconSize[this.readerOrientation].iconHeightLimit};
this.getIconPadding=function(){return this.iconSize[this.readerOrientation].iconPadding};this.getTotalWidth=function(){return(this.iconsLength()-1)*(this.getMaxIconWidth()+this.getIconPadding())};this.getIconDimensionsFromFileDimensions=function(c,b,a){a=Math.ceil(1E3*Math.max(c/this.iconSize[a].iconWidthLimit,b/this.iconSize[a].iconHeightLimit))/1E3;return{width:Math.round(c/a),height:Math.round(b/a)}};this.toggle=function(c,b){var a=c?!this.isVisible:b;if(a==this.isVisible)return this.isVisible;
(this.isVisible=a)?(this.segmentedControl.updateAllSegments(),yudu_commonFunctions.decryptAllPages(),this.displayPage(yudu_thumbnailsFunctions.getCurrentPage()),yudu_commonFunctions.hideToolbar(),this.carouselContainerElement.show()):this.carouselContainerElement.hide();return this.isVisible};this.resize=function(){this.readerOrientation=yudu_commonSettings.orientation;this.visibleWidth=yudu_commonSettings.width/yudu_commonSettings.pixelDensity;this.readerOrientationInit[this.readerOrientation]||
this.initOrientation();this.updateVisibleIcons()};this.updateVisibleIcons=function(){this.updatePositions(this.progression);this.maxVisibleIcons=Math.floor(this.visibleWidth/(this.getMaxIconWidth()+this.getIconPadding()))+5;this.displayIcons()};this.changeIconSet=function(c){var b=this.iconset(),a=this.scroller.getCentreIndex();this.segmentedControl.selectedSegment=c;c.iconSet.update();c=c.iconSet.findClosestIconTo(b,a);this.progressionFromIconIndex(c);this.updateVisibleIcons()};this.progressionFromIconIndex=
function(c){var b=this.iconsLength();this.progression=Math.max(0,Math.min(1,0===b?0:c/(b-1)))};this.displayIcons=function(){for(var c=0;c<this.visibleIcons.length;c++)this.scroller.removeIcon(this.visibleIcons[c]);c=this.scroller.getStartIndex();this.leftIcons=this.icons().slice(0);this.visibleIcons=this.leftIcons.splice(c,this.leftIcons.length-c);this.rightIcons=this.visibleIcons.splice(this.maxVisibleIcons,this.visibleIcons.length-this.maxVisibleIcons);for(c=0;c<this.visibleIcons.length;c++)this.scroller.addIcon(this.visibleIcons[c])};
this.moveIconsLeft=function(){if(this.visibleIcons.length>=this.maxVisibleIcons){var c=this.visibleIcons.shift();this.scroller.removeIcon(c);this.leftIcons.push(c)}0<this.rightIcons.length&&(c=this.rightIcons.shift(),this.scroller.addIcon(c),this.visibleIcons.push(c))};this.moveIconsRight=function(){if(this.visibleIcons.length>=this.maxVisibleIcons){var c=this.visibleIcons.pop();this.scroller.removeIcon(c);this.rightIcons.unshift(c)}0<this.leftIcons.length&&(c=this.leftIcons.pop(),this.scroller.addIcon(c),
this.visibleIcons.unshift(c))};this.updatePositions=function(c){2>this.iconsLength()&&(c=0);this.progression=c;this.progressBar&&this.progressBar.updatePosition(c);this.scroller.updatePosition(c);this.iconLabel&&this.iconLabel.updateLabel()};this.calculateIconPosition=function(c){var b={},a=this.icons().indexOf(c);0>a?(b.x=0,b.y=0):(b.x=Math.round((this.visibleWidth-c.getCurrentWidth())/2+a*(this.getMaxIconWidth()+this.getIconPadding())),b.y=this.getMaxIconHeight()-c.getCurrentHeight());return b};
this.updateThumbnail=function(c){if(0<=c&&c<this.iconsLength()){c=this.icons()[c];c.setImage();for(var b=0;b<this.readerOrientationInit.length;b++)this.readerOrientationInit[b]&&this.updateSingleIconSize(c,b);c.setSize()}};this.update=function(c){if(this.isSpringing){var b=0,a=0;do this.velocity+=this.dampingCoefficient*this.velocity/this.mass/yudu_thumbnailsSettings.fps,b+=this.velocity/yudu_thumbnailsSettings.fps,a+=yudu_thumbnailsSettings.tickTimeMs;while(a<c.delta);1>Math.abs(this.velocity)&&
(this.isSpringing=!1,this.velocity=0);this.scroller&&this.scroller.updatePositionsFromDeltaX(b)}};this.handleInteraction=function(c){var b=this.callbacks[c.target.dataset.id];"function"==typeof b&&b(c)};this.registerListener=function(c,b){this.callbacks[c]=b};this.setPageNumber=function(c){this.isVisible&&this.displayPage(c.data.page)};this.displayPage=function(c){var b=this.primaryIconSets.thumbnails;c=this.iconset().findClosestIconTo(b,c);this.progressionFromIconIndex(c);this.updateVisibleIcons()};
yudu_events.subscribe(yudu_events.ALL,yudu_events.THUMBNAILS.PAGE_CHANGED,yudu_events.callback(this,this.setPageNumber),!1);yudu_events.subscribe(yudu_events.ALL,yudu_events.COMMON.TOUCH,yudu_events.callback(this,this.toggle,!1,!1),!1)},CarouselSegmentedControls=function(d,c){this.carousel=d;this.segmentedControlsWrapper=$("#"+c.carouselSegmentedControlsWrapperId);this.segmentControlContainer=$("#"+c.carouselSegmentedControlContainerId);this.segments=[];this.leftSegmentIndex=2;this.rightSegmentIndex=
-1;this.selectedSegment=!1;this.init=function(){yudu_commonSettings.isDesktop||this.segmentedControlsWrapper.addClass("touchDevice");for(var b=c.iconSets||[],a=0;a<b.length;a++)this.segments.push(new CarouselSegmentedControl(this,{enableSegmentAutoHide:c.enableSegmentAutoHide,iconSet:b[a]}));0<this.segments.length&&(this.selectSegment(this.segments[0]),this.leftSegmentIndex=0,this.segments[this.leftSegmentIndex].addStyleForLeft(),this.rightSegmentIndex=this.segments.length-1,this.segments[this.rightSegmentIndex].addStyleForRight())};
this.updateAllSegments=function(){for(var b=0;b<this.segments.length;b++)this.segments[b].iconSet.update()};this.show=function(){this.segmentedControlsWrapper.removeClass("hidden")};this.hide=function(){this.segmentedControlsWrapper.addClass("hidden")};this.showSegment=function(b){var a=this.segments.indexOf(b);a<this.leftSegmentIndex&&(this.segments[this.leftSegmentIndex]&&this.segments[this.leftSegmentIndex].removeStyleForLeft(),b.addStyleForLeft(),this.leftSegmentIndex=a);a>this.rightSegmentIndex&&
(this.segments[this.rightSegmentIndex]&&this.segments[this.rightSegmentIndex].removeStyleForRight(),b.addStyleForRight(),this.rightSegmentIndex=a);b.show()};this.hideSegment=function(b){if(this.selectedSegment!==b||!this.carousel.isVisible){b.hide();var a=this.segments.indexOf(b);a===this.leftSegmentIndex&&(b.removeStyleForLeft(),this.updateLeftMostSegmentIndex());a===this.rightSegmentIndex&&(b.removeStyleForRight(),this.updateRightMostSegmentIndex());b===this.selectedSegment&&(b.deselect(),this.updateSelection())}};
this.updateLeftMostSegmentIndex=function(){for(var b=this.leftSegmentIndex;!this.segments[b].isVisible&&b<this.segments.length;)b+=1;b<this.segments.length?(this.leftSegmentIndex=b,this.segments[b].addStyleForLeft()):(this.leftSegmentIndex=this.segments.length,this.hide())};this.updateRightMostSegmentIndex=function(){for(var b=this.rightSegmentIndex;!this.segments[b].isVisible&&0<=b;)--b;0<=b?(this.rightSegmentIndex=b,this.segments[b].addStyleForRight()):(this.rightSegmentIndex=-1,this.hide())};this.updateSelection=
function(){for(var b=0;!this.segments[b].isVisible&&b<this.segments.length;)b+=1;b<this.segments.length?this.selectSegment(this.segments[b]):(this.selectedSegment=!1,this.hide())};this.selectSegment=function(b){var a=this.selectedSegment;if(a){if(b===a)return;a.deselect()}b.select();this.carousel.changeIconSet(b);a&&a.autoHideEnabled&&1>a.iconSet.length&&this.hideSegment(a)}},CarouselSegmentedControl=function(d,c){this.parent=d;this.iconSet=c.iconSet;this.autoHideEnabled="boolean"===typeof c.enableSegmentAutoHide?
c.enableSegmentAutoHide:!1;this.isVisible=!0;this.init=function(){this.iconSet.registerAsSegment(this);var b="segmentedControl"+this.iconSet.label;this.element=$("\x3cdiv\x3e\x3c/div\x3e");this.element.text(this.iconSet.label);this.element.attr("data-id",b);this.element.appendTo(this.parent.segmentControlContainer);this.parent.carousel.registerListener(b,yudu_events.callback(this,this.handleClick))};this.verifyVisibility=function(b){this.isVisible!==b&&(b?this.parent.showSegment(this):this.parent.hideSegment(this))};
this.show=function(){this.isVisible=!0;this.element.show()};this.hide=function(){this.isVisible=!1;this.element.hide()};this.isSelected=function(){return this.parent.selectedSegment===this};this.select=function(){this.element.addClass("selected")};this.deselect=function(){this.element.removeClass("selected")};this.addStyleForLeft=function(){this.element.addClass("left")};this.removeStyleForLeft=function(){this.element.removeClass("left")};this.addStyleForRight=function(){this.element.addClass("right")};
this.removeStyleForRight=function(){this.element.removeClass("right")};this.handleClick=function(){this.parent.selectSegment(this)};this.init()},CarouselScroller=function(d,c){this.carousel=d;this.element=document.getElementById(c.carouselScrollerId);this.container=new yudu_commonSettings.createjs.Container;this.container.regX=0;this.container.regY=0;this.container.x=0;this.container.y=0;yudu_thumbnailsFunctions.addElementToStage(this.container);this.isDragging=!1;this.getCurrentPosition=function(){return this.container.x};
this.getStartIndex=function(a){a=Math.floor((-1*(this.container.x+("number"===typeof a?a:0))-this.carousel.visibleWidth/2)/(this.carousel.getMaxIconWidth()+this.carousel.getIconPadding()))-1;return Math.max(0,Math.min(a,this.carousel.iconsLength()-this.carousel.maxVisibleIcons))};this.getCentreIndex=function(){var a=-1*this.container.x/(this.carousel.getMaxIconWidth()+this.carousel.getIconPadding())+.5,a=Math.floor(a);return Math.max(0,Math.min(this.carousel.iconsLength(),a))};this.addIcon=function(a){a&&
!a.isVisible&&(a.initialised||(a.init(),$.data(a.htmlElement,"page",a.pageNumber)),a.setOrientation(this.carousel.readerOrientation),a.isVisible=!0,this.element.appendChild(a.htmlElement),this.container.addChild(a.domElement))};this.removeIcon=function(a){a&&a.isVisible&&(a.isVisible=!1,this.element.removeChild(a.htmlElement),this.container.removeChild(a.domElement))};this.updatePositionsFromDeltaX=function(a){a=-1*(this.getCurrentPosition()+a)/this.carousel.getTotalWidth();this.carousel.updatePositions(Math.min(Math.max(a,
0),1))};this.updatePosition=function(a){a*=-1*this.carousel.getTotalWidth();this.updateDisplayedIcons(a-this.container.x);this.container.x=a};this.updateDisplayedIcons=function(a){var b=this.getStartIndex(),c=this.getStartIndex(a);if(b!=c)if(0>a)for(a=b;a<c;a++)this.carousel.moveIconsLeft();else for(a=b;a>c;a--)this.carousel.moveIconsRight()};this.handleScrollerDragStart=function(a){this.carousel.isSpringing=!1;this.isDragging=!0;this.lastDragData={x:a.gesture.deltaX,time:a.gesture.deltaTime}};this.handleScrollerDrag=
function(a){if(this.isDragging){var b=a.gesture.deltaX-this.lastDragData.x;this.previousDragData={x:this.lastDragData.x,time:this.lastDragData.time};this.lastDragData={x:a.gesture.deltaX,time:a.gesture.deltaTime};this.updatePositionsFromDeltaX(b)}};this.handleScrollerDragEnd=function(a){var b=0;this.previousDragData&&(b=(a.gesture.deltaX-this.previousDragData.x)/(a.gesture.deltaTime-this.previousDragData.time));this.isDragging=!1;this.previousDragData=this.lastDragData=null;a.gesture&&(this.carousel.velocity=
Math.min(b*this.carousel.velocityScale,this.carousel.velocityMax),this.carousel.isSpringing=!0)};this.handleTap=function(a){$(a.target).hasClass(c.carouselIconClassName)&&(this.carousel.isSpringing=!1,a=parseInt($.data(a.target,"page")),yudu_commonFunctions.goToPage(a),this.carousel.toggle(!1,!1))};var b;b=$(this.element).hammer({transform_always_block:!0,prevent_default:!0});b.on("drag",yudu_events.callback(this,this.handleScrollerDrag));b.on("dragend",yudu_events.callback(this,this.handleScrollerDragEnd));
b.on("dragstart",yudu_events.callback(this,this.handleScrollerDragStart));b.on("tap",yudu_events.callback(this,this.handleTap))},CarouselProgressBar=function(d,c){this.carousel=d;this.progressIconWidth=40;this.progressBarRelWidth=.8;this.progressBar=document.getElementById(c.carouselProgressBarId);this.progressIcon=document.getElementById(c.carouselProgressIconId);this.progressBackground=$("#"+c.carouselProgressBackgroundId);this.isDragging=!1;this.init=function(){this.progressBackground.on(yudu_commonSettings.clickAction,
yudu_events.callback(this,this.progressBarClicked))};this.progressBarClicked=function(a){if(a=a.pageX||a.originalEvent.pageX)this.carousel.isSpringing=!1,a=(a-this.progressBackground.offset().left)/this.progressBackground.width(),this.carousel.updatePositions(a),this.carousel.displayIcons()};this.updatePosition=function(a){a=a*this.carousel.visibleWidth*this.progressBarRelWidth;this.progressBar.style.width=a+"px";this.progressIcon.style.left=a+(1-this.progressBarRelWidth)/2*this.carousel.visibleWidth-
this.progressIconWidth/2+"px"};this.handleProgressDragStart=function(a){this.carousel.isSpringing=!1;this.isDragging=!0;this.lastDragData={x:a.gesture.deltaX}};this.handleProgressDrag=function(a){if(this.isDragging){var b=a.gesture.deltaX-this.lastDragData.x;this.lastDragData={x:a.gesture.deltaX};this.carousel.updatePositions(Math.min(Math.max((this.carousel.progression*this.carousel.visibleWidth*this.progressBarRelWidth+b)/(this.carousel.visibleWidth*this.progressBarRelWidth),0),1))}};this.handleProgressDragEnd=
function(){this.isDragging=!1;this.lastDragData=null};var b=$(this.progressIcon).hammer({transform_always_block:!0,prevent_default:!0});b.on("drag",yudu_events.callback(this,this.handleProgressDrag));b.on("dragend",yudu_events.callback(this,this.handleProgressDragEnd));b.on("dragstart",yudu_events.callback(this,this.handleProgressDragStart))},CarouselIconLabel=function(d,c){this.carousel=d;this.label=$("#"+c.carouselLabelId);this.updateLabel=function(){var b=this.carousel.iconset(),a;0<b.length&&
(a=this.carousel.getCurrentIconIndex(),a=isNaN(a)?null:b.icons[a]);a?this.setLabel(a):this.resetLabel()};this.setLabel=function(b){this.label.text(b.getLabel())};this.resetLabel=function(){this.label.text("")}},CarouselIconSet=function(d,c){this.carousel=d;this.segment=!1;this.id=c.id;this.label="string"===typeof c.label?c.label:this.id;this.isPrimary=c.isPrimary||!1;this.filterFunction=c.filterFunction||(this.isPrimary?CarouselIconSet.emptyFilterFunction:CarouselIconSet.blockingFilterFunction);this.icons=
[];this.length=0;this.postUpdate=!1;this.init=function(){this.isPrimary?(this.__original_icons=c.icons,this.carousel.primaryIconSets[this.id]=this):this.parent=c.parent;this.__initialised=!0;this.update(!0);this.addListeners()};this.registerAsSegment=function(b){this.segment=b;this.segment.autoHideEnabled&&(this.postUpdate=function(){this.segment.verifyVisibility(0<this.length)})};this.findClosestIconTo=function(b,a){var c=this.getPrimary();if(b.getPrimary().id!==c.id)return 0;var d=b.icons[a],e=
this.icons.indexOf(d);if(0<=e)return e;for(d=c.__original_icons.indexOf(d)-1;0<d;){e=this.icons.indexOf(c.__original_icons[d]);if(0<=e){d=e;break}--d}return 0<d?d:0};this.getPrimary=function(){return this.isPrimary?this:this.parent.getPrimary()};this.isPrimary?(this.includeBasedOnMap=function(b){for(var a=[],c=0;c<this.__original_icons.length;c++){for(var d=!0,e=this.__original_icons[c],f=0;f<b.length;f++)if(!(0,b[f])(e)){d=!1;break}d&&a.push(e)}return a},this.filterIcons=function(b){b.push(this.filterFunction);
this.__initialised||this.init();return this.includeBasedOnMap(b)}):this.filterIcons=function(b){b.push(this.filterFunction);this.__initialised||this.init();return this.parent.filterIcons(b)};this.getFilteredIcons=function(){return this.filterIcons([])};this.update=function(b){if(!b||!this.isPrimary)if(!this.carousel.isVisible||this.segment&&!this.segment.autoHideEnabled&&!this.segment.isSelected())return;var a,c;if(b=this.carousel.isVisible&&(!this.segment||this.segment.isSelected()))a=this.carousel.scroller.getCentreIndex(),
c=this.icons[a];this.icons=this.getFilteredIcons();this.length=this.icons.length;b&&(c=this.icons.indexOf(c),0>c&&(c=Math.min(a,this.length)),this.carousel.progressionFromIconIndex(c),this.carousel.updateVisibleIcons());this.postUpdate&&this.postUpdate()};this.updateIconsCallback=function(){this.update()};this.addListeners=function(){if(c.listeners)for(var b=0;b<c.listeners.length;b++){var a=c.listeners[b];if(a.topic){var d;d=a.callback?yudu_events.callback(this,a.callback):yudu_events.callback(this,
this.updateIconsCallback);yudu_events.subscribe(a.emitter||yudu_events.ALL,a.topic,d,"boolean"===typeof a.async?a.async:!0)}}};this.init()};CarouselIconSet.emptyFilterFunction=function(d){return!0};CarouselIconSet.blockingFilterFunction=function(d){return!1};
var Thumbnail=function(d,c){this.carousel=d;this.isVisible=this.initialised=!1;this.domElement=this.htmlElement=null;this.id=c.id;this.filename=c.filename;this.fileHeight=c.fileHeight;this.fileWidth=c.fileWidth;this.pageNumber=c.pageNumber;this.readerOrientation=c.initialReaderOrientation;this.pageDetailsIndex=c.pageDetailsIndex;this.dimensions=[];this.dimensions[c.initialReaderOrientation]=c.initialDimensions;this.init=function(){this.initialised=!0;this.htmlElement=document.createElement("div");
this.setImage();this.htmlElement.className=c.iconClassName;this.domElement=new yudu_commonSettings.createjs.DOMElement(this.htmlElement);this.setSize()};this.setImage=function(){if(this.initialised){var b=this.htmlElement;window.yudu_thumbnailsFunctions.generateThumbnailUrl(this.filename(),function(a){b.style.backgroundImage="url("+a+")"})}};this.initOrientation=function(b,a){this.dimensions[b]=a};this.setSize=function(){this.initialised&&(this.htmlElement.style.width=this.dimensions[this.readerOrientation].width+
"px",this.htmlElement.style.height=this.dimensions[this.readerOrientation].height+"px",this.domElement.set(this.dimensions[this.readerOrientation]),this.updatePosition())};this.setPosition=function(b){this.domElement.set(b)};this.updatePosition=function(){this.setPosition(this.carousel.calculateIconPosition(this))};this.setOrientation=function(b){b==this.readerOrientation?this.updatePosition():(this.readerOrientation=b,this.setSize())};this.getFileWidth=function(){return this.fileWidth()};this.getFileHeight=
function(){return this.fileHeight()};this.getCurrentHeight=function(){return this.dimensions[this.readerOrientation].height};this.getCurrentWidth=function(){return this.dimensions[this.readerOrientation].width};this.getLabel=function(){if(0==this.pageNumber&&yudu_commonSettings.hasIntroPage)return yudu_thumbnailsSettings.introString;if(yudu_thumbnailsSettings.pagesDetails[this.pageDetailsIndex]&&yudu_thumbnailsSettings.pagesDetails[this.pageDetailsIndex].label()){var b=yudu_thumbnailsSettings.pagesDetails[this.pageDetailsIndex].label();
return(b&&this.carousel.intRegex.test(b)?yudu_thumbnailsSettings.pageString+" ":"")+b}return yudu_thumbnailsSettings.pageString+" "+this.pageNumber}},thumbnailSettings={enableCarouselLabel:!0,enableCarouselProgressBar:!0,enableSegments:!0,enableSegmentAutoHide:!0,carouselContainerId:"thumbnailBar",carouselSegmentedControlsWrapperId:"segmentedBackground",carouselSegmentedControlContainerId:"segmentedController",carouselScrollerId:"thumbnails",carouselProgressBarId:"progressBar",carouselProgressIconId:"progressIcon",
carouselProgressBackgroundId:"progressBackground",carouselLabelId:"pageLabel",carouselIconClassName:"thumbnail",initialIconSizes:[{iconWidthLimit:100,iconHeightLimit:141,iconPadding:20},{iconWidthLimit:100,iconHeightLimit:141,iconPadding:20}],mechanics:{mass:10,dampingCoefficient:-20,velocityMax:1E4,velocityScale:600}},cssFiles=[yudu_commonFunctions.createBrandingPath("thumbnails/style.css")];yudu_commonFunctions.loadCss(cssFiles,function(){(new Thumbnails(thumbnailSettings)).init()});